/*! For license information please see longTextV2.js.LICENSE.txt */
(window.LearnosityAmd=window.LearnosityAmd||[]).push([[65,74],Array(63).concat([function(e,t,r){var a,s;a=[r(1)],void 0===(s=function(e){var t="mathquill-command-id",r="mathquill-block-id",a=Math.min,s=Math.max;function noop(){}var l=[].slice;function variadic(e){var t=e.length-1;return function(){var r=l.call(arguments,0,t),a=l.call(arguments,t);return e.apply(this,r.concat([a]))}}var y=variadic((function(e,t){return variadic((function(r,a){if(e in r)return r[e].apply(r,t.concat(a))}))}));function iterator(e){return variadic((function(t,r){"function"!=typeof t&&(t=y(t));return e.call(this,(function(e){return t.apply(e,[e].concat(r))}))}))}function bind(e){var t=l.call(arguments,1);return function(){return e.apply(this,t)}}function pray(e,t){if(!t)throw new Error("prayer failed: "+e)}var w=function(e,t,r){function isObject(e){return"object"==typeof e}function isFunction(e){return"function"==typeof e}function SuperclassBare(){}return function P(e,r){function C(){var e=new Bare;return isFunction(e.init)&&e.init.apply(e,arguments),e}function Bare(){}void 0===r&&(r=e,e=Object),C.Bare=Bare;var a,s=SuperclassBare.prototype=e.prototype,l=Bare.prototype=C.prototype=C.p=new SuperclassBare;return l.constructor=C,C.mixin=function(e){return Bare.prototype=C.prototype=P(C,e).prototype,C},(C.open=function(r){if(a={},isFunction(r)?a=r.call(C,l,s,C,e):isObject(r)&&(a=r),isObject(a))for(var y in a)t.call(a,y)&&(l[y]=a[y]);return isFunction(l.init)||(l.init=e),C})(r)}}(0,{}.hasOwnProperty),E=MathQuill.L=-1,S=MathQuill.R=1;function prayDirection(e){pray("a direction was passed",e===E||e===S)}var T=w(e,(function(e){e.insDirOf=function(e,t){return e===E?this.insertBefore(t.first()):this.insertAfter(t.last())},e.insAtDirEnd=function(e,t){return e===E?this.prependTo(t):this.appendTo(t)}})),O=w((function(e){e.parent=0,e[E]=0,e[S]=0,e.init=function(e,t,r){this.parent=e,this[E]=t,this[S]=r},this.copy=function(e){return O(e.parent,e[E],e[S])}})),N=w((function(e){e[E]=0,e[S]=0,e.parent=0;var t=0;this.byId={},e.init=function(){this.id=function uniqueNodeId(){return t+=1}(),N.byId[this.id]=this,this.ends={},this.ends[E]=0,this.ends[S]=0},e.dispose=function(){delete N.byId[this.id]},e.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},e.jQ=T(),e.jQadd=function(e){return this.jQ=this.jQ.add(e)},e.jQize=function(e){e=T(e||this.html());function jQadd(e){if(e.getAttribute){var t=e.getAttribute("mathquill-command-id"),r=e.getAttribute("mathquill-block-id");t&&N.byId[t].jQadd(e),r&&N.byId[r].jQadd(e)}for(e=e.firstChild;e;e=e.nextSibling)jQadd(e)}for(var t=0;t<e.length;t+=1)jQadd(e[t]);return e},e.createDir=function(e,t){prayDirection(e);return this.jQize(),this.jQ.insDirOf(e,t.jQ),t[e]=this.adopt(t.parent,t[E],t[S]),this},e.createLeftOf=function(e){return this.createDir(E,e)},e.selectChildren=function(e,t){return B(e,t)},e.bubble=iterator((function(e){for(var t=this;t;t=t.parent){if(!1===e(t))break}return this})),e.postOrder=iterator((function(e){return function recurse(t){t.eachChild(recurse),e(t)}(this),this})),e.isEmpty=function(){return 0===this.ends[E]&&0===this.ends[S]},e.children=function(){return A(this.ends[E],this.ends[S])},e.eachChild=function(){var e=this.children();return e.each.apply(e,arguments),this},e.foldChildren=function(e,t){return this.children().fold(e,t)},e.withDirAdopt=function(e,t,r,a){return A(this,this).withDirAdopt(e,t,r,a),this},e.adopt=function(e,t,r){return A(this,this).adopt(e,t,r),this},e.disown=function(){return A(this,this).disown(),this},e.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}));function prayWellFormed(e,t,r){pray("a parent is always present",e),pray("leftward is properly set up",t?t[S]===r&&t.parent===e:e.ends[E]===r),pray("rightward is properly set up",r?r[E]===t&&r.parent===e:e.ends[S]===t)}var A=w((function(e){e.init=function(e,t,r){if(void 0===r&&(r=E),prayDirection(r),pray("no half-empty fragments",!e==!t),this.ends={},e){pray("withDir is passed to Fragment",e instanceof N),pray("oppDir is passed to Fragment",t instanceof N),pray("withDir and oppDir have the same parent",e.parent===t.parent),this.ends[r]=e,this.ends[-r]=t;var a=this.fold([],(function(e,t){return e.push.apply(e,t.jQ.get()),e}));this.jQ=this.jQ.add(a)}},e.jQ=T(),e.withDirAdopt=function(e,t,r,a){return e===E?this.adopt(t,r,a):this.adopt(t,a,r)},e.adopt=function(e,t,r){prayWellFormed(e,t,r);this.disowned=!1;var a=this.ends[E];if(!a)return this;var s=this.ends[S];return t||(e.ends[E]=a),r?r[E]=s:e.ends[S]=s,this.ends[S][S]=r,this.each((function(r){r[E]=t,r.parent=e,t&&(t[S]=r),t=r})),this},e.disown=function(){var e=this.ends[E];if(!e||this.disowned)return this;this.disowned=!0;var t=this.ends[S],r=e.parent;return prayWellFormed(r,e[E],e),prayWellFormed(r,t,t[S]),e[E]?e[E][S]=t[S]:r.ends[E]=t[S],t[S]?t[S][E]=e[E]:r.ends[S]=e[E],this},e.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},e.each=iterator((function(e){var t=this.ends[E];if(!t)return this;for(;t!==this.ends[S][S];t=t[S]){if(!1===e(t))break}return this})),e.fold=function(e,t){return this.each((function(r){e=t.call(this,e,r)})),e}})),L={},R={},D={},M=w(O,(function(e){e.init=function(e,t){this.parent=e,this.options=t;var r=this.jQ=this._jQ=T('<span class="mq-cursor">&#8203;</span>');this.blink=function(){r.toggleClass("mq-blink")},this.upDownCache={}},e.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[S]?this.selection&&this.selection.ends[E][E]===this[E]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[S].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},e.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=T(),this},e.withDirInsertAt=function(e,t,r,a){t!==this.parent&&this.parent.blur&&this.parent.blur(),this.parent=t,this[e]=r,this[-e]=a},e.insDirOf=function(e,t){return prayDirection(e),this.withDirInsertAt(e,t.parent,t[e],t),this.parent.jQ.addClass("mq-hasCursor"),this.jQ.insDirOf(e,t.jQ),this},e.insLeftOf=function(e){return this.insDirOf(E,e)},e.insRightOf=function(e){return this.insDirOf(S,e)},e.insAtDirEnd=function(e,t){return prayDirection(e),this.withDirInsertAt(e,t,0,t.ends[e]),this.jQ.insAtDirEnd(e,t.jQ),t.focus(),this},e.insAtLeftEnd=function(e){return this.insAtDirEnd(E,e)},e.insAtRightEnd=function(e){return this.insAtDirEnd(S,e)},e.jumpUpDown=function(e,t){this.upDownCache[e.id]=O.copy(this);var r=this.upDownCache[t.id];if(r)r[S]?this.insLeftOf(r[S]):this.insAtRightEnd(r.parent);else{var a=this.offset().left;t.seek(a,this)}},e.offset=function(){var e=this.jQ.removeClass("mq-cursor").offset();return this.jQ.addClass("mq-cursor"),e},e.unwrapGramp=function(){var e=this.parent.parent,t=e.parent,r=e[S],a=e[E];if(e.disown().eachChild((function(s){s.isEmpty()||(s.children().adopt(t,a,r).each((function(t){t.jQ.insertBefore(e.jQ.first())})),a=s.ends[S])})),!this[S])if(this[E])this[S]=this[E][S];else for(;!this[S];){if(this.parent=this.parent[S],!this.parent){this[S]=e[S],this.parent=t;break}this[S]=this.parent.ends[E]}this[S]?this.insLeftOf(this[S]):this.insAtRightEnd(t),e.jQ.remove(),e[E].siblingDeleted&&e[E].siblingDeleted(this.options,S),e[S].siblingDeleted&&e[S].siblingDeleted(this.options,E)},e.startSelection=function(){for(var e=this.anticursor=O.copy(this),t=e.ancestors={},r=e;r.parent;r=r.parent)t[r.parent.id]=r},e.endSelection=function(){delete this.anticursor},e.select=function(){var e=this.anticursor;if(this[E]===e[E]&&this.parent===e.parent)return!1;for(var t=this;t.parent;t=t.parent)if(t.parent.id in e.ancestors){var r=t.parent;break}pray("cursor and anticursor in the same tree",r);var a,s,l=e.ancestors[r.id],y=S;if(t[E]!==l)for(var w=t;w;w=w[S])if(w[S]===l[S]){y=E,a=t,s=l;break}return y===S&&(a=l,s=t),a instanceof O&&(a=a[S]),s instanceof O&&(s=s[E]),this.hide().selection=r.selectChildren(a,s),this.insDirOf(y,this.selection.ends[y]),this.selectionChanged(),!0},e.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},e.deleteSelection=function(){this.selection&&(this[E]=this.selection.ends[E][E],this[S]=this.selection.ends[S][S],this.selection.remove(),this.selectionChanged(),delete this.selection)},e.replaceSelection=function(){var e=this.selection;return e&&(this[E]=e.ends[E][E],this[S]=e.ends[S][S],delete this.selection),e},e.depth=function(){for(var e=this,t=0;e=e.parent;)t+=e instanceof J?1:0;return t},e.isTooDeep=function(e){if(void 0!==this.options.maxDepth)return this.depth()+(e||0)>this.options.maxDepth}})),B=w(A,(function(e,t){e.init=function(){t.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},e.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),t.adopt.apply(this,arguments)},e.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},e.join=function(e){return this.fold("",(function(t,r){return t+r[e]()}))}})),q=w((function(e){e.init=function(e,t,r){this.API=e,this.root=t,this.container=r,e.__controller=t.controller=this,this.cursor=t.cursor=M(t,e.__options),this.setUnitalicizedTextCmds()},e.setUnitalicizedTextCmds=function(){de={};var e=this.API.__options.unItalicizedTextCmds||[];if(e instanceof Array){for(var t=0;t<e.length;t+=1)de[e[t]]=1;this.API.__options.unItalicizedTextCmds=de}else!e||e instanceof Array||(de=this.API.__options.unItalicizedTextCmds)},e.handle=function(e,t){var r=this.API.__options.handlers;r&&r[e]&&(t===E||t===S?r[e](t,this.API):r[e](this.API))};var t=[];this.onNotify=function(e){t.push(e)},e.notify=function(){for(var e=0;e<t.length;e+=1)t[e].apply(this.cursor,arguments);return this}}));function MathQuill(e){if(!e||!e.nodeType)return null;var t=T(e).children(".mq-root-block").attr(r);return t?N.byId[t].controller.API:null}function APIFnFor(e){function APIFn(t,r){var a=MathQuill(t);return a instanceof e||!t||!t.nodeType?a:e(T(t),r)}return APIFn.prototype=e.prototype,APIFn}var W=w(),j={};MathQuill.__options=W.p;var H=w((function(a){a.init=function(){throw"wtf don't call me, I'm 'abstract'"},a.initRoot=function(a,s,l){this.__options=W(),this.config(l);var y=q(this,a,s);y.createTextarea();var w=s.contents().detach();a.jQ=T('<span class="mq-root-block"/>').attr(r,a.id).toggleClass("mq-disable-italics",!!l&&!!l.disableItalics).appendTo(s),this.latex(w.text()),this.revert=function(){return s.find("["+t+"]").each((function(){var e=N.byId[T(this).attr(t)];e&&e.remove()})),s.find("["+r+"]").each((function(){var e=N.byId[T(this).attr(r)];e&&e.dispose()})),s.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(w),e.each(N.byId,(function(e,t){t.jQ&&t.jQ.length&&3!==t.jQ[0].nodeType||t.dispose()})),e.each(y,(function(e,t){t instanceof T&&t.off(),delete y[e]})),s}},a.config=MathQuill.config=function(e){for(var t in e)if(e.hasOwnProperty(t)){var r=e[t],a=j[t];this.__options[t]=a?a(r):r}return this},a.el=function(){return this.__controller.container[0]},a.text=function(){return this.__controller.exportText()},a.latex=function(e){return arguments.length>0?(this.__controller.renderLatexMath(e),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},a.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},a.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}));MathQuill.prototype=H.prototype,MathQuill.StaticMath=APIFnFor(w(H,(function(e,t){e.init=function(e){this.initRoot(J(),e.addClass("mq-math-mode")),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents()},e.latex=function(){var e=t.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[]),e}})));var V=MathQuill.EditableField=w(H,(function(e){e.initRootAndEvents=function(e,t,r){this.initRoot(e,t,r),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents()},e.focus=function(){return this.__controller.textarea.focus(),this},e.blur=function(){return this.__controller.textarea.blur(),this},e.write=function(e){return this.__controller.writeLatex(e),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},e.clear=function(){return this.select().__controller.backspace(),this},e.cmd=function(e){var t=this.__controller.notify(),r=t.cursor;/^\\[a-z]+$/i.test(e)&&!r.isTooDeep()?(e=e.slice(1),e=(L[e]||$e[e]||Ge)(e),r.selection&&e.replaces(r.replaceSelection()),e.createLeftOf(r.show())):r.parent.write(r,e);return t.blurred&&r.hide().parent.blur(),this},e.select=function(){var e=this.__controller;for(e.notify("move").cursor.insAtRightEnd(e.root);e.cursor[E];)e.selectLeft();return this},e.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},e.moveToDirEnd=function(e){return this.__controller.notify("move").cursor.insAtDirEnd(e,this.__controller.root),this},e.moveToLeftEnd=function(){return this.moveToDirEnd(E)},e.moveToRightEnd=function(){return this.moveToDirEnd(S)},e.keystroke=function(e){e=e.replace(/^\s+|\s+$/g,"").split(/\s+/);for(var t=0;t<e.length;t+=1)this.__controller.keystroke(e[t],{preventDefault:noop});return this},e.typedText=function(e){for(var t=0;t<e.length;t+=1)this.__controller.typedText(e.charAt(t));return this}}));function RootBlockMixin(e){for(var t="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf reflow".split(" "),r=0;r<t.length;r+=1)!function(t){e[t]=function(e){this.controller.handle(t,e)}}(t[r])}var z,U=w((function(e,t,r){function parseError(e,t){throw"Parse Error: "+t+" at "+(e=e?"'"+e+"'":"EOF")}e.init=function(e){this._=e},e.parse=function(e){return this.skip(l)._(""+e,(function success(e,t){return t}),parseError)},e.or=function(e){pray("or is passed a parser",e instanceof r);var t=this;return r((function(r,a,s){return t._(r,a,(function failure(t){return e._(r,a,s)}))}))},e.then=function(e){var t=this;return r((function(a,s,l){return t._(a,(function success(t,a){var y=e instanceof r?e:e(a);return pray("a parser is returned",y instanceof r),y._(t,s,l)}),l)}))},e.many=function(){var e=this;return r((function(t,r,a){for(var s=[];e._(t,success,failure););return r(t,s);function success(e,r){return t=e,s.push(r),!0}function failure(){return!1}}))},e.times=function(e,t){arguments.length<2&&(t=e);var a=this;return r((function(r,s,l){for(var y,w=[],E=!0,S=0;S<e;S+=1)if(!(E=a._(r,success,firstFailure)))return l(r,y);for(;S<t&&E;S+=1)E=a._(r,success,secondFailure);return s(r,w);function success(e,t){return w.push(t),r=e,!0}function firstFailure(e,t){return y=t,r=e,!1}function secondFailure(e,t){return!1}}))},e.result=function(e){return this.then(s(e))},e.atMost=function(e){return this.times(0,e)},e.atLeast=function(e){var t=this;return t.times(e).then((function(e){return t.many().map((function(t){return e.concat(t)}))}))},e.map=function(e){return this.then((function(t){return s(e(t))}))},e.skip=function(e){return this.then((function(t){return e.result(t)}))};this.string=function(e){var t=e.length,a="expected '"+e+"'";return r((function(r,s,l){var y=r.slice(0,t);return y===e?s(r.slice(t),y):l(r,a)}))};var a=this.regex=function(e){pray("regexp parser is anchored","^"===e.toString().charAt(1));var t="expected "+e;return r((function(r,a,s){var l=e.exec(r);if(l){var y=l[0];return a(r.slice(y.length),y)}return s(r,t)}))},s=r.succeed=function(e){return r((function(t,r){return r(t,e)}))},l=(r.fail=function(e){return r((function(t,r,a){return a(t,e)}))},r.letter=a(/^[a-z]/i),r.letters=a(/^[a-z]*/i),r.digit=a(/^[0-9]/),r.digits=a(/^[0-9]*/),r.whitespace=a(/^\s+/),r.optWhitespace=a(/^\s*/),r.any=r((function(e,t,r){return e?t(e.slice(1),e.charAt(0)):r(e,"expected any character")})),r.all=r((function(e,t,r){return t("",e)})),r.eof=r((function(e,t,r){return e?r(e,"expected EOF"):t(e,e)})))})),G=(z={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"},function saneKeyboardEvents(t,r){var a,s=null,l=null,y=e(t),w=e(r.container||y),E=noop;function checkTextareaFor(e){E=e,clearTimeout(a),a=setTimeout(e)}w.bind("keydown keypress input keyup focusout paste",(function(){E()}));var S=!1;function handleKey(){r.keystroke(function stringify(e){var t,r=e.which||e.keyCode,a=z[r],s=[];return e.ctrlKey&&s.push("Ctrl"),e.originalEvent&&e.originalEvent.metaKey&&s.push("Meta"),e.altKey&&s.push("Alt"),e.shiftKey&&s.push("Shift"),t=a||String.fromCharCode(r),s.length||a?(s.push(t),s.join("-")):t}(s),s)}function typedText(){if(!function hasSelection(){var e=y[0];return"selectionStart"in e&&e.selectionStart!==e.selectionEnd}()){var e=y.val();1===e.length?(y.val(""),r.typedText(e)):e&&y[0]&&y[0].select&&y[0].select()}}function pastedText(){var e=y.val();y.val(""),e&&(e=(e=e.replace(/\^\{\{response\}\}/g,"^{}")).replace(/\{\{response\}\}/g,""),r.paste(e))}return w.bind({keydown:function onKeydown(e){s=e,l=null,S&&checkTextareaFor((function(){y[0]&&y[0].select&&y[0].select(),E=noop,clearTimeout(a)})),handleKey()},keypress:function onKeypress(e){s&&l&&handleKey(),l=e,checkTextareaFor(typedText)},focusout:function onBlur(){s=l=null},paste:function onPaste(e){y.focus(),checkTextareaFor(pastedText)}}),{select:function select(e){E(),E=noop,clearTimeout(a),y.val(e),e&&y[0]&&y[0].select&&y[0].select(),S=!!e}}});q.open((function(e,t){e.exportText=function(){return this.root.foldChildren("",(function(e,t){return e+t.text()}))}})),q.open((function(e){e.focusBlurEvents=function(){var e,t=this,r=t.root,a=t.cursor;function windowBlur(){clearTimeout(e),a.selection&&a.selection.jQ.addClass("mq-blur"),blur()}function blur(){a.hide().parent.blur(),t.root&&t.root.jQ.removeClass("mq-focused"),T(window).off("blur",windowBlur)}t.textarea.focus((function(){t.blurred=!1,clearTimeout(e),r.ultimateRoot&&r.ultimateRoot.jQ.find(".mq-last-focused").removeClass("mq-last-focused"),t.container.children(".mq-root-block").addClass("mq-focused mq-last-focused"),a.parent||a.insAtRightEnd(r),a.selection?(a.selection.jQ.removeClass("mq-blur"),t.selectionChanged()):a.show(),t.setUnitalicizedTextCmds()})).blur((function(){t.blurred=!0,e=setTimeout((function(){r.postOrder("intentionalBlur"),a.clearSelection(),blur()})),T(window).on("blur",windowBlur)})),t.blurred=!0,a.hide().parent.blur()}})),q.open((function(e){e.keystroke=function(e,t){this.cursor.parent.keystroke(e,t,this)}})),N.open((function(e){e.keystroke=function(e,t,r){var a=r.cursor;switch(e){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":for(;a[E]||a.selection;)r.backspace();break;case"Shift-Backspace":case"Backspace":r.backspace();break;case"Esc":return;case"Shift-Esc":return void r.escapeDir(E,e,t);case"End":r.notify("move").cursor.insAtRightEnd(a.parent);break;case"Ctrl-End":r.notify("move").cursor.insAtRightEnd(r.root);break;case"Shift-End":for(;a[S];)r.selectRight();break;case"Ctrl-Shift-End":for(;a[S]||a.parent!==r.root;)r.selectRight();break;case"Home":r.notify("move").cursor.insAtLeftEnd(a.parent);break;case"Ctrl-Home":r.notify("move").cursor.insAtLeftEnd(r.root);break;case"Shift-Home":for(;a[E];)r.selectLeft();break;case"Ctrl-Shift-Home":for(;a[E]||a.parent!==r.root;)r.selectLeft();break;case"Left":r.moveLeft();break;case"Shift-Left":r.selectLeft();break;case"Ctrl-Left":break;case"Right":r.moveRight();break;case"Shift-Right":r.selectRight();break;case"Ctrl-Right":break;case"Up":r.moveUp();break;case"Down":r.moveDown();break;case"Shift-Up":if(a[E])for(;a[E];)r.selectLeft();else r.selectLeft();case"Shift-Down":if(a[S])for(;a[S];)r.selectRight();else r.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":for(;a[S]||a.selection;)r.deleteForward();break;case"Shift-Del":case"Del":r.deleteForward();break;case"Meta-A":case"Ctrl-A":for(r.notify("move").cursor.insAtRightEnd(r.root);a[E];)r.selectLeft();break;default:return}t.preventDefault(),r.scrollHoriz()},e.moveOutOf=e.moveTowards=e.deleteOutOf=e.deleteTowards=e.unselectInto=e.selectOutOf=e.selectTowards=function(){pray("overridden or never called on this node")}})),q.open((function(e){function moveUpDown(e,t){var r=e.notify("upDown").cursor,a=t+"Into",s=t+"OutOf";return r[S][a]?r.insAtLeftEnd(r[S][a]):r[E][a]?r.insAtRightEnd(r[E][a]):r.parent.bubble((function(e){var t=e[s];if(t&&("function"==typeof t&&(t=e[s](r)),t instanceof N&&r.jumpUpDown(e,t),!0!==t))return!1})),e}this.onNotify((function(e){"move"!==e&&"upDown"!==e||this.show().clearSelection()})),e.escapeDir=function(e,t,r){prayDirection(e);var a=this.cursor;if(a.parent!==this.root&&r.preventDefault(),a.parent!==this.root)return a.parent.moveOutOf(e,a),this.notify("move")},j.leftRightIntoCmdGoes=function(e){if(e&&"up"!==e&&"down"!==e)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+e+'"';return e},e.moveDir=function(e){prayDirection(e);var t=this.cursor,r=t.options.leftRightIntoCmdGoes;return t.selection?t.insDirOf(e,t.selection.ends[e]):t[e]?t[e].moveTowards(e,t,r):t.parent.moveOutOf(e,t,r),this.notify("move")},e.moveLeft=function(){return this.moveDir(E)},e.moveRight=function(){return this.moveDir(S)},e.moveUp=function(){return moveUpDown(this,"up")},e.moveDown=function(){return moveUpDown(this,"down")},this.onNotify((function(e){"upDown"!==e&&(this.upDownCache={})})),this.onNotify((function(e){"edit"===e&&this.show().deleteSelection()})),e.deleteDir=function(e){prayDirection(e);var t=this.cursor,r=t.selection;return this.notify("edit"),r||(t[e]?t[e].deleteTowards(e,t):t.parent.deleteOutOf(e,t)),t[E].siblingDeleted&&t[E].siblingDeleted(t.options,S),t[S].siblingDeleted&&t[S].siblingDeleted(t.options,E),t.parent.bubble("reflow"),this},e.backspace=function(){return this.deleteDir(E)},e.deleteForward=function(){return this.deleteDir(S)},this.onNotify((function(e){"select"!==e&&this.endSelection()})),e.selectDir=function(e){var t=this.notify("select").cursor,r=t.selection;prayDirection(e),t.anticursor||t.startSelection();var a=t[e];a?r&&r.ends[e]===a&&t.anticursor[-e]!==a?a.unselectInto(e,t):a.selectTowards(e,t):t.parent.selectOutOf(e,t),t.clearSelection(),t.select()||t.show()},e.selectLeft=function(){return this.selectDir(E)},e.selectRight=function(){return this.selectDir(S)}}));var K=function(){function joinBlocks(e){for(var t=e[0]||J(),r=1;r<e.length;r+=1)e[r].children().adopt(t,t.ends[S],0);return t}var e=U.string,t=U.regex,r=U.letter,a=U.any,s=U.optWhitespace,l=U.succeed,y=U.fail,w=r.map((function(e){return ce(e)})),E=t(/^[^${}\\_^]/).map((function(e){return X(e)})),T=t(/^\\not\\[a-z]+/).then((function(e){return D[e]&&D[e]().parser()||y("unknown compound command: "+e)})),O=t(/^[^\\a-eg-zA-Z]/).or(e("\\").then(t(/^[a-z]+/i).or(t(/^\s+/).result(" ")).or(a))).then((function(e){var t=L[e];return t?t(e).parser():y("unknown command: \\"+e)})),N=e("\\").then(t(/^(?!end\b)\w+/)).then((function(e){return L[e]?y("recognised command: \\"+e):Ge(e).parser()})),A=T.or(O).or(w).or(E).or(N),R=e("{").then((function(){return B})).skip(e("}")),M=s.then(R.or(A.map((function commandToBlock(e){var t=J();return e.adopt(t,0,0),t})))),B=M.many().map(joinBlocks).skip(s),q=e("[").then(M.then((function(e){return"]"!==e.join("latex")?l(e):y()})).many().map(joinBlocks).skip(s)).skip(e("]")),W=B;return W.block=M,W.optBlock=q,W}();q.open((function(e,t){e.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},j.maxDepth=function(e){return"number"==typeof e?e:void 0},e.writeLatex=function(e){var t=this.notify("edit").cursor,r=U.all,a=U.eof;this.setUnitalicizedTextCmds();var s=K.skip(a).or(r.result(!1)).parse(e);s&&!s.isEmpty()&&s.prepareInsertionAt(t)&&(s.children().adopt(t.parent,t[E],t[S]),s.jQize().insertBefore(t.jQ),t[E]=s.ends[S],s.finalizeInsert(t.options,t),s.ends[S][S].siblingCreated&&s.ends[S][S].siblingCreated(t.options,E),s.ends[E][E].siblingCreated&&s.ends[E][E].siblingCreated(t.options,S),t.parent.bubble("reflow"));return this},e.renderLatexMath=function(e){var t=this.root,r=this.cursor,a=t.jQ,s=U.all,l=U.eof,y=K.skip(l).or(s.result(!1)).parse(e);if(t.eachChild("postOrder","dispose"),t.ends[E]=t.ends[S]=0,y&&y.prepareInsertionAt(r)){y.children().adopt(t,0,0);var w=y.join("html");a.html(w),t.jQize(a.children()),t.finalizeInsert(r.options)}else a.empty();delete r.selection,r.insAtRightEnd(t)},e.renderLatexText=function(e){var t=this.root,r=this.cursor;t.jQ.children().slice(1).remove(),t.eachChild("postOrder","dispose"),t.ends[E]=t.ends[S]=0,delete r.selection,r.show().insAtRightEnd(t);var a=U.regex,s=U.string,l=U.eof,y=U.all,w=s("$").then(K).skip(s("$").or(l)).map((function(e){var t=re(r);t.createBlocks();var a=t.ends[E];return e.children().adopt(a,0,0),t})),T=s("\\$").result("$").or(a(/^[^$]/)).map(X),O=w.or(T).many().skip(l).or(y.result(!1)).parse(e);if(O){for(var N=0;N<O.length;N+=1)O[N].adopt(t,t.ends[S],0);t.jQize().appendTo(t.jQ),t.finalizeInsert(r.options)}}})),q.open((function(e){e.delegateMouseEvents=function(){var e=this.root.jQ;this.container.bind("mousedown.mathquill",(function(t){var a=T(t.target).closest(".mq-root-block"),s=N.byId[a.attr(r)||e.attr(r)].controller,l=s.cursor,y=(l.blink,s.textareaSpan),w=s.textarea;function mousemove(e){l.anticursor||l.startSelection(),s.seek(T(e.target),e.pageX,e.pageY).cursor.select(),e.target&&T(e.target.ownerDocument).unbind("mousemove",docmousemove)}function docmousemove(e){return delete e.target,mousemove(e)}if(0===y.parent().length)return!1;s.blurred&&(s.editable||a.prepend(y),document.body.focus(),w.focus()),t.preventDefault(),t.target.unselectable=!0,l.show(),s.seek(T(t.target),t.pageX,t.pageY).cursor.startSelection(),a.mousemove(mousemove),T(t.target.ownerDocument).mousemove(docmousemove).mouseup((function mouseup(e){l.selection||s.editable||y.detach(),a.unbind("mousemove",mousemove),T(e.target.ownerDocument).unbind("mousemove",docmousemove).unbind("mouseup",mouseup)}))}))}})),q.open((function(e){e.seek=function(e,a,s){var l=this.notify("select").cursor;if(e){var y=e.attr(r)||e.attr(t);if(!y){var w=e.parent();y=w.attr(r)||w.attr(t)}}var E=y?N.byId[y]:this.root;return pray("nodeId is the id of some Node that exists",E),l.clearSelection().show(),E.seek(a,l),this.scrollHoriz(),this}})),q.open((function(e){e.scrollHoriz=function(){var e=this.cursor,t=e.selection,r=this.root.jQ[0].getBoundingClientRect();if(t){var a=t.jQ[0].getBoundingClientRect(),s=a.left-(r.left+20),l=a.right-(r.right-20);if(t.ends[E]===e[S])if(s<0)w=s;else{if(!(l>0))return;if(a.left-l<r.left+20)w=s;else w=l}else if(l>0)w=l;else{if(!(s<0))return;if(a.right-s>r.right-20)w=l;else w=s}}else{var y=e.jQ[0].getBoundingClientRect().left;if(y>r.right-20)var w=y-(r.right-20);else{if(!(y<r.left+20))return;var w=y-(r.left+20)}}this.root.jQ.stop().animate({scrollLeft:"+="+w},100)}})),q.open((function(t){W.p.substituteTextarea=function(){return T("<textarea>")[0]},t.createTextarea=function(){var e=this.textareaSpan=T('<span class="mq-textarea"></span>'),t=this.API.__options.substituteTextarea();if(!t.nodeType)throw"substituteTextarea() must return a DOM element, got "+t;t=this.textarea=T(t).appendTo(e);var r=this;r.cursor.selectionChanged=function(){r.selectionChanged()},r.container.bind("copy",(function(){r.setTextareaSelection()}))},t.selectionChanged=function(){var e=this;Ee(e.container[0]),void 0===e.textareaSelectionTimeout&&(e.textareaSelectionTimeout=setTimeout((function(){e.setTextareaSelection()})))},t.setTextareaSelection=function(){this.textareaSelectionTimeout=void 0;var e="";this.cursor.selection&&(e=this.cursor.selection.join("latex"),this.API.__options.statelessClipboard&&(e="$"+e+"$")),this.selectFn(e)},t.staticMathTextareaEvents=function(){var t=this,r=(t.root,t.cursor),a=t.textarea,s=t.textareaSpan;function detach(){s.detach(),t.blurred=!0}this.container.prepend(e('<span class="mq-selectable">').text("$"+t.exportLatex()+"$")),t.blurred=!0,a.bind("cut paste",!1).focus((function(){t.blurred=!1})).blur((function(){r.selection&&r.selection.clear(),setTimeout(detach)})),t.selectFn=function(e){a.val(e),e&&a.select()}},t.editablesTextareaEvents=function(){var e=this,t=(e.root,e.cursor),r=e.textarea,a=e.textareaSpan,s=G(r,this);this.selectFn=function(e){s.select(e)},this.container.prepend(a).on("cut",(function(r){t.selection&&setTimeout((function(){e.notify("edit"),t.parent.bubble("reflow")}))})),this.focusBlurEvents()},t.typedText=function(e){if("\n"===e)return this.handle("enter");var t=this.notify().cursor;t.parent.write(t,e),this.scrollHoriz()},t.paste=function(e){this.API.__options.statelessClipboard&&(e="$"===e.slice(0,1)&&"$"===e.slice(-1)?e.slice(1,-1):"\\text{"+e+"}"),this.writeLatex(e).cursor.show()}}));var $=w(N,(function(e,t){e.finalizeInsert=function(e,t){this.postOrder("finalizeTree",e),this.postOrder("contactWeld",t),this.postOrder("blur"),this.postOrder("reflow"),this[S].siblingCreated&&this[S].siblingCreated(e,E),this[E].siblingCreated&&this[E].siblingCreated(e,S),this.bubble("reflow")},e.prepareInsertionAt=function(e){var t=e.options.maxDepth;if(void 0!==t){var r=e.depth();if(r>t)return!1;this.removeNodesDeeperThan(t-r)}return!0},e.removeNodesDeeperThan=function(e){for(var t,r=0,a=[[this,r]];a.length;)(t=a.shift())[0].children().each((function(s){var l=s instanceof J?1:0;(r=t[1]+l)<=e?a.push([s,r]):(l?s.children():s).remove()}))}})),Q=w($,(function(e,t){e.init=function(e,r,a){t.init.call(this),this.ctrlSeq||(this.ctrlSeq=e),r&&(this.htmlTemplate=r),a&&(this.textTemplate=a)},e.replaces=function(e){e.disown(),this.replacedFragment=e},e.isEmpty=function(){return this.foldChildren(!0,(function(e,t){return e&&t.isEmpty()}))},e.parser=function(){var e=K.block,t=this;return e.times(t.numBlocks()).map((function(e){t.blocks=e;for(var r=0;r<e.length;r+=1)e[r].adopt(t,t.ends[S],0);return t}))},e.createLeftOf=function(e){var r=this.replacedFragment;this.createBlocks(),t.createLeftOf.call(this,e),r&&(r.adopt(this.ends[E],0,0),r.jQ.appendTo(this.ends[E].jQ),this.placeCursor(e),this.prepareInsertionAt(e)),this.finalizeInsert(e.options),this.placeCursor(e)},e.createBlocks=function(){for(var e=this.numBlocks(),t=this.blocks=Array(e),r=0;r<e;r+=1){(t[r]=J()).adopt(this,this.ends[S],0)}},e.placeCursor=function(e){e.insAtRightEnd(this.foldChildren(this.ends[E],(function(e,t){return e.isEmpty()?e:t})))},e.moveTowards=function(e,t,r){var a=r&&this[r+"Into"];t.insAtDirEnd(-e,a||this.ends[-e])},e.deleteTowards=function(e,t){t.startSelection(),this.selectTowards(e,t),t.select()},e.selectTowards=function(e,t){t[-e]=this,t[e]=this[e]},e.selectChildren=function(){return B(this,this)},e.unselectInto=function(e,t){t.insAtDirEnd(-e,t.anticursor.ancestors[this.id])},e.seek=function(e,t){function getBounds(e){var t={};return t[E]=e.jQ.offset().left,t[S]=t[E]+e.jQ.outerWidth(),t}var r=this,a=getBounds(r);if(e<a[E])return t.insLeftOf(r);if(e>a[S])return t.insRightOf(r);var s=a[E];r.eachChild((function(l){var y=getBounds(l);return e<y[E]?(e-s<y[E]-e?l[E]?t.insAtRightEnd(l[E]):t.insLeftOf(r):t.insAtLeftEnd(l),!1):e>y[S]?void(l[S]?s=y[S]:a[S]-e<e-y[S]?t.insRightOf(r):t.insAtRightEnd(l)):(l.seek(e,t),!1)}))},e.numBlocks=function(){var e=this.htmlTemplate.match(/&\d+/g);return e?e.length:0},e.html=function(){var e=this.blocks,t=" mathquill-command-id="+this.id,r=this.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);pray("no unmatched angle brackets",r.join("")===this.htmlTemplate);for(var a=0,s=r[0];s;s=r[a+=1])if("/>"===s.slice(-2))r[a]=s.slice(0,-2)+t+"/>";else if("<"===s.charAt(0)){pray("not an unmatched top-level close tag","/"!==s.charAt(1)),r[a]=s.slice(0,-1)+t+">";var l=1;do{pray("no missing close tags",s=r[a+=1]),"</"===s.slice(0,2)?l-=1:"<"===s.charAt(0)&&"/>"!==s.slice(-2)&&(l+=1)}while(l>0)}return r.join("").replace(/>&(\d+)/g,(function(t,r){return" mathquill-block-id="+e[r].id+">"+e[r].join("html")}))},e.latex=function(){return this.foldChildren(this.ctrlSeq,(function(e,t){return e+"{"+(t.latex()||" ")+"}"}))},e.textTemplate=[""],e.text=function(){var e=this,t=0;return e.foldChildren(e.textTemplate[t],(function(r,a){t+=1;var s=a.text();return r&&"("===e.textTemplate[t]&&"("===s[0]&&")"===s.slice(-1)?r+s.slice(1,-1)+e.textTemplate[t]:r+a.text()+(e.textTemplate[t]||"")}))}})),Y=w(Q,(function(e,t){e.init=function(e,r,a){a||(a=e&&e.length>1?e.slice(1):e),t.init.call(this,e,r,[a])},e.parser=function(){return U.succeed(this)},e.numBlocks=function(){return 0},e.replaces=function(e){e.remove()},e.createBlocks=noop,e.moveTowards=function(e,t){t.jQ.insDirOf(e,this.jQ),t[-e]=this,t[e]=this[e]},e.deleteTowards=function(e,t){t[e]=this.remove()[e]},e.seek=function(e,t){e-this.jQ.offset().left<this.jQ.outerWidth()/2?t.insLeftOf(this):t.insRightOf(this)},e.latex=function(){return this.ctrlSeq},e.text=function(){return this.textTemplate},e.placeCursor=noop,e.isEmpty=function(){return!0}})),X=w(Y,(function(e,t){e.init=function(e,r){t.init.call(this,e,"<span>"+(r||e)+"</span>")}})),Z=w(Y,(function(e,t){e.init=function(e,r,a){t.init.call(this,e,'<span class="mq-binary-operator">'+r+"</span>",a)}})),J=w($,(function(e,t){e.join=function(e){return this.foldChildren("",(function(t,r){return t+r[e]()}))},e.html=function(){return this.join("html")},e.latex=function(){return this.join("latex")},e.text=function(){return this.ends[E]===this.ends[S]&&0!==this.ends[E]?this.ends[E].text():this.join("text")},e.keystroke=function(e,r,a){return!a.API.__options.spaceBehavesLikeTab||"Spacebar"!==e&&"Shift-Spacebar"!==e?t.keystroke.apply(this,arguments):(r.preventDefault(),void a.escapeDir("Shift-Spacebar"===e?E:S,e,r))},e.moveOutOf=function(e,t,r){!(r&&this.parent[r+"Into"])&&this[e]?t.insAtDirEnd(-e,this[e]):t.insDirOf(e,this.parent)},e.selectOutOf=function(e,t){t.insDirOf(e,this.parent)},e.deleteOutOf=function(e,t){t.unwrapGramp()},e.seek=function(e,t){var r=this.ends[S];if(!r||r.jQ.offset().left+r.jQ.outerWidth()<e)return t.insAtRightEnd(this);if(e<this.ends[E].jQ.offset().left)return t.insAtLeftEnd(this);for(;e<r.jQ.offset().left;)r=r[E];return r.seek(e,t)},e.chToCmd=function(e,t){var r;return e.match(/^[a-eg-zA-Z]$/)?ce(e):/^\d$/.test(e)?se(e):(r=R[e]||L[e])?r(e):X(e)},e.write=function(e,t){var r=this.chToCmd(t,e.options);e.selection&&r.replaces(e.replaceSelection()),e.isTooDeep()||r.createLeftOf(e.show())},e.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},e.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}})),ee=w(J,RootBlockMixin);MathQuill.MathField=APIFnFor(w(V,(function(e,t){e.init=function(e,t){e.addClass("mq-editable-field mq-math-mode"),this.initRootAndEvents(ee(),e,t)}}))),MathQuill.InertMath=APIFnFor(w(H,(function(e){e.init=function(e,t){this.initRoot(J(),e.addClass("mq-math-mode"),t),this.__controller.staticMathTextareaEvents()}}))),MathQuill.StaticMathWithEditables=APIFnFor(w(H,(function(t){t.init=function(e,t){this.initRoot(J(),e.addClass("mq-math-mode"),t),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents()},t.withActiveNode=function(e){var t=this.__controller.container.find(".mq-inner-editable .mq-root-block"),a=t.filter(".mq-last-focused"),s=a.length?a.eq(0):t.eq(0),l=N.byId[s.attr(r)];l&&(l.__controller=l.__controller||l.controller,e(l))},t.write=function(e){return this.withActiveNode((function(t){return V.prototype.write.call(t,e)})),this},t.cmd=function(e){return this.withActiveNode((function(t){return V.prototype.cmd.call(t,e)})),this},t.clear=function(){return this.withActiveNode((function(e){V.prototype.clear.call(e)})),this},t.keystroke=function(e){return this.withActiveNode((function(t){return V.prototype.keystroke.call(t,e)})),this},t.editables=function(){return this.__controller.container.find(".mq-inner-editable .mq-root-block").sort((function(e,t){return parseInt(T(e).attr("mathquill-block-id"))>parseInt(T(t).attr("mathquill-block-id"))?1:-1})).map((function(){var t=N.byId[e(this).attr(r)],a=e(this).hasClass("mq-focused");return{latex:t.latex(),active:a}})).get()},t.typedText=function(e){return this.withActiveNode((function(t){return V.prototype.typedText.call(t,e)})),this}})));var te=w(N,(function(e,t){function fuseChildren(e){e.jQ[0].normalize();var t=e.jQ.contents().filter((function(e,t){return 3===t.nodeType}))[0];t||(t={data:""});var r=ne(t.data);return r.jQadd(t),e.children().disown(),r.adopt(e,0,0)}e.ctrlSeq="\\text",e.replaces=function(e){e instanceof A?this.replacedText=e.remove().jQ.text():"string"==typeof e&&(this.replacedText=e)},e.jQadd=function(e){t.jQadd.call(this,e),this.ends[E]&&this.ends[E].jQadd(this.jQ[0].firstChild)},e.createLeftOf=function(e){if(t.createLeftOf.call(this,e),this[S].siblingCreated&&this[S].siblingCreated(e.options,E),this[E].siblingCreated&&this[E].siblingCreated(e.options,S),this.bubble("reflow"),e.insAtRightEnd(this),this.replacedText)for(var r=0;r<this.replacedText.length;r+=1)this.write(e,this.replacedText.charAt(r))},e.parser=function(){var e=this,t=U.string,r=U.regex;return U.optWhitespace.then(t("{")).then(r(/^[^}]*/)).skip(t("}")).map((function(t){if(t.length&&de.hasOwnProperty(t)){for(var r=J(),a=0;a<t.length;a+=1)ce(t.charAt(a)).adopt(r,r.ends[S],0);return r.children()}return ne(t).adopt(e,0,0),e}))},e.textContents=function(){return this.foldChildren("",(function(e,t){return e+t.text}))},e.text=function(){return'"'+this.textContents()+'"'},e.latex=function(){return"\\text{"+this.textContents()+"}"},e.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},e.moveTowards=function(e,t){t.insAtDirEnd(-e,this)},e.moveOutOf=function(e,t){t.insDirOf(e,this)},e.unselectInto=e.moveTowards,e.selectTowards=Q.prototype.selectTowards,e.deleteTowards=Q.prototype.deleteTowards,e.selectOutOf=function(e,t){t.insDirOf(e,this)},e.deleteOutOf=function(e,t){this.isEmpty()&&t.insRightOf(this)},e.write=function(e,r){if(e.show().deleteSelection(),"$"!==r)e[E]?e[E].appendText(r):ne(r).createLeftOf(e);else if(this.isEmpty())e.insRightOf(this),X("\\$","$").createLeftOf(e);else if(e[S])if(e[E]){var a=te(),s=this.ends[E];s.disown(),s.adopt(a,0,0),e.insLeftOf(this),t.createLeftOf.call(a,e)}else e.insLeftOf(this);else e.insRightOf(this)},e.seek=function(e,t){t.hide();var r=fuseChildren(this),a=this.jQ.width()/this.text.length,s=Math.round((e-this.jQ.offset().left)/a);s<=0?t.insAtLeftEnd(this):s>=r.text.length?t.insAtRightEnd(this):t.insLeftOf(r.splitRight(s));for(var l=e-t.show().offset().left,y=l&&l<0?E:S,w=y;t[y]&&l*w>0;)t[y].moveTowards(y,t),w=l,l=e-t.offset().left;if(y*l<-y*w&&t[-y].moveTowards(-y,t),t.anticursor){if(t.anticursor.parent===this){var T=t[E]&&t[E].text.length;if(this.anticursorPosition===T)t.anticursor=O.copy(t);else{if(this.anticursorPosition<T){var N=t[E].splitRight(this.anticursorPosition);t[E]=N}else N=t[S].splitRight(this.anticursorPosition-T);t.anticursor=O(this,N[E],N)}}}else this.anticursorPosition=t[E]&&t[E].text.length},e.blur=function(){J.prototype.blur.call(this),fuseChildren(this)},e.focus=J.prototype.focus})),ne=w(N,(function(e,t){function endChar(e,t){return t.charAt(e===E?0:-1+t.length)}e.init=function(e){t.init.call(this),this.text=e},e.jQadd=function(e){this.dom=e,this.jQ=T(e)},e.jQize=function(){return this.jQadd(document.createTextNode(this.text))},e.appendText=function(e){this.text+=e,this.dom.appendData(e)},e.prependText=function(e){this.text=e+this.text,this.dom.insertData(0,e)},e.insTextAtDirEnd=function(e,t){prayDirection(t),t===S?this.appendText(e):this.prependText(e)},e.splitRight=function(e){var t=ne(this.text.slice(e)).adopt(this.parent,this,this[S]);return t.jQadd(this.dom.splitText(e)),this.text=this.text.slice(0,e),t},e.moveTowards=function(e,t){prayDirection(e);var r=endChar(-e,this.text),a=this[-e];return a?a.insTextAtDirEnd(r,e):ne(r).createDir(-e,t),this.deleteTowards(e,t)},e.latex=function(){return this.text},e.deleteTowards=function(e,t){this.text.length>1?e===S?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),t[e]=this[e])},e.selectTowards=function(e,t){prayDirection(e);var r=t.anticursor,a=endChar(-e,this.text);if(r[e]===this){var s=ne(a).createDir(e,t);r[e]=s,t.insDirOf(e,s)}else{var l=this[-e];if(l)l.insTextAtDirEnd(a,e);else(s=ne(a).createDir(-e,t)).jQ.insDirOf(-e,t.selection.jQ);1===this.text.length&&r[-e]===this&&(r[-e]=this[-e])}return this.deleteTowards(e,t)}}));function makeTextBlock(e,t,r){return w(te,{ctrlSeq:e,htmlTemplate:"<"+t+" "+r+">&0</"+t+">"})}L.text=L.textnormal=L.textrm=L.textup=L.textmd=te,L.em=L.italic=L.italics=L.emph=L.textit=L.textsl=makeTextBlock("\\textit","i",'class="mq-text-mode"'),L.strong=L.bold=L.textbf=makeTextBlock("\\textbf","b",'class="mq-text-mode"'),L.sf=L.textsf=makeTextBlock("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),L.tt=L.texttt=makeTextBlock("\\texttt","span",'class="mq-monospace mq-text-mode"'),L.textsc=makeTextBlock("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),L.uppercase=makeTextBlock("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),L.lowercase=makeTextBlock("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),L.ce=w(te,(function(e,t){function wrapDots(e){return e.replace(/(&middot;)/g,'<span class="mq-bond-dot">$1</span>')}e.bondHtml={"-":"-","=":"=","#":"&#8801;","...":wrapDots("&middot;&middot;&middot;"),"....":wrapDots("&middot;&middot;&middot;&middot;"),"->":"&#8594;","<-":"&#8592;"},e.bond=null,e.ctrlSeq="\\ce",e.regex=/^(\\bond{([^{}]+?)})/i,e.jQadd=function(e){t.jQadd.call(this,e),this.bond&&this.jQaddBond()},e.jQaddBond=function(){this.jQ.empty().removeClass("mq-text-mode").addClass("mq-ce mq-bond").html(this.bondHtml[this.bond])},e.parseBond=function(e){e.length&&(this.bond=this.regex.exec(e)&&e.replace(this.regex,"$2")),this.bondHtml[this.bond]||(this.bond=null)},e.latex=function(){return"\\ce{"+(this.bond?"\\bond{"+this.bond+"}":this.textContents())+"}"},e.text=function(){return this.bond||this.textContents()},e.isEmpty=function(){return!this.text()},e.moveOutOf=function(e,t){this.bond||this.parseEnteredText(e,t),t.insDirOf(e,this)},e.parseEnteredText=function(e,t){var r=t[-e];if(this.parseBond(this.textContents()),this.bond){for(;r instanceof ne;)r=r.remove()[-e];t[-e]=this,this.jQaddBond()}},e.parser=function(){var e=this,t=U.string,r=U.regex;return U.optWhitespace.then(t("{")).then(r(this.regex)).skip(t("}")).map((function(t){return e.parseBond(t),e}))},e.moveTowards=Y.prototype.moveTowards,e.deleteTowards=Y.prototype.deleteTowards,e.seek=Y.prototype.seek,e.blur=J.prototype.blur}));var re=w(Q,(function(e,t){e.init=function(e){t.init.call(this,"$"),this.cursor=e},e.htmlTemplate='<span class="mq-math-mode">&0</span>',e.createBlocks=function(){t.createBlocks.call(this),this.ends[E].cursor=this.cursor,this.ends[E].write=function(e,t){"$"!==t?J.prototype.write.call(this,e,t):this.isEmpty()?(e.insRightOf(this.parent),this.parent.deleteTowards(dir,e),X("\\$","$").createLeftOf(e.show())):e[S]?e[E]?J.prototype.write.call(this,e,t):e.insLeftOf(this.parent):e.insRightOf(this.parent)}},e.latex=function(){return"$"+this.ends[E].latex()+"$"}})),ie=w(ee,(function(e,t){e.keystroke=function(e){if("Spacebar"!==e&&"Shift-Spacebar"!==e)return t.keystroke.apply(this,arguments)},e.write=function(e,t){var r;(e.show().deleteSelection(),"$"===t)?re(e).createLeftOf(e):("<"===t?r="&lt;":">"===t&&(r="&gt;"),X(t,r).createLeftOf(e))}}));MathQuill.TextField=APIFnFor(w(V,(function(e){e.init=function(e){e.addClass("mq-editable-field mq-text-mode"),this.initRootAndEvents(ie(),e)},e.latex=function(e){return arguments.length>0?(this.__controller.renderLatexText(e),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})));R["\\"]=w(Q,(function(e,t){e.ctrlSeq="\\",e.replaces=function(e){this._replacedFragment=e.disown(),this.isEmpty=function(){return!1}},e.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',e.textTemplate=["\\"],e.createBlocks=function(){t.createBlocks.call(this),this.ends[E].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[E].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[E].write=function(e,t){e.show().deleteSelection(),t.match(/[a-z]/i)?X(t).createLeftOf(e):(this.parent.renderCommand(e),"\\"===t&&this.isEmpty()||this.parent.parent.write(e,t))},this.ends[E].keystroke=function(e,r,a){return"Tab"===e||"Enter"===e||"Spacebar"===e?(this.parent.renderCommand(a.cursor),void r.preventDefault()):t.keystroke.apply(this,arguments)}},e.createLeftOf=function(e){if(t.createLeftOf.call(this,e),this._replacedFragment){var r=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",(function(e){return T(e.target=r).trigger(e),!1})).insertBefore(this.jQ).add(this.jQ)}},e.latex=function(){return"\\"+this.ends[E].latex()+" "},e.renderCommand=function(e){this.jQ=this.jQ.last(),this.remove(),this[S]?e.insLeftOf(this[S]):e.insAtRightEnd(this.parent);var t=this.ends[E].latex();t||(t=" ");var r=L[t]||$e[t];r?(r=r(t),this._replacedFragment&&r.replaces(this._replacedFragment),r.createLeftOf(e)):((r=te()).replaces(t),r.createLeftOf(e),e.insRightOf(r),this._replacedFragment&&this._replacedFragment.remove())}}));L["∉"]=L.notin=bind(Z,"\\notin ","&#8713;"),L["≅"]=L.cong=bind(Z,"\\cong ","&#8773;"),L["≡"]=L.equiv=bind(Z,"\\equiv ","&#8801;"),L["⊕"]=L.oplus=bind(Z,"\\oplus ","&#8853;"),L["⊗"]=L.otimes=bind(Z,"\\otimes ","&#8855;"),L["≠"]=L.ne=L.neq=bind(Z,"\\ne ","&ne;"),L.ast=L.star=L.loast=L.lowast=bind(Z,"\\ast ","&lowast;"),L.therefor=L.therefore=bind(Z,"\\therefore ","&there4;"),L.cuz=L.because=bind(Z,"\\because ","&#8757;"),L.prop=L.propto=bind(Z,"\\propto ","&prop;"),L["≈"]=L.asymp=L.approx=bind(Z,"\\approx ","&asymp;"),L.isin=L.in=bind(Z,"\\in ","&isin;"),L.ni=L.contains=bind(Z,"\\ni ","&ni;"),L.notni=L.niton=L.notcontains=L.doesnotcontain=D["\\not\\ni"]=bind(Z,"\\not\\ni ","&#8716;"),L.sub=L.subset=bind(Z,"\\subset ","&sub;"),L.sup=L.supset=L.superset=bind(Z,"\\supset ","&sup;"),L.nsub=L.notsub=L.nsubset=L.notsubset=D["\\not\\subset"]=bind(Z,"\\not\\subset ","&#8836;"),L.nsup=L.notsup=L.nsupset=L.notsupset=L.nsuperset=L.notsuperset=D["\\not\\supset"]=bind(Z,"\\not\\supset ","&#8837;"),L.sube=L.subeq=L.subsete=L.subseteq=bind(Z,"\\subseteq ","&sube;"),L.supe=L.supeq=L.supsete=L.supseteq=L.supersete=L.superseteq=bind(Z,"\\supseteq ","&supe;"),L.nsube=L.nsubeq=L.notsube=L.notsubeq=L.nsubsete=L.nsubseteq=L.notsubsete=L.notsubseteq=D["\\not\\subseteq"]=bind(Z,"\\not\\subseteq ","&#8840;"),L.nsupe=L.nsupeq=L.notsupe=L.notsupeq=L.nsupsete=L.nsupseteq=L.notsupsete=L.notsupseteq=L.nsupersete=L.nsuperseteq=L.notsupersete=L.notsuperseteq=D["\\not\\supseteq"]=bind(Z,"\\not\\supseteq ","&#8841;"),L.N=L.naturals=L.Naturals=bind(X,"\\mathbb{N}","&#8469;"),L.P=L.primes=L.Primes=L.projective=L.Projective=L.probability=L.Probability=bind(X,"\\mathbb{P}","&#8473;"),L.Z=L.integers=L.Integers=bind(X,"\\mathbb{Z}","&#8484;"),L.Q=L.rationals=L.Rationals=bind(X,"\\mathbb{Q}","&#8474;"),L.R=L.reals=L.Reals=bind(X,"\\mathbb{R}","&#8477;"),L.C=L.complex=L.Complex=L.complexes=L.Complexes=L.complexplane=L.Complexplane=L.ComplexPlane=bind(X,"\\mathbb{C}","&#8450;"),L.H=L.Hamiltonian=L.quaternions=L.Quaternions=bind(X,"\\mathbb{H}","&#8461;"),L.quad=L.emsp=bind(X,"\\quad ","    "),L.qquad=bind(X,"\\qquad ","        ");var oe=w(Y,(function(e,t){e.init=function(e,r){t.init.call(this,e,'<span class="mq-longarrow">'+r+"</span>")}}));L.diamond=bind(X,"\\diamond ","&#9671;"),L.bigtriangleup=bind(X,"\\bigtriangleup ","&#9651;"),L.ominus=bind(X,"\\ominus ","&#8854;"),L.uplus=bind(X,"\\uplus ","&#8846;"),L.bigtriangledown=bind(X,"\\bigtriangledown ","&#9661;"),L.sqcap=bind(X,"\\sqcap ","&#8851;"),L.triangleleft=bind(X,"\\triangleleft ","&#8882;"),L.sqcup=bind(X,"\\sqcup ","&#8852;"),L.triangleright=bind(X,"\\triangleright ","&#8883;"),L.odot=bind(X,"\\odot ","&#8857;"),L.bigcirc=bind(X,"\\bigcirc ","&#9711;"),L.dagger=bind(X,"\\dagger ","&#0134;"),L.ddagger=bind(X,"\\ddagger ","&#135;"),L.wr=bind(X,"\\wr ","&#8768;"),L.amalg=bind(X,"\\amalg ","&#8720;"),L.models=bind(X,"\\models ","&#8872;"),L.prec=bind(X,"\\prec ","&#8826;"),L.succ=bind(X,"\\succ ","&#8827;"),L.preceq=bind(X,"\\preceq ","&#8828;"),L.succeq=bind(X,"\\succeq ","&#8829;"),L.simeq=bind(X,"\\simeq ","&#8771;"),L.mid=bind(X,"\\mid ","&#8739;"),L.ll=bind(X,"\\ll ","&#8810;"),L.gg=bind(X,"\\gg ","&#8811;"),L.parallel=bind(X,"\\parallel ","&#8741;"),L.nparallel=bind(X,"\\nparallel ","&#8742;"),L.bowtie=bind(X,"\\bowtie ","&#8904;"),L.sqsubset=bind(X,"\\sqsubset ","&#8847;"),L.sqsupset=bind(X,"\\sqsupset ","&#8848;"),L.smile=bind(X,"\\smile ","&#8995;"),L.sqsubseteq=bind(X,"\\sqsubseteq ","&#8849;"),L.sqsupseteq=bind(X,"\\sqsupseteq ","&#8850;"),L.doteq=bind(X,"\\doteq ","&#8784;"),L.frown=bind(X,"\\frown ","&#8994;"),L.vdash=bind(X,"\\vdash ","&#8870;"),L.dashv=bind(X,"\\dashv ","&#8867;"),L.longleftarrow=bind(oe,"\\longleftarrow ",'&larr;<span class="mq-arrow-tail mq-tail-right">&larr;</span>'),L.longrightarrow=bind(oe,"\\longrightarrow ",'<span class="mq-arrow-tail">&larr;</span>&rarr;'),L.Longleftarrow=bind(oe,"\\Longleftarrow ",'&lArr;<span class="mq-arrow-tail mq-tail-right">&lArr;</span>'),L.Longrightarrow=bind(oe,"\\Longrightarrow ",'<span class="mq-arrow-tail">&lArr;</span>&rArr;'),L.longleftrightarrow=bind(oe,"\\longleftrightarrow ",'<span class="mq-arrow-mirror">&larr;&rarr;</span>'),L.Longleftrightarrow=bind(oe,"\\Longleftrightarrow ",'<span class="mq-arrow-mirror">&lArr;&rArr;</span>'),L.updownarrow=bind(X,"\\updownarrow ","&#8597;"),L.Updownarrow=bind(X,"\\Updownarrow ","&#8661;"),L.mapsto=bind(X,"\\mapsto ","&#8614;"),L.nearrow=bind(X,"\\nearrow ","&#8599;"),L.hookleftarrow=bind(X,"\\hookleftarrow ","&#8617;"),L.hookrightarrow=bind(X,"\\hookrightarrow ","&#8618;"),L.searrow=bind(X,"\\searrow ","&#8600;"),L.leftharpoonup=bind(X,"\\leftharpoonup ","&#8636;"),L.rightharpoonup=bind(X,"\\rightharpoonup ","&#8640;"),L.swarrow=bind(X,"\\swarrow ","&#8601;"),L.leftharpoondown=bind(X,"\\leftharpoondown ","&#8637;"),L.rightharpoondown=bind(X,"\\rightharpoondown ","&#8641;"),L.rightleftharpoons=bind(X,"\\rightleftharpoons ","&#8651;"),L.leftrightharpoons=bind(X,"\\leftrightharpoons ","&#8652;"),L.nwarrow=bind(X,"\\nwarrow ","&#8598;"),L.ldots=bind(X,"\\ldots ","&#8230;"),L.cdots=bind(X,"\\cdots ","&#8943;"),L.vdots=bind(X,"\\vdots ","&#8942;"),L.ddots=bind(X,"\\ddots ","&#8945;"),L.surd=bind(X,"\\surd ","&#8730;"),L.triangle=bind(X,"\\triangle ","&#9651;"),L.ell=bind(X,"\\ell ","&#8467;"),L.top=bind(X,"\\top ","&#8868;"),L.flat=bind(X,"\\flat ","&#9837;"),L.natural=bind(X,"\\natural ","&#9838;"),L.sharp=bind(X,"\\sharp ","&#9839;"),L.wp=bind(X,"\\wp ","&#8472;"),L.bot=bind(X,"\\bot ","&#8869;"),L.clubsuit=bind(X,"\\clubsuit ","&#9827;"),L.diamondsuit=bind(X,"\\diamondsuit ","&#9826;"),L.heartsuit=bind(X,"\\heartsuit ","&#9825;"),L.spadesuit=bind(X,"\\spadesuit ","&#9824;"),L.circledot=bind(X,"\\circledot ","&#8857;"),L.middot=bind(X,"\\middot ","&middot;"),L.dottedsquare=bind(X,"\\dottedsquare ","&#11034;"),L.square=bind(X,"\\square ","&#11036;"),L.rectangle=bind(X,"\\rectangle ","&#9647;"),L.oint=bind(X,"\\oint ","&#8750;"),L.bigcap=bind(X,"\\bigcap ","&#8745;"),L.bigcup=bind(X,"\\bigcup ","&#8746;"),L.bigsqcup=bind(X,"\\bigsqcup ","&#8852;"),L.bigvee=bind(X,"\\bigvee ","&#8744;"),L.bigwedge=bind(X,"\\bigwedge ","&#8743;"),L.bigodot=bind(X,"\\bigodot ","&#8857;"),L.bigotimes=bind(X,"\\bigotimes ","&#8855;"),L.bigoplus=bind(X,"\\bigoplus ","&#8853;"),L.biguplus=bind(X,"\\biguplus ","&#8846;"),L.lfloor=bind(X,"\\lfloor ","&#8970;"),L.rfloor=bind(X,"\\rfloor ","&#8971;"),L.lceil=bind(X,"\\lceil ","&#8968;"),L.rceil=bind(X,"\\rceil ","&#8969;"),L.opencurlybrace=L.lbrace=bind(X,"\\lbrace ","{"),L.closecurlybrace=L.rbrace=bind(X,"\\rbrace ","}"),L.mug=bind(X,"\\mug ","&micro;g"),L.mus=bind(X,"\\mus ","&micro;s"),L.mum=bind(X,"\\mum ","&micro;m"),L.muL=bind(X,"\\muL ","&micro;L"),q.open((function(e){this.onNotify((function(e){"move"===e&&this[S]&&this[S].movingLeftOf&&this[S].movingLeftOf(this)}))}));var ae=w(Y,(function(e,t){e.moveTowards=function(e,r){e===S&&this[S]instanceof De?r.insAtDirEnd(E,this[S].ends[E]):t.moveTowards.apply(this,arguments)}}));L["∫"]=L.int=L.integral=bind(ae,"\\int ","<big>&int;</big>"),L.caret=bind(X,"\\text{^}","^"),L.underscore=bind(X,"\\_","_"),L.slash=bind(X,"/"),L.vert=bind(X,"|"),L.perp=L.perpendicular=bind(X,"\\perp ","&perp;"),L.nabla=L.del=bind(X,"\\nabla ","&nabla;"),L.hbar=bind(X,"\\hbar ","&#8463;"),L.AA=L.Angstrom=L.angstrom=bind(X,"\\text\\AA ","&#8491;"),L.ring=L.circ=L.circle=bind(X,"\\circ ","&#8728;"),L.bull=L.bullet=bind(X,"\\bullet ","&bull;"),L.setminus=L.smallsetminus=bind(X,"\\setminus ","&#8726;"),L.not=L["¬"]=L.neg=bind(X,"\\neg ","&not;"),L["…"]=L.dots=L.ellip=L.hellip=L.ellipsis=L.hellipsis=bind(X,"\\dots ","&hellip;"),L.converges=L.darr=L.dnarr=L.dnarrow=L.downarrow=bind(X,"\\downarrow ","&darr;"),L.dArr=L.dnArr=L.dnArrow=L.Downarrow=bind(X,"\\Downarrow ","&dArr;"),L.diverges=L.uarr=L.uparrow=bind(X,"\\uparrow ","&uarr;"),L.uArr=L.Uparrow=bind(X,"\\Uparrow ","&uArr;"),L.to=bind(Z,"\\to ","&rarr;"),L.rarr=L.rightarrow=bind(X,"\\rightarrow ","&rarr;"),L.implies=bind(Z,"\\Rightarrow ","&rArr;"),L.rArr=L.Rightarrow=bind(X,"\\Rightarrow ","&rArr;"),L.gets=bind(Z,"\\gets ","&larr;"),L.larr=L.leftarrow=bind(X,"\\leftarrow ","&larr;"),L.impliedby=bind(Z,"\\Leftarrow ","&lArr;"),L.lArr=L.Leftarrow=bind(X,"\\Leftarrow ","&lArr;"),L.harr=L.lrarr=L.leftrightarrow=bind(X,"\\leftrightarrow ","&harr;"),L.iff=bind(Z,"\\Leftrightarrow ","&hArr;"),L.hArr=L.lrArr=L.Leftrightarrow=bind(X,"\\Leftrightarrow ","&hArr;"),L.Re=L.Real=L.real=bind(X,"\\Re ","&real;"),L.Im=L.imag=L.image=L.imagin=L.imaginary=L.Imaginary=bind(X,"\\Im ","&image;"),L.part=L.partial=bind(X,"\\partial ","&part;"),L.infty=L.infin=L.infinity=bind(X,"\\infty ","&infin;"),L.alef=L.alefsym=L.aleph=L.alephsym=bind(X,"\\aleph ","&alefsym;"),L.xist=L.xists=L.exist=L.exists=bind(X,"\\exists ","&exist;"),L.and=L.land=L.wedge=bind(X,"\\wedge ","&and;"),L.or=L.lor=L.vee=bind(X,"\\vee ","&or;"),L.o=L.O=L.empty=L.emptyset=L.oslash=L.Oslash=L.nothing=L.varnothing=bind(Z,"\\varnothing ","&empty;"),L.cup=L.union=bind(Z,"\\cup ","&cup;"),L.cap=L.intersect=L.intersection=bind(Z,"\\cap ","&cap;"),L.deg=L.degree=bind(X,"\\degree ","&deg;"),L.ang=L.angle=bind(X,"\\angle ","&ang;"),L.measuredangle=bind(X,"\\measuredangle ","m&ang;");var se=w(X,(function(e,t){e.createLeftOf=function(e){e.options.autoSubscriptNumerals&&e.parent!==e.parent.parent.sub&&(e[E]instanceof le&&!1!==e[E].isItalic||e[E]instanceof De&&e[E][E]instanceof le&&!1!==e[E][E].isItalic)?(L._().createLeftOf(e),t.createLeftOf.call(this,e),e.insRightOf(e.parent.parent)):t.createLeftOf.call(this,e)}})),le=w(Y,(function(e,t){e.init=function(e,r){t.init.call(this,e,"<var>"+(r||e)+"</var>")},e.text=function(){var e=this.ctrlSeq;return!this[E]||this[E]instanceof le||this[E]instanceof Z||(e="*"+e),!this[S]||this[S]instanceof Z||"^"===this[S].ctrlSeq||(e+="*"),e}}));W.p.autoCommands={_maxLength:0},j.autoCommands=function(e){if(!/^[a-z]+(?: [a-z]+)*$/i.test(e))throw'"'+e+'" not a space-delimited list of only letters';for(var t=e.split(" "),r={},a=0,l=0;l<t.length;l+=1){var y=t[l];if(y.length<2)throw'autocommand "'+y+'" not minimum length of 2';if(L[y]===pe)throw'"'+y+'" is a built-in operator name';r[y]=1,a=s(a,y.length)}return r._maxLength=a,r};var ce=w(le,(function(e,t){function nonOperatorSymbol(e){return e instanceof Y&&!(e instanceof Z)}e.init=function(e){return t.init.call(this,this.letter=e)},e.createLeftOf=function(e){var r=e.options.autoCommands,a=r._maxLength;if(a>0){for(var s=this.letter,l=e[E],y=1;l instanceof ce&&y<a;)s=l.letter+s,l=l[E],y+=1;for(;s.length;){if(r.hasOwnProperty(s)){if(l=e[E],s.length>1){for(y=2;y<s.length;y+=1,l=l[E]);A(l,e[E]).remove(),e[E]=l[E]}return L[s](s).createLeftOf(e)}s=s.slice(1)}}t.createLeftOf.apply(this,arguments)},e.italicize=function(e){return this.isItalic=e,this.jQ.toggleClass("mq-operator-name",!e),this},e.finalizeTree=e.siblingDeleted=e.siblingCreated=function(e,t){t!==E&&this[S]instanceof ce||this.autoUnItalicize(e)},e.autoUnItalicize=function(e){var t=e.autoOperatorNames;if(0!==t._maxLength){for(var r=this.letter,s=this[E];s instanceof ce;s=s[E])r=s.letter+r;for(var l=this[S];l instanceof ce;l=l[S])r+=l.letter;A(s[S]||this.parent.ends[E],l[E]||this.parent.ends[S]).each((function(e){e.italicize(!0).jQ.removeClass("mq-first mq-last"),e.ctrlSeq=e.letter}));e:for(var y=0,w=s[S]||this.parent.ends[E];y<r.length;y+=1,w=w[S])for(var T=a(t._maxLength,r.length-y);T>0;T-=1){var O=r.slice(y,y+T);if(t.hasOwnProperty(O)){for(var N=0,L=w;N<T;N+=1,L=L[S]){L.italicize(!1);var R=L}var D=ue.hasOwnProperty(O);w.ctrlSeq=(D?"\\":"\\operatorname{")+w.ctrlSeq,R.ctrlSeq+=D?" ":"}",he.hasOwnProperty(O)&&R[E][E][E].jQ.addClass("mq-last"),nonOperatorSymbol(w[E])&&w.jQ.addClass("mq-first"),nonOperatorSymbol(R[S])&&R.jQ.addClass("mq-last"),y+=T-1,w=R;continue e}if(de.hasOwnProperty(O)){for(N=0,L=w;N<T;N+=1,L=L[S]){L.italicize(!1);R=L}w.ctrlSeq="\\text{"+w.ctrlSeq,R.ctrlSeq+="}",he.hasOwnProperty(O)&&R[E][E][E].jQ.addClass("mq-last"),nonOperatorSymbol(w[E])&&w.jQ.addClass("mq-first"),nonOperatorSymbol(R[S])&&R.jQ.addClass("mq-last"),y+=T-1,w=R;continue e}}}}})),ue={},de={},he={limsup:1,liminf:1,projlim:1,injlim:1};!function(){for(var e=W.p.autoOperatorNames={_maxLength:9},t="arg deg det dim exp gcd hom inf ker lg ln log max min sup limsup liminf injlim projlim Pr".split(" "),r=0;r<t.length;r+=1)ue[t[r]]=e[t[r]]=1;var a="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" ");for(r=0;r<a.length;r+=1)ue[a[r]]=1;var s="sin cos tan sec cosec csc cotan cot ctg".split(" ");for(r=0;r<s.length;r+=1)e[s[r]]=e["arc"+s[r]]=e[s[r]+"h"]=e["ar"+s[r]+"h"]=e["arc"+s[r]+"h"]=1}(),j.autoOperatorNames=function(e){if(!/^[a-z]+(?: [a-z]+)*$/i.test(e))throw'"'+e+'" not a space-delimited list of only letters';for(var t=e.split(" "),r={},a=0,l=0;l<t.length;l+=1){var y=t[l];if(y.length<2)throw'"'+y+'" not minimum length of 2';r[y]=1,a=s(a,y.length)}return r._maxLength=a,r};var pe=w(Y,(function(e,t){e.init=function(e){this.ctrlSeq=e},e.createLeftOf=function(e){for(var t=this.ctrlSeq,r=0;r<t.length;r+=1)ce(t.charAt(r)).createLeftOf(e)},e.parser=function(){for(var e=this.ctrlSeq,t=J(),r=0;r<e.length;r+=1)ce(e.charAt(r)).adopt(t,t.ends[S],0);return U.succeed(t.children())}}));for(var fe in ue)ue.hasOwnProperty(fe)&&(L[fe]=pe);L.operatorname=w(Q,(function(e){e.createLeftOf=noop,e.numBlocks=function(){return 1},e.parser=function(){return K.block.map((function(e){return e.children()}))}})),L.f=w(ce,(function(e,t){e.init=function(){Y.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},e.italicize=function(e){return this.jQ.html("f").toggleClass("mq-f",e),t.italicize.apply(this,arguments)}})),L[" "]=L.space=bind(X,"\\ "," "),L["'"]=L.prime=bind(X,"'","&prime;"),L['"']=L.doublePrime=bind(X,'"',"&Prime;"),L.backslash=bind(X,"\\backslash ","\\"),R["\\"]||(R["\\"]=L.backslash),L.$=bind(X,"\\$","$");var me=w(Y,(function(e,t){e.init=function(e,r){t.init.call(this,e,'<span class="mq-nonSymbola">'+(r||e)+"</span>")}}));L["@"]=me,L["&"]=bind(me,"\\&","&amp;"),L["%"]=bind(me,"\\%","%"),L.alpha=L.beta=L.gamma=L.delta=L.zeta=L.eta=L.theta=L.iota=L.kappa=L.mu=L.nu=L.xi=L.rho=L.sigma=L.tau=L.chi=L.psi=L.omega=w(le,(function(e,t){e.init=function(e){t.init.call(this,"\\"+e+" ","&"+e+";")}})),L.phi=bind(le,"\\phi ","&#981;"),L.phiv=L.varphi=bind(le,"\\varphi ","&phi;"),L.epsilon=bind(le,"\\epsilon ","&#1013;"),L.epsiv=L.varepsilon=bind(le,"\\varepsilon ","&epsilon;"),L.piv=L.varpi=bind(le,"\\varpi ","&piv;"),L.sigmaf=L.sigmav=L.varsigma=bind(le,"\\varsigma ","&sigmaf;"),L.thetav=L.vartheta=L.thetasym=bind(le,"\\vartheta ","&thetasym;"),L.upsilon=L.upsi=bind(le,"\\upsilon ","&upsilon;"),L.gammad=L.Gammad=L.digamma=bind(le,"\\digamma ","&#989;"),L.kappav=L.varkappa=bind(le,"\\varkappa ","&#1008;"),L.rhov=L.varrho=bind(le,"\\varrho ","&#1009;"),L.pi=L["π"]=bind(me,"\\pi ","&pi;"),L.lambda=bind(me,"\\lambda ","&lambda;"),L.Upsilon=L.Upsi=L.upsih=L.Upsih=bind(Y,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),L.Gamma=L.Delta=L.Theta=L.Lambda=L.Xi=L.Pi=L.Sigma=L.Phi=L.Psi=L.Omega=w(X,(function(e,t){e.init=function(e){t.init.call(this,"\\"+e+" ","&"+e+";")}})),L.forall=L["∀"]=bind(X,"\\forall ","&#8704;");var ge=w(Q,(function(e){e.init=function(e){this.latex=e},e.createLeftOf=function(e){var t=K.parse(this.latex);t.children().adopt(e.parent,e[E],e[S]),e[E]=t.ends[S],t.jQize().insertBefore(e.jQ),t.finalizeInsert(e.options,e),t.ends[S][S].siblingCreated&&t.ends[S][S].siblingCreated(e.options,E),t.ends[E][E].siblingCreated&&t.ends[E][E].siblingCreated(e.options,S),e.parent.bubble("reflow")},e.parser=function(){var e=K.parse(this.latex).children();return U.succeed(e)}}));L["¹"]=bind(ge,"^1"),L["²"]=bind(ge,"^2"),L["³"]=bind(ge,"^3"),L["¼"]=bind(ge,"\\frac14"),L["½"]=bind(ge,"\\frac12"),L["¾"]=bind(ge,"\\frac34");var ye=w(Z,(function(e){e.init=X.prototype.init,e.contactWeld=e.siblingCreated=e.siblingDeleted=function(e,t){if(t!==S)return this.jQ[0].className=!this[E]||this[E]instanceof Z?"":"mq-binary-operator",this}}));L["+"]=bind(ye,"+","+"),L["–"]=L["-"]=bind(ye,"-","&minus;"),L["±"]=L.pm=L.plusmn=L.plusminus=bind(ye,"\\pm ","&plusmn;"),L.mp=L.mnplus=L.minusplus=bind(ye,"\\mp ","&#8723;"),R["*"]=L.sdot=L.cdot=L.cdotp=bind(Z,"\\cdot ","&middot;");var ve=w(Z,(function(e,t){e.init=function(e,r){this.data=e,this.strict=r;var a=r?"Strict":"";t.init.call(this,e["ctrlSeq"+a],e["html"+a],e["text"+a])},e.swap=function(e){this.strict=e;var t=e?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+t],this.jQ.html(this.data["html"+t]),this.textTemplate=[this.data["text"+t]]},e.deleteTowards=function(e,r){e!==E||this.strict?t.deleteTowards.apply(this,arguments):this.swap(!0)}})),be={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},we={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};L["<"]=L.lt=bind(ve,be,!0),L[">"]=L.gt=bind(ve,we,!0),L["≤"]=L.le=L.leq=bind(ve,be,!1),L["≥"]=L.ge=L.geq=bind(ve,we,!1);var _e=w(Z,(function(e,t){e.init=function(){t.init.call(this,"=","=")},e.createLeftOf=function(e){e[E]instanceof ve&&e[E].strict?e[E].swap(!1):t.createLeftOf.apply(this,arguments)}}));L["="]=_e,L["×"]=L.times=bind(Z,"\\times ","&times;","[x]"),L["÷"]=L.div=L.divide=L.divides=bind(Z,"\\div ","&divide;","[/]"),R["~"]=L.sim=bind(Z,"\\sim ","~","~"),L.complement=L["∁"]=bind(X,"\\complement ","&#8705;"),L.nexists=L["∄"]=bind(X,"\\nexists ","&#8708;"),L.sphericalangle=L["∢"]=bind(X,"\\sphericalangle ","&#8738;"),L.iint=L["∬"]=bind(X,"\\iint ","&#8748;"),L.iiint=L["∭"]=bind(X,"\\iiint ","&#8749;"),L.oiint=L["∯"]=bind(X,"\\oiint ","&#8751;"),L.oiiint=L["∰"]=bind(X,"\\oiiint ","&#8752;"),L.backsim=L["∽"]=bind(X,"\\backsim ","&#8765;"),L.backsimeq=L["⋍"]=bind(X,"\\backsimeq ","&#8909;"),L.eqsim=L["≂"]=bind(X,"\\eqsim ","&#8770;"),L.ncong=L["≇"]=bind(X,"\\ncong ","&#8775;"),L.approxeq=L["≊"]=bind(X,"\\approxeq ","&#8778;"),L.bumpeq=L["≏"]=bind(X,"\\bumpeq ","&#8783;"),L.Bumpeq=L["≎"]=bind(X,"\\Bumpeq ","&#8782;"),L.doteqdot=L["≑"]=bind(X,"\\doteqdot ","&#8785;"),L.fallingdotseq=L["≒"]=bind(X,"\\fallingdotseq ","&#8786;"),L.risingdotseq=L["≓"]=bind(X,"\\risingdotseq ","&#8787;"),L.eqcirc=L["≖"]=bind(X,"\\eqcirc ","&#8790;"),L.circeq=L["≗"]=bind(X,"\\circeq ","&#8791;"),L.triangleq=L["≜"]=bind(X,"\\triangleq ","&#8796;"),L.leqq=L["≦"]=bind(X,"\\leqq ","&#8806;"),L.geqq=L["≧"]=bind(X,"\\geqq ","&#8807;"),L.lneqq=L["≨"]=bind(X,"\\lneqq ","&#8808;"),L.gneqq=L["≩"]=bind(X,"\\gneqq ","&#8809;"),L.between=L["≬"]=bind(X,"\\between ","&#8812;"),L.nleq=L["≰"]=bind(X,"\\nleq ","&#8816;"),L.ngeq=L["≱"]=bind(X,"\\ngeq ","&#8817;"),L.lesssim=L["≲"]=bind(X,"\\lesssim ","&#8818;"),L.gtrsim=L["≳"]=bind(X,"\\gtrsim ","&#8819;"),L.lessgtr=L["≶"]=bind(X,"\\lessgtr ","&#8822;"),L.gtrless=L["≷"]=bind(X,"\\gtrless ","&#8823;"),L.preccurlyeq=L["≼"]=bind(X,"\\preccurlyeq ","&#8828;"),L.succcurlyeq=L["≽"]=bind(X,"\\succcurlyeq ","&#8829;"),L.precsim=L["≾"]=bind(X,"\\precsim ","&#8830;"),L.succsim=L["≿"]=bind(X,"\\succsim ","&#8831;"),L.nprec=L["⊀"]=bind(X,"\\nprec ","&#8832;"),L.nsucc=L["⊁"]=bind(X,"\\nsucc ","&#8833;"),L.subsetneq=L["⊊"]=bind(X,"\\subsetneq ","&#8842;"),L.supsetneq=L["⊋"]=bind(X,"\\supsetneq ","&#8843;"),L.vDash=L["⊨"]=bind(X,"\\vDash ","&#8872;"),L.Vdash=L["⊩"]=bind(X,"\\Vdash ","&#8873;"),L.Vvdash=L["⊪"]=bind(X,"\\Vvdash ","&#8874;"),L.VDash=L["⊫"]=bind(X,"\\VDash ","&#8875;"),L.nvdash=L["⊬"]=bind(X,"\\nvdash ","&#8876;"),L.nvDash=L["⊭"]=bind(X,"\\nvDash ","&#8877;"),L.nVdash=L["⊮"]=bind(X,"\\nVdash ","&#8878;"),L.nVDash=L["⊯"]=bind(X,"\\nVDash ","&#8879;"),L.vartriangleleft=L["⊲"]=bind(X,"\\vartriangleleft ","&#8882;"),L.vartriangleright=L["⊳"]=bind(X,"\\vartriangleright ","&#8883;"),L.trianglelefteq=L["⊴"]=bind(X,"\\trianglelefteq ","&#8884;"),L.trianglerighteq=L["⊵"]=bind(X,"\\trianglerighteq ","&#8885;"),L.multimap=L["⊸"]=bind(X,"\\multimap ","&#8888;"),L.Subset=L["⋐"]=bind(X,"\\Subset ","&#8912;"),L.Supset=L["⋑"]=bind(X,"\\Supset ","&#8913;"),L.Cap=L["⋒"]=bind(X,"\\Cap ","&#8914;"),L.Cup=L["⋓"]=bind(X,"\\Cup ","&#8915;"),L.pitchfork=L["⋔"]=bind(X,"\\pitchfork ","&#8916;"),L.lessdot=L["⋖"]=bind(X,"\\lessdot ","&#8918;"),L.gtrdot=L["⋗"]=bind(X,"\\gtrdot ","&#8919;"),L.lll=L["⋘"]=bind(X,"\\lll ","&#8920;"),L.ggg=L["⋙"]=bind(X,"\\ggg ","&#8921;"),L.lesseqgtr=L["⋚"]=bind(X,"\\lesseqgtr ","&#8922;"),L.gtreqless=L["⋛"]=bind(X,"\\gtreqless ","&#8923;"),L.curlyeqprec=L["⋞"]=bind(X,"\\curlyeqprec ","&#8926;"),L.curlyeqsucc=L["⋟"]=bind(X,"\\curlyeqsucc ","&#8927;"),L.nsim=L["≁"]=bind(X,"\\nsim ","&#8769;"),L.lnsim=L["⋦"]=bind(X,"\\lnsim ","&#8934;"),L.gnsim=L["⋧"]=bind(X,"\\gnsim ","&#8935;"),L.precnsim=L["⋨"]=bind(X,"\\precnsim ","&#8936;"),L.succnsim=L["⋩"]=bind(X,"\\succnsim ","&#8937;"),L.ntriangleleft=L["⋪"]=bind(X,"\\ntriangleleft ","&#8938;"),L.ntriangleright=L["⋫"]=bind(X,"\\ntriangleright ","&#8939;"),L.ntrianglelefteq=L["⋬"]=bind(X,"\\ntrianglelefteq ","&#8940;"),L.ntrianglerighteq=L["⋭"]=bind(X,"\\ntrianglerighteq ","&#8941;"),L.blacksquare=L["∎"]=bind(X,"\\blacksquare ","&#8718;"),L.colon=L["∶"]=bind(X,"\\colon ","&#8758;"),L.llcorner=L["∟"]=bind(X,"\\llcorner ","&#8735;"),L.dotplus=L["∔"]=bind(Z,"\\dotplus ","&#8724;"),L.nmid=L["∤"]=bind(Z,"\nmid ","&#8740;"),L.intercal=L["⊺"]=bind(Z,"\\intercal ","&#8890;"),L.veebar=L["⊻"]=bind(Z,"\\veebar ","&#8891;"),L.barwedge=L["⊼"]=bind(Z,"\\barwedge ","&#8892;"),L.ltimes=L["⋉"]=bind(Z,"\\ltimes ","&#8905;"),L.rtimes=L["⋊"]=bind(Z,"\\rtimes ","&#8906;"),L.leftthreetimes=L["⋋"]=bind(Z,"\\leftthreetimes ","&#8907;"),L.rightthreetimes=L["⋌"]=bind(Z,"\\rightthreetimes ","&#8908;"),L.curlyvee=L["⋎"]=bind(Z,"\\curlyvee ","&#8910;"),L.curlywedge=L["⋏"]=bind(Z,"\\curlywedge ","&#8911;"),L.circledcirc=L["⊚"]=bind(Z,"\\circledcirc ","&#8858;"),L.circledast=L["⊛"]=bind(Z,"\\circledast ","&#8859;"),L.circleddash=L["⊝"]=bind(Z,"\\circleddash ","&#8861;"),L.boxplus=L["⊞"]=bind(Z,"\\boxplus ","&#8862;"),L.boxminus=L["⊟"]=bind(Z,"\\boxminus ","&#8863;"),L.boxtimes=L["⊠"]=bind(Z,"\\boxtimes ","&#8864;"),L.boxdot=L["⊡"]=bind(Z,"\\boxdot ","&#8865;"),L["∂"]=L.partial,L["∃"]=L.exists,L["∅"]=L.varnothing,L["∆"]=L.triangle,L["∇"]=L.nabla,L["∈"]=L.in,L["∊"]=L.in,L["∋"]=L.ni,L["∌"]=L.notni,L["∍"]=L.ni,L["∐"]=L.amalg,L["−"]=L["-"],L["∓"]=L.mp,L["∖"]=L.setminus,L["∘"]=L.circ,L["∙"]=L.bullet,L["∝"]=L.propto,L["∞"]=L.infty,L["∠"]=L.angle,L["∡"]=L.measuredangle,L["∣"]=L.divides,L["∥"]=L.parallel,L["∦"]=L.nparallel,L["∧"]=L.wedge,L["∨"]=L.vee,L["∩"]=L.cap,L["∪"]=L.cup,L["∮"]=L.oint,L["∴"]=L.therefore,L["∵"]=L.because,L["∼"]=L.sim,L["≀"]=L.wr,L["≃"]=L.simeq,L["≍"]=L.asymp,L["≐"]=L.doteq,L["≪"]=L.ll,L["≫"]=L.gg,L["≺"]=L.prec,L["≻"]=L.succ,L["⊂"]=L.subset,L["⊃"]=L.supset,L["⊆"]=L.subseteq,L["⊇"]=L.supseteq,L["⊈"]=L.nsubseteq,L["⊉"]=L.nsupseteq,L["⊏"]=L.sqsubset,L["⊐"]=L.sqsupset,L["⊓"]=L.sqcap,L["⊔"]=L.sqcup,L["⊖"]=L.ominus,L["⊘"]=L.oslash,L["⊙"]=L.odot,L["⊢"]=L.vdash,L["⊣"]=L.dashv,L["⊤"]=L.top,L["⊥"]=L.bot,L["⊧"]=L.models,L["⋀"]=L.wedge,L["⋁"]=L.vee,L["⋂"]=L.cap,L["⋃"]=L.cup,L["⋄"]=L.diamond,L["⋅"]=L.cdot,L["⋆"]=L.star,L["⋈"]=L.bowtie,L["⋮"]=L.vdots,L["⋯"]=L.cdots,L["⋱"]=L.ddots;var Ce,xe,Ee=noop,Se=document.createElement("div").style;for(var Te in{transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1})if(Te in Se){xe=Te;break}xe?Ce=function(e,t,r){e.css(xe,"scale("+t+","+r+")")}:"filter"in Se?(Ee=function(e){e.className=e.className},Ce=function(e,t,r){t/=1+(r-1)/2,e.css("fontSize",r+"em"),e.hasClass("mq-matrixed-container")||e.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>');var a=e.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+t+",SizingMethod='auto expand')");function calculateMarginRight(){e.css("marginRight",(a.width()-1)*(t-1)/t+"px")}calculateMarginRight();var s=setInterval(calculateMarginRight);T(window).load((function(){clearTimeout(s),calculateMarginRight()}))}):Ce=function(e,t,r){e.css("fontSize",r+"em")};var ke=w(Q,(function(e,t){e.init=function(e,r,a){t.init.call(this,e,"<"+r+" "+a+">&0</"+r+">")}})),Oe=w(Q,(function(e,t){e.init=function(e,r,a){this.args=arguments,this.htmlTemplate="<"+r+" "+a+"><"+r+' class="mq-xarrow-over">&0</'+r+"><"+r+' class="mq-xarrow-under"></'+r+"></"+r+">",t.init.call(this,e),this.textTemplate=[e.replace("\\","")+"(",")"]},e.parser=function(){var e=this;return K.optBlock.then((function(t){return K.block.map((function(r){var a=Ne.apply(null,e.args);return a.blocks=[t,r],t.adopt(a,0,0),r.adopt(a,t,0),a}))})).or(t.parser.call(this))}})),Ne=w(Oe,(function(e,t){e.init=function(e,t,r){this.htmlTemplate="<"+t+" "+r+"><"+t+' class="mq-xarrow-over">&1</'+t+"><"+t+' class="mq-xarrow-under">&0</'+t+"></"+t+">",Q.prototype.init.call(this,e),this.textTemplate=[e.replace("\\","")+"[","](",")"]},e.latex=function(){return this.ctrlSeq+"["+this.ends[E].latex()+"]{"+this.ends[S].latex()+"}"},e.finalizeTree=function(){this.downInto=this.ends[E].upOutOf=this.ends[S],this.upInto=this.ends[S].downOutOf=this.ends[E]}})),OverLineStyleGenerator=function(e){var t='<span class="'+e+'-inner-right">g</span><span class="'+e+'-inner-left">h</span>';return w(Q,(function(r,a){r.init=function(r,s,l){a.init.call(this,r,"<"+s+" "+l+"><"+s+' class="'+e+'-inner">'+t+'<span class="mq-empty-box">&0</span></'+s+"></"+s+">")}}))},Pe=w(Q,(function(e,t){e.init=function(e,r,a){t.init.call(this,e,"<"+r+" "+a+'><span class="mq-longdiv-curve-border">)</span><span class="mq-longdiv-inner"><span class="mq-empty">&0</span></'+r+"></span>")}})),Ae=w(Q,(function(e,t){e.init=function(e,r,a){t.init.call(this,e,'<span class="mq-matrix"><span class="mq-paren mq-scaled">[</span><span class="matrix-edit-content-row"><p>'+a+'</p><table class="mq-non-leaf mq-rows-3"><tbody><tr><td class="mq-empty"></td><td class="mq-empty"></td><td class="mq-empty"></td></tr></tbody></table></span><span class="mq-paren mq-scaled">]</span></span>')}})),Le=w(Q,(function(e,t){e.init=function(e){t.init.call(this,e,'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;</span><span class="mq-empty-box">&0</span></span></span>')}})),Re=w(Q,(function(e,t){e.init=function(e,r,a){t.init.call(this,e,'<span class="mq-matrix"><span class="mq-paren mq-scaled">[</span><span class="matrix-edit-content-col"><p>'+a+'</p></span><span class="matrix-edit-content-col"><table class="mq-non-leaf mq-rows-3"><tbody><tr><td class="mq-empty"></td></tr><tr><td class="mq-empty"></td></tr><tr><td class="mq-empty"></td></tr></tbody></table></span><span class="mq-paren mq-scaled">]</span></span>')}})),BiggerSymbolStyle=function(e,t){return w(Y,(function(r,a){r.init=function(r,s,l){a.init.call(this,r,"<"+s+" "+l+"><"+s+' class="'+e+'-inner">'+t+"</"+s+"></"+s+">")}}))},Ie=w(le,(function(e,t){e.symbols={C:"&#8450;",H:"&#8461;",N:"&#8469;",P:"&#8473;",Q:"&#8474;",R:"&#8477;",Z:"&#8484;"},e.init=function(e){var r=e;this.symbols[e]&&(r='<span class="mq-original">'+e+"</span>"+this.symbols[e]),t.init.call(this,e,r)}}));L.mathrm=bind(ke,"\\mathrm","span",'class="mq-roman mq-font"'),L.mathit=bind(ke,"\\mathit","i",'class="mq-font"'),L.mathbf=bind(ke,"\\mathbf","b",'class="mq-font"'),L.mathsf=bind(ke,"\\mathsf","span",'class="mq-sans-serif mq-font"'),L.mathtt=bind(ke,"\\mathtt","span",'class="mq-monospace mq-font"'),L.mathbb=w(Q,(function(e,t){e.init=function(){t.init.call(this,"\\mathbb",'<span class="mq-mathbb mq-font">&0</span>')},e.adopt=function(){return this.eachChild((function(e){if(!e.writeOverride){var t=e.write,r=e.deleteOutOf;e.write=e.writeOverride=function(r,a,s){var l;if(!Ie.prototype.symbols[a])return t.apply(e,arguments);l=Ie(a),s&&l.replaces(s),l.createLeftOf(r)},e.deleteOutOf=function(t,a){var s=[];return e.eachChild((function(t){var r=t.ctrlSeq;s.push(le(r).adopt(e,e.ends[S],0)),t.remove()})),s.length&&(a[S]=s[0]),e.jQize().appendTo(e.jQ),r.apply(e,arguments)}}})),t.adopt.apply(this,arguments)},e.finalizeTree=function(){this.eachChild((function(e){e.eachChild((function(t){var r=t.ctrlSeq,a=le;Ie.prototype.symbols[r]&&(a=Ie),a(r).adopt(e,e.ends[S],0),t.remove()})),e.jQize().appendTo(e.jQ)}))}})),L.underline=bind(ke,"\\underline","span",'class="mq-non-leaf mq-underline"'),L.overline=L.bar=bind(OverLineStyleGenerator("mq-overline"),"\\overline","span",'class="mq-non-leaf mq-overline"'),L.longdiv=bind(Pe,"\\longdiv","span",'class="mq-non-leaf mq-longdiv"'),L.overleftrightarrow=bind(OverLineStyleGenerator("mq-overleftrightarrow"),"\\overleftrightarrow","span",'class="mq-non-leaf mq-overleftrightarrow"'),L.overrightarrow=bind(OverLineStyleGenerator("mq-overarrow"),"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),L.overleftarrow=bind(OverLineStyleGenerator("mq-overarrow"),"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),L.xleftarrow=bind(Oe,"\\xleftarrow","span",'class="mq-non-leaf mq-xarrow mq-arrow-left"'),L.xrightarrow=bind(Oe,"\\xrightarrow","span",'class="mq-non-leaf mq-xarrow mq-arrow-right"'),L.addmatrixrow=bind(Ae,"\\addmatrixrow","span","+"),L.addmatrixcol=bind(Re,"\\addmatrixcol","span","+"),L.ngtr=L["≯"]=bind(BiggerSymbolStyle("mq-ngtr","&#8815;"),"\\ngtr ","span",'class="mq-non-leaf mq-ngtr"'),L.nless=L["≮"]=bind(BiggerSymbolStyle("mq-nless","&#8814;"),"\\nless ","span",'class="mq-non-leaf mq-nless"'),L.dot=bind(Le,"\\dot"),L.parallelogram=bind(BiggerSymbolStyle("mq-parallelogram","&#9649;"),"\\parallelogram ","span",'class="mq-non-leaf mq-parallelogram"');L.textcolor=w(Q,(function(e,t){e.setColor=function(e){this.color=e,this.htmlTemplate='<span class="mq-textcolor" style="color:'+e+'">&0</span>'},e.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},e.parser=function(){var e=this,r=U.optWhitespace,a=U.string,s=U.regex;return r.then(a("{")).then(s(/^[#\w\s.,()%-]*/)).skip(a("}")).then((function(r){return e.setColor(r),t.parser.call(e)}))}})),L.class=w(Q,(function(e,t){e.parser=function(){var e=this,r=U.string,a=U.regex;return U.optWhitespace.then(r("{")).then(a(/^[-\w\s\\\xA0-\xFF]*/)).skip(r("}")).then((function(r){return e.htmlTemplate='<span class="mq-class '+r+'">&0</span>',t.parser.call(e)}))}}));var De=w(Q,(function(e,t){e.ctrlSeq="_{...}^{...}",e.createLeftOf=function(e){if(e[E]||!e.options.supSubsRequireOperand)return t.createLeftOf.apply(this,arguments)},e.contactWeld=function(e){for(var t=E;t;t=t===E&&S)if(this[t]instanceof De){for(var r="sub";r;r="sub"===r&&"sup"){var a=this[r],s=this[t][r];if(a){if(s)if(a.isEmpty())y=O(s,0,s.ends[E]);else{a.jQ.children().insAtDirEnd(-t,s.jQ);var l=a.children().disown(),y=O(s,l.ends[S],s.ends[E]);t===E?l.adopt(s,s.ends[S],0):l.adopt(s,0,s.ends[E])}else this[t].addBlock(a.disown());this.placeCursor=function(e,r){return function(a){a.insAtDirEnd(-t,e||r)}}(s,a)}}this.remove(),e&&e[E]===this&&(t===S&&y?y[E]?e.insRightOf(y[E]):e.insAtLeftEnd(y.parent):e.insRightOf(this[t]));break}this.respace()},W.p.charsThatBreakOutOfSupSub="",e.finalizeTree=function(){this.ends[E].write=function(e,t){if(e.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===t)return;var r=this.chToCmd(t);return r instanceof Y?e.deleteSelection():e.clearSelection().insRightOf(this.parent),r.createLeftOf(e.show())}if(e[E]&&e.options.charsThatBreakOutOfSupSub.indexOf(t)>-1)e.insRightOf(this.parent);else if(" "===t&&!e[S]&&this===this.parent.sub&&this.parent.sup){var a=this.parent;return a.polyatomic=this.latex().length>0,void a.polyatomicClass()}J.p.write.apply(this,arguments)},this.ends[E].keystroke=function(e,t,r){var a=this.parent;"Backspace"===e&&this===a.sub&&a.polyatomic&&!r.cursor[S]?(a.polyatomic=!1,a.polyatomicClass()):J.p.keystroke.apply(this,arguments)},this.polyatomicClass()},e.polyatomicClass=function(){this.jQ.toggleClass("mq-polyatomic",this.polyatomic)},e.moveTowards=function(e,r,a){r.options.autoSubscriptNumerals&&!this.sup?r.insDirOf(e,this):t.moveTowards.apply(this,arguments)},e.movingLeftOf=function(e){this[E]instanceof ae&&e.insLeftOf(this[E])},e.deleteTowards=function(e,r){if(r.options.autoSubscriptNumerals&&this.sub){var a=this.sub.ends[-e];a instanceof Y?a.remove():a&&a.deleteTowards(e,r.insAtDirEnd(-e,this.sub)),this.sub.isEmpty()&&this.sub.deleteOutOf(-e,r.insAtLeftEnd(this.sub))}else t.deleteTowards.apply(this,arguments)},e.latex=function(){function latex(e,t){var r=t&&t.latex();return t?e+(1===r.length?r:"{"+(r||" ")+"}"):""}return latex("_",this.sub)+(this.polyatomic?"{}":"")+latex("^",this.sup)},e.respace=e.siblingCreated=e.siblingDeleted=function(e,t){t!==S&&(this.jQ.toggleClass("mq-limit","\\int "===this[E].ctrlSeq),this.sup&&this.sub||!this.polyatomic||(this.polyatomic=!1),this.polyatomicClass())},e.addBlock=function(e){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=e,e.adopt(this,this.sub,0).downOutOf=this.sub,e.jQ=T('<span class="mq-sup"/>').append(e.jQ.children()).attr(r,e.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=e,e.adopt(this,0,this.sup).upOutOf=this.sup,e.jQ=T('<span class="mq-sub"></span>').append(e.jQ.children()).attr(r,e.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>')),this.sub&&this.sub.polyatomic&&(this.polyatomic=!0);for(var t=0;t<2;t+=1)!function(e,t,r,a){e[t].deleteOutOf=function(s,l){if(l.insDirOf(this[s]?-s:s,this.parent),!this.isEmpty()){var y=this.ends[s];this.children().disown().withDirAdopt(s,l.parent,l[s],l[-s]).jQ.insDirOf(-s,l.jQ),l[-s]=y}e.supsub=r,delete e[t],delete e[a+"Into"],e[r][a+"OutOf"]=insLeftOfMeUnlessAtEnd,delete e[r].deleteOutOf,"sub"===t&&T(e.jQ.addClass("mq-sup-only")[0].lastChild).remove(),e.polyatomic=!1,this.remove()}}(this,"sub sup".split(" ")[t],"sup sub".split(" ")[t],"down up".split(" ")[t])}}));function insLeftOfMeUnlessAtEnd(e){var t=this.parent,r=e;do{if(r[S])return e.insLeftOf(t);r=r.parent.parent}while(r!==t);e.insRightOf(t)}L.subscript=L._=w(De,(function(e,t){e.supsub="sub",e.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub"><span class="mq-empty-box">&0</span></span><span style="display:inline-block;width:0">&#8203;</span></span>',e.textTemplate=["_"],e.finalizeTree=function(){this.downInto=this.sub=this.ends[E],this.sub.upOutOf=insLeftOfMeUnlessAtEnd,t.finalizeTree.call(this)},e.parser=function(){var e=U.regex,r=U.optWhitespace,a=this;return r.then(e(/^([^{}]|{[^}{]*}){}/)).map((function(e){return a.blocks=[K.parse(e.replace(/{}$/,""))],a.blocks[0].adopt(a,a.ends[S],0),a.blocks[0].polyatomic=!0,a})).or(t.parser.call(this))}})),L.superscript=L.supscript=L["^"]=w(De,(function(e,t){e.supsub="sup",e.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup"><span class="mq-empty-box">&0</span></span></span>',e.textTemplate=["**"],e.finalizeTree=function(){this.upInto=this.sup=this.ends[S],this.sup.downOutOf=insLeftOfMeUnlessAtEnd,t.finalizeTree.call(this)}}));var Me=w(Q,(function(e,t){e.parser=function(){for(var e=U.string,t=U.optWhitespace,r=U.succeed,a=K.block,s=this,l=s.blocks=[J(),J()],y=0;y<l.length;y+=1)l[y].adopt(s,s.ends[S],0);return t.then(e("_").or(e("^"))).then((function(e){var t=l["_"===e?0:1];return a.then((function(e){return e.children().adopt(t,t.ends[S],0),r(s)}))})).many().result(s)},e.finalizeTree=function(){this.downInto=this.ends[E],this.upInto=this.ends[S],this.ends[E].upOutOf=this.ends[S],this.ends[S].downOutOf=this.ends[E]}})),Be=w(Me,(function(e,t){e.init=function(e,t){var r='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+t+'</big><span class="mq-from"><span>&0</span></span></span>';Y.prototype.init.call(this,e,r)},e.latex=function(){function simplify(e){return 1===e.length?e:"{"+(e||" ")+"}"}return this.ctrlSeq+"_"+simplify(this.ends[E].latex())+"^"+simplify(this.ends[S].latex())},e.createLeftOf=function(e){t.createLeftOf.apply(this,arguments),e.options.sumStartsWithNEquals&&(ce("n").createLeftOf(e),_e().createLeftOf(e))}}));L["∑"]=L.sum=L.summation=bind(Be,"\\sum ","&sum;"),L["∏"]=L.prod=L.product=bind(Be,"\\prod ","&prod;"),L.coprod=L.coproduct=bind(Be,"\\coprod ","&#8720;"),L.lim=L.limit=w(Me,(function(e,t){e.init=function(){Y.prototype.init.call(this,"\\lim ",'<span class="mq-lim mq-non-leaf"><span class="mq-un-italicized">lim</span><span class="mq-approaches"><span>&0</span></span></span>')},e.latex=function(){return this.ctrlSeq+"_"+function simplify(e){return 1===e.length?e:"{"+(e||" ")+"}"}(this.ends[E].latex())}}));var qe=L.frac=L.dfrac=L.cfrac=L.fraction=w(Q,(function(e,t){e.ctrlSeq="\\frac",e.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator"><span class="mq-empty-box">&0</span></span><span class="mq-denominator"><span class="mq-empty-box">&1</span></span><span style="display:inline-block;width:0">&#8203;</span></span>',e.textTemplate=["(","/",")"],e.finalizeTree=function(){this.upInto=this.ends[S].upOutOf=this.ends[E],this.downInto=this.ends[E].downOutOf=this.ends[S]}})),Fe=L.over=R["/"]=w(qe,(function(e,t){e.createLeftOf=function(e){if(!this.replacedFragment){for(var r=e[E];r&&!(r instanceof Z||r instanceof(L.text||noop)||r instanceof Be||"\\ "===r.ctrlSeq||/^[,;:]$/.test(r.ctrlSeq));)r=r[E];r instanceof Be&&r[S]instanceof De&&(r=r[S])[S]instanceof De&&r[S].ctrlSeq!=r.ctrlSeq&&(r=r[S]),r===e[E]||e.isTooDeep(1)||(this.replaces(A(r[S]||e.parent.ends[E],e[E])),e[E]=r)}t.createLeftOf.call(this,e)}}));L.underset=w(Q,(function(e,t){e.ctrlSeq="\\underset",e.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf"><span class="mq-over">&1</span><span class="mq-under">&0</span></span>',e.textTemplate=["[","|","]"],e.finalizeTree=function(){this.downInto=this.ends[E].upOutOf=this.ends[S],this.upInto=this.ends[S].downOutOf=this.ends[E]}})),L.overset=w(Q,(function(e,t){e.ctrlSeq="\\overset",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><span class="mq-over">&0</span><span class="mq-under">&1</span></span>',e.textTemplate=["[","|","]"],e.finalizeTree=function(){this.downInto=this.ends[S].upOutOf=this.ends[E],this.upInto=this.ends[E].downOutOf=this.ends[S]}}));var We=w(Q,(function(e,t){e.reflow=function(){var e=this.jQ.find(".mq-arc");Ce(e,this.jQ.innerWidth()/e.innerWidth(),1)}}));L.overarc=w(We,(function(e,t){e.ctrlSeq="\\overarc",e.htmlTemplate='<span class="mq-overarc mq-overunder mq-non-leaf"><span class="mq-over"><span class="mq-arc mq-scaled">&frown;</span><span style="display:inline-block;width:0">&nbsp;</span></span><span class="mq-under">&0</span></span>'})),L.underarc=w(We,(function(e,t){e.ctrlSeq="\\underarc",e.htmlTemplate='<span class="mq-underarc mq-overunder mq-non-leaf"><span class="mq-over">&0</span><span class="mq-under"><span class="mq-arc mq-scaled">&smile;</span><span style="display:inline-block;width:0">&nbsp;</span></span></span>'}));var je=L.sqrt=L["√"]=w(Q,(function(e,t){e.ctrlSeq="\\sqrt",e.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem"><span class="mq-empty-box">&0</span></span></span>',e.textTemplate=["sqrt(",")"],e.parser=function(){return K.optBlock.then((function(e){return K.block.map((function(t){var r=He();return r.blocks=[e,t],e.adopt(r,0,0),t.adopt(r,e,0),r}))})).or(t.parser.call(this))},e.reflow=function(){var e=this.ends[S].jQ.parent();Ce(e.prev(),1,e.innerHeight()/+e.css("fontSize").slice(0,-2)-.1)}})),He=(L.vec=w(Q,(function(e,t){e.ctrlSeq="\\vec",e.htmlTemplate='<span class="mq-non-leaf"><span class="mq-vector-prefix">&rarr;</span><span class="mq-vector-stem">&0</span></span>',e.textTemplate=["vec(",")"]})),L.nthroot=w(je,(function(e,t){e.htmlTemplate='<sup class="mq-nthroot mq-non-leaf"><span class="mq-empty-box">&0</span></sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf"><span class="mq-empty-box">&1</span></span></span>',e.textTemplate=["sqrt[","](",")"],e.latex=function(){return"\\sqrt["+this.ends[E].latex()+"]{"+this.ends[S].latex()+"}"}})));L.lrncuberoot=w(je,(function(e,t){e.ctrlSeq="\\lrncuberoot",e.htmlTemplate='<sup class="mq-nthroot mq-non-leaf"><span class="mq-empty-box">3</span></sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf"><span class="mq-empty-box">&0</span></span></span>',e.textTemplate=["sqrt[3](",")"],e.latex=function(){return"\\sqrt[3]{"+this.ends[E].latex()+"}"}})),L.abs=w(Q,(function(e,t){e.ctrlSeq="\\abs",e.htmlTemplate='<span class="mq-abs mq-non-leaf"><span class="mq-empty-box">&0</span></span>',e.textTemplate=["|","|"]})),L.lrnplaceholder=w(Q,(function(e,t){e.ctrlSeq="\\lrnplaceholder",e.htmlTemplate='<span class="mq-lrnplaceholder mq-non-leaf"><span class="mq-empty-box">&0</span></span>',e.textTemplate=[""],e.latex=function(){return this.ends[E].latex()}})),L.lrnexponent=w(Q,(function(e,t){e.ctrSeq="\\lrnexponent",e.htmlTemplate='<span class="mq-lrnexponent mq-non-leaf"><span class="mq-lrnplaceholder mq-non-leaf"><span class="mq-empty-box">&0</span></span><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup"><span class="mq-empty-box">&1</span></span></span></span>',e.textTemplate=["","**"],e.latex=function(){var e=this.ends[S].latex();return e.length>1?e="{"+e+"}":0===e.length&&(e="{ }"),this.ends[E].latex()+"^"+e}})),L.lrnsquaredexponent=w(Q,(function(e,t){e.ctrSeq="\\lrnsquaredexponent",e.htmlTemplate='<span class="mq-lrnexponent mq-non-leaf"><span class="mq-lrnplaceholder mq-non-leaf"><span class="mq-empty-box">&0</span></span><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup"><span class="mq-empty-box">2</span></span></span></span>',e.textTemplate=["","**2"],e.latex=function(){return this.ends[E].latex()+"^2"}})),L.lrnsubscript=w(Q,(function(e,t){e.ctrSeq="\\lrnsubscript",e.htmlTemplate='<span class="mq-lrnexponent mq-non-leaf"><span class="mq-lrnplaceholder mq-non-leaf"><span class="mq-empty-box">&0</span></span><span class="mq-supsub mq-non-leaf"><span class="mq-sub"><span class="mq-empty-box">&1</span></span><span style="display:inline-block;width:0">&nbsp;</span></span></span>',e.textTemplate=["","_"],e.latex=function(){return this.ends[E].latex()+"_"+this.ends[S].latex()}}));function DelimsMixin(e,t){e.jQadd=function(){t.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},e.reflow=function(){var e=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));Ce(this.delimjQs,a(1+.2*(e-1),1.2),1.2*e)}}var Ve=w(w(Q,DelimsMixin),(function(e,t){e.init=function(e,r,a,s,l){t.init.call(this,"\\left"+s,void 0,[r,a]),this.side=e,this.sides={},this.sides[E]={ch:r,ctrlSeq:s},this.sides[S]={ch:a,ctrlSeq:l}},e.numBlocks=function(){return 1},e.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===S?" mq-ghost":"")+'">'+this.sides[E].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===E?" mq-ghost":"")+'">'+("."===this.sides[S].ch?" ":this.sides[S].ch)+"</span></span>",t.html.call(this)},e.latex=function(){return"\\left"+this.sides[E].ctrlSeq+this.ends[E].latex()+"\\right"+this.sides[S].ctrlSeq},e.oppBrack=function(e,t,r){return t instanceof Ve&&t.side&&t.side!==-r&&("|"===this.sides[this.side].ch||t.side===-this.side)&&(!e.restrictMismatchedBrackets||ze[this.sides[this.side].ch]===t.sides[t.side].ch||{"(":"]","[":")"}[this.sides[E].ch]===t.sides[S].ch)&&t},e.closeOpposing=function(e){e.side=0,e.sides[this.side]=this.sides[this.side],e.delimjQs.eq(this.side===E?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},e.createLeftOf=function(e){if(!this.replacedFragment)var r=e.options,a=this.oppBrack(r,e[E],E)||this.oppBrack(r,e[S],S)||this.oppBrack(r,e.parent.parent);if(a){var s=this.side=-a.side;this.closeOpposing(a),a===e.parent.parent&&e[s]&&(A(e[s],e.parent.ends[s],-s).disown().withDirAdopt(-s,a.parent,a,a[s]).jQ.insDirOf(s,a.jQ),a.bubble("reflow"))}else s=(a=this).side,a.replacedFragment?a.side=0:e[-s]&&(a.replaces(A(e[-s],e.parent.ends[-s],s)),e[-s]=0),t.createLeftOf.call(a,e);s===E?e.insAtLeftEnd(a.ends[E]):e.insRightOf(a)},e.placeCursor=noop,e.unwrap=function(){this.ends[E].children().disown().adopt(this.parent,this,this[S]).jQ.insertAfter(this.jQ),this.remove()},e.deleteSide=function(e,t,r){var a=this.parent,s=this[e],l=a.ends[e];if(e===this.side)return this.unwrap(),void(s?r.insDirOf(-e,s):r.insAtDirEnd(e,a));var y=r.options;if(this.side=-e,this.oppBrack(y,this.ends[E].ends[this.side],e)){this.closeOpposing(this.ends[E].ends[this.side]);var w=this.ends[E].ends[e];this.unwrap(),w.siblingCreated&&w.siblingCreated(r.options,e),s?r.insDirOf(-e,s):r.insAtDirEnd(e,a)}else if(this.oppBrack(y,this.parent.parent,e)?(this.parent.parent.closeOpposing(this),this.parent.parent.unwrap()):(this.sides[e]={ch:ze[this.sides[this.side].ch],ctrlSeq:ze[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(e===E?0:1).addClass("mq-ghost").html(this.sides[e].ch)),s){w=this.ends[E].ends[e];A(s,l,-e).disown().withDirAdopt(-e,this.ends[E],w,0).jQ.insAtDirEnd(e,this.ends[E].jQ.removeClass("mq-empty")),w.siblingCreated&&w.siblingCreated(r.options,e),r.insDirOf(-e,s)}else t?r.insDirOf(e,this):r.insAtDirEnd(e,this.ends[E])},e.deleteTowards=function(e,t){this.deleteSide(-e,!1,t)},e.finalizeTree=function(){this.ends[E].deleteOutOf=function(e,t){this.parent.deleteSide(e,!0,t)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===E?1:0).removeClass("mq-ghost"),this.side=0}},e.siblingCreated=function(e,t){t===-this.side&&this.finalizeTree()}})),ze={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|"};function bindCharBracketPair(e,t){t=t||e;var r=ze[e],a=ze[t];R[e]=bind(Ve,E,e,r,t,a),R[r]=bind(Ve,S,e,r,t,a)}bindCharBracketPair("("),bindCharBracketPair("["),bindCharBracketPair("{","\\{"),L.langle=bind(Ve,E,"&lang;","&rang;","\\langle ","\\rangle "),L.rangle=bind(Ve,S,"&lang;","&rang;","\\langle ","\\rangle "),R["|"]=bind(Ve,E,"|","|","|","|"),L.left=w(Q,(function(e){e.parser=function(){var e=U.regex,t=U.string,r=(U.succeed,U.optWhitespace);return r.then(e(/^(?:[([|]|\\\{)/)).then((function(a){var s="\\"===a.charAt(0)?a.slice(1):a;return K.then((function(l){var y=e(/^(?:[\])|]|\\\})/);return l.ends[-1]===l.ends[1]&&l.ends[1]instanceof $e.array&&(y=e(/^(?:[\])|\.]|\\\})/)),t("\\right").skip(r).then(y).map((function(e){var t="\\"===e.charAt(0)?e.slice(1):e,r=Ve(0,s,t,a,e);return r.blocks=[l],l.adopt(r,0,0),r}))}))}))}})),L.right=w(Q,(function(e){e.parser=function(){return U.fail("unmatched \\right")}}));var Ue=L.binom=L.binomial=w(w(Q,DelimsMixin),(function(e,t){e.ctrlSeq="\\binom",e.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',e.textTemplate=["choose(",",",")"]})),Ge=(L.choose=w(Ue,(function(e){e.createLeftOf=Fe.prototype.createLeftOf})),w(Y,(function(e,t){e.init=function(e){e="\\"+e,t.init.call(this,e,'<span class="mq-unknown-cmd">'+e+"</span>")}}))),Ke=w(MathQuill.MathField,(function(e){e.init=function(e,t,r,a,s){RootBlockMixin(e),this.__options=a||W();var l=q(this,e,r);l.editable=s,e.ultimateRoot=t,e.select=V.prototype.select,l.createTextarea(),l.editablesTextareaEvents(),l.cursor.insAtRightEnd(e)}}));L.MathQuillMathField=w(Q,(function(e,t){e.ctrlSeq="\\MathQuillMathField",e.htmlTemplate='<span class="mq-editable-field mq-inner-editable"><span class="mq-root-block">&0</span></span>',e.parser=function(){var e=this,r=U.string,a=U.regex,s=U.succeed;return r("[").then(a(/^[a-z][a-z0-9]*/i)).skip(r("]")).map((function(t){e.name=t})).or(s()).then(t.parser.call(e))},e.finalizeTree=function(){var e=N.byId[this.jQ.closest(".mq-root-block").attr(r)],t=e&&e.controller&&e.controller.API.__options||{},a=this.ends[E].keystroke;function focusAdjacentEditable(e,t,r){var a,s;if(!r[e])for(;s=t[e]||t.parent&&t.parent[e];)if((a=(t=s).jQ.filter(".mq-editable-field").add(t.jQ.find(".mq-editable-field")).eq(0)).length)return a.find(".mq-textarea").children()[0].focus(),!0}Ke(this.ends[E],e,this.jQ,t,!0),this.ends[E].keystroke=function(e,t,r){var s=r.cursor,l=!1;switch(e){case"Left":l=focusAdjacentEditable(E,this.parent,s);break;case"Right":l=focusAdjacentEditable(S,this.parent,s);break;case"Up":l=focusAdjacentEditable("upOutOf",this.parent,s);break;case"Down":l=focusAdjacentEditable("downOutOf",this.parent,s)}l||"function"!=typeof a||a.apply(this,arguments)}},e.registerInnerField=function(e){e.push(e[this.name]=this.ends[E].controller.API)},e.latex=function(){return this.ends[E].latex()},e.text=function(){return this.ends[E].text()},e.seek=function(){return t.seek.apply(this,arguments)},e.focus=function(){return t.focus.apply(this,arguments)},e.blur=function(){return t.blur&&t.blur.apply(this,arguments)}})),L.MathQuillVarField=w(Q,(function(e,t){e.ctrlSeq="\\MathQuillVarField",e.htmlTemplate='<span class="lrn-mq-var-container"><span class="mq-root-block">&0</span></span>',e.latex=function(){return"{{var:"+this.ends[E].latex()+"}}"},e.text=function(){return this.ends[E].text()},e.finalizeTree=function(){var e=N.byId[this.jQ.closest(".mq-root-block").attr(r)],t=e&&e.controller&&e.controller.API.__options||{};Ke(this.ends[E],e,this.jQ,t,!1),this.ends[E].keystroke=function(e,t,r){t.preventDefault()}}})),L.MathQuillResponseContainer=w(Q,(function(e,t){e.ctrlSeq="\\MathQuillResponseContainer",e.htmlTemplate='<span class="lrn-mq-response-container"><marker class="lrn-qe-keyboard-i-response"></marker><content>Response</content></span>',e.latex=function(){return"\\MathQuillResponseContainer"},e.text=function(){return this.ends[E].text()}})),L.MathQuillResponseContainerIcon=w(Q,(function(e,t){e.ctrlSeq="\\MathQuillResponseContainerIcon",e.htmlTemplate='<span class="lrn-mq-response-container-icon"><span class="lrn-qe-keyboard-i-response"></span></span>',e.latex=function(){return"\\MathQuillResponseContainerIcon"},e.text=function(){return this.ends[E].text()}}));var $e={};L.begin=w(Q,(function(e,t){e.parser=function(){var e=U.string,t=U.regex;return e("{").then(t(/^[a-z]+\*?/i)).skip(e("}")).then((function(e){return $e[e]?$e[e]().parser():U.fail("unknown environment type: "+e)}))}}));var Qe=L.matrix=$e.matrix=w(Q,(function(e,t){var s=w(J,(function(e,t){e.init=function(e,r){return this.column=e,this.row=r,t.init.call(this)},e.keystroke=function(e,r,a){switch(e){case"Shift-Spacebar":return r.preventDefault(),this.parent.insertColumn(this,a.cursor);case"Shift-Enter":return this.parent.insertRow(this,a.cursor)}return t.keystroke.apply(this,arguments)},e.deleteOutOf=function(e,r){var a=this,s=arguments;this.parent.backspace(this,e,r,(function(){return t.deleteOutOf.apply(a,s)}))}})),l="&",y="\\\\";e.parentheses={left:null,right:null},e.maximum={rows:10,columns:10},e.defaults={rows:2,columns:2},e.ctrlSeq="\\matrix",e.createBlocks=function(){var e,t,r=this,a=r.blocks=[],l=0;this.htmlTemplate.replace(/&\d+/g,(function(y,w){var E=r.htmlTemplate.substring(0,w).match(/<tr[^>]*>/gi).length-1;t=e===E?t+1:0,a[l]=s(t,E),a[l].adopt(r,r.ends[S],0),e=E,l++}))},e.reflow=function(){var e=this.jQ.children("table"),t=e.outerHeight()/+e.css("fontSize").slice(0,-2),r=this.jQ.children(".mq-paren");r.length&&Ce(r,a(1+.2*(t-1),1.2),1.05*t)},e.latex=function(){var e,t,r,a=this.getMatrixName(),s="\\begin{"+a+"}";for(r=0;r<this.blocks.length;r++)e=this.blocks[r].row,void 0!==t&&(s+=t!==e?y:l),t=e,s+=this.blocks[r].latex();return s+="\\end{"+a+"}"},e.createLeftOf=function(r){this.cursor=r;var a=Math.min(this.defaults.rows,this.maximum.rows),s=Math.min(this.defaults.columns,this.maximum.columns);this.defaultHtmlTemplate=this.defaultHtmlTemplate||this.generateHtmlTemplate(a,s),e.htmlTemplate=this.defaultHtmlTemplate,t.createLeftOf.call(this,r)},e.getMatrixName=function(){return this.ctrlSeq.replace("\\","")},e.generateHtmlTemplate=function(e,t){var r=this,a='<span class="mq-matrix mq-non-leaf">'+parenTemplate(this.parentheses.left);a+='<table class="mq-non-leaf">',e=Math.min(e,this.maximum.rows),t=Math.min(t,this.maximum.columns);for(var s=0,l=0;l<e;l++){a+="<tr>";for(var y=0;y<t;y++)a+="<td"+columnClass(y)+">&"+s+"</td>",s++;a+="</tr>"}return a+="</table>",a+=parenTemplate(this.parentheses.right)+"</span>";function parenTemplate(e){return e?'<span class="mq-paren mq-scaled">'+e+"</span>":""}function columnClass(e){var t=r.getColumnClass&&r.getColumnClass(e);return t?' class="'+t+'"':""}},e.htmlTemplate=e.generateHtmlTemplate(1,1),e.parser=function(){var e=U.regex,t=this,r=this.getMatrixName(),a=new RegExp("^(.*?)\\\\end{"+r+"}"),w=new RegExp("\\\\end{"+r+"}");return e(a).then((function(e){var r,a=[],E=e.replace(w,"").split(y),T=Math.min(E.length,t.maximum.rows),O=0;for(A=0;A<T;A++)r=E[A].split(l),O=Math.max(O,r.length);for(O=Math.min(O,t.maximum.columns),A=0;A<T;A++){r=E[A].split(l);for(e=0;e<O;e++){var N=s(e,A);K.parse(r[e]||" ").children().adopt(N,N.ends[S],0),a.push(N)}}t.htmlTemplate=t.generateHtmlTemplate(T,O),t.blocks=a;for(var A=0;A<a.length;A+=1)a[A].adopt(t,t.ends[S],0);return U.succeed(t)}))},e.finalizeTree=function(){var e=this.jQ.find("table");e.length&&(this.relink(),e.removeClass((function(e,t){var r=t.match(/mq-rows-\d+/g);return r&&r.join(" ")||""})),e.addClass("mq-rows-"+e.find("tr").length))},e.relink=function(){var e=this.jQ.find("td"),t=N.byId[e.first().attr(r)],a=N.byId[e.last().attr(r)],s=e.eq(0).closest("tr"),l=[];e.each((function(t){var a,y=N.byId[T(this).attr(r)],w=e.eq(t+1),O=T(this).closest("tr").next("tr"),A=T(this).closest("tr").index(),L=T(this).index();if(w.length){var R=N.byId[w.attr(r)];y[S]=R,R[E]=y}if((a=O.length?O.find("td").eq(L):s.find("td").eq(L+1)).length){var D=N.byId[a.attr(r)];y.downOutOf=D,D.upOutOf=y}y.column=L,y.row=A,l.push(y)})),this.ends[E]=t,this.ends[S]=a,t&&t[E]&&delete t[E],a&&a[S]&&delete a[S],this.blocks=l},e.deleteCell=function(e){var t,a=e.jQ.closest("tr"),s=e.jQ.index(),l=a.index(),y=a.find("td").not(e.jQ),w=this.jQ.find("tr").not(a).map((function(){return T(this).find("td")[s]})),E=1===this.jQ.find("td").length;function isEmpty(){return N.byId[T(this).attr(r)].isEmpty()}return y.filter(isEmpty).length===y.length&&w.length&&(y.remove(),e.jQ.remove(),a.remove(),this.finalizeTree()),w.filter(isEmpty).length===w.length&&y.length&&(w.remove(),e.jQ.remove(),this.finalizeTree()),E||(l=Math.min(l,this.jQ.find("tr").length-1),s=Math.min(s,this.jQ.find("tr").eq(l).find("td").length-1),t=N.byId[this.jQ.find("tr").eq(l).find("td").eq(s).attr(r)]),t},e.addRow=function(e){if(!(this.jQ.find("tr").length>=this.maximum.rows)){for(var t,a,l=e.find("td").length,y=T("<tr></tr>"),w=0;w<l;w++)(t=s()).parent=this,t.jQ=T('<td class="mq-empty">').attr(r,t.id),y.append(t.jQ),a=a||t;return y.insertAfter(e),a}},e.addColumn=function(e){if(!(e.closest("tr").find("td").length>=this.maximum.columns)){var t,a=e.index(),l=e.closest("tr").index(),y=this,w=[];return this.jQ.find("tr").each((function(){(t=s()).parent=y,t.jQ=T('<td class="mq-empty">').attr(r,t.id),t.jQ.insertAfter(T(this).find("td").eq(a)),w.push(t)})),w[l]}},e.insertColumn=function(e,t){newBlock=this.addColumn(e.jQ),newBlock&&(this.finalizeTree(),this.bubble("reflow"),t.insAtRightEnd(newBlock))},e.insertRow=function(e,t){newBlock=this.addRow(e.jQ.closest("tr")),newBlock&&(this.finalizeTree(),this.bubble("reflow"),t.insAtRightEnd(newBlock))},e.backspace=function(e,t,r,a){if(e.isEmpty()){var s=this.deleteCell(e);s?r.insAtRightEnd(s):(a(),this.finalizeTree()),this.bubble("edited")}}}));return $e.array=w(Qe,(function(e,t){e.ctrlSeq="\\array",e.defaults={rows:2,columns:1},e.parser=function(){var e=U.regex,r=U.string,a=this;return r("{").then(e(/^[rcl]+/)).then((function(e){return a.alignments=e,r("}").then(t.parser.call(a))}))},e.getColumnClass=function(e){if(this.alignments&&this.alignments.length>e)return"mq-array-column-"+this.alignments.charAt(e)},e.latex=function(){var e=t.latex.call(this),r="\\begin{"+this.getMatrixName()+"}";return this.alignments?e.replace(r,r+"{"+this.alignments+"}"):e}})),L.pmatrix=$e.pmatrix=w(Qe,(function(e,t){e.ctrlSeq="\\pmatrix",e.parentheses={left:"(",right:")"}})),L.bmatrix=$e.bmatrix=w(Qe,(function(e,t){e.ctrlSeq="\\bmatrix",e.parentheses={left:"[",right:"]"}})),L.Bmatrix=$e.Bmatrix=w(Qe,(function(e,t){e.ctrlSeq="\\Bmatrix",e.parentheses={left:"{",right:"}"}})),L.vmatrix=$e.vmatrix=w(Qe,(function(e,t){e.ctrlSeq="\\vmatrix",e.parentheses={left:"|",right:"|"}})),L.Vmatrix=$e.Vmatrix=w(Qe,(function(e,t){e.ctrlSeq="\\Vmatrix",e.parentheses={left:"&#8214;",right:"&#8214;"}})),MathQuill}.apply(t,a))||(e.exports=s)},function(e,t,r){"use strict";r.r(t);var a=r(257),s=r(268);t.default={View:s.a,Model:a.a}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";r.d(t,"a",(function(){return S})),r.d(t,"c",(function(){return hasBlockElement}));var a=r(1),s=r.n(a),l=r(0),y=r.n(l),w=r(7),E=r(2),S=["h1","h2","h3","h4","h5","h6","p","pre","div","blockquote","section","article","table"],T=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,O=new function(){var e=/Mac|iPad|iPhone|iPod/.test(navigator.platform),t=y.a.uniqueId("lrn_capslock_listener_"),r=this,a=[];function setStatus(e){r.status!==e&&(y.a.each(a,(function(t){t(e)})),r.status=e)}this.status=!1,this.observe=function(l,w){return w&&(l=y.a.bind(l,w)),a.push(l),1===a.length&&function startListening(){var a=!1;s()(window).on("focus."+t,(function(){s()(window).one("keypress."+t,r.correctStatus)})),e?(s()(window).on("keydown."+t,(function(e){20===(e||window.event).keyCode&&setStatus(!r.status)})),s()(window).on("keyup."+t,(function(e){20===(e||window.event).keyCode&&setStatus(!1)}))):(s()(window).on("keydown."+t,(function(e){var t=e||window.event;a||20!==t.keyCode||(setStatus(!r.status),a=!0)})),s()(window).on("keyup."+t,(function(e){var t=e||window.event;a&&20===t.keyCode&&(a=!1)})))}(),l},this.unobserve=function(e){(a=y.a.without(a,e)).length||function stopListening(){s()(window).off("."+t)}()},this.correctStatus=function(t){var r=t||window.event,a=r.charCode||r.keyCode,s=r.shiftKey;a<123&&a>96?setStatus(s):!(a<91&&a>64)||e&&s||setStatus(!s)}},N=new function(){var e=y.a.uniqueId("lrn_fullscreen_listener_"),t=this,r=[],a={generic:{change:"fullscreenchange",element:"fullscreenElement"},webkit:{change:"webkitfullscreenchange",element:"webkitFullscreenElement"},ms:{change:"MSFullscreenChange",element:"msFullscreenElement"},moz:{change:"mozfullscreenchange",element:"mozFullScreenElement"}},l="ie"===w.a.browser&&11===w.a.version,E=y.a.find(a,(function(e){if("on".concat(e.change)in document.documentElement)return e}));!E&&l&&(E=a.ms);var S=!1;function setElement(){var e=document[E.element];t.element!==e&&(y.a.each(r,(function(t){t(e)})),t.element=e)}function updateElementAfterNextRender(){S||(S=!0,requestAnimationFrame((function(){requestAnimationFrame((function(){S=!1,setElement()}))})))}this.element=null,this.observe=function(t,a){return a&&(t=y.a.bind(t,a)),E&&(r.push(t),1===r.length&&function startListening(){s()(document).on(E.change+"."+e,updateElementAfterNextRender),S||setElement()}()),t},this.unobserve=function(t){(r=y.a.without(r,t)).length||function stopListening(){s()(document).off("."+e)}()}};function isEventSupported(e){var t=document.createElement("p"),r=!1;if(t.addEventListener)t.addEventListener(e,(function(){r=!0}),!1);else{if(!t.attachEvent)return!1;t.attachEvent("on"+e,(function(){r=!0}))}return t.setAttribute("id","target"),r}function hasBlockElement(e){return y.a.some(S,(function(t){return new RegExp("<".concat(t,"[^>]*>(.*?)<\\/").concat(t,">")).test(e)}))}t.b={capsLock:O,fullScreen:N,getViewportOffset:function getViewportOffset(){var e=s()(window),t={top:e.scrollTop(),left:e.scrollLeft()};return t.right=t.left+e.width(),t.bottom=t.top+e.height(),t},getVisibleViewportDimensions:function getVisibleViewportDimensions(){var e,t=window.innerWidth,r=window.innerHeight;return y.a.contains(["firefox","opera"],w.a.browser)&&(t=(e=s()('<div style="position:fixed;right:0;bottom:0;"></div>').appendTo(s()("body"))).get(0).getBoundingClientRect().left,r=e.get(0).getBoundingClientRect().top,e.remove()),{width:t,height:r}},sidesOnScreen:function sidesOnScreen(e){var t=s()(e),r=t.offset(),a=this.getViewportOffset();return r.right=r.left+t.outerWidth(),r.bottom=r.top+t.outerHeight(),{top:a.top<r.top&&r.top<a.bottom,right:a.right>r.right&&r.right>a.left,bottom:a.bottom>r.bottom&&r.bottom>a.top,left:a.left<r.left&&r.left<a.right}},observeMutation:function observeMutation(e,t,r){t=t||{};var a,l=s()(e),w=y.a.uniqueId("lrn.mutation."),E={childList:t.childList||!1,characterData:t.characterData||!1,attributeOldValue:t.attributeOldValue||!1,charactedDataOldValue:t.charactedDataOldValue||!1,subtree:t.subtree||!1,attributes:t.attributes||!1};if(t.attributeFilter instanceof Array&&(E.attributeFilter=t.attributeFilter),T){if(!(E.childList||E.attributes||E.characterData))return console.log('NOTE: At the very least, childList, attributes, or characterData must be set to true. Otherwise, "An invalid or illegal string was specified" error is thrown.'),!1;a=new T((function(e){e.forEach(r)})),l.each((function(){try{a.observe(e,E)}catch(t){console.log(t,e,E)}}))}else l.data("lrn-mutation-ns",w),E.attributes&&(isEventSupported("DOMAttrModified")?l.on("DOMAttrModified."+w,r):"onpropertychange"in document.body&&e.attachEvent("propertychange",r)),E.childList&&(isEventSupported("DOMSubtreeModified")?l.on("DOMSubtreeModified."+w+" DOMCharacterDataModified."+w+" DOMAttributeNameChanged."+w,r):"onpropertychange"in document.body&&l.find("*").each((function(){this.attachEvent&&this.attachEvent("onpropertychange",r)})));return a},unobserveMutation:function unobserveMutation(e,t,r){if(e)e.disconnect();else{var a=s()(t),l=a.data("lrn-mutation-ns");a.removeData("lrn-mutation-ns").off("."+l),r&&!isEventSupported("DOMSubtreeModified")&&"onpropertychange"in document.body&&(t.detachEvent("onpropertychange",r),a.find("*").each((function(){this.detachEvent&&this.detachEvent("onpropertychange",r)})))}},recomputeOpacityOn:function recomputeOpacityOn(e){if(window.getComputedStyle)return window.getComputedStyle(e).opacity},updateButtonMap:function updateButtonMap(e){var t=function getButtonMap(e){return e.map((function(){var e=s()(this),t=e.offset(),r=t.left+parseInt(e.css("margin-left"),10),a=t.top+parseInt(e.css("margin-top"),10);return{top:a,right:r+e.width(),bottom:a+e.height(),left:r,el:this,links:{}}})).get()}(e);function isBetween(e,t,r){return y.a.min([t,r])<=e&&y.a.max([t,r])>=e}function closest(e,t){var r=(t.left+t.right)/2,a=(t.top+t.bottom)/2;return y.a.first(y.a.sortBy(e,(function(e){var t=(e.left+e.right)/2,s=(e.top+e.bottom)/2,l=Math.abs(t-r),y=Math.abs(s-a);return Math.sqrt(l*l+y*y)})))}function areAligned(e,t,r,a){return isBetween(r,e,t)||isBetween(a,e,t)||isBetween(e,r,a)&&isBetween(t,r,a)}return y.a.each(t,(function(e){var r,a,s,l,y=[],w=[];for(l=0;l<t.length;l++)(s=t[l])!==e&&(areAligned(e.top,e.bottom,s.top,s.bottom)&&s.left>=e.right&&y.push(s),areAligned(e.left,e.right,s.left,s.right)&&s.top>=e.bottom&&w.push(s));r=closest(y,e),a=closest(w,e),r&&(e.links.RIGHT=r,r.links.LEFT=e),a&&(e.links.DOWN=a,a.links.UP=e)})),t},toggleBackgroundClickable:function toggleBackgroundClickable(e){var t=s()("html"),r=t.map((function(){return s()(this).css("cursor")})).get();e&&!y.a.isEqual(r,["pointer"])&&(this.cachedHtmlCursorStyle=r,t.css("cursor","pointer")),!e&&this.cachedHtmlCursorStyle&&y.a.each(this.cachedHtmlCursorStyle,(function(e,r){t.eq(r).css("cursor","auto"===e?"":e)}))},isElementVisible:function isElementVisible(e){return!!e.offsetParent&&"hidden"!==getComputedStyle(e).getPropertyValue("visibility")},focusable:function focusable(e,t){var r,a,l,y=e.nodeName.toLowerCase();return"area"===y?(a=(r=e.parentNode).name,!(!e.href||!a||"map"!==r.nodeName.toLowerCase())&&(!!(l=s()('img[usemap="#'+a+'"]')[0])&&this.isElementVisible(l))):(/^(input|select|textarea|button|object)$/.test(y)?!e.disabled:"a"===y&&e.href||t)&&this.isElementVisible(e)},getNextTab:function getNextTab(e,t){var r,a,l,w,E,S=!1,T=!1,O=this,N=!0;return s()(document).find("*").each((function(A,L){return a=s()(L),l=a.attr("tabindex"),w=isNaN(l),r=(w||l>=0)&&O.focusable(L,!w),E=!1,y.a.isArray(t)&&y.a.each(t,(function(e){a.hasClass(e)&&(E=!0)})),!!E||(!T&&r&&(T=a),S&&r?(N=!1,T=a,!1):void(r&&L===e&&(S=!0)))})),!!T&&{nextTabElement:T,isFirstElement:N}},detectRenderEnd:function detectRenderEnd(e,t){var r=this,a={childList:!0,subtree:!0,attributes:!0};return new E.default((function(s){var l,y;function resolveSoon(){clearTimeout(l),l=setTimeout((function(){r.unobserveMutation(y,e,resolveSoon),s()}),t)}y=r.observeMutation(e,a,resolveSoon),resolveSoon()}))}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i18nTemplate}));var a=r(0),s=r.n(a);function i18nTemplate(e,t){return s.a.isEmpty(e)?"":(s()(t).forEach((function(t,r){var a="{{".concat(r,"}}");e=e.replace(a,t)})),e)}},function(e,t,r){"use strict";r.d(t,"b",(function(){return isArrowKey})),r.d(t,"c",(function(){return isEnterOrSpace}));var a=r(0),s=r.n(a);function isArrowKey(e){return s.a.contains([37,38,39,40],e)}function isEnterOrSpace(e){return 32===e||13===e}t.a={PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,ESCAPE:27,ENTER:13,TAB:9,SHIFT:16,SPACE:32,DELETE:46,ADD_EQUAL:187,FF_ADD_EQUAL:61,NUM_PAD_ADD:107,MINUS:189,FF_MINUS:173,NUM_PAD_MINUS:109,NUM_PAD_MULTIPLY:106,DIVIDE:191,NUM_PAD_DIVIDE:111,DECIMAL:190,NUM_PAD_DECIMAL:110,NUMBER_0:48,NUMBER_1:49,NUMBER_2:50,NUMBER_3:51,NUMBER_4:52,NUMBER_5:53,NUMBER_6:54,NUMBER_7:55,NUMBER_8:56,NUMBER_9:57,NUM_PAD_0:96,NUM_PAD_1:97,NUM_PAD_2:98,NUM_PAD_3:99,NUM_PAD_4:100,NUM_PAD_5:101,NUM_PAD_6:102,NUM_PAD_7:103,NUM_PAD_8:104,NUM_PAD_9:105}},,,function(e,t,r){"use strict";r.d(t,"c",(function(){return getViewportDimensions})),r.d(t,"b",(function(){return getElementDocumentBounding}));var a=r(0),s=r.n(a),l=document.documentElement;function getViewportScroll(){return{left:window.pageXOffset||l.scrollLeft,top:window.pageYOffset||l.scrollTop}}function getViewportDimensions(){var e=getViewportScroll();return{top:e.top,left:e.left,width:document.documentElement.clientWidth||document.body.clientWidth,height:document.documentElement.clientHeight||document.body.clientHeight}}function getDocumentDimensions(){var e=document.body,t=document.documentElement;return{width:Math.max(e.scrollWidth,e.offsetWidth,t.clientWidth,t.scrollWidth,t.offsetWidth),height:Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)}}function getElementDocumentBounding(e){var t=e.getBoundingClientRect(),r=getViewportScroll();return{top:t.top+r.top,left:t.left+r.left,width:t.width,height:t.height}}t.a={relativeToElement:function relativeToElement(e,t,r){var a=s.a.extend({gap:0,viewportGap:5,centerAlign:!0},r),l=a.gap,y=getElementDocumentBounding(t),w=a.centerAlign?y.width/2:0,E=getElementDocumentBounding(e),S=a.centerAlign?E.width/2:0,T=a.viewportGap,O=getViewportDimensions(),N=getDocumentDimensions(),A=E.top+E.height+l,L=N.height-A,R=E.top-O.top<O.height+O.top-A&&L>y.height||A<y.height,D=E.left+S-w,M=A,B="bottom";return y.width>=O.width?D=0:D+y.width>O.width?D=O.width-y.width-T:D<0&&(D=T),M+y.height>O.top+O.height&&(M=E.top-y.height-l,B="top"),(M<0||R)&&(M=A,B="bottom"),{left:D,top:M,position:B}},getViewportScroll:getViewportScroll,getViewportDimensions:getViewportDimensions,getViewportCenter:function getViewportCenter(){var e=getViewportDimensions();return{x:e.left+e.width/2,y:e.top+e.height/2}},getDocumentDimensions:getDocumentDimensions,getElementDocumentBounding:getElementDocumentBounding,getPositionRelativeToParent:function getPositionRelativeToParent(e,t){var r=getElementDocumentBounding(e),a=getElementDocumentBounding(t);return{top:r.top-a.top,left:r.left-a.left}}}},,function(e,t,r){"use strict";r(5),r(1);var a=r(0),s=r.n(a),l=r(163),y=[{key:"mathrm",latex:"\\mathrm"},{key:"mathit",latex:"\\mathit"},{key:"mathbf",latex:"\\mathbf"},{key:"mathsf",latex:"\\mathsf"},{key:"mathtt",latex:"\\mathtt"},{key:"underline",latex:"\\underline"},{key:"bar",latex:"\\overline"},{key:"overline",latex:"\\overline"},{key:"_",latex:"_"},{key:"subscript",latex:"_"},{key:"^",latex:"^"},{key:"supscript",latex:"^"},{key:"superscript",latex:"^"},{key:"fraction",latex:"\\frac"},{key:"cfrac",latex:"\\frac"},{key:"dfrac",latex:"\\frac"},{key:"frac",latex:"\\frac"},{key:"over",latex:"\\frac"},{key:"√",latex:"\\sqrt"},{key:"sqrt",latex:"\\sqrt"},{key:"vec",latex:"\\vec"},{key:"nthroot",latex:"\\sqrt"},{key:"lbrace",latex:"\\left\\{\\right\\}"},{key:"lang",latex:"\\left\\langle \\right\\rangle "},{key:"langle",latex:"\\left\\langle \\right\\rangle "},{key:"rbrace",latex:"\\left\\{\\right\\}"},{key:"rang",latex:"\\left\\langle \\right\\rangle "},{key:"rangle",latex:"\\left\\langle \\right\\rangle "},{key:"lparen",latex:"\\left(\\right)"},{key:"lbracket",latex:"\\left[\\right]"},{key:"lbrack",latex:"\\left[\\right]"},{key:"rparen",latex:"\\left(\\right)"},{key:"rbracket",latex:"\\left[\\right]"},{key:"rbrack",latex:"\\left[\\right]"},{key:"rpipe",latex:"\\left|\\right|"},{key:"lpipe",latex:"\\left|\\right|"},{key:"textmd",latex:"\\text"},{key:"textup",latex:"\\text"},{key:"textrm",latex:"\\text"},{key:"textnormal",latex:"\\text"},{key:"text",latex:"\\text"},{key:"textsl",latex:"\\textit"},{key:"textit",latex:"\\textit"},{key:"emph",latex:"\\textit"},{key:"italics",latex:"\\textit"},{key:"italic",latex:"\\textit"},{key:"em",latex:"\\textit"},{key:"textbf",latex:"\\textbf"},{key:"bold",latex:"\\textbf"},{key:"strong",latex:"\\textbf"},{key:"textsf",latex:"\\textsf"},{key:"sf",latex:"\\textsf"},{key:"texttt",latex:"\\texttt"},{key:"tt",latex:"\\texttt"},{key:"textsc",latex:"\\textsc"},{key:"uppercase",latex:"\\uppercase"},{key:"lowercase",latex:"\\lowercase"},{key:"binomial",latex:"\\binom"},{key:"binom",latex:"\\binom"},{key:"matrix",latex:"\\matrix"},{key:"pmatrix",latex:"\\pmatrix"},{key:"bmatrix",latex:"\\bmatrix"},{key:"Bmatrix",latex:"\\Bmatrix"},{key:"vmatrix",latex:"\\vmatrix"},{key:"Vmatrix",latex:"\\Vmatrix"},{key:"choose",latex:"\\binom"},{key:"vector",latex:"\\vector"},{key:"editable",latex:"\\editable"},{key:"f",latex:"f"},{key:"prime",latex:"'"},{key:"&",latex:"\\&"},{key:"%",latex:"\\%"},{key:"phi",latex:"\\phi "},{key:"varphi",latex:"\\varphi "},{key:"phiv",latex:"\\varphi "},{key:"epsilon",latex:"\\epsilon "},{key:"varepsilon",latex:"\\varepsilon "},{key:"epsiv",latex:"\\varepsilon "},{key:"varpi",latex:"\\varpi "},{key:"piv",latex:"\\varpi "},{key:"varsigma",latex:"\\varsigma "},{key:"sigmav",latex:"\\varsigma "},{key:"sigmaf",latex:"\\varsigma "},{key:"thetasym",latex:"\\vartheta "},{key:"vartheta",latex:"\\vartheta "},{key:"thetav",latex:"\\vartheta "},{key:"upsi",latex:"\\upsilon "},{key:"upsilon",latex:"\\upsilon "},{key:"digamma",latex:"\\digamma "},{key:"Gammad",latex:"\\digamma "},{key:"gammad",latex:"\\digamma "},{key:"varkappa",latex:"\\varkappa "},{key:"kappav",latex:"\\varkappa "},{key:"varrho",latex:"\\varrho "},{key:"rhov",latex:"\\varrho "},{key:"π",latex:"\\pi "},{key:"pi",latex:"\\pi "},{key:"lambda",latex:"\\lambda "},{key:"Upsih",latex:"\\Upsilon "},{key:"upsih",latex:"\\Upsilon "},{key:"Upsi",latex:"\\Upsilon "},{key:"Upsilon",latex:"\\Upsilon "},{key:"+",latex:"+"},{key:"-",latex:"-"},{key:"–",latex:"-"},{key:"plusminus",latex:"\\pm "},{key:"plusmn",latex:"\\pm "},{key:"pm",latex:"\\pm "},{key:"±",latex:"\\pm "},{key:"minusplus",latex:"\\mp "},{key:"mnplus",latex:"\\mp "},{key:"mp",latex:"\\mp "},{key:"response",latex:"\\response "},{key:"cdot",latex:"\\cdot "},{key:"sdot",latex:"\\cdot "},{key:"=",latex:"="},{key:"<",latex:"<"},{key:">",latex:">"},{key:"times",latex:"\\times "},{key:"divides",latex:"\\div "},{key:"divide",latex:"\\div "},{key:"div",latex:"\\div "},{key:"neq",latex:"\\ne "},{key:"ne",latex:"\\ne "},{key:"≠",latex:"\\ne "},{key:"lowast",latex:"\\ast "},{key:"loast",latex:"\\ast "},{key:"star",latex:"\\ast "},{key:"ast",latex:"\\ast "},{key:"therefore",latex:"\\therefore "},{key:"therefor",latex:"\\therefore "},{key:"because",latex:"\\because "},{key:"cuz",latex:"\\because "},{key:"propto",latex:"\\propto "},{key:"prop",latex:"\\propto "},{key:"approx",latex:"\\approx "},{key:"asymp",latex:"\\approx "},{key:"≈",latex:"\\approx "},{key:"lt",latex:"<"},{key:"gt",latex:">"},{key:"leq",latex:"\\le "},{key:"le",latex:"\\le "},{key:"≤",latex:"\\le "},{key:"geq",latex:"\\ge "},{key:"ge",latex:"\\ge "},{key:"≥",latex:"\\ge "},{key:"isin",latex:"\\in "},{key:"contains",latex:"\\ni "},{key:"ni",latex:"\\ni "},{key:"doesnotcontain",latex:"\\not\\ni "},{key:"notcontains",latex:"\\not\\ni "},{key:"niton",latex:"\\not\\ni "},{key:"notni",latex:"\\not\\ni "},{key:"subset",latex:"\\subset "},{key:"sub",latex:"\\subset "},{key:"superset",latex:"\\supset "},{key:"supset",latex:"\\supset "},{key:"sup",latex:"\\supset "},{key:"notsubset",latex:"\\not\\subset "},{key:"nsubset",latex:"\\not\\subset "},{key:"notsub",latex:"\\not\\subset "},{key:"nsub",latex:"\\not\\subset "},{key:"notsuperset",latex:"\\not\\supset "},{key:"nsuperset",latex:"\\not\\supset "},{key:"notsupset",latex:"\\not\\supset "},{key:"nsupset",latex:"\\not\\supset "},{key:"notsup",latex:"\\not\\supset "},{key:"nsup",latex:"\\not\\supset "},{key:"subseteq",latex:"\\subseteq "},{key:"subsete",latex:"\\subseteq "},{key:"subeq",latex:"\\subseteq "},{key:"sube",latex:"\\subseteq "},{key:"superseteq",latex:"\\supseteq "},{key:"supersete",latex:"\\supseteq "},{key:"supseteq",latex:"\\supseteq "},{key:"supsete",latex:"\\supseteq "},{key:"supeq",latex:"\\supseteq "},{key:"supe",latex:"\\supseteq "},{key:"notsubseteq",latex:"\\not\\subseteq "},{key:"notsubsete",latex:"\\not\\subseteq "},{key:"nsubseteq",latex:"\\not\\subseteq "},{key:"nsubsete",latex:"\\not\\subseteq "},{key:"notsubeq",latex:"\\not\\subseteq "},{key:"notsube",latex:"\\not\\subseteq "},{key:"nsubeq",latex:"\\not\\subseteq "},{key:"nsube",latex:"\\not\\subseteq "},{key:"notsuperseteq",latex:"\\not\\supseteq "},{key:"notsupersete",latex:"\\not\\supseteq "},{key:"nsuperseteq",latex:"\\not\\supseteq "},{key:"nsupersete",latex:"\\not\\supseteq "},{key:"notsupseteq",latex:"\\not\\supseteq "},{key:"notsupsete",latex:"\\not\\supseteq "},{key:"nsupseteq",latex:"\\not\\supseteq "},{key:"nsupsete",latex:"\\not\\supseteq "},{key:"notsupeq",latex:"\\not\\supseteq "},{key:"notsupe",latex:"\\not\\supseteq "},{key:"nsupeq",latex:"\\not\\supseteq "},{key:"nsupe",latex:"\\not\\supseteq "},{key:"summation",latex:"\\sum "},{key:"sum",latex:"\\sum "},{key:"∑",latex:"\\sum "},{key:"product",latex:"\\prod "},{key:"prod",latex:"\\prod "},{key:"∏",latex:"\\prod "},{key:"coproduct",latex:"\\coprod "},{key:"coprod",latex:"\\coprod "},{key:"integral",latex:"\\int "},{key:"int",latex:"\\int "},{key:"∫",latex:"\\int "},{key:"Naturals",latex:"\\mathbb{N}"},{key:"naturals",latex:"\\mathbb{N}"},{key:"Probability",latex:"\\mathbb{P}"},{key:"probability",latex:"\\mathbb{P}"},{key:"Projective",latex:"\\mathbb{P}"},{key:"projective",latex:"\\mathbb{P}"},{key:"Primes",latex:"\\mathbb{P}"},{key:"primes",latex:"\\mathbb{P}"},{key:"P",latex:"\\mathbb{P}"},{key:"Integers",latex:"\\mathbb{Z}"},{key:"integers",latex:"\\mathbb{Z}"},{key:"Rationals",latex:"\\mathbb{Q}"},{key:"rationals",latex:"\\mathbb{Q}"},{key:"Q",latex:"\\mathbb{Q}"},{key:"Reals",latex:"\\mathbb{R}"},{key:"reals",latex:"\\mathbb{R}"},{key:"ComplexPlane",latex:"\\mathbb{C}"},{key:"Complexplane",latex:"\\mathbb{C}"},{key:"complexplane",latex:"\\mathbb{C}"},{key:"Complexes",latex:"\\mathbb{C}"},{key:"complexes",latex:"\\mathbb{C}"},{key:"Complex",latex:"\\mathbb{C}"},{key:"complex",latex:"\\mathbb{C}"},{key:"C",latex:"\\mathbb{C}"},{key:"Quaternions",latex:"\\mathbb{H}"},{key:"quaternions",latex:"\\mathbb{H}"},{key:"Hamiltonian",latex:"\\mathbb{H}"},{key:"emsp",latex:"\\quad "},{key:"quad",latex:"\\quad "},{key:"qquad",latex:"\\qquad "},{key:"diamond",latex:"\\diamond "},{key:"bigtriangleup",latex:"\\bigtriangleup "},{key:"ominus",latex:"\\ominus "},{key:"uplus",latex:"\\uplus "},{key:"bigtriangledown",latex:"\\bigtriangledown "},{key:"sqcap",latex:"\\sqcap "},{key:"triangleleft",latex:"\\triangleleft "},{key:"sqcup",latex:"\\sqcup "},{key:"triangleright",latex:"\\triangleright "},{key:"odot",latex:"\\odot "},{key:"bigcirc",latex:"\\bigcirc "},{key:"dagger",latex:"\\dagger "},{key:"ddagger",latex:"\\ddagger "},{key:"wr",latex:"\\wr "},{key:"amalg",latex:"\\amalg "},{key:"models",latex:"\\models "},{key:"prec",latex:"\\prec "},{key:"succ",latex:"\\succ "},{key:"preceq",latex:"\\preceq "},{key:"succeq",latex:"\\succeq "},{key:"simeq",latex:"\\simeq "},{key:"mid",latex:"\\mid "},{key:"ll",latex:"\\ll "},{key:"gg",latex:"\\gg "},{key:"parallel",latex:"\\parallel "},{key:"bowtie",latex:"\\bowtie "},{key:"sqsubset",latex:"\\sqsubset "},{key:"sqsupset",latex:"\\sqsupset "},{key:"smile",latex:"\\smile "},{key:"sqsubseteq",latex:"\\sqsubseteq "},{key:"sqsupseteq",latex:"\\sqsupseteq "},{key:"doteq",latex:"\\doteq "},{key:"frown",latex:"\\frown "},{key:"vdash",latex:"\\vdash "},{key:"dashv",latex:"\\dashv "},{key:"longleftarrow",latex:"\\longleftarrow "},{key:"longrightarrow",latex:"\\longrightarrow "},{key:"Longleftarrow",latex:"\\Longleftarrow "},{key:"Longrightarrow",latex:"\\Longrightarrow "},{key:"longleftrightarrow",latex:"\\longleftrightarrow "},{key:"updownarrow",latex:"\\updownarrow "},{key:"Longleftrightarrow",latex:"\\Longleftrightarrow "},{key:"Updownarrow",latex:"\\Updownarrow "},{key:"mapsto",latex:"\\mapsto "},{key:"nearrow",latex:"\\nearrow "},{key:"hookleftarrow",latex:"\\hookleftarrow "},{key:"hookrightarrow",latex:"\\hookrightarrow "},{key:"searrow",latex:"\\searrow "},{key:"leftharpoonup",latex:"\\leftharpoonup "},{key:"rightharpoonup",latex:"\\rightharpoonup "},{key:"swarrow",latex:"\\swarrow "},{key:"leftharpoondown",latex:"\\leftharpoondown "},{key:"rightharpoondown",latex:"\\rightharpoondown "},{key:"nwarrow",latex:"\\nwarrow "},{key:"ldots",latex:"\\ldots "},{key:"cdots",latex:"\\cdots "},{key:"vdots",latex:"\\vdots "},{key:"ddots",latex:"\\ddots "},{key:"surd",latex:"\\surd "},{key:"triangle",latex:"\\triangle "},{key:"ell",latex:"\\ell "},{key:"top",latex:"\\top "},{key:"flat",latex:"\\flat "},{key:"natural",latex:"\\natural "},{key:"sharp",latex:"\\sharp "},{key:"wp",latex:"\\wp "},{key:"bot",latex:"\\bot "},{key:"clubsuit",latex:"\\clubsuit "},{key:"diamondsuit",latex:"\\diamondsuit "},{key:"heartsuit",latex:"\\heartsuit "},{key:"spadesuit",latex:"\\spadesuit "},{key:"oint",latex:"\\oint "},{key:"bigcap",latex:"\\bigcap "},{key:"bigcup",latex:"\\bigcup "},{key:"bigsqcup",latex:"\\bigsqcup "},{key:"bigvee",latex:"\\bigvee "},{key:"bigwedge",latex:"\\bigwedge "},{key:"bigodot",latex:"\\bigodot "},{key:"bigotimes",latex:"\\bigotimes "},{key:"bigoplus",latex:"\\bigoplus "},{key:"biguplus",latex:"\\biguplus "},{key:"lfloor",latex:"\\lfloor "},{key:"rfloor",latex:"\\rfloor "},{key:"lceil",latex:"\\lceil "},{key:"rceil",latex:"\\rceil "},{key:"slash",latex:"\\slash "},{key:"opencurlybrace",latex:"\\opencurlybrace "},{key:"closecurlybrace",latex:"\\closecurlybrace "},{key:"caret",latex:"\\caret "},{key:"underscore",latex:"\\underscore "},{key:"backslash",latex:"\\backslash "},{key:"vert",latex:"|"},{key:"perpendicular",latex:"\\perp "},{key:"perp",latex:"\\perp "},{key:"del",latex:"\\nabla "},{key:"nabla",latex:"\\nabla "},{key:"hbar",latex:"\\hbar "},{key:"angstrom",latex:"\\text\\AA "},{key:"Angstrom",latex:"\\text\\AA "},{key:"AA",latex:"\\text\\AA "},{key:"circle",latex:"\\circ "},{key:"circ",latex:"\\circ "},{key:"ring",latex:"\\circ "},{key:"bullet",latex:"\\bullet "},{key:"bull",latex:"\\bullet "},{key:"smallsetminus",latex:"\\setminus "},{key:"setminus",latex:"\\setminus "},{key:"neg",latex:"\\neg "},{key:"¬",latex:"\\neg "},{key:"not",latex:"\\neg "},{key:"hellipsis",latex:"\\dots "},{key:"ellipsis",latex:"\\dots "},{key:"hellip",latex:"\\dots "},{key:"ellip",latex:"\\dots "},{key:"dots",latex:"\\dots "},{key:"…",latex:"\\dots "},{key:"downarrow",latex:"\\downarrow "},{key:"dnarrow",latex:"\\downarrow "},{key:"dnarr",latex:"\\downarrow "},{key:"darr",latex:"\\downarrow "},{key:"converges",latex:"\\downarrow "},{key:"Downarrow",latex:"\\Downarrow "},{key:"dnArrow",latex:"\\Downarrow "},{key:"dnArr",latex:"\\Downarrow "},{key:"dArr",latex:"\\Downarrow "},{key:"uparrow",latex:"\\uparrow "},{key:"uarr",latex:"\\uparrow "},{key:"diverges",latex:"\\uparrow "},{key:"Uparrow",latex:"\\Uparrow "},{key:"uArr",latex:"\\Uparrow "},{key:"to",latex:"\\to "},{key:"rightarrow",latex:"\\rightarrow "},{key:"rarr",latex:"\\rightarrow "},{key:"implies",latex:"\\Rightarrow "},{key:"Rightarrow",latex:"\\Rightarrow "},{key:"rArr",latex:"\\Rightarrow "},{key:"gets",latex:"\\gets "},{key:"leftarrow",latex:"\\leftarrow "},{key:"larr",latex:"\\leftarrow "},{key:"impliedby",latex:"\\Leftarrow "},{key:"Leftarrow",latex:"\\Leftarrow "},{key:"lArr",latex:"\\Leftarrow "},{key:"leftrightarrow",latex:"\\leftrightarrow "},{key:"lrarr",latex:"\\leftrightarrow "},{key:"harr",latex:"\\leftrightarrow "},{key:"iff",latex:"\\Leftrightarrow "},{key:"Leftrightarrow",latex:"\\Leftrightarrow "},{key:"lrArr",latex:"\\Leftrightarrow "},{key:"hArr",latex:"\\Leftrightarrow "},{key:"real",latex:"\\Re "},{key:"Real",latex:"\\Re "},{key:"Re",latex:"\\Re "},{key:"Imaginary",latex:"\\Im "},{key:"imaginary",latex:"\\Im "},{key:"imagin",latex:"\\Im "},{key:"image",latex:"\\Im "},{key:"imag",latex:"\\Im "},{key:"Im",latex:"\\Im "},{key:"partial",latex:"\\partial "},{key:"part",latex:"\\partial "},{key:"infinity",latex:"\\infty "},{key:"infty",latex:"\\infty "},{key:"infin",latex:"\\infty "},{key:"inf",latex:"\\infty "},{key:"alephsym",latex:"\\aleph "},{key:"aleph",latex:"\\aleph "},{key:"alefsym",latex:"\\aleph "},{key:"alef",latex:"\\aleph "},{key:"exists",latex:"\\exists "},{key:"exist",latex:"\\exists "},{key:"xists",latex:"\\exists "},{key:"xist",latex:"\\exists "},{key:"wedge",latex:"\\wedge "},{key:"land",latex:"\\wedge "},{key:"and",latex:"\\wedge "},{key:"vee",latex:"\\vee "},{key:"lor",latex:"\\vee "},{key:"or",latex:"\\vee "},{key:"varnothing",latex:"\\varnothing "},{key:"nothing",latex:"\\varnothing "},{key:"Oslash",latex:"\\varnothing "},{key:"oslash",latex:"\\varnothing "},{key:"emptyset",latex:"\\varnothing "},{key:"empty",latex:"\\varnothing "},{key:"union",latex:"\\cup "},{key:"intersection",latex:"\\cap "},{key:"intersect",latex:"\\cap "},{key:"cap",latex:"\\cap "},{key:"degree",latex:"^\\circ "},{key:"deg",latex:"^\\circ "},{key:"angle",latex:"\\angle "},{key:"ang",latex:"\\angle "}],w=s.a.unique(s.a.pluck(y,"latex")),E=[];function strTrim(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}s.a.each(w,(function(e){var t,r=strTrim(e);s.a.contains(["\\varsigma","\\vartheta"],r)&&(r=r.replace("\\var","\\")),t={id:r,aliases:s.a.map(s.a.pluck(s.a.where(y,{latex:e}),"key"),strTrim)},E.push(t)}));var S,T=new l.a(E),O=[{id:"",label:"empty",title:"",numberpad_and_keypad:!0},{id:"x",label:"x",type:"write",val:"x",shortcut:["x"],title:"x",name:"x",label_latex:!0},{id:"y",label:"y",type:"write",val:"y",shortcut:["y"],title:"y",name:"y",label_latex:!0},{id:"z",label:"z",type:"write",val:"z",shortcut:["z"],title:"z",name:"z",label_latex:!0},{id:"a",label:"a",type:"write",val:"a",shortcut:["a"],title:"a",name:"a",label_latex:!0},{id:"b",label:"b",type:"write",val:"b",shortcut:["b"],title:"b",name:"b",label_latex:!0},{id:"c",label:"c",type:"write",val:"c",shortcut:["c"],title:"c",name:"c",label_latex:!0},{id:"d",label:"d",type:"write",val:"d",shortcut:["d"],title:"d",name:"d",label_latex:!0},{id:"f",label:"f",type:"write",val:"f",shortcut:["f"],title:"f",name:"f",label_latex:!0},{id:"abc",label:"abc",type:"write",val:"\\text{abc}",shortcut:["toggle","abc"],title:"abc",name:"abc"},{id:",",label:",",type:"write",val:",",shortcut:[],title:""},{id:"'",label:"\\prime",type:"write",val:"'",shortcut:[],title:"Prime/Arcminute",name:"prime"},{id:'"',label:"\\doublePrime",type:"write",val:'"',shortcut:[],title:"Double Prime/Arcsecond",name:"doubleprime"},{id:"\\$",label:"$",type:"write",val:"\\$",shortcut:[],title:"Dollars",name:"dollars"},{id:"+",label:"+",type:"write",val:"+",shortcut:["+"],title:"Plus",name:"plus"},{id:"-",label:"-",type:"write",val:"-",shortcut:["-"],title:"Minus",name:"minus"},{id:"\\times",label:"×",type:"write",val:"\\times",shortcut:["*"],title:"Multiply",name:"times"},{id:"\\div",label:"÷",type:"write",val:"\\div",shortcut:["toggle","/"],title:"Divide",name:"div"},{id:"\\pm",label:"±",type:"write",val:"\\pm",shortcut:["toggle","pm"],title:"Plus or minus",name:"pm"},{id:"=",label:"=",type:"write",val:"=",shortcut:["="],title:"Equals",name:"equals"},{id:">",label:">",type:"write",val:">",shortcut:[">"],title:"Greater than",name:"greater"},{id:"<",label:"<",type:"write",val:"<",shortcut:["<"],title:"Less than",name:"less"},{id:"\\ge",label:"≥",type:"write",val:"\\ge",shortcut:["toggle","gte"],title:"Greater than or equal to",name:"ge"},{id:"\\le",label:"≤",type:"write",val:"\\le",shortcut:["toggle","lte"],title:"Less than or equal to",name:"le"},{id:"\\ne",label:"≠",type:"write",val:"\\neq",shortcut:["toggle","ne"],title:"Not equal to",name:"ne"},{id:"\\approx",label:"≈",type:"write",val:"\\approx",shortcut:["toggle","ae"],title:"Approximately equal to",name:"approx"},{id:"\\perp",label:"\\perp",type:"write",val:"\\perp",shortcut:["toggle","pr"],title:"Perpendicular to",name:"perp"},{id:"\\nsim",label:"≁",type:"write",val:"\\nsim",shortcut:["toggle","nsim"],title:"Not similar",name:"nsim"},{id:"\\ncong",label:"≇",type:"write",val:"\\ncong",shortcut:["toggle","ncong"],title:"Not congruent",name:"ncong"},{id:"\\propto",label:"\\propto",type:"write",val:"\\propto",shortcut:["toggle","pl"],title:"Proportional to",name:"propto"},{id:"\\mid",label:"|",type:"write",val:"|",shortcut:[],title:"Vertical line",name:"mid"},{id:"\\ngtr",label:"\\ngtr",type:"write",val:"\\ngtr",shortcut:[],title:"Not greater than",name:"ngtr"},{id:"\\nless",label:"\\nless",type:"cmd",val:"\\nless",shortcut:[],title:"Not less than",name:"nless"},{id:"\\left(\\right)",label:"\\left(\\right)",type:"cmd",val:"(",shortcut:["toggle","rd"],title:"Group in parentheses",name:"parentheses"},{id:"\\left[\\right]",label:"\\left[\\right]",type:"cmd",val:"[",shortcut:["toggle","sr"],title:"Group in brackets",name:"brackets"},{id:"\\left\\{\\right\\}",label:"\\left\\{\\right\\}",type:"cmd",val:"{",shortcut:["toggle","cr"],title:"Group in curly braces",name:"curlybraces"},{id:"\\left[\\right)",label:"\\left[\\right)",type:"write",val:"\\left[\\right)",shortcut:[],title:"Group in odd braces",name:"rightbraces"},{id:"\\left(\\right]",label:"\\left(\\right]",type:"write",val:"\\left(\\right]",shortcut:[],title:"Group in odd braces",name:"leftbraces"},{id:"[",label:"[",type:"write",val:"[",shortcut:["["],title:"Left square bracket",name:"leftbracket"},{id:"]",label:"]",type:"write",val:"]",shortcut:["]"],title:"Right square bracket",name:"rightbracket"},{id:"^",label:"x^{}",type:"cmd",val:"^",shortcut:["^"],title:"Exponent",label_latex:!0,name:"exponent"},{id:"^2",label:"x^2",type:"write",val:"^2",shortcut:["toggle","pt"],title:"Square",label_latex:!0,name:"square"},{id:"_",label:"x_{}",type:"cmd",val:"_",shortcut:["_"],title:"Subscript",label_latex:!0,name:"subscript"},{id:"\\frac",label:"\\frac{x}{}",type:"cmd",val:"/",shortcut:["/"],title:"Fraction using previous expression as numerator",name:"frac"},{id:"x\\frac{}{}",label:"x\\frac{}{}",type:"write",val:"\\frac{}{}",shortcut:["toggle","mf"],title:"Fraction",name:"fraction",extra_commands:[{type:"keystroke",val:"Left"},{type:"keystroke",val:"Up"}]},{id:"\\frac{}{}",label:"\\frac{}{}",type:"write",val:"\\frac{}{}",shortcut:[],title:"Fraction",name:"fraction",extra_commands:[{type:"keystroke",val:"Left"},{type:"keystroke",val:"Up"}]},{id:":",label:":",type:"write",val:":",shortcut:[":"],title:"Ratio",name:"ratio"},{id:"%",label:"%",type:"write",val:"%",shortcut:["%"],title:"Percentage",name:"percentage"},{id:"\\abs",label:"\\abs{}",type:"cmd",val:"\\abs",shortcut:["toggle","abs"],title:"Absolute value",name:"abs"},{id:"\\sqrt",label:"\\sqrt{}",type:"cmd",val:"\\sqrt",shortcut:["toggle","sq"],title:"Square root",name:"sqrt"},{id:"\\sqrt[3]{}",label:"\\sqrt[3]{}",type:"cmd",val:"\\lrncuberoot",shortcut:["toggle","cb"],title:"Cube root",name:"cube"},{id:"\\sqrt[n]{}",label:"\\sqrt[]{}",type:"cmd",val:"\\nthroot",shortcut:["toggle","nsq"],title:"Nth root",name:"nthroot"},{id:"\\int_{}^{}",label:"\\int_{}^{}",type:"write",val:"\\int_{}^{}",shortcut:["toggle","int"],title:"Integral",name:"int",extra_commands:[{type:"keystroke",val:"Left"},{type:"keystroke",val:"Down"}]},{id:"\\sum",label:"\\sum",type:"write",val:"\\sum",shortcut:[],title:"Summation",name:"sum",label_latex:!0},{id:"\\partial",label:"\\partial",type:"write",val:"\\partial",shortcut:[],title:"Partial Derivative",name:"partial",label_latex:!0},{id:"\\lim_{x\\to {}}",label:"\\lim_{x\\to {}}",type:"write",val:"\\lim_{x\\to {}}",shortcut:[],title:"Limit x to",name:"limit",label_latex:!0},{id:"\\underset{\\sim}{\\mathbf{}}",label:"\\underset{\\sim}{\\mathbf{}}",type:"write",val:"\\underset{\\sim}{\\mathbf{}}",shortcut:["toggle","vec"],title:"Vector",name:"vector",extra_commands:[{type:"keystroke",val:"Left"},{type:"keystroke",val:"Left"}],aliases:["\\mathbf{\\underset{\\sim}{}}"]},{id:"\\mathbb{R}",label:"\\mathbb{R}",type:"write",val:"\\mathbb{R}",shortcut:["toggle","rea"],title:"Real number set",name:"mathbb"},{id:"\\mathbbq",label:"\\mathbb{Q}",type:"write",val:"\\mathbb{Q}",shortcut:[],title:"Q",name:"mathbbq"},{id:"\\mathbbn",label:"\\mathbb{N}",type:"write",val:"\\mathbb{N}",shortcut:[],title:"N",name:"mathbbn"},{id:"\\mathbbz",label:"\\mathbb{Z}",type:"write",val:"\\mathbb{Z}",shortcut:[],title:"Z",name:"mathbbz"},{id:"\\mathbbi",label:"\\mathbb{I}",type:"write",val:"\\mathbb{I}",shortcut:[],title:"I",name:"mathbbi"},{id:"\\mathbbc",label:"\\mathbb{C}",type:"write",val:"\\mathbb{C}",shortcut:[],title:"C",name:"mathbbc"},{id:"imaginary",label:"i",type:"write",val:"\\text{i}",shortcut:[],title:"Imaginary Number",name:"imaginary"},{id:"euler",label:"e",type:"write",val:"\\text{e}",shortcut:[],title:"Euler Number",name:"euler"},{id:"\\alpha",label:"\\alpha",type:"write",val:"\\alpha",shortcut:["toggle","al"],title:"Alpha",name:"alpha"},{id:"\\beta",label:"\\beta",type:"write",val:"\\beta",shortcut:["toggle","be"],title:"Beta",name:"beta"},{id:"\\gamma",label:"\\gamma",type:"write",val:"\\gamma",shortcut:["toggle","ga"],title:"Gamma",name:"gamma"},{id:"\\delta",label:"\\delta",type:"write",val:"\\delta",shortcut:["toggle","de"],title:"Delta",name:"delta"},{id:"\\epsilon",label:"\\epsilon",type:"write",val:"\\epsilon",shortcut:["toggle","ep"],title:"Epsilon",name:"epsilon"},{id:"\\varepsilon",label:"\\varepsilon",type:"write",val:"\\varepsilon",shortcut:["toggle","vep"],title:"Epsilon",name:"epsilon"},{id:"\\zeta",label:"\\zeta",type:"write",val:"\\zeta",shortcut:["toggle","ze"],title:"Zeta",name:"zeta"},{id:"\\eta",label:"\\eta",type:"write",val:"\\eta",shortcut:["toggle","et"],title:"Eta",name:"eta"},{id:"\\theta",label:"\\theta",type:"write",val:"\\theta",shortcut:["toggle","th"],title:"Theta",name:"theta"},{id:"\\iota",label:"\\iota",type:"write",val:"\\iota",shortcut:["toggle","io"],title:"Iota",name:"iota"},{id:"\\kappa",label:"\\kappa",type:"write",val:"\\kappa",shortcut:["toggle","ka"],title:"Kappa",name:"kappa"},{id:"\\lambda",label:"\\lambda",type:"write",val:"\\lambda",shortcut:["toggle","lbd"],title:"Lambda",name:"lambda"},{id:"\\mu",label:"\\mu",type:"write",val:"\\mu",shortcut:["toggle","mu"],title:"Mu",name:"mu"},{id:"\\nu",label:"\\nu",type:"write",val:"\\nu",shortcut:["toggle","nu"],title:"Nu",name:"nu"},{id:"\\xi",label:"\\xi",type:"write",val:"\\xi",shortcut:["toggle","xi"],title:"Xi",name:"xi"},{id:"o",label:"o",type:"write",val:"o",shortcut:["toggle","omc"],title:"Omicron",name:"omicron",label_latex:!0},{id:"\\pi",label:"\\pi",type:"write",val:"\\pi",shortcut:["toggle","pi"],title:"Pi",name:"pi"},{id:"\\rho",label:"\\rho",type:"write",val:"\\rho",shortcut:["toggle","rh"],title:"Rho",name:"rho"},{id:"\\sigma",label:"\\sigma",type:"write",val:"\\sigma",shortcut:["toggle","sig"],title:"Sigma",name:"sigma"},{id:"\\tau",label:"\\tau",type:"write",val:"\\tau",shortcut:["toggle","ta"],title:"Tau",name:"tau"},{id:"\\upsilon",label:"\\upsilon",type:"write",val:"\\upsilon",shortcut:["toggle","ups"],title:"Upsilon",name:"upsilon"},{id:"\\phi",label:"\\phi",type:"write",val:"\\phi",shortcut:["toggle","ph"],title:"Phi",name:"phi"},{id:"\\chi",label:"\\chi",type:"write",val:"\\chi",shortcut:["toggle","ch"],title:"Chi",name:"chi"},{id:"\\psi",label:"\\psi",type:"write",val:"\\psi",shortcut:["toggle","psi"],title:"Psi",name:"psi"},{id:"\\omega",label:"\\omega",type:"write",val:"\\omega",shortcut:["toggle","omg"],title:"Omega",name:"omega"},{id:"A",label:"A",type:"write",val:"A",shortcut:["toggle","ual"],title:"Alpha (uppercase)",name:"ALPHA",label_latex:!0},{id:"B",label:"B",type:"write",val:"B",shortcut:["toggle","ube"],title:"Beta (uppercase)",name:"BETA",label_latex:!0},{id:"\\Gamma",label:"\\Gamma",type:"write",val:"\\Gamma",shortcut:["toggle","uga"],title:"Gamma (uppercase)",name:"GAMMA"},{id:"\\Delta",label:"\\Delta",type:"write",val:"\\Delta",shortcut:["toggle","ude"],title:"Delta (uppercase)",name:"DELTA"},{id:"E",label:"E",type:"write",val:"E",shortcut:["toggle","uep"],title:"Epsilon (uppercase)",name:"EPSILON",label_latex:!0},{id:"Z",label:"Z",type:"write",val:"Z",shortcut:["toggle","uze"],title:"Zeta (uppercase)",name:"ZETA",label_latex:!0},{id:"H",label:"H",type:"write",val:"H",shortcut:["toggle","uet"],title:"Eta (uppercase)",name:"ETA",label_latex:!0},{id:"\\Theta",label:"\\Theta",type:"write",val:"\\Theta",shortcut:["toggle","uth"],title:"Theta (uppercase)",name:"THETA"},{id:"I",label:"I",type:"write",val:"I",shortcut:["toggle","uio"],title:"Iota (uppercase)",name:"IOTA",label_latex:!0},{id:"K",label:"K",type:"write",val:"K",shortcut:["toggle","uka"],title:"Kappa (uppercase)",name:"KAPPA",label_latex:!0},{id:"\\Lambda",label:"\\Lambda",type:"write",val:"\\Lambda",shortcut:["toggle","ulbd"],title:"Lambda (uppercase)",name:"LAMBDA"},{id:"M",label:"M",type:"write",val:"M",shortcut:["toggle","umu"],title:"Mu (uppercase)",name:"MU",label_latex:!0},{id:"N",label:"N",type:"write",val:"N",shortcut:["toggle","unu"],title:"Nu (uppercase)",name:"NU",label_latex:!0},{id:"\\Xi",label:"\\Xi",type:"write",val:"\\Xi",shortcut:["toggle","uxi"],title:"Xi (uppercase)",name:"XI"},{id:"O",label:"O",type:"write",val:"O",shortcut:["toggle","uomc"],title:"Omicron (uppercase)",name:"OMICRON",label_latex:!0},{id:"\\Pi",label:"\\Pi",type:"write",val:"\\Pi",shortcut:["toggle","upi"],title:"Pi (uppercase)",name:"PI"},{id:"R",label:"R",type:"write",val:"R",shortcut:["toggle","urh"],title:"Rho (uppercase)",name:"RHO",label_latex:!0},{id:"\\Sigma",label:"\\Sigma",type:"write",val:"\\Sigma",shortcut:["toggle","w"],title:"Sigma (uppercase)",name:"SIGMA"},{id:"T",label:"T",type:"write",val:"T",shortcut:["toggle","uta"],title:"Tau (uppercase)",name:"TAU",label_latex:!0},{id:"\\Upsilon",label:"\\Upsilon",type:"write",val:"\\Upsilon",shortcut:["toggle","uups"],title:"Upsilon (uppercase)",name:"UPI"},{id:"\\Phi",label:"\\Phi",type:"write",val:"\\Phi",shortcut:["toggle","uph"],title:"Phi (uppercase)",name:"PHI"},{id:"X",label:"X",type:"write",val:"X",shortcut:["toggle","uch"],title:"Chi (uppercase)",name:"PHI",label_latex:!0},{id:"\\Psi",label:"\\Psi",type:"write",val:"\\Psi",shortcut:["toggle","upsi"],title:"Psi (uppercase)",name:"PSI"},{id:"\\Omega",label:"\\Omega",type:"write",val:"\\Omega",shortcut:["toggle","uomg"],title:"Omega (uppercase)",name:"OMEGA"},{id:"\\sin",label:"\\sin",type:"write",val:"\\sin",shortcut:["toggle","sin"],title:"Sine",name:"sin"},{id:"\\cos",label:"\\cos",type:"write",val:"\\cos",shortcut:["toggle","cos"],title:"Cosine",name:"cos"},{id:"\\tan",label:"\\tan",type:"write",val:"\\tan",shortcut:["toggle","tan"],title:"Tangent",name:"tan"},{id:"\\arcsin",label:"\\arcsin",type:"write",val:"\\arcsin",shortcut:["toggle","isin"],title:"Inverse sine",name:"arcsin"},{id:"\\arccos",label:"\\arccos",type:"write",val:"\\arccos",shortcut:["toggle","icos"],title:"Inverse cosine",name:"arccos"},{id:"\\arctan",label:"\\arctan",type:"write",val:"\\arctan",shortcut:["toggle","itan"],title:"Inverse tangent",name:"arctan"},{id:"\\sec",label:"\\sec",type:"write",val:"\\sec",shortcut:[],title:""},{id:"\\csc",label:"\\csc",type:"write",val:"\\csc",shortcut:[],title:""},{id:"\\cot",label:"\\cot",type:"write",val:"\\cot",shortcut:[],title:""},{id:"\\sin^{-1}",label:"\\sin^{-1}",type:"write",val:"\\sin^{-1}",shortcut:[],title:""},{id:"\\sec^{-1}",label:"\\sec^{-1}",type:"write",val:"\\sec^{-1}",shortcut:[],title:""},{id:"\\cos^{-1}",label:"\\cos^{-1}",type:"write",val:"\\cos^{-1}",shortcut:[],title:""},{id:"\\csc^{-1}",label:"\\csc^{-1}",type:"write",val:"\\csc^{-1}",shortcut:[],title:""},{id:"\\tan^{-1}",label:"\\tan^{-1}",type:"write",val:"\\tan^{-1}",shortcut:[],title:""},{id:"\\cot^{-1}",label:"\\cot^{-1}",type:"write",val:"\\cot^{-1}",shortcut:[],title:""},{id:"\\cap",label:"\\intersection",type:"write",val:"\\intersection",shortcut:["toggle","ir"],title:"Intersection",name:"cap"},{id:"\\cup",label:"\\union",type:"write",val:"\\union",shortcut:["toggle","un"],title:"Union",name:"union"},{id:"\\in",label:"\\in",type:"write",val:"\\in",shortcut:["toggle","mo"],title:"Member of",name:"in"},{id:"\\notin",label:"\\notin",type:"write",val:"\\notin",shortcut:["toggle","nmo"],title:"Not member of",name:"notin"},{id:"\\ni",label:"\\ni",type:"write",val:"\\ni",shortcut:["toggle","cs"],title:"Contains",name:"ni"},{id:"\\subseteq",label:"\\subseteq",type:"write",val:"\\subseteq",shortcut:["toggle","sb"],title:"Subset",name:"subseteq"},{id:"\\supseteq",label:"\\supseteq",type:"write",val:"\\supseteq",shortcut:["toggle","sp"],title:"Superset",name:"supseteq"},{id:"\\subset",label:"\\subset",type:"write",val:"\\subset",shortcut:["toggle","ssb"],title:"Subset (strict)",name:"subset"},{id:"\\supset",label:"\\supset",type:"write",val:"\\supset",shortcut:["toggle","ssp"],title:"Superset (strict)",name:"supset"},{id:"\\not\\subset",label:"\\not\\subset",type:"write",val:"\\not\\subset",shortcut:["toggle","snb"],title:"Not subset (strict)",name:"notsubset"},{id:"\\not\\supset",label:"\\not\\supset",type:"write",val:"\\not\\supset",shortcut:["toggle","snp"],title:"Not superset (strict)",name:"notsupset"},{id:"\\not\\subseteq",label:"\\not\\subseteq",type:"write",val:"\\not\\subseteq",shortcut:["toggle","nsb"],title:"Not subset",name:"notsubseteq"},{id:"\\not\\supseteq",label:"\\not\\supseteq",type:"write",val:"\\not\\supseteq",shortcut:["toggle","nsp"],title:"Not superset",name:"notsupseteq"},{id:"\\not\\ni",label:"\\not\\ni",type:"write",val:"\\not\\ni",shortcut:["toggle","ncs"],title:"Does not contain",name:"notni"},{id:"\\backslash",label:"\\backslash",type:"write",val:"\\backslash",shortcut:["toggle","bsh"],title:"Backslash",name:"backslash"},{id:"\\slash",label:"\\slash",type:"write",val:"\\slash",shortcut:["ctrl","/"],title:"Forward slash",name:"slash"},{id:"!",label:"!",type:"write",val:"!",shortcut:["!"],title:"Factorial",name:"factorial"},{id:"\\emptyset",label:"\\emptyset",type:"write",val:"\\emptyset",shortcut:[],title:""},{id:"\\angle",label:"\\angle",type:"write",val:"\\angle",shortcut:["toggle","ang"],title:"Angle",name:"angle"},{id:"\\measuredangle",label:"\\measuredangle",type:"write",val:"\\measuredangle",shortcut:["toggle","mang"],title:"Measure of angle",name:"measuredangle"},{id:"\\parallel",label:"\\parallel",type:"write",val:"\\parallel",shortcut:["toggle","pa"],title:"Parallel to",name:"parallel"},{id:"\\nparallel",label:"\\nparallel",type:"write",val:"\\nparallel",shortcut:["toggle","npa"],title:"Not parallel to",name:"nparallel"},{id:"\\sim",label:"\\sim",type:"write",val:"\\sim",shortcut:["toggle","sm"],title:"Similar to",name:"sim"},{id:"\\cong",label:"\\cong",type:"write",val:"\\cong",shortcut:["toggle","cg"],title:"Congruent to",name:"cong"},{id:"\\degree",label:"\\degree",type:"write",val:"\\degree",shortcut:["toggle","dg"],title:"Degree symbol",name:"degree"},{id:"\\triangle",label:"\\triangle",type:"write",val:"\\triangle",shortcut:["toggle","tri"],title:"Triangle",name:"triangle"},{id:"\\circledot",label:"\\circledot",type:"write",val:"\\circledot",shortcut:["toggle","cir"],title:"Circle",name:"circledot"},{id:"\\circ",label:"\\circ",type:"write",val:"\\circ",shortcut:["toggle","circ"],title:"Composition",name:"circ"},{id:"\\parallelogram",label:"\\parallelogram",type:"cmd",val:"\\parallelogram",shortcut:["toggle","par"],title:"Parallelogram",name:"parallelogram"},{id:"\\overarc",label:"\\overarc{}",type:"cmd",val:"\\overarc",shortcut:["toggle","oa"],title:"Arc",name:"overarc"},{id:"\\leftarrow",label:"\\leftarrow",type:"write",val:"\\leftarrow",shortcut:["toggle","la"],title:"Leftwards arrow",name:"leftarrow"},{id:"\\rightarrow",label:"\\rightarrow",type:"write",val:"\\rightarrow",shortcut:["toggle","ra"],title:"Rightwards arrow",name:"rightarrow"},{id:"\\leftrightarrow",label:"\\leftrightarrow",type:"write",val:"\\leftrightarrow",shortcut:["toggle","lr"],title:"Left/right arrow",name:"leftrightarrow"},{id:"\\longleftrightarrow",label:"\\longleftrightarrow",type:"write",val:"\\longleftrightarrow",shortcut:["toggle","llr"],title:"Long left/right arrow",name:"longleftrightarrow"},{id:"\\rightdoublearrow",label:"\\Rightarrow",type:"write",val:"\\Rightarrow",shortcut:["toggle","rda"],title:"Implies equivalence",name:"rightdoublearrow"},{id:"\\leftrightdoublearrow",label:"\\Leftrightarrow",type:"write",val:"\\Leftrightarrow",shortcut:["toggle","lrda"],title:"Material equivalence",name:"leftrightdoublearrow"},{id:"\\overrightarrow",label:"\\overrightarrow{}",type:"cmd",val:"\\overrightarrow",shortcut:["toggle","ry"],title:"Ray",name:"overrightarrow"},{id:"\\overleftarrow",label:"\\overleftarrow{}",type:"cmd",val:"\\overleftarrow",shortcut:["toggle","ry"],title:"Left ray",name:"overleftarrow"},{id:"\\overleftrightarrow",label:"\\overleftrightarrow{}",type:"cmd",val:"\\overleftrightarrow",shortcut:["toggle","li"],title:"Line",name:"overleftrightarrow"},{id:"\\overline",label:"\\overline{}",type:"cmd",val:"\\overline",shortcut:["toggle","li"],title:"Line segment",name:"overline"},{id:"\\dot",label:"\\dot{}",type:"cmd",val:"\\dot",shortcut:[],title:"Recurring Decimal",name:"dot"},{id:"\\longdiv",label:"\\longdiv{}",type:"cmd",val:"\\longdiv",shortcut:["toggle","ld"],title:"Long division",name:"longdiv"},{id:"\\overset{}^{H}",label:"\\overset{}^{H}",type:"write",val:"\\overset{}{} ",shortcut:["toggle","ox"],title:"Oxidation",name:"overset",label_latex:!0,extra_commands:[{type:"keystroke",val:"Up"}]},{id:"\\therefore",label:"\\therefore",type:"write",val:"\\therefore",shortcut:["toggle","tf"],title:"Therefore",name:"therefore"},{id:"\\infty",label:"\\infinity",type:"write",val:"\\infinity",shortcut:["toggle","ift"],title:"Infinity",name:"infty"},{id:"\\square",label:"\\square",type:"write",val:"\\square",shortcut:["toggle","sqr"],title:"Square",name:"square"},{id:"\\matrix",label:"☷",type:"cmd",val:"\\matrix",shortcut:["toggle","mx"],title:"Matrix",name:"matrix"},{id:"\\pmatrix",label:"(☷)",type:"cmd",val:"\\pmatrix",shortcut:["toggle","px"],title:"Matrix bounded by parentheses",name:"pmatrix"},{id:"\\bmatrix",label:"\\begin{bmatrix}&\\\\&\\end{bmatrix}",type:"cmd",val:"\\bmatrix",shortcut:["toggle","bx"],title:"2 x 2 Matrix bounded by brackets",name:"bmatrix",label_latex:!0},{id:"\\threebmatrix",label:"\\begin{bmatrix}&&\\\\&&\\\\&&\\end{bmatrix}",type:"write",val:"\\begin{bmatrix}&&\\\\&&\\\\&&\\end{bmatrix}",shortcut:[],title:"3 x 3 Matrix bounded by brackets",name:"threebmatrix",label_latex:!0,extra_commands:[{type:"keystroke",val:"Left Left Left Up Up"}]},{id:"\\singlebmatrix",label:"\\begin{bmatrix}\\end{bmatrix}",type:"write",val:"\\begin{bmatrix}\\end{bmatrix}",shortcut:[],title:"Single Matrix bounded by brackets",name:"singlebmatrix",label_latex:!0,extra_commands:[{type:"keystroke",val:"Left"}]},{id:"\\Bmatrix",label:"{☷}",type:"cmd",val:"\\Bmatrix",shortcut:["toggle","bbx"],title:"Matrix bounded by braces",name:"Bmatrix"},{id:"\\vmatrix",label:"|☷|",type:"cmd",val:"\\vmatrix",shortcut:["toggle","vx"],title:"Matrix bounded by vertical lines",name:"vmatrix"},{id:"\\Vmatrix",label:"‖☷‖",type:"cmd",val:"\\Vmatrix",shortcut:["toggle","vvx"],title:"Matrix bounded by double vertical lines",name:"Vmatrix"},{id:"\\ldots",label:"\\ldots",type:"write",val:"\\ldots",shortcut:["toggle","ld"],title:"Horizontal dots (baseline)",name:"ldots"},{id:"\\cdots",label:"\\cdots",type:"write",val:"\\cdots",shortcut:["toggle","cd"],title:"Horizontal dots (centered)",name:"cdots"},{id:"\\ddots",label:"\\ddots",type:"write",val:"\\ddots",shortcut:["toggle","dd"],title:"Diagonal dots",name:"ddots"},{id:"\\vdots",label:"\\vdots",type:"write",val:"\\vdots",shortcut:["toggle","vd"],title:"Vertical dots",name:"vdots"},{id:"\\cdot",label:"\\cdot",type:"write",val:"\\cdot",shortcut:[],title:"Dot multiplier",name:"cdot"},{id:"\\cdotp",label:"\\cdotp",type:"write",val:"\\cdotp",shortcut:[],title:"Center dot (punctuation)",name:"cdotp"},{id:"\\response",label:"□",type:"write",val:"\\response",shortcut:["toggle","rs"],title:"Editable {{response}} area",name:"response"},{id:"║",label:"\\addmatrixcol",type:"softkey",val:"insertColumn",shortcut:["toggle","space"],title:"Insert column",name:"addmatrixcol",label_latex:!0},{id:"═",label:"\\addmatrixrow",type:"softkey",val:"insertRow",shortcut:["toggle","enter"],title:"Insert row",name:"addmatrixrow"},{id:"g",label:"g",type:"write",val:"\\text{g}",shortcut:["g"],title:"Gram",name:"gram"},{id:"cg",label:"cg",type:"write",val:"\\text{cg}",shortcut:["cg"],title:"Centigram",name:"cg"},{id:"kg",label:"kg",type:"write",val:"\\text{kg}",shortcut:["kg"],title:"Kilogram",name:"kg"},{id:"mg",label:"mg",type:"write",val:"\\text{mg}",shortcut:["mg"],title:"Milligram",name:"mg"},{id:"ng",label:"ng",type:"write",val:"\\text{ng}",shortcut:["ng"],title:"Nanogram",name:"ng"},{id:"m",label:"m",type:"write",val:"\\text{m}",shortcut:["m"],title:"Meter",name:"meter"},{id:"cm",label:"cm",type:"write",val:"\\text{cm}",shortcut:["cm"],title:"Centimeter",name:"cm"},{id:"km",label:"km",type:"write",val:"\\text{km}",shortcut:["km"],title:"Kilometer",name:"km"},{id:"mm",label:"mm",type:"write",val:"\\text{mm}",shortcut:["mm"],title:"Millimeter",name:"mm"},{id:"nm",label:"nm",type:"write",val:"\\text{nm}",shortcut:["nm"],title:"Nanometer",name:"nm"},{id:"s",label:"s",type:"write",val:"\\text{s}",shortcut:["s"],title:"Second",name:"second"},{id:"cs",label:"cs",type:"write",val:"\\text{cs}",shortcut:["cs"],title:"Centisecond",name:"cs"},{id:"ks",label:"ks",type:"write",val:"\\text{ks}",shortcut:["ks"],title:"Kilosecond",name:"ks"},{id:"ms",label:"ms",type:"write",val:"\\text{ms}",shortcut:["ms"],title:"Millisecond",name:"ms"},{id:"ns",label:"ns",type:"write",val:"\\text{ns}",shortcut:["ns"],title:"Nanosecond",name:"ns"},{id:"L",label:"L",type:"write",val:"\\text{L}",shortcut:["L"],title:"Liter",name:"liter"},{id:"mL",label:"mL",type:"write",val:"\\text{mL}",shortcut:["mL"],title:"Millitliter",name:"ml"},{id:"µg",label:"µg",type:"write",val:"\\text{µg}",shortcut:[],title:"Microgram",name:"ug"},{id:"in",label:"in",type:"write",val:"\\text{in}",shortcut:["in"],title:"Inch",name:"inch"},{id:"ft",label:"ft",type:"write",val:"\\text{ft}",shortcut:["ft"],title:"Foot",name:"ft"},{id:"mi",label:"mi",type:"write",val:"\\text{mi}",shortcut:["mi"],title:"Mile",name:"mi"},{id:"fl",label:"fl oz",type:"write",val:"\\text{fl oz}",shortcut:["fl"],title:"Fluid Ounce",name:"fl"},{id:"cup",label:"cup",type:"write",val:"\\text{cup}",shortcut:["cup"],title:"Cup",name:"cup"},{id:"pt",label:"pt",type:"write",val:"\\text{pt}",shortcut:["pt"],title:"Pint",name:"pt"},{id:"qt",label:"qt",type:"write",val:"\\text{qt}",shortcut:["qt"],title:"Quart",name:"qt"},{id:"gal",label:"gal",type:"write",val:"\\text{gal}",shortcut:["gal"],title:"Gallon",name:"gal"},{id:"oz",label:"oz",type:"write",val:"\\text{oz}",shortcut:["oz"],title:"Ounce",name:"oz"},{id:"lb",label:"lb",type:"write",val:"\\text{lb}",shortcut:["lb"],title:"Pound",name:"lb"},{id:"mug",label:"µg",type:"write",val:"\\mug",shortcut:["mug"],title:"Microgram",name:"mug"},{id:"mus",label:"µs",type:"write",val:"\\mus",shortcut:["mus"],title:"Microsecond",name:"mus"},{id:"mum",label:"µm",type:"write",val:"\\mum",shortcut:["mum"],title:"Micrometer",name:"mum"},{id:"muL",label:"µL",type:"write",val:"\\muL",shortcut:["muL"],title:"Microlitre",name:"mul"},{id:"\\because",label:"\\because",type:"cmd",val:"\\because",shortcut:[],title:"Because",name:"because",label_latex:!0},{id:"\\impliedby",label:"\\impliedby",type:"cmd",val:"\\impliedby",shortcut:[],title:"Is implied by",name:"isimpliedby",label_latex:!0},{id:"\\gg",label:"\\gg",type:"cmd",val:"\\gg",shortcut:[],title:"Much greater than",name:"muchgreaterthan",label_latex:!0},{id:"\\ll",label:"\\ll",type:"cmd",val:"\\ll",shortcut:[],title:"Much lesser than",name:"muchlesserthan",label_latex:!0},{id:"\\del",label:"\\del",type:"cmd",val:"\\del",shortcut:[],title:"Nabla",name:"nabla",label_latex:!0},{id:"\\mathbf{i}",label:"\\mathbf{i}",type:"write",shortcut:[],val:"\\mathbf{i}",title:"Standard basis I",name:"standardbasisI",label_latex:!0},{id:"\\mathbf{j}",label:"\\mathbf{j}",type:"write",shortcut:[],val:"\\mathbf{j}",title:"Standard basis J",name:"standardbasisJ",label_latex:!0},{id:"\\mathbf{k}",label:"\\mathbf{k}",type:"write",shortcut:[],val:"\\mathbf{k}",title:"Standard basis K",name:"standardbasisK",label_latex:!0},{id:"box_^",label:"\\lrnexponent{}{}",type:"cmd",val:"\\lrnexponent",shortcut:["^"],title:"Exponent",name:"exponent",label_latex:!0},{id:"box_^2",label:"\\lrnexponent{}{2}",type:"cmd",val:"\\lrnsquaredexponent",shortcut:["toggle","pt"],title:"Square",name:"square",label_latex:!0},{id:"box__",label:"\\lrnsubscript{}{}",type:"cmd",val:"\\lrnsubscript",shortcut:["_"],title:"Subscript",name:"subscript",label_latex:!0},{id:"box_\\frac",label:"\\frac{\\square}{}",type:"cmd",val:"/",shortcut:["/"],title:"Fraction",name:"fraction"},{id:"box_x\\frac{}{}",label:"\\square\\frac{}{}",type:"write",val:"\\frac{}{}",shortcut:["toggle","mf"],title:"Fraction",name:"fraction",extra_commands:[{type:"keystroke",val:"Left"},{type:"keystroke",val:"Up"}]},{id:"mol",label:"mol",type:"write",val:"\\text{mol}",shortcut:["mol"],title:"Mole",name:"mol"},{id:"\\atomic",label:"_{}^{}\\text{H}",type:"write",val:"_{}^{}",shortcut:[],title:"Atomic symbol",name:"atomic",label_latex:!0,extra_commands:[{type:"keystroke",val:"Up"}]},{id:"\\polyatomic",label:"\\text{H}_{}{}^{}",type:"write",val:"_{}{}^{}",shortcut:[],title:"Polyatomic ion",name:"polyatomic",label_latex:!0,extra_commands:[{type:"keystroke",val:"Up"}]},{id:"chem^",label:"\\text{H}^{}",type:"cmd",val:"^",shortcut:[],title:"Superscript",name:"superscript",label_latex:!0},{id:"chem_",label:"\\text{H}_{}",type:"cmd",val:"_",shortcut:[],title:"Subscript",name:"subscript",label_latex:!0},{id:"\\text{g}\\ \\text{mol}^{-1}",label:"\\text{g}\\ \\text{mol}^{-1}",type:"write",val:"\\text{g}\\ \\text{mol}^{-1}",shortcut:["gpm"],title:"Molar mass",name:"molar"},{id:"\\rightleftharpoons",label:"\\rightleftharpoons",type:"write",val:"\\rightleftharpoons",shortcut:["toggle","rlh"],title:"Right / left harpoons",name:"rightleftharpoons"},{id:"\\leftrightharpoons",label:"\\leftrightharpoons",type:"write",val:"\\leftrightharpoons",shortcut:["toggle","lrh"],title:"Left / right harpoons",name:"leftrightharpoons"},{id:"\\ce{\\bond{-}}",label:"\\ce{\\bond{-}}",type:"write",val:"\\ce{\\bond{-}}",shortcut:["toggle","sib"],title:"Single bond",name:"singlebond"},{id:"\\ce{\\bond{=}}",label:"\\ce{\\bond{=}}",type:"write",val:"\\ce{\\bond{=}}",shortcut:["toggle","dob"],title:"Double bond",name:"doublebond"},{id:"\\ce{\\bond{#}}",label:"\\ce{\\bond{#}}",type:"write",val:"\\ce{\\bond{#}}",shortcut:["toggle","trb"],title:"Triple bond",name:"triplebond"},{id:"\\ce{\\bond{...}}",label:"\\ce{\\bond{...}}",type:"write",val:"\\ce{\\bond{...}}",shortcut:["toggle","tdb"],title:"Three dot bond",name:"threedotbond"},{id:"\\ce{\\bond{....}}",label:"\\ce{\\bond{....}}",type:"write",val:"\\ce{\\bond{....}}",shortcut:["toggle","fdb"],title:"Four dot bond",name:"fourdotbond"},{id:"\\ce{\\bond{->}}",label:"\\ce{\\bond{->}}",type:"write",val:"\\ce{\\bond{->}}",shortcut:["toggle","rgb"],title:"Right arrow bond",name:"rightarrowbond"},{id:"\\ce{\\bond{<-}}",label:"\\ce{\\bond{<-}}",type:"write",val:"\\ce{\\bond{<-}}",shortcut:["toggle","lfb"],title:"Left arrow bond",name:"leftarrowbond"},{id:"\\xrightarrow",label:"\\xrightarrow[y]{x}",type:"write",val:"\\xrightarrow[]{}",shortcut:["toggle","xra"],title:"Arrow with superscript and subscript",name:"xrightarrow"},{id:"\\lfloor",label:"\\lfloor",type:"write",val:"\\lfloor",title:"Left floor",name:"lfloor"},{id:"\\rfloor",label:"\\rfloor",type:"write",val:"\\rfloor",title:"Right floor",name:"rfloor"},{id:"\\lceil",label:"\\lceil",type:"write",val:"\\lceil",title:"Left ceiling",name:"lceil"},{id:"\\rceil",label:"\\rceil",type:"write",val:"\\rceil",title:"Right ceiling",name:"rceil"},{id:"\\uparrow",label:"\\uparrow",type:"write",val:"\\uparrow",title:"Up arrow",name:"uparrow"},{id:"\\downarrow",label:"\\downarrow",type:"write",val:"\\downarrow",title:"Down arrow",name:"downarrow"},{id:"\\equiv",label:"\\equiv",type:"write",val:"\\equiv",title:"Equivalence",name:"equiv"},{id:"\\and",label:"\\and",type:"write",val:"\\and",title:"And",name:"and"},{id:"\\not",label:"\\not",type:"write",val:"\\not",title:"Not",name:"not"},{id:"\\or",label:"\\or",type:"write",val:"\\or",title:"Or",name:"or"},{id:"\\exist",label:"\\exist",type:"write",val:"\\exist",title:"Exist",name:"exist"},{id:"\\exists",label:"\\exists",type:"write",val:"\\exists",title:"Exists",name:"exists"},{id:"\\forall",label:"\\forall",type:"write",val:"\\forall",title:"Forall",name:"forall"},{id:"\\oplus",label:"\\oplus",type:"write",val:"\\oplus",title:"Circled plus",name:"oplus"},{id:"a_lowercase",label:"a",type:"write",val:"a",shortcut:["a"],title:"a",label_latex:!0},{id:"b_lowercase",label:"b",type:"write",val:"b",shortcut:["b"],title:"b",label_latex:!0},{id:"c_lowercase",label:"c",type:"write",val:"c",shortcut:["c"],title:"c",label_latex:!0},{id:"d_lowercase",label:"d",type:"write",val:"d",shortcut:["d"],title:"d",label_latex:!0},{id:"e_lowercase",label:"e",type:"write",val:"e",shortcut:["e"],title:"e",label_latex:!0},{id:"f_lowercase",label:"f",type:"write",val:"f",shortcut:["f"],title:"f",label_latex:!0},{id:"g_lowercase",label:"g",type:"write",val:"g",shortcut:["g"],title:"g",label_latex:!0},{id:"h_lowercase",label:"h",type:"write",val:"h",shortcut:["h"],title:"h",label_latex:!0},{id:"i_lowercase",label:"i",type:"write",val:"i",shortcut:["i"],title:"i",label_latex:!0},{id:"j_lowercase",label:"j",type:"write",val:"j",shortcut:["j"],title:"j",label_latex:!0},{id:"k_lowercase",label:"k",type:"write",val:"k",shortcut:["k"],title:"k",label_latex:!0},{id:"l_lowercase",label:"l",type:"write",val:"l",shortcut:["l"],title:"l",label_latex:!0},{id:"m_lowercase",label:"m",type:"write",val:"m",shortcut:["m"],title:"m",label_latex:!0},{id:"n_lowercase",label:"n",type:"write",val:"n",shortcut:["n"],title:"n",label_latex:!0},{id:"o_lowercase",label:"o",type:"write",val:"o",shortcut:["o"],title:"o",label_latex:!0},{id:"p_lowercase",label:"p",type:"write",val:"p",shortcut:["p"],title:"p",label_latex:!0},{id:"q_lowercase",label:"q",type:"write",val:"q",shortcut:["q"],title:"q",label_latex:!0},{id:"r_lowercase",label:"r",type:"write",val:"r",shortcut:["r"],title:"r",label_latex:!0},{id:"s_lowercase",label:"s",type:"write",val:"s",shortcut:["s"],title:"s",label_latex:!0},{id:"t_lowercase",label:"t",type:"write",val:"t",shortcut:["t"],title:"t",label_latex:!0},{id:"u_lowercase",label:"u",type:"write",val:"u",shortcut:["u"],title:"u",label_latex:!0},{id:"v_lowercase",label:"v",type:"write",val:"v",shortcut:["v"],title:"v",label_latex:!0},{id:"w_lowercase",label:"w",type:"write",val:"w",shortcut:["w"],title:"w",label_latex:!0},{id:"x_lowercase",label:"x",type:"write",val:"x",shortcut:["x"],title:"x",label_latex:!0},{id:"y_lowercase",label:"y",type:"write",val:"y",shortcut:["y"],title:"y",label_latex:!0},{id:"z_lowercase",label:"z",type:"write",val:"z",shortcut:["z"],title:"z",label_latex:!0},{id:"A_uppercase",label:"A",type:"write",val:"A",shortcut:["A"],title:"A",label_latex:!0},{id:"B_uppercase",label:"B",type:"write",val:"B",shortcut:["B"],title:"B",label_latex:!0},{id:"C_uppercase",label:"C",type:"write",val:"C",shortcut:["C"],title:"C",label_latex:!0},{id:"D_uppercase",label:"D",type:"write",val:"D",shortcut:["D"],title:"D",label_latex:!0},{id:"E_uppercase",label:"E",type:"write",val:"E",shortcut:["E"],title:"E",label_latex:!0},{id:"F_uppercase",label:"F",type:"write",val:"F",shortcut:["F"],title:"F",label_latex:!0},{id:"G_uppercase",label:"G",type:"write",val:"G",shortcut:["G"],title:"G",label_latex:!0},{id:"H_uppercase",label:"H",type:"write",val:"H",shortcut:["H"],title:"H",label_latex:!0},{id:"I_uppercase",label:"I",type:"write",val:"I",shortcut:["I"],title:"I",label_latex:!0},{id:"J_uppercase",label:"J",type:"write",val:"J",shortcut:["J"],title:"J",label_latex:!0},{id:"K_uppercase",label:"K",type:"write",val:"K",shortcut:["K"],title:"K",label_latex:!0},{id:"L_uppercase",label:"L",type:"write",val:"L",shortcut:["L"],title:"L",label_latex:!0},{id:"M_uppercase",label:"M",type:"write",val:"M",shortcut:["M"],title:"M",label_latex:!0},{id:"N_uppercase",label:"N",type:"write",val:"N",shortcut:["N"],title:"N",label_latex:!0},{id:"O_uppercase",label:"O",type:"write",val:"O",shortcut:["O"],title:"O",label_latex:!0},{id:"P_uppercase",label:"P",type:"write",val:"P",shortcut:["P"],title:"P",label_latex:!0},{id:"Q_uppercase",label:"Q",type:"write",val:"Q",shortcut:["Q"],title:"Q",label_latex:!0},{id:"R_uppercase",label:"R",type:"write",val:"R",shortcut:["R"],title:"R",label_latex:!0},{id:"S_uppercase",label:"S",type:"write",val:"S",shortcut:["S"],title:"S",label_latex:!0},{id:"T_uppercase",label:"T",type:"write",val:"T",shortcut:["T"],title:"T",label_latex:!0},{id:"U_uppercase",label:"U",type:"write",val:"U",shortcut:["U"],title:"U",label_latex:!0},{id:"V_uppercase",label:"V",type:"write",val:"V",shortcut:["V"],title:"V",label_latex:!0},{id:"W_uppercase",label:"W",type:"write",val:"W",shortcut:["W"],title:"W",label_latex:!0},{id:"X_uppercase",label:"X",type:"write",val:"X",shortcut:["X"],title:"X",label_latex:!0},{id:"Y_uppercase",label:"Y",type:"write",val:"Y",shortcut:["Y"],title:"Y",label_latex:!0},{id:"Z_uppercase",label:"Z",type:"write",val:"Z",shortcut:["Z"],title:"Z",label_latex:!0},{id:"7",label:"7",type:"write",val:"7",shortcut:["7"],title:"Seven",name:"seven",style:"lrn-btn-grid-num",numberpad_symbol:!0},{id:"8",label:"8",type:"write",val:"8",shortcut:["8"],title:"Eight",name:"eight",style:"lrn-btn-grid-num",numberpad_symbol:!0},{id:"9",label:"9",type:"write",val:"9",shortcut:["9"],title:"Nine",name:"nine",style:"lrn-btn-grid-num",numberpad_symbol:!0},{id:"÷",label:"÷",type:"write",val:"÷",shortcut:["÷"],title:"Divided by",name:"divide",style:"lrn-btn-grid-operator",numberpad_symbol:!0},{id:"4",label:"4",type:"write",val:"4",shortcut:["4"],title:"Four",name:"four",style:"lrn-btn-grid-num",numberpad_symbol:!0},{id:"5",label:"5",type:"write",val:"5",shortcut:["5"],title:"Five",name:"five",style:"lrn-btn-grid-num",numberpad_symbol:!0},{id:"6",label:"6",type:"write",val:"6",shortcut:["6"],title:"Six",name:"six",style:"lrn-btn-grid-num",numberpad_symbol:!0},{id:"multiply",label:"×",type:"write",val:"×",shortcut:["×"],title:"Multiplied by",name:"multiply",style:"lrn-btn-grid-operator",numberpad_symbol:!0},{id:"1",label:"1",type:"write",val:"1",shortcut:["1"],title:"One",name:"one",style:"lrn-btn-grid-num",numberpad_symbol:!0},{id:"2",label:"2",type:"write",val:"2",shortcut:["2"],title:"Two",name:"two",style:"lrn-btn-grid-num",numberpad_symbol:!0},{id:"3",label:"3",type:"write",val:"3",shortcut:["3"],title:"Three",name:"three",style:"lrn-btn-grid-num",numberpad_symbol:!0},{id:"minus",label:"-",type:"write",val:"-",shortcut:["-"],title:"Minus",name:"minus",style:"lrn-btn-grid-operator",numberpad_symbol:!0},{id:"0",label:"0",type:"write",val:"0",shortcut:["0"],title:"Zero",name:"zero",style:"lrn-btn-grid-num",numberpad_symbol:!0},{id:"decimal",label:".",type:"write",val:".",shortcut:["."],title:"Decimal",name:"decimal",style:"lrn-btn-grid-num",numberpad_symbol:!0},{id:"comma",label:",",type:"write",val:",",shortcut:[","],title:"Comma",name:"comma",style:"lrn-btn-grid-num",numberpad_symbol:!0},{id:"plus",label:"+",type:"write",val:"+",shortcut:["+"],title:"Plus",name:"plus",style:"lrn-btn-grid-operator",numberpad_symbol:!0},{id:"left",label:"<",type:"keystroke",val:"Left",shortcut:[],title:"Left",name:"left",style:"lrn-btn-grid-dir",numberpad_symbol:!0,key_style:"lrn_arrow_left"},{id:"right",label:">",type:"keystroke",val:"Right",shortcut:[],title:"Right",name:"right",style:"lrn-btn-grid-dir",numberpad_symbol:!0,key_style:"lrn_arrow_right"},{id:"backspace",label:"Backspace",type:"keystroke",val:"Backspace",shortcut:[],title:"Backspace",name:"backspace",style:"lrn-btn-grid-dir",numberpad_symbol:!0,key_style:"lrn_backspace"},{id:"=",label:"=",type:"write",val:"=",shortcut:["="],title:"Equals",name:"equals",style:"lrn-btn-grid-operator",numberpad_symbol:!0},{id:"\\left\\{\\begin{array}{l}\\end{array}\\right.",label:"\\left\\{\\begin{array}{l}x+\\\\y+\\end{array}\\right.",type:"write",val:"\\left\\{\\begin{array}{l} \\\\ \\end{array}\\right.",shortcut:["toggle","ine"],title:"System of equations/inequalities",name:"inequalities",style:"lrn-btn-array"},{id:"\\begin{array}{rlll}\\end{array}",label:"\\begin{array}{rlll}&=&\\\\&=&\\end{array}",type:"write",val:"\\begin{array}{rlll}&+&&=\\\\&+&&=\\end{array}",shortcut:["toggle","mle"],title:"Multi line equation",name:"multiline",style:"lrn-btn-array"},{id:"{{response}}",label:"\\MathQuillResponseContainerIcon",type:"write",val:"\\MathQuillResponseContainer",title:"Response Container",name:"responseContainerIcon",style:"lrn-btn-grid-operator"}],N=new l.a;s.a.each(O,(function(e){var t=T.get(e.id);t?(t.set(e),N.add(t)):N.add(e)}));var A=[{symbol:"+",group:"Arithmetic"},{symbol:"-",group:"Arithmetic"},{symbol:"\\times",group:"Arithmetic"},{symbol:"\\div",group:"Arithmetic"},{symbol:"\\pm",group:"Arithmetic"},{symbol:"=",group:"Comparison"},{symbol:">",group:"Comparison"},{symbol:"<",group:"Comparison"},{symbol:"\\ge",group:"Comparison"},{symbol:"\\le",group:"Comparison"},{symbol:"\\ne",group:"Comparison"},{symbol:"\\approx",group:"Comparison"},{symbol:"\\perp",group:"Comparison"},{symbol:"\\propto",group:"Comparison"},{symbol:"\\left(\\right)",group:"Parentheses"},{symbol:"\\left[\\right]",group:"Parentheses"},{symbol:"\\left\\{\\right\\}",group:"Parentheses"},{symbol:"^",group:"Subscript and superscript"},{symbol:"^2",group:"Subscript and superscript"},{symbol:"_",group:"Subscript and superscript"},{symbol:"\\frac",group:"Fraction"},{symbol:":",group:"Fraction"},{symbol:"\\sqrt",group:"Root"},{symbol:"\\sqrt[n]{}",group:"Root"},{symbol:"\\pi",group:"Greek letters"},{symbol:"\\Pi",group:"Greek letters"},{symbol:"\\sigma",group:"Greek letters"},{symbol:"\\Sigma",group:"Greek letters"},{symbol:"\\delta",group:"Greek letters"},{symbol:"\\Delta",group:"Greek letters"},{symbol:"\\theta",group:"Greek letters"},{symbol:"\\Theta",group:"Greek letters"},{symbol:"\\matrix",group:"Matrices"},{symbol:"\\bmatrix",group:"Matrices"},{symbol:"\\ldots",group:"Matrices"},{symbol:"\\ddots",group:"Matrices"},{symbol:"\\vdots",group:"Matrices"},{symbol:"║",group:"Matrices"},{symbol:"═",group:"Matrices"}],L={handwriting:{title:"Handwriting",name:"Handwriting",label:"&#9997;",render_latex:!1},qwerty:{title:"Keyboard",name:"Keyboard",label:"&#9000;",render_latex:!1},basic:{title:"Basic",label:"\\text{Basic}",value:["x","y","^2","\\sqrt","\\frac","x\\frac{}{}","^","_","<",">","\\pm","\\$","%","\\degree",":","\\left(\\right)","\\abs","\\pi","\\infty"]},basic_junior:{title:"Basic Junior",label:"=",value:["<",">","","","\\frac","x\\frac{}{}"]},basic_author:{title:"Basic",label:"\\text{Basic}",value:["x","y","^2","\\sqrt","\\frac","x\\frac{}{}","^","_","<",">","\\pm","\\$","%","\\degree",":","\\left(\\right)","\\abs","\\pi","\\infty"]},algebra:{title:"Algebra",label:"x",value:["x","y","^2","\\sqrt","\\frac","x\\frac{}{}","^","\\sqrt[n]{}","<",">","\\pm","\\abs","\\pi","\\infty","\\left(\\right)","\\left[\\right]"]},comparison:{title:"Comparison",label:"<",value:["\\ne","\\approx","","","<",">","","","\\le","\\ge","","","\\ngtr","\\nless"]},geometry:{title:"Geometry",label:"\\angle",value:["\\perp","\\parallel","\\nparallel","\\underset{\\sim}{\\mathbf{}}","\\angle","\\measuredangle","\\sim","\\cong","\\triangle","\\circledot","\\parallelogram","\\overarc","\\degree","'",'"',"\\pi","\\overline","\\overrightarrow","\\overleftrightarrow","\\square"]},matrices:{title:"Matrices",label:"\\begin{bmatrix}&\\\\&\\end{bmatrix}",value:["\\ldots","\\singlebmatrix","║","═","\\ddots","\\bmatrix","","","\\vdots","\\threebmatrix","","","^","","","","_"]},trigonometry:{title:"Trigonometry",label:"\\sin",value:["\\sin","\\sec","\\sin^{-1}","\\sec^{-1}","\\cos","\\csc","\\cos^{-1}","\\csc^{-1}","\\tan","\\cot","\\tan^{-1}","\\cot^{-1}"]},sets:{title:"Sets",label:"\\intersection",value:["\\subset","\\supset","\\subseteq","\\supseteq","\\in","\\notin","\\ni","\\not\\subset","\\cup","\\cap","\\emptyset","",",",":","!","\\backslash","\\slash","\\left(\\right)","\\left\\{\\right\\}","\\left[\\right)","\\left(\\right]"]},units_si:{title:"Units (SI)",label:"\\text{kg}",value:["g","kg","mg","µg","m","km","cm","mm","L","mL","","","s","ms"]},units_us:{title:"Units (US Customary)",label:"\\text{lb}",value:["oz","lb","","","in","ft","mi","","fl","pt","gal"]},greek:{title:"Greek letters",label:"\\alpha",value:["\\alpha","\\gamma","\\delta","\\pi","\\theta","\\sigma","\\Delta","\\Pi","\\Theta","\\Sigma","\\lambda","\\phi","\\tau","\\varepsilon","\\beta","\\mu","\\rho"]},chemistry:{title:"Chemistry",label:"\\text{Chem}",value:["chem^","chem_","\\atomic","\\polyatomic","\\rightarrow","\\leftarrow","\\rightleftharpoons","\\longleftrightarrow","\\xrightarrow","mol","'","\\overset{}^{H}","\\text{g}\\ \\text{mol}^{-1}"]},chemistry_author:{title:"Chemistry",label:"\\text{Chem}",value:["chem^","chem_","\\atomic","\\polyatomic","\\rightarrow","\\leftarrow","\\rightleftharpoons","\\longleftrightarrow","\\xrightarrow","mol","'","\\overset{}^{H}","\\text{g}\\ \\text{mol}^{-1}"]},grouping:{title:"Grouping Symbols",label:"\\left(\\right)",value:["\\left(\\right)","\\left[\\right]","\\left\\{\\right\\}"]},calculus:{title:"Calculus",label:"\\Delta",value:["d","f","\\int","\\Delta","\\prime","\\frac","\\left(\\right)","\\lim","\\int_{}^{}","\\sum","\\partial","\\lim_{x\\to {}}","\\del","\\mathbf{i}","\\mathbf{j}","\\mathbf{k}"]},misc:{title:"Miscellaneous",label:"\\text{Misc}",value:["a","b","\\propto","abc","\\mid","\\cdot","\\longdiv","\\mathbb{R}"]},discrete:{title:"Discrete",label:"\\text{Discrete}",value:["\\lfloor","\\rfloor","\\lceil","\\rceil","\\uparrow","\\equiv","\\and","\\or","\\not","\\exist","\\forall","\\oplus"]},arrays:{title:"Arrays",label:"\\left\\{\\begin{array}{l}x\\end{array}\\right.",value:["\\left\\{\\begin{array}{l}\\end{array}\\right.","\\begin{array}{rlll}\\end{array}","║","═"]},general:{title:"General",label:"x",value:["x","y","^2","^","_","\\pm","\\frac","x\\frac{}{}","\\sqrt","\\sqrt[3]{}","\\sqrt[n]{}","%","\\abs","\\therefore","\\infty",":"]}},R=["x","y","^2",">","<","\\sqrt","\\left(\\right)","\\sin","\\frac","\\theta","\\pi","a","b","^","\\le","\\ge","\\sqrt[n]{}","\\left\\{\\right\\}","\\cos","\\tan",":"],D=s.a.map(R,(function(e){return{symbol:e}}));function getCollection(e){var t=new l.a;return s.a.each(e,(function(e){var r=N.get(e.symbol);r&&(r.set(s.a.omit(e,"symbol")),t.add(r))})),t}function getNewerFormatMasterCollection(){return S=S||function convertToNewerFormat(e){return s.a.each([{id:"║",type:"keystroke",val:"Shift-Spacebar",shortcut:["shift + space"]},{id:"═",type:"keystroke",val:"Shift-Enter",shortcut:["shift + enter"]}],(function(t){var r=e.get(t.id);r&&(e.remove(r),r=r.clone().set(t),e.add(r))})),e}(N.clone())}s.a.each(A,(function(e){s.a.contains(R,e.symbol)||s.a.contains(["+","-","\\times","\\div","="],e.symbol)||D.push(e)})),t.a={master:N,defaultInputUiSymbols:L,ctrlShortcuts:[{label:"Forward slash",type:"write",shortcut:"/",val:"\\slash"},{label:"Open keypad",type:"open-keypad",shortcut:"\\",val:""}],updateI18nSymbols:function updateI18nSymbols(e,t,r){!function updateCuratedSymbols(e){var t=e.labels.mathKeyboardSymbols||{};s.a.each(O,(function(e){var r=e.name;s.a.extend(e,{title:r?t[r]:e.title})}))}(e),function updateDefaultInputUiSymbols(e,t,r){var a=e.labels.mathKeyboardTitle||{};s.a.each(t,(function(e){var t=L[e]||{},l=s.a.findWhere(r,{id:e}),y=l&&l.label||a[e]||t.title||e.title;s.a.isEmpty(y)||(L[e]=s.a.extend(t,{title:y}))}))}(e,t,r),function updateMasterCollection(e){s.a.each(getNewerFormatMasterCollection().models,(function(t){var r=s.a.findWhere(e,{id:t.id});s.a.extend(t.attributes,{title:r.title})}))}(O)},getForToolbar:function getForToolbar(e){return getCollection(e||A)},getForKeyboard:function getForKeyboard(e){return getCollection(e||D)},getForInputUi:function getForInputUi(e,t){var r={},a=0,l=this;function formatSymbolsGroup(e,r){var a={};return(r=r||L[e]).render_latex=!s.a.isBoolean(r.render_latex)||r.render_latex,r.value&&(r=s.a.clone(r),a=l.calculateGroupDimensions(r.value,t)),"Keyboard"!==r.name&&"Handwriting"!==r.name||(a.columnCount=4,a.hasSymbols=!0,a.processedSymbols=[],a.custom=!0),r.value=a.processedSymbols,r.hasSymbols=a.hasSymbols,r.rowCount=a.rowCount,r.columnCount=a.hasSymbols?a.columnCount:0,r.custom=a.custom,r}return s.a.each(e,(function(e){if(s.a.isString(e)&&L[e]&&l.isAvailable(L[e],t)&&(r[e]=formatSymbolsGroup(e)),s.a.isObject(e)&&e.label&&s.a.isArray(e.value)&&(r["custom"+ ++a]=formatSymbolsGroup(void 0,e)),s.a.isString(e)&&"master"===e){var y={id:["=","\\response"],style:["lrn-btn-grid-num","lrn-btn-grid-operator","lrn-btn-grid-dir"]},w=s.a.reduce(O,(function(e,t){var r=t.id,a=t.style;return r&&-1===y.id.indexOf(r)&&-1===y.style.indexOf(a)&&e.push(r),e}),[]);r.master=formatSymbolsGroup(null,{title:"All Symbols",label:"All Symbols",value:w})}})),r},getForInputNumberPad:function getForInputNumberPad(e){return this.calculateGroupDimensions(e)},calculateGroupDimensions:function calculateGroupDimensions(e,t){var r,a=[],l=1,y=1,w=0,E=!1,T=this;return s.a.each(e,(function(e,r){var O;s.a.isString(e)?O=S.get(e):s.a.isObject(e)&&e.symbol&&(O=S.get(e.symbol))&&O.set(s.a.omit(e,"symbol")),e.length>0&&(E=!0,w=r+1,y>l&&(l=y)),y%4==0?y=1:y++,O&&T.isAvailable(O.attributes,t)&&a.push(O)})),r=Math.ceil(w/4),{processedSymbols:a,columnCount:l,rowCount:r,hasSymbols:E}},isAvailable:function isAvailable(e,t){var r=t?"chemistry":"math";return!s.a.isArray(e.contexts)||s.a.contains(e.contexts,r)},getShortcutsMap:function getShortcutsMap(){return this.getNewerFormatMasterCollection(),S.getShortcutsMap()},getNewerFormatMasterCollection:getNewerFormatMasterCollection}},function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(127),y=r.n(l),w=r(131),E=r(129),S=r(21);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function renderFeatures(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e.features,l=r.removeOnComplete;return s.a.isEmpty(a)?null:y.a.createElement("div",{className:t},s.a.map(a,(function(e,t){var r=!!e._last;return(y.a.createElement(T,{key:t,feature:e,isLastFeature:r,removeOnComplete:l}))})))}var T=function(e){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(EmbeddedFeature,e);var t=_createSuper(EmbeddedFeature);function EmbeddedFeature(){return _classCallCheck(this,EmbeddedFeature),t.apply(this,arguments)}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(EmbeddedFeature,[{key:"render",value:function render(){var e=this;return(y.a.createElement("div",{ref:function ref(t){return e.el=t}}))}},{key:"componentDidMount",value:function componentDidMount(){var e=this.props,t=e.feature,r=e.baseActions,a=e.isLastFeature,s=e.removeOnComplete;r.legacyRenderEmbeddedFeature({feature:t,isLastFeature:a,removeOnComplete:s,el:this.el})}}]),EmbeddedFeature}(y.a.Component);T=E.b(null,(function(e){return{baseActions:w.b(S.a,e)}}))(T),t.a={VerticalFeatures:function VerticalFeatures(e){return renderFeatures(e,"lrn_stimulus_features_vertical")},OverlayFeatures:function OverlayFeatures(e){return renderFeatures(e,"lrn_stimulus_features_overlay",{removeOnComplete:!0})}}},function(e,t,r){"use strict";var a={};function clear(e){var t=a[e];t&&(clearTimeout(t),delete a[e])}t.a={start:function start(e,t){var r=arguments,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;clear(e);var l=function repeatFn(){t(),start.apply(null,r)};a[e]=setTimeout(l,s)},clear:clear}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"f",(function(){return s})),r.d(t,"e",(function(){return l})),r.d(t,"d",(function(){return y})),r.d(t,"c",(function(){return w})),r.d(t,"g",(function(){return E})),r.d(t,"b",(function(){return S}));var a={bold:{type:"button",icon:"lrn-icon-bold",command:"bold"},italic:{type:"button",icon:"lrn-icon-italic",command:"italic"},underline:{type:"button",icon:"lrn-icon-underline",command:"underline"},codeInline:{type:"button",icon:"lrn-icon-code-inline",command:"codeInline"},codeEditor:{type:"button",icon:"lrn-icon-code-editor",command:"codeEditor"},orderedList:{type:"button",icon:"lrn-icon-list-numbered",command:"insertOrderedList"},unorderedList:{type:"button",icon:"lrn-icon-list-bulleted",command:"insertUnorderedList"},removeFormat:{type:"button",icon:"lrn-icon-remove-format",command:"removeFormat"},alignLeft:{type:"button",icon:"lrn-icon-align-left",command:"alignLeftStyle"},alignCenter:{type:"button",icon:"lrn-icon-align-center",command:"alignCenterStyle"},alignRight:{type:"button",icon:"lrn-icon-align-right",command:"alignRightStyle"},alignJustify:{type:"button",icon:"lrn-icon-align-justify",command:"alignJustifyStyle"},superscript:{type:"button",icon:"lrn-icon-superscript",command:"superscript"},subscript:{type:"button",icon:"lrn-icon-subscript",command:"subscript"},insertHorizontalRule:{type:"button",icon:"lrn-icon-hr",command:"insertHorizontalRule"},indentIncrease:{type:"button",icon:"lrn-icon-indent-increase",command:"increaseIndent"},indentDecrease:{type:"button",icon:"lrn-icon-indent-decrease",command:"decreaseIndent"},textDirectionLtr:{type:"button",icon:"lrn-icon-text-direction-ltr",command:"textDirectionLtr"},textDirectionRtl:{type:"button",icon:"lrn-icon-text-direction-rtl",command:"textDirectionRtl"},blockquote:{type:"button",icon:"lrn-icon-blockquote",command:"insertBlockQuote"},table:{type:"createTable",icon:"lrn-icon-table"},editTable:{type:"editTable",icon:"lrn-icon-edit-table"},image:{type:"insertImage",icon:"lrn-icon-image",icons:{edit:"lrn-icon-image-edit",preview:"lrn-icon-image-preview",delete:"lrn-icon-image-delete"}},undo:{type:"button",icon:"lrn-icon-undo",command:"undo"},redo:{type:"button",icon:"lrn-icon-redo",command:"redo"},charactermap:{type:"charactermap"},characterMathMap:{type:"characterMathMap"},"|":{type:"divider"},formulaEditor:{type:"formulaEditor",icon:"lrn-icon-formula"}},s=12,l={SMALL:"small",MEDIUM:"medium",LARGE:"large",FULL_SIZE:"fullSize"},y={SMALL:200,MEDIUM:525,LARGE:1024,FULL_SIZE:3024},w={CREATE_FORMULA:"createFormula",EDIT_FORMULA:"editFormula"},E={FORMULA_EDITOR:"editFormula"},S=["image/jpg","image/jpeg","image/png","image/gif","image/bmp",".jfif"]},function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=function filterUnfocusableElements(e){return s.a.filter(e,(function(e){return!s.a.isNull(e)&&!e.disabled&&e.offsetWidth>0&&e.offsetHeight>0}))},y={left:function left(e){if(e){e=l(e);var t=this.getFocusedElement(e).index;t?t>0&&e[t-1].focus():e[e.length-1].focus()}},top:function top(e){e=l(e);var t=this.getFocusedElement(e).element;if(t){var r=t.getBoundingClientRect(),a=s.a.findLastIndex(e,(function(e){var t=e.getBoundingClientRect();if(t.top<r.top&&t.left<=r.left)return!0}));a>=0&&e[a].focus()}},right:function right(e){e=l(e);var t=this.getFocusedElement(e).index;e&&!1!==t&&(t===e.length-1?e[0].focus():t<e.length-1&&e[t+1].focus())},bottom:function bottom(e){e=l(e);var t=this.getFocusedElement(e).element;if(t){var r=t.getBoundingClientRect(),a=s.a.findIndex(e,(function(e){var t=e.getBoundingClientRect();if(t.top>r.top&&t.left>=r.left)return!0}));a>=0&&e[a].focus()}},getFocusedElement:function getFocusedElement(e){var t=document.activeElement,r=e.indexOf(t);return r<0?{}:{element:t,index:r}}};t.a=y},,function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(128),y=r.n(l),w=r(127),E=r.n(w),S=r(129),T=r(140),O=r(154),N=r(7),A=r(155);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var L={XSMALL:{className:"lrn-xs",minWidth:0},SMALL:{className:"lrn-sm",minWidth:481},MEDIUM:{className:"lrn-md",minWidth:801},LARGE:{className:"lrn-lg",minWidth:1200}};function ResponsiveWidget(e){if(!e.responsive)return e.children;return E.a.createElement(A.a.Detector,{onChange:function onSizeChange(t){var r=s.a.chain(L).filter((function(e){return e.minWidth<=t.width})).pluck("className").value().join(" ");e.onChange&&e.onChange(_objectSpread(_objectSpread({},t),{},{responsiveClassName:r}))}},e.children)}var R=function applyResponsiveWidgetLayout(e){var t;e.state=s.a.extend({},e.state,{dimensions:{width:0,height:0},layoutMode:"split"}),e.render=function(){var r=e.baseClassName,a=e.state,l=e.props.base,y=l.responseId,w=l.widgetLayout,S=function getLayoutData(e,t){if("stack"===e){return{layoutClassName:"",elements:s.a.map(t,(function(e){return{type:e.type,width:"",paddingLeft:"",paddingRight:""}}))}}return{layoutClassName:"clearfix",elements:t}}(a.layoutMode,w.elements),T=S.elements,O=S.layoutClassName;return t||(t=s.a.findWhere(w.elements,{type:"interaction"})),E.a.createElement(A.a.Detector,{onChange:function onChange(r){return function onComponentResize(e,t,r){var a,s=t.width,l=e.state.layoutMode,y=(a=r.width||50,s*a/100<400?"stack":"split");y!==l&&e.setState({layoutMode:y})}(e,r,t)}},E.a.createElement("div",{id:y,className:"".concat(r," ").concat(O)},e.getInstructorStimulus(),s.a.map(T,(function(t,r){return E.a.createElement(A.a.Column,_extends({key:r},t),function getChildComponent(t){return"stimulus"===t?e.getStimulus():e.getQuestionContent()}(t.type))}))))}};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function baseQuestion_extends(){return(baseQuestion_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function baseQuestion_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var D=function(e){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(BaseQuestion,e);var t=_createSuper(BaseQuestion);function BaseQuestion(e){var r;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,BaseQuestion),baseQuestion_defineProperty(_assertThisInitialized(r=t.call(this,e)),"state",{}),baseQuestion_defineProperty(_assertThisInitialized(r),"onSizeChange",(function(e){var t=e.responsiveClassName;r.setState({responsiveClassName:t})})),s.a.getNested(e,"base.widgetLayout.enabled")&&R(_assertThisInitialized(r)),r}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(BaseQuestion,[{key:"render",value:function render(){var e=this.baseClassName,t=this.props.base.responseId;return E.a.createElement(ResponsiveWidget,{responsive:this.props.responsive,onChange:this.onSizeChange},E.a.createElement("div",{id:t,className:e},this.getInstructorStimulus(),this.getStimulus(),this.getQuestionContent()))}},{key:"baseClassName",get:function get(){var e=this.props.base,t=e.questionType,r=e.fontSizeClass,a=e.inMaskingState;return y()({"lrn-masking":a,"lrn-ie":"ie"===N.a.browser,"lrn-ios":N.a.isIOS},r,this.state.responsiveClassName,"lrn lrn_widget lrn_qr lrn_clearfix lrn_".concat(t," ").concat(r))}},{key:"getQuestionContent",value:function getQuestionContent(){var e=this.props,t=e.base,r=e.children,a=t.stimulus,l=t.extraClassNames||{},y={responseWrapper:"lrn_response_wrapper ",response:"lrn_response lrn_clearfix "},w=s.a.getNested(t,"__legacyAttributes.extraClassNames")||{};return w.lrn_response_wrapper&&(y.responseWrapper+=w.lrn_response_wrapper),w.lrn_response&&(y.response+=w.lrn_response),y.responseWrapper+=l.responseWrapper||"",y.response+=l.response||"",E.a.createElement("div",{className:y.responseWrapper},E.a.createElement(T.a.OverlayFeatures,{features:a.legacyOverlayFeatures}),E.a.createElement("div",{className:y.response},r))}},{key:"getStimulus",value:function getStimulus(){var e=this.props.base,t=e.stimulus,r=e.stimulusReview,a=e.isReviewState,s=e.responseId,l=a&&r.visible?r:t;return E.a.createElement(O.a.Stimulus,baseQuestion_extends({},l,{responseId:s}))}},{key:"getInstructorStimulus",value:function getInstructorStimulus(){var e=this.props.base.stimulusInstructor;return(E.a.createElement(O.a.InstructorStimulus,e))}}]),BaseQuestion}(E.a.Component);D=S.b((function(e){return{base:e.base}}),null)(D);t.a=D},function(e,t,r){"use strict";var a=r(1),s=r.n(a),l=r(0),y=r.n(l),w=(r(54),document),E=s()("body");function unwatch(e){w.unbindLeave&&w.unbindLeave(e)}t.a={watch:function watch(e,t){E.find(e).length&&w.leave&&w.leave(e,y.a.debounce((function(){E.find(e).length||(t(),unwatch(e))}),10))},unwatch:unwatch}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r(127);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var s=function(e){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(Wrapper,e);var t=_createSuper(Wrapper);function Wrapper(){return _classCallCheck(this,Wrapper),t.apply(this,arguments)}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(Wrapper,[{key:"render",value:function render(){return this.props.children}}]),Wrapper}(r.n(a).a.PureComponent)},function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(5),y=r.n(l),w=r(127),E=r.n(w),S=r(130),T=r.n(S),O=r(131),N=r(129),A=r(192),L=r(55),R=r(21),D=r(57),M=r(31),B=r(37),q=r(38),W=r(146),j=r(150),H=r(147);function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}(e)||function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function _unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var V=y.a.View.extend({initialize:function initialize(){var e=this;this._responseId=this.model.get("response_id"),this.activity=this.options.activity,this.remove=this.remove.bind(this),this.initialisationCompleted=this.initialisationCompleted.bind(this);var t=this.getDataService();this.addFacadeMethods(this.getFacade()),t.prepare((function(){e.setLegacyAttributes(),e.render(),e.initialisationCompleted(),W.a.watch('[id="'.concat(e._responseId,'"]'),e.remove)}))},update:function update(){var e=this,t=this.getDataService(),r=this.getStore(),a=s.a.extend({},t.getInitialState()),l=this.widgetInstance;l&&s.a.isFunction(l.reset)&&l.reset(),r.dispatch({type:"UPDATE_ALL",payload:{data:a}}),this.prepareStoreState(),this.setLegacyAttributes();var y=R.a.renderMathIfRequired({success:function success(){e.onMathRendered()}});r.dispatch(y)},getDataService:function getDataService(){if(!this._dataService){var e=this.DataService;this._dataService=new e(this.model,this.getFacade())}return this._dataService},getStore:function getStore(){if(!this._store){var e=this.getDataService(),t=this.getReducers(),r=this.getMiddleware();s.a.each(t,(function(e,t){var r=e.setName;r&&r(t)})),this._store=Object(O.d)(Object(O.c)(t),e.getInitialState(),Object(j.a)(O.a.apply(void 0,_toConsumableArray(r)))),this.prepareStoreState()}return this._store},getMiddleware:function getMiddleware(){var e=this;return[A.a.withExtraArgument(this.getThunkServices()),function legacyMiddleWare(t){return function(t){return function(r){return r.type===R.a.actionTypes.QUESTION_LEGACY_BEGIN_RESPONSE&&e.beginResponse(),t(r)}}}]},getThunkServices:function getThunkServices(){var e=this;return{dataService:this.getDataService().getFacade(),mathService:this.getMathService(),simplefeatureService:{render:function renderViewSimpleFeatures(){return e.options.services.renderViewSimpleFeatures(e)}}}},getReducers:function getReducers(){return{base:L.a}},render:function render(){if(this.component)try{this.el&&T.a.unmountComponentAtNode(this.el)}catch(e){}else{var e=document.createElement("div");this.$el.replaceWith(e),this.setElement(e),this.$el.attr("data-lrn-widget-container",this._responseId).attr("data-lrn-widget-type","question")}return this.renderComponent()},renderComponent:function renderComponent(){var e=this,t=this.getStore(),r=this.ViewComponent,a=!0===this.forwardRef?E.a.createElement(r,{ref:function ref(t){return e.widgetInstance=t}}):E.a.createElement(r,null);return new Promise((function(r){T.a.render(E.a.createElement(H.a,{ref:function ref(t){return e.component=t}},E.a.createElement(N.a,{store:t},a)),e.el,r)}))},remove:function remove(){if(!this._removed){try{var e=T.a.findDOMNode(this.component);e&&!this.$el.find(e).length&&this.$el.append(e),this.el&&(this._unmounted=T.a.unmountComponentAtNode(this.el))}catch(e){}y.a.View.prototype.remove.call(this),W.a.unwatch('[id="'.concat(this._responseId,'"]')),this._removed=!0}},renderSimpleFeatures:function renderSimpleFeatures(e){return B.a.renderSimpleFeatures.call(this,this.$el,this.activity,e)},initialisationCompleted:function initialisationCompleted(){var e=this.getMathService(),t=this.options.mathRenderPromise;e.mathquillRendering()&&(t=e.renderMathquill()),t&&t.then(this.onMathRendered.bind(this)),this.imageLoader=new q.a({element:this.el}),this.imageLoader.loadImages(),this.options.initialisationCallback&&s.a.defer(this.options.initialisationCallback)},prepareStoreState:function prepareStoreState(){},getFacade:function getFacade(){if(s.a.isUndefined(this.questionFacade)){var e=new D.a(this).facade;this.questionFacade=e}return this.questionFacade},addFacadeMethods:function addFacadeMethods(e){},getMathService:function getMathService(){return s.a.isUndefined(this._mathService)&&(this._mathService=new M.a(this,"question")),this._mathService},setLegacyAttributes:function setLegacyAttributes(){var e=this.__legacyAttributes,t=R.a.setLegacyAttributes(e);this.getStore().dispatch(t)},onMathRendered:function onMathRendered(){var e=this.cacheRenderedMath.bind(this);this.getStore().dispatch(R.a.notifyMathRendered({cacheRenderedMath:e}))},cacheRenderedMath:function cacheRenderedMath(e){e&&this.getStore().dispatch(R.a.cacheRenderedMath({mathInResponse:e}))},setDisabled:function setDisabled(e){var t=this.activity.get("state"),r=this.activity.STATE,a=[r.INITIAL,r.RESUME],l=this.getStore().getState().base.disabled;return!(!s.a.contains(a,t)||l===e)&&(e?this.undelegateEvents():this.delegateEvents(),this.getStore().dispatch(R.a.setDisabled(e)),!0)},beginResponse:function beginResponse(){},pauseResponse:function pauseResponse(){},stopResponse:function stopResponse(){},masking:function masking(e,t){this.getStore().dispatch(R.a.setMaskingState(e,t))},reset:function reset(){this.getFacade().trigger("reset")}});t.a=V},function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(5),y=r.n(l);function MathEvents(){}var w={AWAIT_UPDATE:"await-update",CHANGE_DISABLED_STATE:"change-disabled-state",CONTENT_OUTDATED:"content-outdated",EDITOR_BLURRED:"editor-blurred",EDITOR_FOCUSED:"editor-focused",EDITOR_PRESSED:"editor-pressed",EDITOR_SPOKENMATH_UPDATED:"editor-spokenmath-updated",EDITOR_REMOVED:"editor-removed",ESCAPE_UI:"escape-ui",ESCAPE_UI_WITHOUT_KEYBOARD:"escape-ui-without-keyboard",EXTERNAL_KEY:"external-key",GET_ACTIVE_ID:"get-active-id",ITEM_BLURRED:"item-blurred",ITEM_FOCUSED:"item-focused",MATH_COMMAND:"math-command",RESET_STATE:"reset-state",SET_ERROR:"set-error",SHIFT_KEY:"shift-key",TAB_EDITOR:"tab-away-from-editor",UPDATED:"updated",WRITE_LATEX:"write-latex"};MathEvents.prototype=s.a.extend({EVENT:w},y.a.Events),s.a.extend(MathEvents,w),t.a=MathEvents},function(e,t,r){"use strict";var a;a=function composeWithDevTools(e){return e},t.a=a},function(e,t,r){"use strict";var a=r(127),s=r.n(a);function Icon(e){var t=e.icon;return t?s.a.createElement("span",{className:"lrn_icon  ".concat(t),"aria-hidden":"true"}):null}function ScreenReader(e){var t=e.label;return t?s.a.createElement("span",{className:"sr-only"},"  ",t):null}t.a={Divider:function Divider(){return s.a.createElement("div",{className:"lrn-divider"})},Button:function Button(e){var t=e.disabled,r=e.isActive,a=e.name,l=e.icon,y=e.label,w=e.activeClassName,E=e.children,S=e.getRef,T=e.onMouseEnter,O=e.onMouseLeave,N=e.onMouseDown,A=e.onClick,L=e.tabIndex,R="lrn_btn  lrn-editor-toolbar-button-".concat(a,"  ").concat(r?w:"","  ").concat(e.className||"");return s.a.createElement("button",{ref:function ref(e){return S&&S(e)},type:"button",className:R,"aria-label":y,"aria-pressed":r,disabled:t,onMouseEnter:function onMouseEnter(){return T(y)},onMouseLeave:O,onMouseDown:function mouseDownHandler(e){N&&N(),e.preventDefault()},onClick:function clickHandler(e){A&&A(),e.preventDefault()},tabIndex:L},s.a.createElement(Icon,{icon:l}),s.a.createElement(ScreenReader,{label:y}),E)}}},function(e,t,r){"use strict";var a=r(127),s=r.n(a),l=r(180);r(182);t.a=function Modal(e){var t=e.afterRender,r=e.children,a=e.title,y=e.parentNode,w=e.modalIsOpen,E=e.onRequestClose,S=e.preventFocusWhenAppear,T="lrn-wysihtml-modal  ".concat(e.className||"");return s.a.createElement(l.a,{afterRender:t,preventFocusWhenAppear:S,isOpen:w,parentNode:y,className:"lrn-wysihtml-floating-modal",onRequestClose:E,shouldUpdatePosition:!1},s.a.createElement("div",{className:T,style:{opacity:1}},s.a.createElement("div",{className:"lrn-wysihtml-modal-dialog",role:"dialog",style:{opacity:1}},s.a.createElement("div",{className:"lrn-wysihtml-modal-title"},a),s.a.createElement("button",{type:"button",className:"lrn_btn lrn_btn_close",title:"Close","data-lrn-action":"close",onClick:E},s.a.createElement("span",{className:"sr-only"},"Close")),s.a.createElement("div",{className:"lrn-wysihtml-modal-content"},r))))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return B}));var a=r(0),s=r.n(a),l=r(127),y=r.n(l),w=r(143),E=r(137),S=r(141),T=r(134),O=r(133);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var N=T.a.UP,A=T.a.DOWN,L=T.a.ESCAPE,R=T.a.TAB,D=T.a.SHIFT;function getLabelContent(e,t){var r=e;return s.a.isFunction(e)&&(r=e(t)),s.a.isString(r)?r:""}function Button(e){var t=e.title,r=e.icon,a=e.label,l=e.value,w=e.index,E=e.selectedIndex,S=e.selectOption,T=e.onKeyDown,O=e.cacheButton,N=E===w?"lrn_selected":"",A=getLabelContent(a,l);return y.a.createElement("button",{title:t,"aria-label":t,className:"lrn_btn lrn_dropdown_option ".concat(N),type:"button",unselectable:"on",tabIndex:"0",onClick:function onClick(){return S(w)},onKeyDown:T,ref:function ref(e){return O&&O(e)}},function getIcon(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s.a.isString(e.className)?e.className:"",r=s.a.isString(e.content)?e.content:"";return t||r?y.a.createElement("span",{className:"lrn_icon ".concat(t),dangerouslySetInnerHTML:{__html:r}}):null}(r),y.a.createElement("span",{className:"lrn_content",dangerouslySetInnerHTML:{__html:A}}))}function ScrollingIndicator(e){var t=e.scrollStart,r=e.scrollEnd;return(y.a.createElement("div",{className:"lrn_scrolling_indicator",onMouseEnter:t,onMouseLeave:r},y.a.createElement("span",{className:"lrn_caret"})))}function Viewport(e){var t=e.children,r=e.setEl,a=e.setContentEl,s=e.viewportStyle,l=(void 0===s?{}:s).height;return y.a.createElement("div",{className:"lrn_viewport",style:{height:l},ref:r},y.a.createElement("div",{className:"lrn_viewport_content",ref:a},t))}var M=function(e){_inherits(DropdownMenu,e);var t=_createSuper(DropdownMenu);function DropdownMenu(e){var r;return _classCallCheck(this,DropdownMenu),_defineProperty(_assertThisInitialized(r=t.call(this,e)),"MIN_VIEWPORT_SIZE",150),_defineProperty(_assertThisInitialized(r),"VIEWPORT_GAP",50),_defineProperty(_assertThisInitialized(r),"buttons",[]),_defineProperty(_assertThisInitialized(r),"state",{viewport:null,scrollTop:0}),_defineProperty(_assertThisInitialized(r),"focusIndex",0),_defineProperty(_assertThisInitialized(r),"cacheButton",(function(e){e&&r.buttons.push(e)})),_defineProperty(_assertThisInitialized(r),"requestToClose",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=r.props,a=t.onRequestClose,s=t.isTabbable,l=t.timeOfLastToggle,y=Date.now()-l;y<200||(S.a.clear("custom_dropdown"),r._removeAllEvents(),a&&a(e),s&&(r.focusIndex=0))})),_defineProperty(_assertThisInitialized(r),"selectOption",(function(e){var t=r.props,a=t.onChange,s=t.isTabbable;a&&a(e),s&&(r.focusIndex=0)})),_defineProperty(_assertThisInitialized(r),"_onKeyDown",(function(e){var t=_assertThisInitialized(r).buttons,a=r.props,l=a.menuOptions,y=a.isTabbable,E=e.keyCode;if(function isSupportedKey(e){return s.a.contains([N,A,L,R,D],e)}(E))if(y){if(e.shiftKey&&E===D)return;E!==R||e.shiftKey?E===R&&e.shiftKey&&r.focusIndex--:r.focusIndex++,E===R&&r.focusIndex===l.length&&r.requestToClose(!0)}else e.preventDefault(),E===L?r.requestToClose(!0):E===N?w.a.top(t):E===A&&w.a.bottom(t)})),_defineProperty(_assertThisInitialized(r),"_scrollStart",(function(){var e=_assertThisInitialized(r),t=e.viewportEl,a=e.viewportContentEl;S.a.start("custom_dropdown",(function(){var e=t.scrollTop+5;e<a.clientHeight-t.clientHeight&&r.setState({scrollTop:e})}))})),_defineProperty(_assertThisInitialized(r),"_scrollEnd",(function(){S.a.clear("custom_dropdown")})),r.useViewport=!!s.a.isUndefined(e.useViewport)||e.useViewport,r}return _createClass(DropdownMenu,[{key:"render",value:function render(){var e=this,t=this.props,r=t.menuOptions,a=t.selectedIndex,l=t.className,w=t.renderOption,E=this.state.viewport,S=s.a.isString(l)?l:"",T=function(){if(E)return{height:"".concat(E.height,"px")}}(),O=function getOptions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.menuOptions,r=void 0===t?[]:t,a=e.selectedIndex,s=e.selectOption,l=e.onKeyDown,w=e.cacheButton,E=e.renderOption;return r.map((function(e,t){var r=e.title,S=e.icon,T=e.label,O=e.value;if(E)return e.onClick=function(){return s(t)},e.isActive=t===a,e.onKeyDown=function(e){return l(e)},E(e);var N={key:t,title:r,icon:S,label:T,value:O,index:t,selectedIndex:a,selectOption:s,onKeyDown:l,cacheButton:w};return(y.a.createElement(Button,N))}))}({menuOptions:r,selectedIndex:a,selectOption:this.selectOption,onKeyDown:this._onKeyDown,cacheButton:this.cacheButton,renderOption:w});return y.a.createElement("div",{ref:function ref(t){return e.el=t},className:"lrn_dropdown_menu ".concat(S),role:"menu"},!this.useViewport&&O,this.useViewport&&y.a.createElement(Viewport,{setEl:function setEl(t){return e.viewportEl=t},setContentEl:function setContentEl(t){return e.viewportContentEl=t},viewportStyle:T},O),this.useViewport&&T&&y.a.createElement(ScrollingIndicator,{scrollStart:this._scrollStart,scrollEnd:this._scrollEnd}))}},{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(){this.buttons=[]}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._removeAllEvents()}},{key:"componentDidUpdate",value:function componentDidUpdate(e){var t=this.props,r=t.isOpen,a=t.focusToSelectedOption;if(r&&!this._documentEventsAdded){var s=this._getSelectedOptionElement();if(a&&s&&s.focus(),this._bindListeners(),this.useViewport){var l=this._getViewport(),y={viewport:l,scrollTop:this._getScrollTopByElement(s,l)};this.state!==y&&this.setState(y)}}else r||(this._removeAllEvents(),e.isOpen!==r&&this.setState({viewport:null,scrollTop:0}));if(r){var w=this.state.scrollTop;w>0&&(this.viewportEl.scrollTop=w)}}},{key:"_getSelectedOptionElement",value:function _getSelectedOptionElement(){var e=this.buttons,t=this.props;if(!s.a.isEmpty(e)){var r=t.selectedIndex;return e[r>=0?r:0]}}},{key:"_bindListeners",value:function _bindListeners(){document.addEventListener("click",this.requestToClose),this._documentEventsAdded=!0}},{key:"_removeAllEvents",value:function _removeAllEvents(){document.removeEventListener("click",this.requestToClose),this._documentEventsAdded=!1}},{key:"_getViewport",value:function _getViewport(){var e,t=this.el,r=this.viewportContentEl,a=t.getBoundingClientRect().top,s=r.getBoundingClientRect().height,l=this.VIEWPORT_GAP,y=this.MIN_VIEWPORT_SIZE,w=E.a.getViewportDimensions().height-a;if(w<s&&(e=w<y?y:w),e)return{top:a,height:e-=l}}},{key:"_getScrollTopByElement",value:function _getScrollTopByElement(e,t){if(!e||!t)return 0;var r=e.getBoundingClientRect(),a=r.top+r.height-t.top-t.height;return a>0?a:0}}]),DropdownMenu}(y.a.Component),B=function(e){_inherits(Dropdown,e);var t=_createSuper(Dropdown);function Dropdown(e){var r;_classCallCheck(this,Dropdown),_defineProperty(_assertThisInitialized(r=t.call(this,e)),"toggle",(function(){var e=r.state.isOpen,t=!e,a=e&&!t;r.setState({isOpen:t,focusToSelectedOption:!0,timeOfLastToggle:Date.now()}),a&&r.buttonEl.focus()})),_defineProperty(_assertThisInitialized(r),"open",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{focusToSelectedOption:!0};r.setState({isOpen:!0,focusToSelectedOption:e.focusToSelectedOption})})),_defineProperty(_assertThisInitialized(r),"close",(function(){r.setState({isOpen:!1})})),_defineProperty(_assertThisInitialized(r),"setSelectedIndex",(function(e){r.state.selectedIndex!==e?r.setState({selectedIndex:e,isOpen:!1}):r.close()})),_defineProperty(_assertThisInitialized(r),"_onDropdownRequestToClose",(function(e){r.close(),e&&r.buttonEl.focus()})),_defineProperty(_assertThisInitialized(r),"_onDropdownOptionChange",(function(e){var t=r.props,a=t.menuOptions,s=t.onChange;r.setSelectedIndex(e),r.buttonEl.focus(),s&&s({index:e,value:a[e].value})})),_defineProperty(_assertThisInitialized(r),"_onKeyDown",(function(e){var t=e.keyCode;(r.props.toggleButton||{}).disableArrowKey||(t===N||t===A?(e.preventDefault(),r.open()):t===R&&e.shiftKey&&r._onDropdownRequestToClose())})),_defineProperty(_assertThisInitialized(r),"_onBlur",(function(){var e=r.props.onBlur;s.a.isFunction(e)&&!r.isOpen()&&r.buttonEl!==document.activeElement&&e()}));var a=e.selectedIndex,l=e.scaleToFit,y=e.isDisabled,w=e.useViewport;return r.useViewport=!!s.a.isUndefined(w)||w,r.state={scaleToFit:l,selectedIndex:s.a.isNumber(a)?a:-1,isOpen:!1,isDisabled:y,labelStyle:null,timeOfLastToggle:0},r}return _createClass(Dropdown,[{key:"componentDidMount",value:function componentDidMount(){this.state.scaleToFit&&this._updateSelectedLabel()}},{key:"componentDidUpdate",value:function componentDidUpdate(e,t){var r=this.props,a=r.updateComplete,l=r.renderMain,y=this.state,w=y.selectedIndex,E=y.scaleToFit;t.selectedIndex!==w?(s.a.isFunction(a)&&a(),s.a.isFunction(l)&&l(w),E&&this._updateSelectedLabel()):w!==this.props.selectedIndex&&s.a.isNumber(this.props.selectedIndex)&&this.setState({selectedIndex:this.props.selectedIndex})}},{key:"render",value:function render(){var e=this,t=this.state,r=t.selectedIndex,a=t.isOpen,l=t.isDisabled,w=t.focusToSelectedOption,E=t.timeOfLastToggle,S=this.props,T=S.ariaDescription,N=S.ariaSelected,A=S.menuOptions,L=S.popupClassName,R=S.containerClass,D=S.renderMain,B=S.renderOption,q=S.title,W=S.isTabbable,j=this._getSelectedOption().title||q,H=Object(O.a)(N,{title:j}),V=s.a.isFunction(D)?D(this.state.selectedIndex):this._getMainButtonContent(),z=["lrn_btn","lrn_dropdown_toggle",l?"lrn_disabled":""].join(" "),U=["lrn_dropdown",R||"",a?"lrn_open":""].join(" ");return y.a.createElement("div",{className:U},y.a.createElement("button",{"aria-label":H,title:q,"aria-roledescription":T,className:z,type:"button",onClick:l?void 0:this.toggle,onKeyDown:l?void 0:this._onKeyDown,onBlur:l?void 0:this._onBlur,ref:function ref(t){return e.buttonEl=t}},V,y.a.createElement("span",{className:"lrn_caret lrn_caret_right"})),y.a.createElement(M,{menuOptions:A,className:L,selectedIndex:r,isOpen:a,timeOfLastToggle:E,isTabbable:W,focusToSelectedOption:w,useViewport:this.useViewport,onChange:this._onDropdownOptionChange,onRequestClose:this._onDropdownRequestToClose,renderOption:B}))}},{key:"isOpen",value:function isOpen(){return this.state.isOpen}},{key:"_getMainButtonContent",value:function _getMainButtonContent(){var e=this,t=this.state.labelStyle,r=this._getSelectedOption(),a=r.label,s=r.value;return y.a.createElement("span",{ref:function ref(t){return e.buttonLabelEl=t},className:"lrn_content",style:t,dangerouslySetInnerHTML:{__html:getLabelContent(a,s)}})}},{key:"_getSelectedOption",value:function _getSelectedOption(){var e=this.state.selectedIndex,t=this.props.menuOptions;return t&&t.length>e&&e>=0?t[e]:{title:"",label:""}}},{key:"_updateSelectedLabel",value:function _updateSelectedLabel(){var e=this.buttonEl,t=this.buttonLabelEl;if(e&&t){var r=e.getBoundingClientRect(),a=t.getBoundingClientRect(),s=a.height-r.height,l=null;if(s>0){var y=1-s/a.height;l={transform:"scale(".concat(y,")"),transformOrigin:"left top"}}l!==this.state.labelStyle&&this.setState({labelStyle:l})}}}]),Dropdown}(y.a.Component)},function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(140),y=r(127),w=r.n(y);t.a={Stimulus:function Stimulus(e){if(!e.visible)return null;var t=e.responseId;return w.a.createElement("div",{className:"lrn_question"},w.a.createElement("div",{className:"lrn_stimulus lrn_clearfix"},w.a.createElement("div",{className:"lrn_stimulus_content lrn_clearfix",dangerouslySetInnerHTML:{__html:e.content},id:"stimulus-".concat(t)}),function renderLegacyVerticalFeatures(){var t=e.legacyVerticalFeatures,r=e.legacyEvents,a=e.i18n;if(!s.a.isEmpty(t))return w.a.createElement(l.a.VerticalFeatures,{features:t,i18n:a,events:r})}()))},InstructorStimulus:function InstructorStimulus(e){return e.visible?w.a.createElement("div",{className:"lrn_question"},w.a.createElement("div",{className:"lrn-instructor-stimulus"},w.a.createElement("div",{className:"lrn_clearfix"},w.a.createElement("div",{className:"lrn-instructor-stimulus-content",dangerouslySetInnerHTML:{__html:e.content}})))):null}}},function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(40),y=r.n(l),w=r(127),E=r.n(w),S=r(130),T=r.n(S),O=r(24);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var N=function(e){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(Detector,e);var t=_createSuper(Detector);function Detector(e){var r;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Detector),function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}(_assertThisInitialized(r=t.call(this,e)),"onWrapperSizeChange",s.a.debounce((function(){var e=_assertThisInitialized(r),t=e.onChange,a=e.el;t&&a&&!r._unmounted&&t({width:a.offsetWidth,height:a.offsetHeight})}),400)),s.a.isFunction(e.onChange)&&(r.onChange=e.onChange),r}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(Detector,[{key:"componentDidMount",value:function componentDidMount(){var e=this;this.el=T.a.findDOMNode(this),this.resizeSensor=Object(O.a)(this.el,(function(){return new y.a(e.el,e.onWrapperSizeChange)})),this.onWrapperSizeChange()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._unmounted=!0,this.resizeSensor.detach(this.onWrapperSizeChange),this.el=null}},{key:"render",value:function render(){var e=this.props.children;return E.a.Children.only(e)}}]),Detector}(E.a.PureComponent);t.a={Detector:N,Column:function Column(e){var t=function(e){var t=function formatValue(e){return e?"".concat(e,"%"):""},r=e.width,a=e.paddingLeft,s=e.paddingRight;return{width:t(r),paddingLeft:t(a),paddingRight:t(s),float:r?"left":""}}(e);return(E.a.createElement("div",{style:t},e.children))}}},,,function(e,t,r){"use strict";r.d(t,"a",(function(){return defineGetters}));var a=r(0),s=r.n(a);function defineGetters(e,t){s.a.each(t,(function(t,r){t=t.bind(e),Object.defineProperty(e,r,{get:t})}))}},,function(e,t,r){"use strict";r.d(t,"a",(function(){return getTabbableDescendants}));var a=r(0),s=r(132);function isFocusable(e){var t=e.nodeName.toLowerCase(),r=!e.disabled,l=Object(a.contains)(["a","button","input","select","textarea","object"],t)&&r,y=e.getAttribute("tabindex"),w=Object(a.isNumber)(y)&&y>=0;return s.b.isElementVisible(e)&&(l||w)}function getTabbableDescendants(e){return[].slice.call(e.querySelectorAll("*"),0).filter(isFocusable)}},function(e,t,r){"use strict";var a=r(1),s=r.n(a),l=r(5),y=r.n(l),w=r(0),E=r.n(w),S=r(63),T=r.n(S),O=r(139),N=r(149),A=r(4),L=r(7),R=r(51),D=r(132),M=r(24),B=r(164),q=r.n(B),W=r(165),j={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",191:"/",220:"\\",8:"Backspace",32:"Spacebar",13:"Enter",9:"Tab",37:"Left",38:"Up",39:"Right",40:"Down",16:"Shift"},H=[0,1,2,3,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],V=O.a.ctrlShortcuts,z=O.a.getShortcutsMap();t.a=y.a.View.extend({MAX_MATH_DEPTH:40,events:{"keypress span.lrn_math_editable":"keyPress","keyup span.lrn_math_editable":"keyUp","keydown span.lrn_math_editable":"keyDown","click span.lrn_math_editable":"editorPressed","touchstart span.lrn_math_editable":"editorPressed","cut .lrn_focusable":"updateModel","paste .lrn_focusable":"updateModel","focus .lrn_focusable":"onFocus","blur .lrn_focusable":"onBlur"},mathEvents:void 0,shortcutKeyTime:500,shiftIsPressed:!1,template:q.a,initialize:function initialize(){this.keys="",T.a.config({autoCommands:"lim"}),this.mathEvents=new N.a,this.addRenderingLogic(),this.displayLogic.isReadOnly&&(this.events={}),this.render(),this.bindHandwritingEvents(),this.listenTo(this.mathEvents,this.mathEvents.EVENT.MATH_COMMAND,this.enterMath,this),this.listenTo(this.mathEvents,this.mathEvents.EVENT.ESCAPE_UI,this.refocusEditor,this),this.listenTo(this.mathEvents,this.mathEvents.EVENT.ESCAPE_UI_WITHOUT_KEYBOARD,this.refocusEditorWithoutKeyboard,this),this.displayLogic.templateAriaLabel||(this.$logger=this.$('[data-lrn-component="logger"]'),this.dynamicAriaLabel=E.a.debounce(this.dynamicAriaLabel.bind(this),300),this.listenTo(this.mathEvents,this.mathEvents.EVENT.UPDATED,this.dynamicAriaLabel,this)),this.listenTo(this.mathEvents,this.mathEvents.EVENT.EXTERNAL_KEY,(function(e,t){var r=s.a.Event(e.type,E.a.pick(e,"type","keyCode","metaKey","shiftKey","altKey","which"));this.$("span.lrn_math_editable").trigger(r)}),this),this.listenTo(this.mathEvents,this.mathEvents.EVENT.WRITE_LATEX,this.clearAndWrite),this.listenTo(this.mathEvents,this.mathEvents.EVENT.CHANGE_DISABLED_STATE,(function(e){this.options.disableInput!==e&&(this.options.disableInput=e,this.addRenderingLogic(),this.render())}),this)},addRenderingLogic:function addRenderingLogic(){this.displayLogic={},this.displayLogic.isReadOnly=this.options.readOnly,this.displayLogic.disableInput=this.options.disableInput,this.displayLogic.hasOwnBorder=this.options.clozeBordering&&(this.options.readOnly||!this.hasEditableAreas()),this.displayLogic.templateAriaLabel=this.options.templateAriaLabel},bindHandwritingEvents:function bindHandwritingEvents(){var e,t=this.mathEvents,r=this.$("span.lrn_math_editable"),a=r.attr("title")||"";function resetState(){r.removeClass("lrn-state-outdated lrn-state-awaiting-update lrn-state-error").attr("title",a)}this.listenTo(t,t.EVENT.CONTENT_OUTDATED,(function(){resetState(),r.addClass("lrn-state-outdated")})),this.listenTo(t,t.EVENT.AWAIT_UPDATE,(function(){resetState(),r.addClass("lrn-state-awaiting-update")})),this.listenTo(t,t.EVENT.SET_ERROR,(function(t){resetState(),r.addClass("lrn-state-error").attr("title",t),clearTimeout(e),e=setTimeout(resetState,5e3)})),this.listenTo(t,t.EVENT.GET_ACTIVE_ID,(function(e){var t=s()(document.activeElement).filter(".lrn_focusable");e((t.length?t:this.$(".lrn_focusable")).prop("id"))})),this.listenTo(t,t.EVENT.RESET_STATE,resetState)},bindTextareaListeners:function bindTextareaListeners(e){var t=this.mathEvents,r=this,a=e[0],s=a.value;this.textareas=this.textareas||[],this.textareas.push(e),e.on("input.lrn.formulaeditor",(function(e){var l=r.getMathCommand(s,a.value);l&&(l.unshift(t.EVENT.MATH_COMMAND),t.trigger.apply(t,l)),s=a.value})),e.on("keyup.lrn.formulaeditor",(function(e){var t=r.mathquill.latex();0===a.value.length&&t.length&&(a.value="a",a.selectionStart=0,a.selectionEnd="a".length,s=a.value)})),e.on("paste.lrn.formulaeditor",(function(){r.removeTextareas()}))},clearAndWrite:function clearAndWrite(e){e=this.convertDynamicVarsForMathquill(e),this.mathquill.clear().write(e),this.updateModel()},editorPressed:function editorPressed(e){this.mathEvents.trigger(this.mathEvents.EVENT.EDITOR_PRESSED)},enterMath:function enterMath(e,t,r){var a=T()(this.getMqEl()),s=r&&r.get("extra_commands");window.clearTimeout(this.shortcutKeyTimeout),this.keys="",E.a.isFunction(a[e])&&(a[e](t),E.a.each(s||[],(function(e){E.a.isFunction(a[e.type])&&a[e.type](e.val)})),this.updateModel())},getMathCommand:function getMathCommand(e,t){return t.length===e.length+1&&0===t.indexOf(e)?["typedText",t[t.length-1]]:t.length===e.length-1?["keystroke","Backspace"]:void 0},getMqEl:function getMqEl(){return this.$("span.lrn_math_editable")[0]},getValue:function getValue(){var e=this.displayLogic.isReadOnly,t=this.currentEditables||this.options.editables||[],r=this.options.template,a=this.currentValue||this.options.value||r||"";return this.hasEditableAreas()&&(t=E.a.clone(t),a=r.replace(/{{response}}/g,(function(){var r=t.shift()||"";return e&&r.length?" "+r:"\\MathQuillMathField{"+r+"}"}))),a=this.convertDynamicVarsForMathquill(a)},handlePipeSymbol:function handlePipeSymbol(){this.mathEvents.trigger(this.mathEvents.EVENT.MATH_COMMAND,"cmd","\\abs")},addMathQuillVarField:function addMathQuillVarField(e){var t="\\MathQuillVarField{\\text{"+e+"}}";this.mathquill.write(t),this.updateModel()},hasEditableAreas:function hasEditableAreas(){var e=this.options.template;return E.a.isString(e)&&e.length>0&&e.indexOf("{{response}}")>-1},keyDown:function keyDown(e){var t,r=j[e.keyCode],a=this.mathEvents;if(e.shiftKey&&e.altKey)return!1;if(r&&r.length>1){if(e.shiftKey&&"Shift"!==r?r="Shift-"+r:"Spacebar"===r&&(r="space"),"Tab"===r&&(t=D.b.getNextTab(document.activeElement,["MathJax","lrn_dropdown_toggle"]))&&(t.originalEvent=e,a.trigger(a.EVENT.TAB_EDITOR,t)),"Shift"===r){if(this.shiftIsPressed)return;a.trigger(a.EVENT.SHIFT_KEY),this.shiftIsPressed=!0}a.trigger(a.EVENT.MATH_COMMAND,"no-input",r)}this.updateModel()},keyPress:function keyPress(e){var t=e.which||e.keyCode,r=e.key||String.fromCharCode(t),a=this.mathEvents,s=e.metaKey||e.ctrlKey;this.removeTextareas();var l="\\"===r&&!this.options.enableRawLatex;return!E.a.contains(H,t)&&("*"===r&&(r="×"),"$"===r?(a.trigger(a.EVENT.MATH_COMMAND,"write","\\$"),!1):"|"===r?(this.handlePipeSymbol(),!1):l?(this.preventRawLatexBeingEntered(),!1):(r=r.replace("\t",""),s||1!==r.length?void 0:(D.b.capsLock.correctStatus(e),a.trigger(a.EVENT.MATH_COMMAND,"typedText",r),!1)))},keyUp:function keyUp(e){var t=this.mathEvents,r=j[e.keyCode];if(e.altKey&&e.shiftKey&&r&&(this.keys=this.keys+r,window.clearTimeout(this.shortcutKeyTimeout),window.clearTimeout(this.resetKeyTimeout),!function noOtherShortcutBeginsWith(e){return!E.a.find(E.a.keys(z),(function(t){return t!==e&&0===t.indexOf(e)}))}(this.keys)?this.setShortcutKeyTimeout():this.sendShortcut()),e.ctrlKey&&r){var a=E.a.findWhere(V,{shortcut:r});a&&t.trigger(t.EVENT.MATH_COMMAND,a.type,a.val)}e.shiftKey||"Shift"!==r||(t.trigger(t.EVENT.SHIFT_KEY),this.shiftIsPressed=!1)},getAriaLabel:function getAriaLabel(){return this.options.response_container&&this.options.response_container.aria_label?this.options.response_container.aria_label:this.options.aria_label?this.options.aria_label:this.options.i18n.labels.responseArea},mathquillify:function mathquillify(){var e,t=this.currentValue,r=this.displayLogic.isReadOnly,a=this.displayLogic.disableInput,l=t.indexOf("\\MathQuillMathField")<0,y=t.indexOf("\\MathQuillMathField{}")>-1,w=R.a.isTouchDevice(),S=this.options.showInputUi,O=E.a.uniq(this.options.text_blocks||[]),N=this.options.persistent_id||"",L=0,D=this,M=this.getAriaLabel();this.mathquill&&(this.mathEvents.trigger(this.mathEvents.EVENT.EDITOR_BLURRED),this.mathquill.revert()),r||a?(this.mathquill=T.a.InertMath(this.getMqEl(),{disableItalics:this.options.disableItalics,maxDepth:this.MAX_MATH_DEPTH}),this.displayLogic.templateAriaLabel||(this.$('[data-lrn-component="logger"]').removeAttr("aria-live").removeAttr("aria-hidden"),this.dynamicAriaLabel())):(this.mathquill=T.a[l?"MathField":"StaticMathWithEditables"](this.getMqEl(),{handlers:{},substituteTextarea:function substituteTextarea(){var e=w&&S?"span":"textarea",t=s()("<"+e+">").attr({tabindex:"0",class:"lrn_focusable",id:"focusable"+L+++N});if("textarea"===e&&(t.attr({"aria-label":M,autocomplete:"off",autocapitalize:"none"}),D.bindTextareaListeners(t)),t.length>0)return t[0]},unItalicizedTextCmds:O,disableItalics:this.options.disableItalics,maxDepth:this.MAX_MATH_DEPTH}),this.$(".lrn_focusable").eq(0).attr("tabindex","0"));try{this.mathquill.latex(t)}catch(t){e=!0}r||a||!(t.length>0)||""!==this.mathquill.latex()||!l&&y||(e=!0),e&&A.a.exception({code:10023,detail:t}),l||(this.$(".mq-inner-editable").addClass("lrn_bordered_mathinput"),this.$(".mq-selectable").attr("aria-hidden",!0)),this.$("span[mathquill-command-id]").each((function(e,t){var r=s()(t);!r.hasClass("mq-non-leaf")&&!r.hasClass("mq-editable-field")&&r.attr("aria-hidden",!0)})),this.$(".mq-sqrt-prefix, var, .mq-paren").attr("aria-hidden",!0),this.setResponseSizing()},onAttach:function onAttach(){var e=this;Object(M.a)(this.$el,(function(){e.mathquill.reflow()}))},onBlur:function onBlur(e){this.onFocusChange(e),this.mathEvents.trigger(this.mathEvents.EVENT.ITEM_BLURRED)},onFocus:function onFocus(e){this.preventEditorFocus||(this.onFocusChange(e),this.mathEvents.trigger(this.mathEvents.EVENT.EDITOR_FOCUSED)),this.preventEditorFocus=!1},onFocusChange:function onFocusChange(e){var t="focusin"===e.type;s()(e.currentTarget).closest(".lrn_bordered_mathinput").toggleClass("lrn_focused",t),L.a.isAppleWebKit&&L.a.isMobile&&D.b.toggleBackgroundClickable(t)},preventRawLatexBeingEntered:function preventRawLatexBeingEntered(){this.mathEvents.trigger(this.mathEvents.EVENT.MATH_COMMAND,"cmd","\\backslash")},refocusEditor:function refocusEditor(){this.$(".mq-textarea .lrn_focusable").filter('[tabindex="0"]').eq(0).trigger("focus")},refocusEditorWithoutKeyboard:function refocusEditorWithoutKeyboard(){this.preventEditorFocus=!0,this.$(".mq-textarea .lrn_focusable").filter('[tabindex="0"]').eq(0).trigger("focus")},remove:function remove(){var e=this.$(".lrn_focusable").map((function(){return s()(this).prop("id")})).get();return this.removeTextareas(),y.a.View.prototype.remove.call(this),this.mathEvents.trigger(this.mathEvents.EVENT.EDITOR_REMOVED,e),this},removeTextareas:function removeTextareas(){this.textareas&&(E()(this.textareas).each((function(e){e.off(".lrn.formulaeditor")})),delete this.textareas)},render:function render(){return this.currentValue=this.getValue(),this.$el.html(this.template({displayLogic:this.displayLogic})),this.mathquillify(),s.a.contains(document,this.el)&&this.onAttach(),this},sendShortcut:function sendShortcut(){var e=z[this.keys],t=this.mathEvents;return!(!e||!t.trigger(t.EVENT.MATH_COMMAND,e.get("type"),e.get("val"),e))},setResponseSizing:function setResponseSizing(){var e=this.options.response_container,t=this.options.response_containers,r=this.hasEditableAreas(),a=this;function resizeBlock(e,t){var r=!1;t&&t.width&&(e.css("min-width",t.width),r=!0),t&&t.height&&(e.css("min-height",t.height),r=!0),r&&(e.css("display","inline-block"),a.mathquill.reflow())}!r||!e||t&&t.length||(t=[e]),r&&E.a.isArray(t)?this.$(".mq-inner-editable .mq-root-block").each((function(r){var a=t[r]||e;resizeBlock(s()(this),a)})):e&&(resizeBlock(this.$el,e),e.height&&s()(this.getMqEl()).css("min-height",e.height))},setShortcutKeyTimeout:function setShortcutKeyTimeout(){var e=this;this.shortcutKeyTimeout=window.setTimeout((function(){e.sendShortcut()||(e.resetKeyTimeout=window.setTimeout((function(){e.keys=""}),3*e.shortcutKeyTime))}),this.shortcutKeyTime)},updateModel:function updateModel(){var e="ie"===L.a.browser&&L.a.version<=8?50:0,t=this;E.a.delay((function(){var e=T()(t.getMqEl()),r=t.convertDynamicVarsFromMathquill(e.latex()),a=e.editables&&e.editables()||[];t.currentValue!==r&&(t.currentValue=r,t.currentEditables=a.map((function(e){return t.convertDynamicVarsFromMathquill(e.latex)})),t.mathEvents.trigger(t.mathEvents.EVENT.UPDATED,r,t.currentEditables))}),e)},dynamicAriaLabel:function dynamicAriaLabel(){var e=this;if(!this.options.disableSpokenmathUserInputs){var t=this.getValue();W.a.process(t).then((function(t){e.$logger.text(t),e.mathEvents.trigger(e.mathEvents.EVENT.EDITOR_SPOKENMATH_UPDATED,t)}))}},convertDynamicVarsForMathquill:function convertDynamicVarsForMathquill(e){return e.replace(/{{var:([a-z0-9 _]+)}}/gi,"\\MathQuillVarField{\\text{$1}}")},convertDynamicVarsFromMathquill:function convertDynamicVarsFromMathquill(e){return e.replace(/\{\{var:\\text\{([^\}]*)\}{3}/gi,"{{var:$1}}")}})},function(e,t,r){"use strict";var a=r(1),s=r.n(a),l=r(63),y=r.n(l),w=r(0),E=r.n(w),S=r(5),T=r.n(S),O=r(139),N=r(166),A=r.n(N),L=r(167),R=r.n(L),D=r(168),M=r.n(D),B=r(169),q=r.n(B),W=r(51),j=r(24),H=r(6),V=T.a.View.extend({CLASSNAMES:{TOOLBAR:".lrn_toolbar",CANVAS_WRAPPER:".lrn_canvas_drawing",LINE_COLOUR_PALETTE:".lrn_line_colour_palette",LINE_COLOUR_PALETTE_TRIGGER:".lrn_line_colour_palette_trigger",LINE_COLOUR_SELECTOR:".lrn_btn_color_selector",CANVAS:".lrn_canvas"},DATA_SELECTOR:{LINE_COLOUR_DATA_SELECTION:"data-colour-selection"},DEFAULT_CANVAS_WIDTH:300,DEFAULT_CANVAS_HEIGHT:150,EVENT:{SHOWN:"shown",UPDATED:"updated",LOAD_ERROR:"load-error",LOADED:"loaded",STROKE_BEGIN:"stroke-begin",RESET:"reset"},MARK_TYPES:{GESTURE:"gesture",CLEAR:"clear"},MAX_LINE_COLOUR_NUMBER:6,TOOLBAR_OPTIMISED_WIDTH:300,bgImg:null,bgLoaded:!1,bgImgScale:1,canPaint:!1,events:{"mousedown canvas.lrn_canvas.lrn_paintable":"startPainting","mousemove canvas.lrn_canvas.lrn_paintable":"paintToHere","mouseleave canvas.lrn_canvas.lrn_paintable":"stopPainting","mouseup canvas.lrn_canvas.lrn_paintable":"stopPainting","mousedown .lrn_old_ie canvas.lrn_canvas":"ie8PreventBlurEvent","mousedown .lrn_old_ie .lrn_btn":"ie8PreventBlurEvent","mousedown .lrn_btn_color_selector":"setSelectedLineColour","mousedown .lrn_line_colour_palette_trigger":"toggleLineColourPalette","keydown .lrn_canvas":"buttonKeyDownOnCanvas","keydown .lrn_keyboard_paintable":"buttonKeyDown","keyup .lrn_keyboard_paintable":"buttonKeyUp","blur .lrn_keyboard_paintable":"destroyDrawingIndicator","focus .lrn_keyboard_paintable":"addMarker"},KEYCODES:{TAB:9,LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ENTER:13},initTime:null,isPainting:!1,lastDrawnPoint:{x:null,y:null},redrawQueue:[],markRedrawQueue:[],template:M.a,touchEvents:{"touchend .lrn_clear:not(.lrn_disabled)":"clearAll","touchend .lrn_replay:not(.lrn_disabled)":"replay","touchend .lrn_undo:not(.lrn_disabled)":"undo","touchend .lrn_redo:not(.lrn_disabled)":"redo","touchend .lrn_btn_color_selector":"setSelectedLineColour","touchend .lrn_line_colour_palette_trigger":"toggleLineColourPalette","touchstart canvas.lrn_canvas.lrn_paintable":"startPainting","touchmove canvas.lrn_canvas.lrn_paintable":"paintToHere","touchleave canvas.lrn_canvas.lrn_paintable":"stopPainting","touchend canvas.lrn_canvas.lrn_paintable":"stopPainting"},keysPressed:{},pixelMoveDistance:3,initialize:function initialize(){var e=this.options.$externalContainer,t={"click .lrn_clear:not(.lrn_disabled)":"clearAll","click .lrn_replay:not(.lrn_disabled)":"replay","click .lrn_undo:not(.lrn_disabled)":"undo","click .lrn_redo:not(.lrn_disabled)":"redo"};this.hasFlashCanvas()&&q.a.setPath(H.a.assetsHost+"/swf/"),W.a.isTouchDevice()?(this.events=E.a.extend({},this.events,this.touchEvents),W.a.isMobile||E.a.extend(this.events,t)):this.events=E.a.extend(t,this.events),this.$container=e&&e.length?e:this.$el,this.$toolbar=this.$(this.CLASSNAMES.TOOLBAR),this.i18n=this.options.i18n,this.initTime=(new Date).getTime(),this.setDrawingOptions(),this.canPaint=this.options.canPaint,this.showRedraw=this.options.showRedraw,this.animateRedraw=!this.canPaint,this.canvasWidth=this.options.imgWidth?this.options.imgWidth:this.DEFAULT_CANVAS_WIDTH,this.canvasHeight=this.options.imgHeight?this.options.imgHeight:this.DEFAULT_CANVAS_HEIGHT,this.imageAlt=this.options.imgAlt||"",this.render(),this.setState({buffer:this.options.marks||[]}),this.imgSrc=this.options.imgSrc,this.bgImg=new Image,this.hasBgImg()?s()(this.bgImg).on("load",this.bgImageLoaded.bind(this)).on("error",this.bgImageLoadError.bind(this)).attr("src",this.imgSrc):(this.once(this.EVENT.SHOWN,(function(){this.setCanvasSize(this.canvasHeight,this.canvasWidth),this.makeResponsive()}),this),E.a.delay(E.a.bind((function(){this.trigger(this.EVENT.LOADED),this.trigger(this.EVENT.SHOWN)}),this))),this.on(this.EVENT.RESET,this.setState,this),s()(window).on("resize orientationchange",E.a.debounce(E.a.bind(this.makeResponsive,this),400))},addCurrentMarkToBuffer:function addCurrentMarkToBuffer(){var e=this.state;e.buffer=e.buffer.slice(0,e.position+1),e.buffer.push(this.currentMark),e.bufferToRender=e.bufferToRender.slice(0,e.position+1),e.bufferToRender.push(this.getPointToRender(this.currentMark)),e.position=e.buffer.length-1},bgImageLoaded:function bgImageLoaded(){this.options.imgWidth||(this.canvasWidth=this.bgImg.width),this.options.imgHeight||(this.canvasHeight=this.bgImg.height),this.bgLoaded=!0,this.makeResponsive(),this.trigger(this.EVENT.LOADED)},bgImageLoadError:function bgImageLoadError(){this.trigger(this.EVENT.LOAD_ERROR)},makeResponsive:function makeResponsive(){Object(j.a)(this.$container,E.a.bind(this.fitCanvasToContainer,this))},fitCanvasToContainer:function fitCanvasToContainer(){var e=this.canvasWidth,t=this.canvasHeight,r=e/t,a=this.$container.innerWidth();a&&e>a&&(t=(e=a)/r),this.bgImgScale=this.bgImg.width?e/this.bgImg.width:e/this.canvasWidth,this.setCanvasSize(t,e),this.$(this.CLASSNAMES.CANVAS_WRAPPER).width(e),this.$toolbar.width()<=this.TOOLBAR_OPTIMISED_WIDTH&&this.$toolbar.addClass("lrn_toolbar_optimised"),this.hasFlashCanvas()?s()(this.cnv).css("background-image","url("+this.imgSrc+")"):this.imgSrc&&this.ctx.drawImage(this.bgImg,0,0,e,t),this.setBufferToRender(),this.redraw(!1)},setBufferToRender:function setBufferToRender(){var e=this,t=this.bgImgScale;this.state.bufferToRender=E.a.map(this.state.buffer,(function(r){return r.points?E.a.extend({},r,{points:E.a.map(r.points,(function(a){return e.getPointToRender(a,r.bgImgScale,t)}))}):r}))},getPointToRender:function getPointToRender(e,t,r){return t=t||1,r=r||1,E.a.extend({},e,{x:e.x/t*r,y:e.y/t*r})},clearAll:function clearAll(){this.currentMark={type:this.MARK_TYPES.CLEAR,startTime:(new Date).getTime()-this.initTime},this.resetBackground(),this.addCurrentMarkToBuffer(),this.update()},expandCanvasToContainer:function expandCanvasToContainer(){this.setCanvasSize(this.$el.height(),this.$el.width())},getEventPoint:function getEventPoint(e){var t=this,r=this.scale||1,a=function getMousePoint(e){var a=e.offsetX?e.offsetX:Math.round(e.pageX-t.$el.find(".lrn_canvas").offset().left),s=e.offsetY?e.offsetY:Math.round(e.pageY-t.$el.find(".lrn_canvas").offset().top);return{x:a/r,y:s/r}};return e.type.indexOf("mouse")>-1?a(e):e.type.indexOf("touch")>-1?function getTouchPoint(e){var a=e.originalEvent.touches[0],l=s()(t.cnv).offset(),y=a.pageX-l.left,w=a.pageY-l.top;return{x:y/r,y:w/r}}(e):e.type.indexOf("keydown")>-1&&a(e)},getVisibleMarks:function getVisibleMarks(e){for(var t=this.state.buffer,r=0,a=e?"buffer":"bufferToRender",s=this.state.position;s>-1;s--)if(t[s].type===this.MARK_TYPES.CLEAR){r=s+1;break}return this.state[a].slice(r,this.state.position+1)},hasBgImg:function hasBgImg(){return!(!this.imgSrc||!this.imgSrc.length)},ie8PreventBlurEvent:function ie8PreventBlurEvent(){var e=document.activeElement;E.a.defer((function(){s()(e).focus()}))},paintDot:function paintDot(e,t){this.ctx.fillStyle=t||this.selectedLineColour,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,this.options.line_width,0,2*Math.PI),this.ctx.fill(),this.lastDrawnPoint=e},paintLine:function paintLine(e,t,r){this.ctx.strokeStyle=r||this.selectedLineColour,this.ctx.lineJoin=this.options.line_join,this.ctx.lineWidth=this.options.line_width,this.ctx.lineCap=this.options.line_cap,this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.stroke(),this.lastDrawnPoint=t},paintToHere:function paintToHere(e){var t,r;if(!this.isPainting)return!1;this.isKeypadMoving&&this.getCursorCoordinates(e),t=this.getEventPoint(e),r=null!==this.lastDrawnPoint.x?this.lastDrawnPoint:t,this.paintLine(r,t),this.currentMark.points.push(this.lastDrawnPoint),e.preventDefault()},redo:function redo(){this.state.position++,this.update(),this.redraw(!0)},redraw:function redraw(e){var t,r,a,s=!!E.a.isUndefined(e)||e,l=this.animateRedraw,y=0,w=this.getVisibleMarks(),S=this;if(s&&this.resetBackground(),!w.length)return!1;t=function drawCurrentLine(e,t){l&&S.redrawQueue.shift();var r=e.points[t],a=t>0?t-1:0,s=e.points[a];1===e.points.length?S.paintDot(r,e.line_colour):S.paintLine(s,r,e.line_colour)},r=function drawCurrentMark(e){var r,a=(e.endTime-e.startTime)/e.points.length;E.a.each(e.points,(function(s,y){l?(r=E.a.delay(E.a.bind(t,S),a*y,e,y),S.redrawQueue.push(r)):t(e,y)})),S.ctx.closePath()},E.a.each(w,(function(e){switch(e.type){case this.MARK_TYPES.GESTURE:l?(a=E.a.delay(E.a.bind(r,this),y,e),y+=e.endTime-e.startTime,S.markRedrawQueue.push(a)):r(e);break;case this.MARK_TYPES.CLEAR:this.resetBackground();break;default:throw new Error("Unsupported mark type ",e.type)}}),this),this.animateRedraw=!1},render:function render(){return this.$el.html(this.template({displayLogic:E.a.pick(this,"canPaint","showRedraw","imageAlt"),lineColourData:{colours:this.options.line_colour,limit:this.MAX_LINE_COLOUR_NUMBER},labels:this.i18n.labels})),this.cnv=this.$("canvas.lrn_canvas")[0],this.hasFlashCanvas()&&(this.$(".lrn_canvas_drawing").addClass("lrn_old_ie"),q.a.initElement(this.cnv)),this.ctx=this.cnv.getContext("2d"),this},resetBackground:function resetBackground(){this.ctx.clearRect(0,0,this.cnv.width,this.cnv.height),this.bgLoaded&&!this.hasFlashCanvas()&&this.ctx.drawImage(this.bgImg,0,0,this.cnv.width,this.cnv.height),E.a.each(this.redrawQueue,clearTimeout),E.a.each(this.markRedrawQueue,clearTimeout)},setCanvasSize:function setCanvasSize(e,t){s()(this.cnv).height(e).width(t).attr("height",e+"px").attr("width",t+"px"),this.hasFlashCanvas()&&this.ctx._resize(t,e)},setDisabled:function setDisabled(e){e?this.undelegateEvents():this.delegateEvents()},setDrawingOptions:function setDrawingOptions(){var e=this.options,t={line_colour:"#c92e32",line_join:"round",line_width:5,line_cap:"round"};e.line_color&&(e.line_colour=e.line_color),E.a.isArray(e.line_colour)?this.selectedLineColour=e.line_colour[0]:E.a.isString(e.line_colour)?this.selectedLineColour=e.line_colour:this.selectedLineColour=t.line_colour;var r=this;E.a.each(t,(function(t,a){r.options[a]=e.hasOwnProperty(a)?e[a]:t}))},setSelectedLineColour:function setSelectedLineColour(e){var t=s()(e.currentTarget);t&&t.length&&(s()(".lrn_btn_color_selector").removeClass("lrn_selected"),t.addClass("lrn_selected"),this.selectedLineColour=t.attr(this.DATA_SELECTOR.LINE_COLOUR_DATA_SELECTION),this.$(this.CLASSNAMES.LINE_COLOUR_PALETTE_TRIGGER).find("span").css("background",this.selectedLineColour),this.$(this.CLASSNAMES.LINE_COLOUR_PALETTE).removeClass("lrn_active")),e.preventDefault()},setState:function setState(e){e.buffer=e.buffer||[],e.bufferToRender=e.bufferToRender||[],e.position=E.a.isNumber(e.position)?e.position:e.buffer.length-1,this.state=e,this.redraw(!0),this.updateButtonStates()},getCursorCoordinates:function getCursorCoordinates(e){return e.offsetX=Math.round(this.$indicator.offset().left-this.$canvas.offset().left),e.offsetY=Math.round(this.$indicator.offset().top-this.$canvas.offset().top),e.pageX=Math.round(this.$indicator.offset().left),e.pageY=Math.round(this.$indicator.offset().top),e},startPainting:function startPainting(e){this.isPainting=!0,this.hasActiveDrawingIndicator()&&this.getCursorCoordinates(e),this.lastDrawnPoint=this.getEventPoint(e),this.currentMark={type:this.MARK_TYPES.GESTURE,line_colour:this.selectedLineColour,line_join:this.options.line_join,line_width:this.options.line_width,startTime:(new Date).getTime()-this.initTime,points:[],bgImgScale:this.bgImgScale},this.currentMark.points.push(this.lastDrawnPoint),this.trigger(this.EVENT.STROKE_BEGIN),e.preventDefault()},stopPainting:function stopPainting(e){this.isPainting&&(1===this.currentMark.points.length&&this.paintDot(this.currentMark.points[0]),this.ctx.closePath(),this.isPainting=!1,this.currentMark.endTime=(new Date).getTime()-this.initTime,this.addCurrentMarkToBuffer(),this.update()),e.preventDefault()},toggleLineColourPalette:function toggleLineColourPalette(e){this.$(this.CLASSNAMES.LINE_COLOUR_PALETTE).toggleClass("lrn_active"),e.preventDefault()},undo:function undo(){this.state.position--,this.update(),this.redraw(!0)},update:function update(){var e=this.getVisibleMarks(!0);this.trigger(this.EVENT.UPDATED,e,this.state),this.updateButtonStates(),this.$(this.CLASSNAMES.LINE_COLOUR_PALETTE).removeClass("lrn_active")},updateButtonStates:function updateButtonStates(){var e=this.state.position>-1,t=this.state.buffer.length>this.state.position+1,r=this.getVisibleMarks(!0).length>0;this.$(".lrn_undo").toggleClass("lrn_disabled",!e),this.$(".lrn_redo").toggleClass("lrn_disabled",!t),this.$(".lrn_clear").toggleClass("lrn_disabled",!r)},replay:function replay(){this.animateRedraw=!0,this.redraw(!0)},buttonKeyDown:function buttonKeyDown(e){switch(e.keyCode){case this.KEYCODES.LEFT:case this.KEYCODES.UP:case this.KEYCODES.RIGHT:case this.KEYCODES.DOWN:e.preventDefault(),this.isKeypadMoving=!0,this.moveIndicator(e),this.paintToHere(e);break;case this.KEYCODES.SPACE:case this.KEYCODES.ENTER:this.startPainting(e),this.isKeypadMoving&&(this.moveIndicator(e),this.paintToHere(e))}},buttonKeyUp:function buttonKeyUp(e){switch(e.keyCode){case this.KEYCODES.LEFT:case this.KEYCODES.UP:case this.KEYCODES.RIGHT:case this.KEYCODES.DOWN:this.isKeypadMoving=!1,this.stopMovingIndicator(e);break;case this.KEYCODES.SPACE:case this.KEYCODES.ENTER:this.isKeypadMoving=!1,this.stopPainting(e)}},buttonKeyDownOnCanvas:function buttonKeyDownOnCanvas(e){switch(e.keyCode){case this.KEYCODES.TAB:this.createKeyboardDrawingCursor(e)}},calculateNewPointCoordinates:function calculateNewPointCoordinates(e,t,r,a){var s=this.keysPressed[t]?this.pixelMoveDistance:0,l=this.keysPressed[r]?this.pixelMoveDistance:0,y=parseInt(e,10)-s+l;return this.getBoundedCursorCoordinate(y,a)},getBoundedCursorCoordinate:function getBoundedCursorCoordinate(e,t){var r=t?this.$canvas.position().left+this.$canvas.innerWidth():this.$canvas.position().top+this.$canvas.innerHeight(),a=t?this.$canvas.position().left:this.$canvas.position().top;return e<a?a:e>r?r:e},moveIndicator:function moveIndicator(e){var t=this;this.keysPressed[e.which]=!0,this.$indicator.css({top:function top(e,r){return t.calculateNewPointCoordinates(r,t.KEYCODES.UP,t.KEYCODES.DOWN)},left:function left(e,r){return t.calculateNewPointCoordinates(r,t.KEYCODES.LEFT,t.KEYCODES.RIGHT,!0)}})},stopMovingIndicator:function stopMovingIndicator(e){this.keysPressed[e.which]=!1},createKeyboardDrawingCursor:function createKeyboardDrawingCursor(){this.$el.find(".lrn_toolbar");this.$indicator=this.$el.find(".lrn_keyboard_paintable"),this.$indicator.css(this.getIndicatorPosition())},addMarker:function addMarker(){this.$indicator.append("<span>+</span>")},hasActiveDrawingIndicator:function hasActiveDrawingIndicator(){return!(!this.$indicator||!this.$indicator.children().length)},getIndicatorPosition:function getIndicatorPosition(){var e;return this.$canvas=this.$el.find(".lrn_canvas"),{top:(e=this.$canvas.position()).top+"px",left:e.left+"px"}},destroyDrawingIndicator:function destroyDrawingIndicator(){this.$indicator.empty()},hasFlashCanvas:function hasFlashCanvas(){return E.a.isUndefined(this._hasFlashCanvas)&&(this._hasFlashCanvas=!E.a.isEmpty(q.a)),this._hasFlashCanvas}}),z=r(41),U=r(170),G=r(132),K=T.a.View.extend({DELAY:750,LINE_COLOUR:"#52a8ec",appendParent:"body",touchEvents:{"touchstart .lrn_canvas_drawing":"stopPropagation"},fixedPositionEvents:{"mousedown .lrn_btn":"preventAction"},EVENT:{SHOWN:"shown",WRITING_STARTED:"writing-started",RECOGNITION_ENDED:"recognition-ended",RECOGNITION_REQUEST:"recognition-request",CANCEL_RECOGNITION:"cancel-recognition",RECEIVED_RESULT:"received-result",CHANGE_CONTEXT:"change-context",DELETE_CONTEXTS:"delete-contexts",ERROR:"error"},results:{},initialize:function initialize(){this.options.mathEvents;var e=W.a.isTouchDevice(),t=this;this.events=e?this.touchEvents:{},this.isRecognising=!1,this.i18n=this.options.i18n,this.results={},this.contexts=this.initContexts(),this.currentContext={},this.render(),this.listenTo(this.canvasDrawing,this.canvasDrawing.EVENT.UPDATED,this.onUpdate,this),this.listenTo(this.canvasDrawing,this.canvasDrawing.EVENT.STROKE_BEGIN,(function(){t.endRecognition(),t.trigger(t.EVENT.WRITING_STARTED)})),this.on(this.EVENT.CANCEL_RECOGNITION,this.endRecognition,this),this.on(this.EVENT.RECOGNITION_REQUEST,this.requestRecognition,this),this.on(this.EVENT.CHANGE_CONTEXT,this.changeContext,this),this.on(this.EVENT.DELETE_CONTEXTS,this.deleteContexts,this),this.on(this.EVENT.SHOWN,(function(){t.canvasDrawing.trigger(t.canvasDrawing.EVENT.SHOWN)}))},appendToBody:function appendToBody(){var e=this;this.$el.appendTo(this.appendParent).addClass("lrn_widget lrn_handwriting_fixed"),this.events=E.a.extend({},this.events,this.fixedPositionEvents),this.delegateEvents(),this.scaler=new U.a(this.$el,{debounceTime:300,onUpdate:function onUpdate(t){e.canvasDrawing.scale=t}}),this.fullScreenObserver=G.b.fullScreen.observe((function(e){var t=e||"body";t!==this.appendParent&&(this.$el.appendTo(t),this.appendParent=t)}),this),this.show=function(){this.$el.finish().fadeIn(100),this.trigger(this.EVENT.SHOWN),this.scaler.start().scale()},this.hide=function(){this.$el.finish().fadeOut(100),this.scaler.stop()}},changeContext:function changeContext(e){var t=this.contexts[e];t||(t=this.contexts[e]={state:{}}),t!==this.currentContext&&(this.canvasDrawing.trigger(this.canvasDrawing.EVENT.RESET,t.state),this.currentContext=t)},deleteContexts:function deleteContexts(e){E.a.each(e,(function(e){delete this.contexts[e]}),this)},endRecognition:function endRecognition(){this.isRecognising=!1,this.trigger(this.EVENT.RECOGNITION_ENDED),z.a.cancel()},getHandwriting:function getHandwriting(){var e={};return E.a.each(this.contexts,(function(t,r){e[r]=t.marks})),e},getMarksDigest:function getMarksDigest(e){return E.a.reduce(e,(function(e,t){return e+t.startTime}),"")},initContexts:function initContexts(){var e={};return E.a.each(this.options.handwriting,(function(t,r){e[r]={state:{buffer:t},marks:t}})),e},onUpdate:function onUpdate(e,t){var r=this.getMarksDigest(e),a=this.results[r],s=this;clearTimeout(this.recogniseTimeout),this.currentContext.state=t,this.currentContext.marks=e,this.endRecognition(),a?this.trigger(this.EVENT.RECEIVED_RESULT,a):(this.isRecognising=!0,this.recogniseTimeout=setTimeout((function(){s.isRecognising&&s.recognise.call(s,e,r)}),this.DELAY))},preventAction:function preventAction(e){e.preventDefault(),e.stopPropagation()},recognise:function recognise(e,t){var r=this;this.trigger(this.EVENT.RECOGNITION_REQUEST,e,(function(e){r.results[t]=e,r.isRecognising&&(r.endRecognition(),r.trigger(r.EVENT.RECEIVED_RESULT,e))}),(function(e){r.isRecognising&&(r.endRecognition(),r.trigger(r.EVENT.ERROR,r.i18n.labels.handwritingApiError))}))},remove:function remove(){return this.scaler&&(this.scaler.destroy(),this.scaler=null),this.fullScreenObserver&&G.b.fullScreen.unobserve(this.fullScreenObserver),this.canvasDrawing.remove(),delete this.canvasDrawing,T.a.View.prototype.remove.apply(this,arguments)},render:function render(){return this.canvasDrawing=new V({el:this.el,i18n:this.i18n,canPaint:!0,line_colour:this.LINE_COLOUR}),this.options.fixed&&this.appendToBody(),this},requestRecognition:function requestRecognition(e,t,r){z.a.recognise({type:z.a.TYPE.EQUATION,marks:e,successFn:t,failFn:r,handwritingRecognises:this.options.handwritingRecognises,security:this.options.security})},stopPropagation:function stopPropagation(e){e.stopPropagation()}}),$=r(171),Q=r(36);function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}(e)||function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function _unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function getSymbolGroupsCustomLabels(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="symbols.options.";return Object.keys(e).filter((function(e){return e.indexOf(t)>-1})).map((function(r){return{id:r.replace(t,""),label:e[r]}}))}var Y={},X=T.a.View.extend({CLASSES:{BUTTON_ACTIVE:"lrn_active"},SELECTORS:{KEYBOARD_HELP:".lrn-formula-keyboard-help",MENU_GROUP:'[data-lrn-component="menuGroup"]',MENU_GROUP_TOGGLE:'[data-lrn-component="menuGroup"] .lrn_dropdown_toggle',ARIA_LIVE:".lrn-formula-keypad-arialive"},DEFAULTSYMBOLGROUPS:{math:["basic","qwerty"],chemistry:["chemistry","basic","qwerty"]},EVENT:{ACTIVATED_GROUP:"activated-group",HIDDEN:"hidden",SHOWN:"shown"},KEYCODES:{LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,ESC:27,SPACE:32,ENTER:13},ACTIONS:{KEYPAD_OPEN:"open-keypad"},MINIMUM_KEYPAD_VISIBILITY:.25,TYPE:{FLOATING_KEYBOARD:"floating-keyboard",BLOCK_KEYBOARD:"block-keyboard",BLOCK_ON_FOCUS_KEYBOARD:"block-on-focus-keyboard",FIXED_HANDWRITING_ONLY:"fixed-handwriting-only",NO_INPUT_UI:"no-input-ui"},appendParent:"body",buttonMap:[],defaultNumColumns:8,helpModal:void 0,isBlockOnFocus:!1,isFloating:!1,isVisible:!0,shouldIgnoreNextAction:!1,lastFocusedElement:null,lazyRemoveTimeout:6e4,mainGroupNumColumns:4,$window:s()(window),normalEvents:{"mousedown button":"preventAction","mousedown button *":"preventAction","click .lrn-formula-keyboard-close":"closeButtonAction","keydown .lrn-formula-keyboard-close span":"closeButtonAction","click [tabindex]":"buttonAction","keydown [tabindex]":"buttonKeyDown","keydown .lrn_dropdown_toggle":"buttonKeyDown","keyup [tabindex]":"handleKeyEvent","keypress [tabindex]":"handleKeyEvent","blur [tabindex]":"blurredButton","mousedown div":"preventAction","selectstart div":"preventAction","mousedown .lrn_dropdown_toggle":"onDropdownToggleMouseUp","mouseup .lrn_dropdown_toggle":"onDropdownToggleMouseDown","mousedown .lrn-ui-style-floating-keyboard .lrn-drag-area":"startDrag","mousedown .lrn-ui-style-floating-keyboard .lrn-drag-area *":"startDrag"},touchEvents:{"touchend [tabindex]":"buttonAction","touchstart .lrn-ui-style-floating-keyboard .lrn-drag-area":"startTouchDrag","touchstart .lrn-formula-keyboard":"preventAction","touchstart .lrn-formula-keyboard-mask":"onMaskTouchstart","touchend .lrn-formula-keyboard-mask":"onMaskTouchend"},defaultNumberPadSymbols:["7","8","9","÷","4","5","6","multiply","1","2","3","minus","0","decimal","comma","plus","left","right","backspace","="],defaultHorizontalNumberPadSymbols:["0","1","2","3","4","5","6","7","8","9","decimal","comma","plus","minus","multiply","÷","=","left","right","backspace"],initialize:function initialize(){var e=this.options;this.i18n=e.i18n;var t,r=e.mathEvents,a=this.DEFAULTSYMBOLGROUPS[e.chemistry?"chemistry":"math"],s=E.a.isUndefined(e.symbols)?a:e.symbols,l=getSymbolGroupsCustomLabels(this.i18n.labels);O.a.updateI18nSymbols(this.i18n,s,l),this.horizontalLayout=e.horizontalLayout,t=this.horizontalLayout?e.horizontalPad||this.defaultHorizontalNumberPadSymbols:e.numberPad||this.defaultNumberPadSymbols,this.symbolGroups=O.a.getForInputUi(s,e.chemistry),this.numberPadSymbols=O.a.getForInputNumberPad(t),this.horizontalLayout&&(this.numberPadSymbols.columnCount=10,this.numberPadSymbols.rowCount=2),this.masterSymbolCollection=O.a.getNewerFormatMasterCollection(),this.numColumns=this.defaultNumColumns,this.buttonMapCache={},E.a.isUndefined(this.symbolGroups.value)&&(this.numColumns=4),this.resetDraggableElementPosition=E.a.debounce(E.a.bind(this.resetDraggableElementPosition,this),10),this.showHint=E.a.debounce(E.a.bind(this.showHint,this),200),this.updateAriaLiveText=E.a.debounce(E.a.bind(this.updateAriaLiveText,this),500),this.whetherToShowHints=E.a.isUndefined(e.showHints)||!0===e.showHints,this.uiBelowResponse=!!e.uiBelowResponse,this.setEvents(),this.listenTo(r,r.EVENT.EDITOR_FOCUSED,this.show),this.isLazy()||this.render()},activateGroup:function activateGroup(e){var t=!E.a.isUndefined(this.symbolGroups[e]),r=t&&!!this.symbolGroups[e].value.length,a='[data-symbol-group="'+e+'"]';t&&(this.$(".lrn-formula-keyboard-pager button").not(a).removeClass(this.CLASSES.BUTTON_ACTIVE).end().filter(a).addClass(this.CLASSES.BUTTON_ACTIVE),this.$(".lrn-formula-keyboard-page").not(a).hide().end().filter(a).show(),this.group=e,this.trigger(this.EVENT.ACTIVATED_GROUP,e),this.$(".lrn-formula-keyboard-main, lrn-keyboard-button-parent lrn-formula-keyboard-page").toggle(r),"handwriting"===this.group?this.$(this.SELECTORS.KEYBOARD_HELP).hide():this.$(this.SELECTORS.KEYBOARD_HELP).show()),this.updateButtonMap()},activateHelpModal:function activateHelpModal(){var e=s()(this.$el.closest(".lrn_response_wrapper")[0]||this.el),t=e.offset().top,r=e.find(".lrn_response_input").innerHeight(),a=this.$(".lrn-formula-keyboard").innerHeight();this.helpModal.show(t,r+a)},blurredButton:function blurredButton(){if(this._isDropdownClosed()&&!this.$el.find(":focus").length){var e=this.options.mathEvents;e.trigger(e.EVENT.ITEM_BLURRED)}},buttonAction:function buttonAction(e){var t=s()(e.currentTarget);if(!this.maskHasBeenScrolled(e))if(t.closest(".lrn-formula-keyboard-mask").length&&(e.preventDefault(),e.stopPropagation()),this.shouldIgnoreNextAction)this.shouldIgnoreNextAction=!1;else if(!this.isDragging){var r=t.data("mq-command"),a=t.data("symbol-group"),l=t.data("type");"help"===l&&this.activateHelpModal(),"caps"===l&&this.toggleCaps(),r&&this.sendMathCommand(e),a&&(e.currentTarget.focus(),this.activateGroup(a))}},buttonKeyDown:function buttonKeyDown(e){if(this._isDropdownClosed()){var t=this.options.mathEvents;switch(e.keyCode){case this.KEYCODES.LEFT:case this.KEYCODES.UP:case this.KEYCODES.RIGHT:case this.KEYCODES.DOWN:this.moveFocusInDirection(e);break;case this.KEYCODES.ESC:t.trigger(t.EVENT.ESCAPE_UI);break;case this.KEYCODES.TAB:e.shiftKey?(e.preventDefault(),t.trigger(t.EVENT.ESCAPE_UI_WITHOUT_KEYBOARD)):this.nextTab?(this.nextTab.is(":hidden")&&this.nextTab.parent().first().hasClass("lrn-formulaessay-button")&&(this.nextTab=this.nextTab.parent().siblings().find("button").filter(":visible").first()),this.nextTab.is(":visible")&&(e.preventDefault(),E.a.defer(E.a.bind((function(){this.nextTab.focus()}),this)))):t.trigger(t.EVENT.ESCAPE_UI_WITHOUT_KEYBOARD)}return this.handleKeyEvent(e)}},getLastNonEmptyElementIndex:function getLastNonEmptyElementIndex(e){var t=e.slice().reverse().reduce((function(e,t,r){return""!==t&&null===e?r:e}),null);return e.length-t-1},getAdjustedLayout:function getAdjustedLayout(e){var t=this.getLastNonEmptyElementIndex(e),r=e.reduce((function(e,r,a){return""!==r||a<t?e:e+1}),0);return e.slice(0,e.length-r)},shouldAdjustWidthOfTopRow:function shouldAdjustWidthOfTopRow(){var e=this.options.horizontalPad||this.defaultHorizontalNumberPadSymbols;return!(!this.horizontalLayout||!E.a.isArray(e))&&this.getAdjustedLayout(e).length<=10},shouldAdjustWidthOfBothRows:function shouldAdjustWidthOfBothRows(){var e=this.options.horizontalPad||this.defaultHorizontalNumberPadSymbols;if(!this.horizontalLayout||!E.a.isArray(e))return!1;var t=e.slice(0,10),r=this.getAdjustedLayout(t).length<=10,a=e.slice(10),s=this.getAdjustedLayout(a).length<=10;return r&&s},shouldAdjustWidth:function shouldAdjustWidth(){return this.shouldAdjustWidthOfTopRow()||this.shouldAdjustWidthOfBothRows()},calculatePositionAndWidth:function calculatePositionAndWidth(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.calculateWidth(e).width,r=e.pLeft+(e.pWidth-t)/2,a=e.pTop+e.pHeight,s=e.boardHeight;if(r+t>e.hLeft+e.hWidth&&(r=e.hLeft+e.hWidth-t),(e.hWidth<t||r<e.hLeft)&&(r=e.hLeft),!e.uiBelowResponse&&e.isFloating&&(a+s>this.$window.height()+this.$window.scrollTop()&&(a=e.pTop-s),a<=0)){var l=(a=e.pTop+e.pHeight)<=0;l&&(t=e.boardWidth,a=e.boardTop,r=e.boardLeft)}return this.shouldAdjustWidth()&&(t=null),{top:a,width:t,left:r}},calculateWidth:function calculateWidth(e){return{width:this.isFloating||this.isImageCloze?E.a.min([e.maxWidth,e.hWidth])*e.widthScale:100*e.widthScale+"%"}},calculateWidthScale:function calculateWidthScale(e){var t=1,r=this.numColumns;return r<this.mainGroupNumColumns&&(r=this.mainGroupNumColumns),!this.shouldAdjustWidth()&&e>this.minWidth&&(t=r/this.defaultNumColumns),t},getDraggableElement:function getDraggableElement(){return this.$(".lrn-formula-keyboard")},getHandwriting:function getHandwriting(){var e=this.handwritingPad;if(this.hasHandwriting())return e.getHandwriting.apply(e,arguments)},getPositionWithinBounds:function getPositionWithinBounds(e,t,r,a){return t<r+e?r+e:t>a+e?a+e:t},handleKeyEvent:function handleKeyEvent(e){if(this._isDropdownClosed()){var t=this.options.mathEvents,r=e.keyCode||e.which;E.a.contains(this.KEYCODES,r)||(t.trigger(t.EVENT.EXTERNAL_KEY,e),"keypress"!==e.type&&8!==r||e.preventDefault(),"keydown"===e.type&&e.shiftKey&&e.altKey&&e.preventDefault())}},hasHandwriting:function hasHandwriting(){return!(!this.symbolGroups.handwriting&&!this.isFixedHandwriting)},hide:function hide(){var e=this;(this.isFloating||this.isBlockOnFocus)&&this.isVisible?(this.$(".lrn-formula-keyboard").finish().fadeOut(100,(function(){e.resetDraggableElement(),e.trigger(e.EVENT.HIDDEN)})),this.isVisible=!1):this.isFixedHandwriting&&this.handwritingPad.hide(),this.isLazy()&&this.resetRemoveTimeout(),e.updateAriaLiveText(e.i18n.labels.ariaLiveText.mathKeyboard.mathKeyboardClosed)},closeButtonAction:function closeButtonAction(e){var t=this;(function shouldHideKeypad(e){if("click"===e.type)return!0;if("keydown"===e.type){var r=e.charCode||e.keyCode;if(r===t.KEYCODES.SPACE||r===t.KEYCODES.ENTER)return!0}})(e)&&(this.lastFocusedElement=null,e.preventDefault(),this.restoreFocusToInput(),this.hide())},hideHint:function hideHint(){this.$(".lrn-formula-keyboard-hint").addClass("lrn-empty"),this.hintShowing=!1},isCapitalised:function isCapitalised(){return this.$(".lrn-formula-keyboard").hasClass("lrn_caps_on")},isLazy:function isLazy(){var e=[this.TYPE.FLOATING_KEYBOARD,this.TYPE.BLOCK_ON_FOCUS_KEYBOARD,this.TYPE.FIXED_HANDWRITING_ONLY];return this.options.lazy&&E.a.contains(e,this.options.uiStyleType)},moveFocusInDirection:function moveFocusInDirection(e){var t=E.a.findWhere(this.buttonMap,{el:e.currentTarget}),r=E.a.invert(this.KEYCODES)[e.keyCode];if(t&&t.links[r]){var a=t.links[r];a===this.rootControlElement&&"UP"===r&&(this.rootControlElement.links.DOWN=t),this.lastFocusedElement=a.el,s()(this.lastFocusedElement).focus()}e.preventDefault(),e.stopPropagation()},notifyContainerWidth:function notifyContainerWidth(e){this.isFloating||this.isFixedHandwriting||this.horizontalLayout||(this.getDraggableElement().width(e),this.isImageCloze=!0)},onAttach:function onAttach(){var e,t,r=this,a=this.menuGroupDropdown;this.isRendered&&!this.isAttached&&(e=this.$(".lrn-formula-keyboard"),t=E.a.keys(this.symbolGroups),Object(j.a)(e,(function(){var e=r.menuGroupDropdown;e&&e.open({focusToSelectedOption:!1}),r.renderLatex(),e&&e.close()})),this.maxWidth=parseInt(e.css("max-width")),this.minWidth=parseInt(e.css("min-width")),"master"===t[0]&&t.length>1?(this.activateGroup(t[1]),a&&(a.selectedIndex=1)):(a&&(a.selectedIndex=0),this.activateGroup(t[0])),this.isAttached=!0)},pickCoords:function pickCoords(e,t){var r=this.$(".lrn-formula-keyboard").height()*this.MINIMUM_KEYPAD_VISIBILITY,a=this.$(".lrn-formula-keyboard").width()*this.MINIMUM_KEYPAD_VISIBILITY,s=this.pageWidth-a,l=-3*a,y=this.pageHeight-r;return{x:this.getPositionWithinBounds(t.x,e.clientX,l,s),y:this.getPositionWithinBounds(t.y,e.clientY,0,y)}},preventAction:function preventAction(e){var t=s()(e.target);!t.closest(this.SELECTORS.MENU_GROUP).length&&!t.closest(".lrn-formula-keyboard-mask").length&&(e.cancelable?e.preventDefault():this.shouldIgnoreNextAction=!0,e.stopPropagation())},pulseButton:function pulseButton(e,t,r){var a,s=1===t.length?t.toLowerCase():t,l=this;"\\"!==s&&(s=s.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),(a=r?this.$('[data-symbol-cid="'+r.cid+'"]'):this.$('[data-mq-value="'+s+'"]')).addClass(this.CLASSES.BUTTON_ACTIVE),setTimeout((function(){a.removeClass(l.CLASSES.BUTTON_ACTIVE)}),100)),this.isVisible||e!==this.ACTIONS.KEYPAD_OPEN||this.show()},remove:function remove(e){return s()(document).off(".lrn."+this.cid),G.b.capsLock.unobserve(this.capsObserver),this.fullScreenObserver&&G.b.fullScreen.unobserve(this.fullScreenObserver),this.unSetHintToShow(),!e&&this.clone&&(s()(this.clone).remove(),this.clone=null),this.$(".mq-math-mode.lrn-mq-original").each((function(){y()(this).revert()})),this.helpModal&&(this.helpModal.remove(),this.helpModal=null),this.handwritingPad&&(this.handwritingPad.remove(),this.handwritingPad=null),this.buttonMap=[],this.buttonMapCache={},T.a.View.prototype.remove.apply(this,arguments)},adjustHorizontalKeypadWidth:function adjustHorizontalKeypadWidth(){this.shouldAdjustWidthOfTopRow()?this.adjustWidthOfTopRow():this.shouldAdjustWidthOfBothRows()&&this.adjustWidthOfBothRows()},getHorizontalKeypadElements:function getHorizontalKeypadElements(){var e=this.el,t=e.querySelector(".lrn-formula-keyboard"),r=t.querySelector(".lrn-formula-keyboard-main");return{outerKeypadContainer:e,innerKeypadContainer:t,buttonsContainer:r,allButtons:E.a.toArray(r.children)}},applyStylesToAdjustedHorizontalKeypad:function applyStylesToAdjustedHorizontalKeypad(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getHorizontalKeypadElements(),a=r.outerKeypadContainer,s=r.innerKeypadContainer;s.classList.add("lrn-formula-keyboard--adjusted"),a.classList.add("lrn_absolute_keyboard_parent--adjusted"),a.style.maxWidth="".concat(80*e.length,"px");var l=t||e;l.forEach((function(t){t.style.width="".concat(100/e.length,"%")}));var y=l.length,w="320px";y<=3&&(w="".concat(80*y,"px")),a.style.minWidth=w},isNonEmpty:function isNonEmpty(e){return e.classList.contains("lrn_btn_grid")},isPurposedlyEmpty:function isPurposedlyEmpty(e,t){var r=t.classList.contains("lrn-btn-placeholder"),a=e.filter(this.isNonEmpty),s=e.indexOf(E.a.last(a)),l=e.indexOf(t)<s;return r&&l},adjustWidthOfTopRow:function adjustWidthOfTopRow(){var e=this;if(this.shouldAdjustWidthOfTopRow()){var t=this.getHorizontalKeypadElements().allButtons,r=t.filter((function(r){return e.isNonEmpty(r)||e.isPurposedlyEmpty(t,r)}));E.a.difference(t,r).forEach((function(e){return e.classList.add("lrn-btn-placeholder--hidden")})),this.applyStylesToAdjustedHorizontalKeypad(r)}},adjustWidthOfBothRows:function adjustWidthOfBothRows(){var e=this;if(this.shouldAdjustWidthOfBothRows()){for(var t=this.getHorizontalKeypadElements(),r=t.buttonsContainer,a=t.allButtons,s=a.slice(0,10),l=s.filter((function(t){return e.isNonEmpty(t)||e.isPurposedlyEmpty(s,t)})),y=a.slice(10),w=y.filter((function(t){return e.isNonEmpty(t)||e.isPurposedlyEmpty(y,t)})),E=document.createElement("div"),S=document.createElement("div");r.firstChild;)r.removeChild(r.firstChild);l.forEach((function(e){E.appendChild(e)})),w.forEach((function(e){S.appendChild(e)})),r.appendChild(E),r.appendChild(S);var T=l.length>=w.length?l:w,O=[].concat(_toConsumableArray(l),_toConsumableArray(w));this.applyStylesToAdjustedHorizontalKeypad(T,O)}},render:function render(){var e=this.options.uiStyleType===this.TYPE.BLOCK_ON_FOCUS_KEYBOARD||this.options.uiStyleType===this.TYPE.FLOATING_KEYBOARD;this.$el.html(A()({symbolGroups:this.symbolGroups,showHints:this.whetherToShowHints,numberPadSymbols:this.numberPadSymbols,horizontalLayout:this.horizontalLayout,labels:this.i18n.labels,showCloseButton:e})),this.adjustHorizontalKeypadWidth(),this.$(".lrn-formula-keyboard").addClass("lrn-ui-style-"+this.options.uiStyleType).toggleClass("lrn-touch",!!W.a.isTouchDevice()),this.helpModal=new Z({symbolGroups:this.symbolGroups,i18nLabels:this.i18n.labels}).render(),this.on(this.EVENT.ACTIVATED_GROUP,this.setWidthFromGroup),this.options.uiStyleType===this.TYPE.FIXED_HANDWRITING_ONLY&&(this.isFixedHandwriting=!0),this.hasHandwriting()&&(this.handwritingPad=new K({el:this.$(".lrn-handwriting")[0],security:this.options.security,handwriting:this.options.handwriting,handwritingRecognises:this.options.handwritingRecognises,fixed:this.isFixedHandwriting,i18n:this.i18n}),this.setHandwritingEvents()),this.options.uiStyleType===this.TYPE.BLOCK_ON_FOCUS_KEYBOARD&&(this.isBlockOnFocus=!0),this.options.uiStyleType===this.TYPE.FLOATING_KEYBOARD&&(this.isFloating=!0,this.options.immutablePositioner&&(this.options.positioner=this.options.immutablePositioner),this.$el.addClass("lrn lrn_widget lrn_absolute_keyboard_parent").appendTo(this.appendParent),this.fullScreenObserver=G.b.fullScreen.observe((function(e){var t=e||"body";t!==this.appendParent&&(this.$el.appendTo(t),this.appendParent=t)}),this),this.on(this.EVENT.SHOWN,E.a.debounce(this.resetVirginDraggableElement)),this.on(this.EVENT.ACTIVATED_GROUP,this.resetVirginDraggableElement)),this.options.uiStyleType!==this.TYPE.FLOATING_KEYBOARD&&this.options.uiStyleType!==this.TYPE.BLOCK_ON_FOCUS_KEYBOARD||(this.isVisible=!1);var t=this.TYPE;return E.a.contains([t.BLOCK_KEYBOARD,t.BLOCK_ON_FOCUS_KEYBOARD],this.options.uiStyleType)&&this.hideKeyboardMenuBar(),E.a.isEmpty(this.symbolGroups)||this.renderMenuGroup(),this.setMathEvents(this.options.mathEvents),this.capsObserver=G.b.capsLock.observe(this.toggleCaps,this),this.isRendered=!0,s.a.contains(document,this.el)&&this.onAttach(),this},renderMenuGroup:function renderMenuGroup(){var e=this,t=this.SELECTORS,r=t.MENU_GROUP,a=t.MENU_GROUP_TOGGLE,s=this.$(r).get(0),l=getSymbolGroupsCustomLabels(this.i18n.labels),y=this.options.disableSpokenmathUserInputs;Object(j.a)(s,(function(t){e.menuGroupDropdown=new $.a(s,function getDropdownSymbols(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;return E.a.map(e,(function(e,a){var s=e.title,l=e.render_latex,y=e.label;return s||!l||r||Q.a.translateOrEmptyString(y,(function(e){s=e})),{title:s,value:a,label:function labelFunction(){var e=E.a.findWhere(t,{id:a});return e?e.label:l&&y.indexOf("\\")>-1?'<span class="mathquill-embedded-latex">'.concat(y,"</span>"):"qwerty"===a?'<span class="lrn-group-qwerty" />':y}}}))}(e.symbolGroups,l,y),{scaleToFit:!0,toggleButton:{disableArrowKey:!0},ariaLabel:e.i18n.labels.ariaLabel.mathKeyboard.selectSymbolGroup,ariaDescription:e.i18n.labels.ariaLabel.mathKeyboard.symbolGroupRole,ariaSelected:e.i18n.labels.ariaLabel.mathKeyboard.currentSymbolGroup}),E.a.delay((function(){t()}),10)})),this.menuGroupDropdown.on("change",this.selectGroup,this).on("blur",this.blurredButton,this).on("updateComplete",(function(){return e.renderLatex(e.$(a))}))},renderLatex:function renderLatex(e){(e=e||this.$el).find(".mathquill-embedded-latex").each((function(){var e=this.textContent,t=Y[e];t?this.parentNode.replaceChild(t.cloneNode(!0),this):(y.a.InertMath(this),Y[e]=this.cloneNode(!0),this.classList.add("lrn-mq-original"))}))},resetDraggableElement:function resetDraggableElement(){this.isFloating&&(this.resetDraggableElementPosition(),this.hasBeenDragged=!1)},hideKeyboardMenuBar:function hideKeyboardMenuBar(){this.$(".lrn-drag-area").addClass("lrn_hide"),this.$(".lrn-formula-keyboard-menu").addClass("lrn-hide-menu-bar")},resetDraggableElementPosition:function resetDraggableElementPosition(){if(this.options.horizontalParent&&this.options.positioner){var e=s()(this.options.horizontalParent),t=s()(this.options.positioner),r=this.getDraggableElement(),a=e.outerWidth(),l=t.offset(),y=this.calculateWidthScale(a);r.css(this.calculatePositionAndWidth({pLeft:l.left,pTop:l.top,pWidth:t.outerWidth(),pHeight:t.outerHeight(),hLeft:e.offset().left,hWidth:a,maxWidth:this.maxWidth,boardHeight:r.outerHeight(),boardWidth:r.outerWidth(),boardTop:r.offset().top,boardLeft:r.offset().left,widthScale:y,isFloating:this.isFloating,uiBelowResponse:this.uiBelowResponse}))}},resetRemoveTimeout:function resetRemoveTimeout(){var e=this.options.mathEvents,t=this;clearTimeout(this.removeTimeout),this.removeTimeout=setTimeout((function(){t.isRendered&&(t.remove(!0),t.setElement(s()(t.clone).removeClass("lrn_clone")[0]),t.isRendered=!1,t.isAttached=!1,t.listenToOnce(e,e.EVENT.EDITOR_FOCUSED,(function(){t.show()})))}),this.lazyRemoveTimeout)},resetVirginDraggableElement:function resetVirginDraggableElement(){this.hasBeenDragged||this.resetDraggableElementPosition()},sendMathCommand:function sendMathCommand(e){var t=s()(e.currentTarget).attr("data-mq-command"),r=s()(e.currentTarget).attr("data-mq-value"),a=s()(e.currentTarget).data("symbol-cid"),l=this.masterSymbolCollection.get(a),y=this.options.mathEvents;"qwerty"===this.group&&this.isCapitalised()&&r.match(/^[a-z]$/)&&(r=r.toUpperCase()),y.trigger(y.EVENT.MATH_COMMAND,t,r,l)},setElement:function setElement(){return T.a.View.prototype.setElement.apply(this,arguments),this.clone=this.$el.clone().insertBefore(this.$el).addClass("lrn_clone")[0],this.options.el=this.el,this.options.$el=this.$el,this},setEvents:function setEvents(){this.events={},this.additionalEvents={},this.additionalTouchEvents={},this.whetherToShowHints&&(this.additionalEvents["mouseenter button[title]"]="setHintToShow",this.additionalEvents["mouseleave button[title]"]="unSetHintToShow",this.additionalTouchEvents["touchstart button[title]"]="showTouchHint"),s.a.extend(this.events,this.normalEvents,this.additionalEvents),W.a.isTouchDevice()&&s.a.extend(this.events,this.touchEvents,this.additionalTouchEvents)},setHandwritingEvents:function setHandwritingEvents(){var e=this.handwritingPad,t=this;this.listenTo(e,e.EVENT.WRITING_STARTED,(function(){var e=t.options.mathEvents;e.trigger(e.EVENT.CONTENT_OUTDATED)})),this.listenTo(e,e.EVENT.RECOGNITION_ENDED,(function(){var e=t.options.mathEvents;e.trigger(e.EVENT.RESET_STATE)})),this.listenTo(e,e.EVENT.RECOGNITION_REQUEST,(function(){var e=t.options.mathEvents;e.trigger(e.EVENT.AWAIT_UPDATE)})),this.listenTo(e,e.EVENT.RECEIVED_RESULT,(function(e){var r=t.options.mathEvents;r.trigger(r.EVENT.WRITE_LATEX,e)})),this.listenTo(e,e.EVENT.ERROR,(function(e){var r=t.options.mathEvents;r.trigger(r.EVENT.SET_ERROR,e)})),this.on(this.EVENT.ACTIVATED_GROUP+" "+this.EVENT.SHOWN,(function(){t.isVisible&&"handwriting"===t.group&&t.handwritingPad.trigger(t.handwritingPad.EVENT.SHOWN)}))},setHintToShow:function setHintToShow(e){this.hintToShow=e.currentTarget,this.showHint()},setMathEvents:function setMathEvents(e){var t,r=this,a=this;function changeHandwritingContext(){e.trigger(e.EVENT.GET_ACTIVE_ID,(function(e){a.handwritingPad.trigger(a.handwritingPad.EVENT.CANCEL_RECOGNITION),a.handwritingPad.trigger(a.handwritingPad.EVENT.CHANGE_CONTEXT,e)}))}return this.stopListening(this.options.mathEvents),this.options.mathEvents=e,this.listenTo(e,e.EVENT.MATH_COMMAND,this.pulseButton),this.listenTo(e,e.EVENT.SHIFT_KEY,(function(){G.b.capsLock.status&&"osx"===W.a.getOs()||a.toggleCaps()})),this.listenTo(e,e.EVENT.EDITOR_FOCUSED,this.show),this.listenTo(e,e.EVENT.EDITOR_BLURRED,(function(){r._mathDropdownFocus||r.hide()})),this.listenTo(e,e.EVENT.TAB_EDITOR,(function(e){e&&e.nextTabElement&&(e.isFirstElement||(a.nextTab=e.nextTabElement),a.isFixedHandwriting||(e.originalEvent.preventDefault(),E.a.defer((function(){(t=a.lastFocusedElement?a.$(a.lastFocusedElement):a.$("button:visible, [tabindex]:visible").get(0))?t.focus():e.nextTabElement.focus()}))))})),this.isFloating&&this.listenTo(e,e.EVENT.UPDATED,this.resetVirginDraggableElement),this.hasHandwriting()&&(this.listenTo(e,[e.EVENT.EDITOR_PRESSED,e.EVENT.UPDATED,e.EVENT.EDITOR_BLURRED,e.EVENT.MATH_COMMAND].join(" "),(function(){a.handwritingPad.trigger(a.handwritingPad.EVENT.CANCEL_RECOGNITION)})),changeHandwritingContext(),this.listenTo(e,e.EVENT.EDITOR_FOCUSED,changeHandwritingContext),this.listenTo(e,e.EVENT.EDITOR_REMOVED,(function(e){a.handwritingPad.trigger(a.handwritingPad.EVENT.DELETE_CONTEXTS,e)}))),this.listenTo(e,e.EVENT.MATH_COMMAND,this.updateCapitalisation),this.listenTo(e,"all",(function(t){t!==e.EVENT.ITEM_BLURRED&&a.helpModal&&a.helpModal.hide()}),this),this},onDropdownToggleMouseUp:function onDropdownToggleMouseUp(){this._mathDropdownFocus=!0},onDropdownToggleMouseDown:function onDropdownToggleMouseDown(){this._mathDropdownFocus=!1},setPositioner:function setPositioner(e,t){return this.isFloating&&!this.options.immutablePositioner&&(this.options.positioner=e,t&&(this.options.horizontalParent=e),this.resetVirginDraggableElement()),this},setWidthFromGroup:function setWidthFromGroup(e){this.numColumns=(this.symbolGroups[e]?this.symbolGroups[e].columnCount:0)+(this.numberPadSymbols.hasSymbols?this.symbolGroups[e].custom?4:this.numberPadSymbols.columnCount:0);var t=this.horizontalLayout&&this.shouldAdjustWidth()?1:this.numColumns/this.defaultNumColumns;this.shouldUpdateWidth()&&this.getDraggableElement().css(this.calculateWidth({hWidth:s()(this.options.horizontalParent).outerWidth(),widthScale:t,maxWidth:this.maxWidth}))},shouldUpdateWidth:function shouldUpdateWidth(){return this.options.horizontalParent&&s()(this.options.horizontalParent).is(":visible")},updateAriaLiveText:function updateAriaLiveText(e){s()(this.el).find(this.SELECTORS.ARIA_LIVE).text("").hide().text(e).show()},show:function show(){var e=this;this.updateAriaLiveText(this.i18n.labels.ariaLiveText.mathKeyboard.mathKeyboardOpened),clearTimeout(this.removeTimeout),this.isRendered||(this.render(),this.onAttach()),!this.isFloating&&!this.isBlockOnFocus||this.isVisible?this.isFixedHandwriting&&this.handwritingPad.show():(this.resetDraggableElement(),E.a.defer((function(){e.$(".lrn-formula-keyboard").finish().fadeIn(100,(function(){e.trigger(e.EVENT.SHOWN)}))})),this.isVisible=!0),delete this.tempPageWidth},showHint:function showHint(){if(this.hintToShow){var e=s()(this.hintToShow),t=e.data("shortcut");this.$(".lrn-hint-title").text(e.attr("title")||""),this.$(".lrn-hint-shortcut").text(E.a.exists(t)?t:""),this.$(".lrn-formula-keyboard-hint").removeClass("lrn-empty"),this.hintShowing=!0}},showTouchHint:function showTouchHint(e){this.hintTimeout&&clearTimeout(this.hintTimeout),this.showHint(e),this.hintTimeout=setTimeout(E.a.bind(this.hideHint,this),1e3)},startDrag:function startDrag(e){var t,r=this.getDraggableElement(),a=r.position(),l=this,y=this.$(".lrn-formula-keyboard-menu"),w={x:e.clientX-y.offset().left,y:e.clientY-y.offset().top};this.isDragging||(this.pageHeight=s()(document).outerHeight(),this.tempPageWidth=this.tempPageWidth||s()(document).innerWidth(),this.pageWidth=this.tempPageWidth),s()(document).on("mousemove.lrn."+this.cid,(function(e){var s=l.pickCoords(e,w);t?r.css({top:a.top+(s.y-t.y),left:a.left+(s.x-t.x)}):(t=s,l.hasBeenDragged=!0,l.isDragging=!0)})),s()(document).one("mouseup.lrn."+this.cid,(function(e){l.isDragging=!1,s()(document).off("mousemove.lrn."+l.cid)}))},startTouchDrag:function startTouchDrag(e){var t,r=this.getDraggableElement(),a=r.position(),l=this,y=this.$(".lrn-formula-keyboard-menu"),w={x:e.originalEvent.touches[0].clientX-y.offset().left,y:e.originalEvent.touches[0].clientY-y.offset().top};this.isDragging||(this.pageHeight=s()(document).outerHeight(),this.tempPageWidth=this.tempPageWidth||s()(document).innerWidth(),this.pageWidth=this.tempPageWidth),s()(document).on("touchmove.lrn."+this.cid,(function(e){var s=l.pickCoords(e.originalEvent.touches[0],w);t?r.css({top:a.top+(s.y-t.y),left:a.left+(s.x-t.x)}):(t=s,l.hasBeenDragged=!0)})),s()(document).one("touchend.lrn."+this.cid,(function(e){s()(document).off("touchmove.lrn."+l.cid)}))},toggleCaps:function toggleCaps(e){this.$(".lrn-formula-keyboard").toggleClass("lrn_caps_on",e)},unSetHintToShow:function unSetHintToShow(){this.hintShowing&&this.hideHint(),this.hintToShow=null},getElementByClassName:function getElementByClassName(e){return E.a.find(this.buttonMap,(function(t){return t.el.classList.contains(e)}))},getControlElements:function getControlElements(){return{dropdownElement:this.getElementByClassName("lrn_dropdown_toggle"),closeButtonElement:this.getElementByClassName("lrn-formula-keyboard-close-button"),helpButtonElement:this.getElementByClassName("lrn-formula-keyboard-help-button")}},getRootControlElement:function getRootControlElement(){var e=this.getControlElements(),t=e.dropdownElement,r=e.closeButtonElement,a=e.helpButtonElement;return this.horizontalLayout?a||r:t||a||r},getFirstRowElements:function getFirstRowElements(){var e=this.getControlElements(),t=e.dropdownElement,r=this.buttonMap.filter((function(r){var a=E.a.values(e).indexOf(r)>-1,s=!!t&&t.el.parentNode.contains(r.el);return!a&&!s})),a=E.a.min(r,(function(e){return e.top}));return this.buttonMap.filter((function(e){return e.top===a.top}))},applyArrowNavigationFixes:function applyArrowNavigationFixes(){var e=this.getControlElements(),t=e.dropdownElement,r=e.helpButtonElement,a=e.closeButtonElement,s=this.getFirstRowElements(),l=this.getRootControlElement();this.buttonMap.forEach((function(e){E.a.contains(s,e)&&(e.isInFirstRow=!0,l&&(e.links.UP=l))})),t&&a&&(t.links.UP=a),a&&(r||t)&&(a.links.DOWN=r||t);var y=t&&t.links.DOWN&&t.links.DOWN.el;y&&t.el.parentNode.contains(y)&&(t.links.DOWN=s[0])},updateButtonMap:function updateButtonMap(e){var t=this;!e&&this.buttonMapCache[this.group]?this.buttonMap=this.buttonMapCache[this.group]:Object(j.a)(this.$(".lrn-formula-keyboard"),(function(){t.buttonMap=t.buttonMapCache[t.group]=G.b.updateButtonMap(t.$("button.lrn_dropdown_toggle, [tabindex]:visible")),t.applyArrowNavigationFixes()})),this.rootControlElement=this.getRootControlElement()},updateCapitalisation:function updateCapitalisation(e,t){"qwerty"===this.group&&/^[a-zA-Z]$/.test(t)&&this.toggleCaps(/[A-Z]/.test(t))},selectGroup:function selectGroup(e){this.activateGroup(e.value),this.isFloating&&this.restoreFocusToInput()},onMaskTouchstart:function onMaskTouchstart(e){this.maskTouchstart=e.originalEvent.touches[0].clientY},restoreFocusToInput:function restoreFocusToInput(){var e=s()(this.options.positioner).find(".lrn_focusable");e&&e.focus()},maskHasBeenScrolled:function maskHasBeenScrolled(e){if(!E.a.isNumber(this.maskTouchstart))return!1;var t=Math.abs(e.originalEvent.changedTouches[0].clientY-this.maskTouchstart)>5;return this.maskTouchstart=null,t},getMenuContainer:function getMenuContainer(){return this.$(".lrn-formula-keyboard-menu-right").get(0)},_isDropdownClosed:function _isDropdownClosed(){var e=this.menuGroupDropdown;return!e||!e.isOpen()}}),Z=T.a.View.extend({isMathRendered:!1,previousActiveEl:void 0,events:{"keydown .lrn-content":"handleKeyDown","mousedown.lrn.formula.modal .lrn-ignore-mousedown":"handleMouseDown","click .lrn-close":"hide"},handleKeyDown:function handleKeyDown(e){27===e.keyCode&&this.hide()},handleMouseDown:function handleMouseDown(e){e.stopPropagation()},hide:function hide(){this.$el.parent().length&&(this.$el.detach().css({opacity:""}),s()(document).off(".lrn."+this.cid),this.previousActiveEl&&this.previousActiveEl.focus())},renderMath:function renderMath(){this.$(".mathquill-embedded-latex").each((function(){y.a.InertMath(this)})),this.isMathRendered=!0},remove:function remove(){return s()(document).off(".lrn."+this.cid),this.$(".mathquill-embedded-latex.mq-math-mode").each((function(){y()(this).revert()})),this.previousActiveEl=null,T.a.View.prototype.remove.apply(this,arguments)},render:function render(){var e=this.options.i18nLabels.mathKeyboardHelp;return this.setElement(s()(R()({symbolGroups:this.options.symbolGroups,formulaHelpLabels:e}))),this},show:function show(e,t){if(!this.$el.parent().length){var r=E.a.bind(this.hide,this);this.$el.css({top:e}).appendTo("body"),this.$(".lrn-content").css({height:t-parseInt(this.$el.css("marginTop"))}),this.isMathRendered||this.renderMath(),G.b.recomputeOpacityOn(this.el),this.$el.css({opacity:1}),this.previousActiveEl=document.activeElement,this.$el.find("[autofocus]").focus(),s()(document).on("mousedown.lrn."+this.cid,r)}}});t.a=X},function(e,t,r){"use strict";var a=r(5),s=r.n(a),l=r(0),y=r.n(l),w=r(51),E=["toggle"],S=["Left","Right","Backspace","÷","×","-","+","="];switch(w.a.getOs()){case"osx":E=["shift","opt"];break;case"windows":case"unix":case"linux":E=["shift","alt"]}var T=s.a.Model.extend({keysForToggle:E,keyForCtrlToggle:"ctrl",ariaHiddenSymbols:S,defaults:{type:"write"},initialize:function initialize(){this.createDisplayableShortcut(),this.on("change:shortcut",this.createDisplayableShortcut,this)},createDisplayableShortcut:function createDisplayableShortcut(){var e=y.a.clone(this.get("shortcut"));"toggle"===y.a.first(e)&&(e=y.a.union(this.keysForToggle,y.a.rest(e,1))),"ctrl"===y.a.first(e)&&(e=y.a.union(["ctrl"],y.a.rest(e))),e&&e[0]===this.get("title")&&(e=[]),this.set("displayableShortcut",e)},renderLabelAsLatex:function renderLabelAsLatex(){var e=this.get("label_latex");return y.a.isBoolean(e)?e:this.get("label").indexOf("\\")>-1},isPlaceholder:function isPlaceholder(){return""===this.get("id")},isFunctional:function isFunctional(){return!("addmatrixcol"===this.get("name")||"addmatrixrow"===this.get("name"))&&"keystroke"===this.get("type")},hasOwnStyle:function hasOwnStyle(){return!!this.get("style")},isAria:function isAria(e){return y.a.contains(S,e)}});t.a=s.a.Collection.extend({model:T,get:function get(e){return s.a.Collection.prototype.get.apply(this,arguments)||this.find((function(t){return y.a.contains(t.get("aliases"),e)}))},add:function add(e){this.isUnique(e)&&s.a.Collection.prototype.add.apply(this,arguments)},isUnique:function isUnique(e){var t=e.aliases&&y.a.union(e.aliases,e.id)||[];return!this.any((function(r){return e.id===r.id||y.a.intersection(t,r.get("aliases")).length}))},getShortcutsMap:function getShortcutsMap(){var e={};return this.each((function(t){var r=t.get("shortcut");"toggle"===y.a.first(r)&&(e[r[1]]=t)})),e},getGroups:function getGroups(){var e=y.a.unique(this.pluck("group")),t=this;return y.a.map(e,(function(e){return t.where({group:e})}))},getFirstInEachGroup:function getFirstInEachGroup(){return y.a.map(this.getGroups(),y.a.first)}})},function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="lrn-spokenmath" aria-live="polite" data-lrn-component="logger"></span><span class="lrn_math_editable',displayLogic.hasOwnBorder&&(__p+=" lrn_bordered_mathinput"),__p+="",displayLogic.disableInput&&(__p+="",displayLogic.hasOwnBorder&&(__p+=" mq-editable-field"),__p+=" lrn_hide_cursor"),__p+='"',displayLogic.templateAriaLabel&&(__p+='aria-label="'+(null==(__t=displayLogic.templateAriaLabel)?"":_.escape(__t))+'"'),__p+="></span>";return __p}},function(e,t,r){"use strict";r.d(t,"a",(function(){return E}));var a=r(0),s=r.n(a),l=r(2),y=r(13);function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var w="spokenmathWorker";var E=new(function(){function SingletonWorker(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,SingletonWorker),this._loading=!1,this._collections=[],this._resolveCollections=this._resolveCollections.bind(this),this.getPostMessage=t.getPostMessage.bind(this),this.processReceivedMessage=t.processReceivedMessage.bind(this)}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(SingletonWorker,[{key:"process",value:function process(e){var t=this,r=this._collections;return new l.default((function(a){r.push({data:e,resolve:a}),t._loading||t._loadWorker()}))}},{key:"_loadWorker",value:function _loadWorker(){var e=this;this._loading=!0,function loadWorker(e){return new l.default((function(t){y.a.getExposedExternalBundle(e)().then((function(e){t(e)}))}))}(w).then((function(t){var r=new t,a=e._collections,l=s.a.pluck(a,"data");r.postMessage(e.getPostMessage(l)),r.addEventListener("message",(function(t){var s=t.data;r.terminate(),e._loading=!1,e._resolveCollections(e.processReceivedMessage(s)),a.length&&e._loadWorker()}))}))}},{key:"_resolveCollections",value:function _resolveCollections(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this._collections;e.length&&t.length;){var r=t.shift(),a=r.resolve;a(e.shift())}}}]),SingletonWorker}())(w,{getPostMessage:function getPostMessage(e){return{latexes:e}},processReceivedMessage:function processReceivedMessage(e){return e.value}})},function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){if(__p+='<div class="sr-only lrn-formula-keypad-arialive" aria-live="polite"></div><div class="lrn-formula-keyboard lrn_clearfix" role="toolbar" aria-label="'+(null==(__t=labels.ariaLabel.mathKeyboard.title)?"":_.escape(__t))+'"><div class="lrn_toolbar lrn-formula-keyboard-menu lrn_clearfix '+(null==(__t=horizontalLayout&&"lrn-formula-keyboard-menu--horizontal")?"":__t)+" "+(null==(__t=!showHints&&"lrn-formula-keyboard-menu--no-hints")?"":__t)+'"><div class="lrn-drag-area"><div class="lrn-drag-handler"><span></span><span></span><span></span><span></span></div>',showCloseButton&&(__p+='<div class="lrn-formula-keyboard-close"><button class="lrn-formula-keyboard-close-button" tabindex="0" aria-label="'+(null==(__t=labels.ariaLabel.mathKeyboard.close)?"":_.escape(__t))+'"></button></div>'),__p+='</div><div class="clearfix"><div class="lrn-formula-keyboard-menu-right">',showHints&&(__p+='<div class="lrn-formula-keyboard-menu-container  lrn-formula-keyboard-menu-help  lrn-desktop-only"><button type="button" class="lrn-formula-keyboard-help-button" data-type="help" tabindex="-1" aria-label="'+(null==(__t=labels.ariaLabel.mathKeyboard.help)?"":_.escape(__t))+'"></button></div>'),__p+='</div><div class="lrn-formula-keyboard-menu-left">',_.keys(symbolGroups).length&&(__p+='<div class="lrn-formula-keyboard-menu-container lrn-formula-keyboard-menu-groups" data-lrn-component="menuGroup"></div>'),__p+="",showHints&&(__p+='<span class="lrn-formula-keyboard-hint lrn-empty"><span class="lrn-hint-title"></span> <span class="lrn-hint-shortcut lrn-desktop-only"></span></span>'),__p+='</div></div></div><div class="lrn-keyboard-holder">',numberPadSymbols.hasSymbols){__p+="";var fullKeypadClassName="lrn-keyboard-wrapper-"+numberPadSymbols.columnCount+"-columns";__p+='<div class="lrn-formula-keyboard-main '+(null==(__t=horizontalLayout?"lrn-formula-keyboard--horizontal":fullKeypadClassName)?"":__t)+'">';var numberPadIndex=1,numberPadRowIndex=0;_.each(numberPadSymbols.processedSymbols,(function(e){if(__p+="",numberPadRowIndex<numberPadSymbols.rowCount){if(__p+="",numberPadIndex<=numberPadSymbols.columnCount){var t=e.get("style")||"lrn-btn-grid-sym";__p+='<button type="button"class="'+(null==(__t=e.isPlaceholder()?"lrn-btn-placeholder":"lrn_btn_grid "+t)?"":__t)+'"aria-label="'+(null==(__t=e.get("title")||"")?"":__t)+'"data-mq-command="'+(null==(__t=e.get("type"))?"":_.escape(__t))+'"data-mq-value="'+(null==(__t=e.get("val"))?"":_.escape(__t))+'"tabindex="-1"',_.isArray(e.get("displayableShortcut"))&&(__p+="",showHints&&(__p+='title="'+(null==(__t=e.get("title"))?"":_.escape(__t))+'"'),__p+='data-shortcut="'+(null==(__t=e.get("displayableShortcut").join(" + "))?"":_.escape(__t))+'"'),__p+=">",e.isAria(e.get("val"))?(__p+='<span aria-hidden="true"',e.isFunctional()?__p+='class="'+(null==(__t=e.get("key_style"))?"":_.escape(__t))+'">':__p+=">"+(null==(__t=e.get("val"))?"":_.escape(__t)),__p+='</span><span class="sr-only">'+(null==(__t=e.get("title"))?"":_.escape(__t))+"</span>"):(__p+="",e.renderLabelAsLatex()?__p+='<span class="mathquill-embedded-latex">'+(null==(__t=e.get("label"))?"":_.escape(__t))+"</span>":__p+='<span class="lrn-btn-grid-sym__label" data-symbol-id="'+(null==(__t=e.get("val"))?"":_.escape(__t))+'">'+(null==(__t=e.get("label"))?"":_.escape(__t))+"</span>",__p+=""),__p+="</button>"}numberPadIndex===numberPadSymbols.columnCount&&numberPadRowIndex++,4===numberPadIndex?numberPadIndex=1:numberPadIndex++}})),__p+="</div>"}__p+="",!horizontalLayout&&_.each(symbolGroups,(function(e,t){if(__p+="",e.value.length){__p+='<div class="lrn-formula-keyboard-page lrn-keyboard-wrapper-'+(null==(__t=e.columnCount)?"":__t)+'-columns" data-symbol-group="'+(null==(__t=t)?"":__t)+'">',"master"===t&&(__p+='<div class="lrn-formula-keyboard-mask">');var r=1,a=0;_.each(e.value,(function(t){__p+="",a<e.rowCount&&(__p+="",r<=e.columnCount&&(__p+='<button aria-label="'+(null==(__t=t.get("title")||"")?"":__t)+'"type="button"class="'+(null==(__t=t.isPlaceholder()?" lrn-btn-placeholder ":"lrn_btn_grid")?"":__t)+(null==(__t=t.isFunctional()?" lrn-btn-grid-sym-functional":"")?"":__t)+(null==(__t=t.hasOwnStyle()?" "+t.get("style"):" lrn-btn-grid-sym")?"":__t)+'"data-symbol-cid="'+(null==(__t=t.cid)?"":_.escape(__t))+'"data-symbol-id="'+(null==(__t=t.get("id"))?"":_.escape(__t))+'"data-mq-command="'+(null==(__t=t.get("type"))?"":_.escape(__t))+'"data-mq-value="'+(null==(__t=t.get("val"))?"":_.escape(__t))+'"tabindex="-1"',_.isArray(t.get("displayableShortcut"))&&(__p+="",showHints&&(__p+='title="'+(null==(__t=t.get("title"))?"":_.escape(__t))+'"'),__p+='data-shortcut="'+(null==(__t=t.get("displayableShortcut").join(" + "))?"":_.escape(__t))+'"'),__p+=">",t.isFunctional()?__p+='<span aria-hidden="true" class="'+(null==(__t=t.get("key_style"))?"":_.escape(__t))+'"></span><span class="sr-only">'+(null==(__t=t.get("label"))?"":_.escape(__t))+"</span>":t.renderLabelAsLatex()?__p+='<span class="mathquill-embedded-latex">'+(null==(__t=t.get("label"))?"":_.escape(__t))+"</span>":__p+='<span class="lrn-btn-grid-sym__label" data-symbol-id="'+(null==(__t=t.get("val"))?"":_.escape(__t))+'">'+(null==(__t=t.get("label"))?"":_.escape(__t))+"</span>",__p+="</button>"),r===e.columnCount&&a++,4===r?r=1:r++)})),__p+="","master"===t&&(__p+="</div>"),__p+="</div>"}__p+=""})),__p+='</div><div class="lrn-qwerty lrn-formula-keyboard-page" data-symbol-group="qwerty"><div class="lrn-qwerty-row lrn-qwerty-row-1"><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="1" tabindex="-1">1</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="2" tabindex="-1">2</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="3" tabindex="-1">3</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="4" tabindex="-1">4</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="5" tabindex="-1">5</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="6" tabindex="-1">6</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="7" tabindex="-1">7</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="8" tabindex="-1">8</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="9" tabindex="-1">9</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="0" tabindex="-1">0</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="keystroke" data-mq-value="Backspace" tabindex="-1"><span aria-hidden="true" class="lrn_backspace"></span><span class="sr-only">Backspace</span></button></div><div class="lrn-qwerty-row lrn-qwerty-row-2"><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="q" tabindex="-1">q</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="w" tabindex="-1">w</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="e" tabindex="-1">e</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="r" tabindex="-1">r</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="t" tabindex="-1">t</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="y" tabindex="-1">y</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="u" tabindex="-1">u</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="i" tabindex="-1">i</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="o" tabindex="-1">o</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="p" tabindex="-1">p</button></div><div class="lrn-qwerty-row lrn-qwerty-row-3"><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="a" tabindex="-1">a</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="s" tabindex="-1">s</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="d" tabindex="-1">d</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="f" tabindex="-1">f</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="g" tabindex="-1">g</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="h" tabindex="-1">h</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="j" tabindex="-1">j</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="k" tabindex="-1">k</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="l" tabindex="-1">l</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value=":" tabindex="-1">:</button></div><div class="lrn-qwerty-row lrn-qwerty-row-4"><button type="button" class="lrn_btn_grid lrn-btn-grid-dir" data-mq-command="keystroke" data-mq-value="Up" tabindex="-1"><span aria-hidden="true">↑</span><span class="sr-only">Up</span></button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="z" tabindex="-1">z</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="x" tabindex="-1">x</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="c" tabindex="-1">c</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="v" tabindex="-1">v</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="b" tabindex="-1">b</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="n" tabindex="-1">n</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="m" tabindex="-1">m</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="," tabindex="-1">,</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid" data-mq-command="write" data-mq-value="." tabindex="-1">.</button></div><div class="lrn-qwerty-row lrn-qwerty-row-5"><button type="button" class="lrn_btn_grid lrn-btn-grid-dir " data-mq-command="keystroke" data-mq-value="Left" tabindex="-1"><span aria-hidden="true">←</span><span class="sr-only">Left</span></button><button type="button" class="lrn_btn_grid lrn-btn-grid-dir " data-mq-command="keystroke" data-mq-value="Down" tabindex="-1"><span aria-hidden="true">↓</span><span class="sr-only">Down</span></button><button type="button" class="lrn_btn_grid lrn-btn-grid-dir"  data-mq-command="keystroke" data-mq-value="Right" tabindex="-1"><span aria-hidden="true">→</span><span class="sr-only">Right</span></button><button type="button" class="lrn-qwerty-btn lrn-spacebar lrn_btn_grid" data-mq-command="cmd" data-mq-value="space" tabindex="-1">␣</button><button type="button" class="lrn-qwerty-btn lrn_btn_grid lrn_btn_caps" data-type="caps" data-mq-value="Shift" tabindex="-1"><span aria-hidden="true">⇧</span><span class="sr-only">Caps Lock</span></button></div></div><div class="lrn lrn-handwriting lrn-formula-keyboard-page" data-symbol-group="handwriting"></div></div>'}return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="lrn lrn-formula-symbols-help"><div class="lrn-close lrn-ignore-mousedown"></div><div class="lrn-content lrn-ignore-mousedown lrn-math-keep-keyboard-open" tabindex="0" autofocus><h3>'+(null==(__t=formulaHelpLabels.title)?"":__t)+"</h3><p>"+(null==(__t=formulaHelpLabels.shortcuts)?"":__t)+"</p><table>",_.each(symbolGroups,(function(e,t){__p+='<tr><td colspan="3"><h4>'+(null==(__t=e.title)?"":__t)+"</h4></td></tr>",_.each(e.value,(function(e){__p+="",_.isArray(e.get("displayableShortcut"))&&e.get("displayableShortcut").length&&(__p+="<tr><td>",e.renderLabelAsLatex()?__p+='<span class="mathquill-embedded-latex">'+(null==(__t=e.get("label"))?"":__t)+"</span>":__p+=""+(null==(__t=e.get("label").replace("<","&lt;").replace(">","&gt;"))?"":__t),__p+="</td><td>"+(null==(__t=e.get("title"))?"":__t)+'</td><td class="lrn-shortcut">'+(null==(__t=e.get("displayableShortcut").join(" + ").replace("<","&lt;").replace(">","&gt;"))?"":__t)+"</td></tr>"),__p+=""})),__p+=""})),__p+='</table><p class="lrn-disclaimer">'+(null==(__t=formulaHelpLabels.disclaimer)?"":__t)+"</p></div></div>";return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="lrn-accessibility-label">To answer this question, you need to highlight areas of an image. If you have trouble seeing the image, you should skip this question.</span><div class="lrn_canvas_drawing"><div class="lrn_toolbar"><ul class="lrn_toolbar_left">',displayLogic.canPaint&&(__p+='<li class="lrn_btn lrn_clear lrn_disabled" title="'+(null==(__t=labels.clear)?"":__t)+'" aria-label="'+(null==(__t=labels.clear)?"":_.escape(__t))+'" role="button"><button class="lrn-label" type="button" tabindex="0">'+(null==(__t=labels.clear)?"":__t)+'</button></li><li class="lrn_btn lrn_undo lrn_disabled" title="'+(null==(__t=labels.undo)?"":__t)+'" aria-label="'+(null==(__t=labels.undo)?"":_.escape(__t))+'" role="button"><button class="lrn-label" type="button" tabindex="0">'+(null==(__t=labels.undo)?"":__t)+'</button></li><li class="lrn_btn lrn_redo lrn_disabled" title="'+(null==(__t=labels.redo)?"":__t)+'" aria-label="'+(null==(__t=labels.redo)?"":_.escape(__t))+'" role="button"><button class="lrn-label" type="button" tabindex="0">'+(null==(__t=labels.redo)?"":__t)+"</button></li>"),__p+="",displayLogic.showRedraw&&(__p+='<li class="lrn_btn lrn_replay" title="'+(null==(__t=labels.replay)?"":__t)+'"><span class="lrn-label">'+(null==(__t=labels.replay)?"":__t)+"</span></li>"),__p+="",lineColourData&&_.isArray(lineColourData.colours)&&lineColourData.colours.length>1&&(__p+='<li class="lrn_line_colour_palette"><a class="lrn_btn lrn_line_colour_palette_trigger"><span style="background: '+(null==(__t=lineColourData.colours[0])?"":__t)+';"></span></a><ul>',_.each(lineColourData.colours,(function(e,t){__p+="",t<lineColourData.limit&&(__p+='<li class="lrn_btn_color_selector ',0==t&&(__p+="lrn_selected "),__p+='" data-colour-selection="'+(null==(__t=e)?"":__t)+'"><span style="background: '+(null==(__t=e)?"":__t)+';"></span></li>'),__p+=""})),__p+="</ul></li>"),__p+='</ul></div><canvas class="lrn_canvas',displayLogic.canPaint&&(__p+=" lrn_paintable"),__p+='" tabindex="0">'+(null==(__t=displayLogic.imageAlt)?"":_.escape(__t))+'</canvas><div class="lrn_keyboard_paintable" tabindex="0" aria-label="'+(null==(__t=labels.ariaLabel.drawing.highlight)?"":_.escape(__t))+'"></div></div>';return __p}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_RESULT__=function(){if(window.ActiveXObject&&!window.CanvasRenderingContext2D&&function(window,document,undefined){var NULL=null,CANVAS="canvas",CANVAS_RENDERING_CONTEXT_2D="CanvasRenderingContext2D",CANVAS_GRADIENT="CanvasGradient",CANVAS_PATTERN="CanvasPattern",FLASH_CANVAS="FlashCanvas",G_VML_CANVAS_MANAGER="G_vmlCanvasManager",OBJECT_ID_PREFIX="external",ON_FOCUS="onfocus",ON_PROPERTY_CHANGE="onpropertychange",ON_READY_STATE_CHANGE="onreadystatechange",ON_UNLOAD="onunload",config=window[FLASH_CANVAS+"Options"]||{},BASE_URL=config.swfPath||getScriptUrl().replace(/[^\/]+$/,""),SWF_URL=BASE_URL+"flashcanvas.swf",INDEX_SIZE_ERR=1,NOT_SUPPORTED_ERR=9,INVALID_STATE_ERR=11,SYNTAX_ERR=12,TYPE_MISMATCH_ERR=17,SECURITY_ERR=18;function Lookup(e){for(var t=0,r=e.length;t<r;t++)this[e[t]]=t}var properties=new Lookup(["toDataURL","save","restore","scale","rotate","translate","transform","setTransform","globalAlpha","globalCompositeOperation","strokeStyle","fillStyle","createLinearGradient","createRadialGradient","createPattern","lineWidth","lineCap","lineJoin","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","clearRect","fillRect","strokeRect","beginPath","closePath","moveTo","lineTo","quadraticCurveTo","bezierCurveTo","arcTo","rect","arc","fill","stroke","clip","isPointInPath","font","textAlign","textBaseline","fillText","strokeText","measureText","drawImage","createImageData","getImageData","putImageData","addColorStop","direction","resize"]),isReady={},images={},lock={},callbacks={},canvases={},spans={},CanvasRenderingContext2D=function(e,t){this.canvas=e,this._swf=t,this._canvasId=t.id.slice(8),this._initialize(),this._gradientPatternId=0,this._direction="",this._font="";var r=this;setInterval((function(){0===lock[r._canvasId]&&r._executeCommand()}),30)};CanvasRenderingContext2D.prototype={save:function(){this._setCompositing(),this._setShadows(),this._setStrokeStyle(),this._setFillStyle(),this._setLineStyles(),this._setFontStyles(),this._stateStack.push([this._globalAlpha,this._globalCompositeOperation,this._strokeStyle,this._fillStyle,this._lineWidth,this._lineCap,this._lineJoin,this._miterLimit,this._shadowOffsetX,this._shadowOffsetY,this._shadowBlur,this._shadowColor,this._font,this._textAlign,this._textBaseline]),this._queue.push(properties.save)},restore:function(){var e=this._stateStack;if(e.length){var t=e.pop();this.globalAlpha=t[0],this.globalCompositeOperation=t[1],this.strokeStyle=t[2],this.fillStyle=t[3],this.lineWidth=t[4],this.lineCap=t[5],this.lineJoin=t[6],this.miterLimit=t[7],this.shadowOffsetX=t[8],this.shadowOffsetY=t[9],this.shadowBlur=t[10],this.shadowColor=t[11],this.font=t[12],this.textAlign=t[13],this.textBaseline=t[14]}this._queue.push(properties.restore)},scale:function(e,t){this._queue.push(properties.scale,e,t)},rotate:function(e){this._queue.push(properties.rotate,e)},translate:function(e,t){this._queue.push(properties.translate,e,t)},transform:function(e,t,r,a,s,l){this._queue.push(properties.transform,e,t,r,a,s,l)},setTransform:function(e,t,r,a,s,l){this._queue.push(properties.setTransform,e,t,r,a,s,l)},_setCompositing:function(){var e=this._queue;this._globalAlpha!==this.globalAlpha&&(this._globalAlpha=this.globalAlpha,e.push(properties.globalAlpha,this._globalAlpha)),this._globalCompositeOperation!==this.globalCompositeOperation&&(this._globalCompositeOperation=this.globalCompositeOperation,e.push(properties.globalCompositeOperation,this._globalCompositeOperation))},_setStrokeStyle:function(){if(this._strokeStyle!==this.strokeStyle){var e=this._strokeStyle=this.strokeStyle;if("string"==typeof e);else{if(!(e instanceof CanvasGradient||e instanceof CanvasPattern))return;e=e.id}this._queue.push(properties.strokeStyle,e)}},_setFillStyle:function(){if(this._fillStyle!==this.fillStyle){var e=this._fillStyle=this.fillStyle;if("string"==typeof e);else{if(!(e instanceof CanvasGradient||e instanceof CanvasPattern))return;e=e.id}this._queue.push(properties.fillStyle,e)}},createLinearGradient:function(e,t,r,a){return isFinite(e)&&isFinite(t)&&isFinite(r)&&isFinite(a)||throwException(NOT_SUPPORTED_ERR),this._queue.push(properties.createLinearGradient,e,t,r,a),new CanvasGradient(this)},createRadialGradient:function(e,t,r,a,s,l){return isFinite(e)&&isFinite(t)&&isFinite(r)&&isFinite(a)&&isFinite(s)&&isFinite(l)||throwException(NOT_SUPPORTED_ERR),(r<0||l<0)&&throwException(INDEX_SIZE_ERR),this._queue.push(properties.createRadialGradient,e,t,r,a,s,l),new CanvasGradient(this)},createPattern:function(e,t){e||throwException(TYPE_MISMATCH_ERR);var r,a=e.tagName,s=this._canvasId;if(a)if("img"===(a=a.toLowerCase()))r=e.getAttribute("src",2);else{if(a===CANVAS||"video"===a)return;throwException(TYPE_MISMATCH_ERR)}else e.src?r=e.src:throwException(TYPE_MISMATCH_ERR);return"repeat"!==t&&"no-repeat"!==t&&"repeat-x"!==t&&"repeat-y"!==t&&""!==t&&t!==NULL&&throwException(SYNTAX_ERR),this._queue.push(properties.createPattern,encodeXML(r),t),!images[s][r]&&isReady[s]&&(this._executeCommand(),++lock[s],images[s][r]=!0),new CanvasPattern(this)},_setLineStyles:function(){var e=this._queue;this._lineWidth!==this.lineWidth&&(this._lineWidth=this.lineWidth,e.push(properties.lineWidth,this._lineWidth)),this._lineCap!==this.lineCap&&(this._lineCap=this.lineCap,e.push(properties.lineCap,this._lineCap)),this._lineJoin!==this.lineJoin&&(this._lineJoin=this.lineJoin,e.push(properties.lineJoin,this._lineJoin)),this._miterLimit!==this.miterLimit&&(this._miterLimit=this.miterLimit,e.push(properties.miterLimit,this._miterLimit))},_setShadows:function(){var e=this._queue;this._shadowOffsetX!==this.shadowOffsetX&&(this._shadowOffsetX=this.shadowOffsetX,e.push(properties.shadowOffsetX,this._shadowOffsetX)),this._shadowOffsetY!==this.shadowOffsetY&&(this._shadowOffsetY=this.shadowOffsetY,e.push(properties.shadowOffsetY,this._shadowOffsetY)),this._shadowBlur!==this.shadowBlur&&(this._shadowBlur=this.shadowBlur,e.push(properties.shadowBlur,this._shadowBlur)),this._shadowColor!==this.shadowColor&&(this._shadowColor=this.shadowColor,e.push(properties.shadowColor,this._shadowColor))},clearRect:function(e,t,r,a){this._queue.push(properties.clearRect,e,t,r,a)},fillRect:function(e,t,r,a){this._setCompositing(),this._setShadows(),this._setFillStyle(),this._queue.push(properties.fillRect,e,t,r,a)},strokeRect:function(e,t,r,a){this._setCompositing(),this._setShadows(),this._setStrokeStyle(),this._setLineStyles(),this._queue.push(properties.strokeRect,e,t,r,a)},beginPath:function(){this._queue.push(properties.beginPath)},closePath:function(){this._queue.push(properties.closePath)},moveTo:function(e,t){this._queue.push(properties.moveTo,e,t)},lineTo:function(e,t){this._queue.push(properties.lineTo,e,t)},quadraticCurveTo:function(e,t,r,a){this._queue.push(properties.quadraticCurveTo,e,t,r,a)},bezierCurveTo:function(e,t,r,a,s,l){this._queue.push(properties.bezierCurveTo,e,t,r,a,s,l)},arcTo:function(e,t,r,a,s){s<0&&isFinite(s)&&throwException(INDEX_SIZE_ERR),this._queue.push(properties.arcTo,e,t,r,a,s)},rect:function(e,t,r,a){this._queue.push(properties.rect,e,t,r,a)},arc:function(e,t,r,a,s,l){r<0&&isFinite(r)&&throwException(INDEX_SIZE_ERR),this._queue.push(properties.arc,e,t,r,a,s,l?1:0)},fill:function(){this._setCompositing(),this._setShadows(),this._setFillStyle(),this._queue.push(properties.fill)},stroke:function(){this._setCompositing(),this._setShadows(),this._setStrokeStyle(),this._setLineStyles(),this._queue.push(properties.stroke)},clip:function(){this._queue.push(properties.clip)},isPointInPath:function(e,t){},_setFontStyles:function(){var e=this._queue;if(this._font!==this.font)try{var t=spans[this._canvasId];t.style.font=this._font=this.font;var r=t.currentStyle,a=t.offsetHeight,s=[r.fontStyle,r.fontWeight,a,r.fontFamily].join(" ");e.push(properties.font,s)}catch(e){}this._textAlign!==this.textAlign&&(this._textAlign=this.textAlign,e.push(properties.textAlign,this._textAlign)),this._textBaseline!==this.textBaseline&&(this._textBaseline=this.textBaseline,e.push(properties.textBaseline,this._textBaseline)),this._direction!==this.canvas.currentStyle.direction&&(this._direction=this.canvas.currentStyle.direction,e.push(properties.direction,this._direction))},fillText:function(e,t,r,a){this._setCompositing(),this._setFillStyle(),this._setShadows(),this._setFontStyles(),this._queue.push(properties.fillText,encodeXML(e),t,r,a===undefined?1/0:a)},strokeText:function(e,t,r,a){this._setCompositing(),this._setStrokeStyle(),this._setShadows(),this._setFontStyles(),this._queue.push(properties.strokeText,encodeXML(e),t,r,a===undefined?1/0:a)},measureText:function(e){var t=spans[this._canvasId];try{t.style.font=this.font}catch(e){}return t.innerText=(""+e).replace(/[ \n\f\r]/g,"\t"),new TextMetrics(t.offsetWidth)},drawImage:function(e,t,r,a,s,l,y,w,E){e||throwException(TYPE_MISMATCH_ERR);var S,T=e.tagName,O=arguments.length,N=this._canvasId;if(T)if("img"===(T=T.toLowerCase()))S=e.getAttribute("src",2);else{if(T===CANVAS||"video"===T)return;throwException(TYPE_MISMATCH_ERR)}else e.src?S=e.src:throwException(TYPE_MISMATCH_ERR);if(this._setCompositing(),this._setShadows(),S=encodeXML(S),3===O)this._queue.push(properties.drawImage,O,S,t,r);else if(5===O)this._queue.push(properties.drawImage,O,S,t,r,a,s);else{if(9!==O)return;0!==a&&0!==s||throwException(INDEX_SIZE_ERR),this._queue.push(properties.drawImage,O,S,t,r,a,s,l,y,w,E)}!images[N][S]&&isReady[N]&&(this._executeCommand(),++lock[N],images[N][S]=!0)},createImageData:function(){},getImageData:function(e,t,r,a){},putImageData:function(e,t,r,a,s,l,y){},loadImage:function(e,t,r){var a,s=e.tagName,l=this._canvasId;s?"img"===s.toLowerCase()&&(a=e.getAttribute("src",2)):e.src&&(a=e.src),a&&!images[l][a]&&((t||r)&&(callbacks[l][a]=[e,t,r]),this._queue.push(properties.drawImage,1,encodeXML(a)),isReady[l]&&(this._executeCommand(),++lock[l],images[l][a]=!0))},_initialize:function(){this.globalAlpha=this._globalAlpha=1,this.globalCompositeOperation=this._globalCompositeOperation="source-over",this.strokeStyle=this._strokeStyle="#000000",this.fillStyle=this._fillStyle="#000000",this.lineWidth=this._lineWidth=1,this.lineCap=this._lineCap="butt",this.lineJoin=this._lineJoin="miter",this.miterLimit=this._miterLimit=10,this.shadowOffsetX=this._shadowOffsetX=0,this.shadowOffsetY=this._shadowOffsetY=0,this.shadowBlur=this._shadowBlur=0,this.shadowColor=this._shadowColor="rgba(0, 0, 0, 0.0)",this.font=this._font="10px sans-serif",this.textAlign=this._textAlign="start",this.textBaseline=this._textBaseline="alphabetic",this._queue=[],this._stateStack=[]},_flush:function(){var e=this._queue;return this._queue=[],e},_executeCommand:function(){var commands=this._flush();if(commands.length>0)return eval(this._swf.CallFunction('<invoke name="executeCommand" returntype="javascript"><arguments><string>'+commands.join("&#0;")+"</string></arguments></invoke>"))},_resize:function(e,t){this._executeCommand(),this._initialize(),e>0&&(this._swf.width=e),t>0&&(this._swf.height=t),this._queue.push(properties.resize,e,t)}};var CanvasGradient=function(e){this._ctx=e,this.id=e._gradientPatternId++};CanvasGradient.prototype={addColorStop:function(e,t){(isNaN(e)||e<0||e>1)&&throwException(INDEX_SIZE_ERR),this._ctx._queue.push(properties.addColorStop,this.id,e,t)}};var CanvasPattern=function(e){this.id=e._gradientPatternId++},TextMetrics=function(e){this.width=e},DOMException=function(e){this.code=e,this.message=DOMExceptionNames[e]};DOMException.prototype=new Error;var DOMExceptionNames={1:"INDEX_SIZE_ERR",9:"NOT_SUPPORTED_ERR",11:"INVALID_STATE_ERR",12:"SYNTAX_ERR",17:"TYPE_MISMATCH_ERR",18:"SECURITY_ERR"};function onReadyStateChange(){if("complete"===document.readyState){document.detachEvent(ON_READY_STATE_CHANGE,onReadyStateChange);for(var e=document.getElementsByTagName(CANVAS),t=0,r=e.length;t<r;++t)FlashCanvas.initElement(e[t])}}function onFocus(){var e=event.srcElement,t=e.parentNode;e.blur(),t.focus()}function onPropertyChange(){var e=event.propertyName;if("width"===e||"height"===e){var t=event.srcElement,r=t[e],a=parseInt(r,10);(isNaN(a)||a<0)&&(a="width"===e?300:150),r===a?(t.style[e]=a+"px",t.getContext("2d")._resize(t.width,t.height)):t[e]=a}}function onUnload(){for(var e in window.detachEvent(ON_UNLOAD,onUnload),canvases){var t,r=canvases[e],a=r.firstChild;for(t in a)"function"==typeof a[t]&&(a[t]=NULL);for(t in r)"function"==typeof r[t]&&(r[t]=NULL);a.detachEvent(ON_FOCUS,onFocus),r.detachEvent(ON_PROPERTY_CHANGE,onPropertyChange)}window[CANVAS_RENDERING_CONTEXT_2D]=NULL,window[CANVAS_GRADIENT]=NULL,window[CANVAS_PATTERN]=NULL,window[FLASH_CANVAS]=NULL,window[G_VML_CANVAS_MANAGER]=NULL}var FlashCanvas={setPath:function(e){SWF_URL=(BASE_URL=e)+"flashcanvas.swf"},initElement:function(e){if(e.getContext)return e;var t=getUniqueId(),r=OBJECT_ID_PREFIX+t;isReady[t]=!1,images[t]={},lock[t]=1,callbacks[t]={},setCanvasSize(e),e.innerHTML='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+location.protocol+'//fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="100%" height="100%" id="'+r+'"><param name="allowScriptAccess" value="always"><param name="flashvars" value="id='+r+'"><param name="wmode" value="transparent"></object><span style="margin:0;padding:0;border:0;display:inline-block;position:static;height:1em;overflow:visible;white-space:nowrap"></span>',canvases[t]=e;var a=e.firstChild;spans[t]=e.lastChild;var s=document.body.contains;if(s(e))a.movie=SWF_URL;else var l=setInterval((function(){s(e)&&(clearInterval(l),a.movie=SWF_URL)}),0);"BackCompat"!==document.compatMode&&window.XMLHttpRequest||(spans[t].style.overflow="hidden");var y=new CanvasRenderingContext2D(e,a);return e.getContext=function(e){return"2d"===e?y:NULL},e.toDataURL=function(e,t){return"image/jpeg"===(""+e).replace(/[A-Z]+/g,toLowerCase)?y._queue.push(properties.toDataURL,e,"number"==typeof t?t:""):y._queue.push(properties.toDataURL,e),y._executeCommand()},a.attachEvent(ON_FOCUS,onFocus),e},saveImage:function(e){e.firstChild.saveImage()},setOptions:function(e){},trigger:function(e,t){canvases[e].fireEvent("on"+t)},unlock:function(e,t,r){var a,s,l,y,w,E,S;lock[e]&&--lock[e],t===undefined?(s=(a=canvases[e]).firstChild,setCanvasSize(a),l=a.width,y=a.height,a.style.width=l+"px",a.style.height=y+"px",l>0&&(s.width=l),y>0&&(s.height=y),s.resize(l,y),a.attachEvent(ON_PROPERTY_CHANGE,onPropertyChange),isReady[e]=!0,"function"==typeof a.onload&&setTimeout((function(){a.onload()}),0)):(w=callbacks[e][t])&&(E=w[0],S=w[1+r],delete callbacks[e][t],"function"==typeof S&&S.call(E))}};function getScriptUrl(){var e=document.getElementsByTagName("script"),t=e[e.length-1];return document.documentMode>=8?t.src:t.getAttribute("src",4)}function getUniqueId(){return Math.random().toString(36).slice(2)||"0"}function encodeXML(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function toLowerCase(e){return e.toLowerCase()}function throwException(e){throw new DOMException(e)}function setCanvasSize(e){var t=parseInt(e.width,10),r=parseInt(e.height,10);(isNaN(t)||t<0)&&(t=300),(isNaN(r)||r<0)&&(r=150),e.width=t,e.height=r}document.createElement(CANVAS),document.createStyleSheet().cssText=CANVAS+"{display:inline-block;overflow:hidden;width:300px;height:150px}","complete"===document.readyState?onReadyStateChange():document.attachEvent(ON_READY_STATE_CHANGE,onReadyStateChange),window.attachEvent(ON_UNLOAD,onUnload),window[CANVAS_RENDERING_CONTEXT_2D]=CanvasRenderingContext2D,window[CANVAS_GRADIENT]=CanvasGradient,window[CANVAS_PATTERN]=CanvasPattern,window[FLASH_CANVAS]=FlashCanvas,window[G_VML_CANVAS_MANAGER]={init:function(){},init_:function(){},initElement:FlashCanvas.initElement},keep=[CanvasRenderingContext2D.measureText,CanvasRenderingContext2D.loadImage]}(window,document),"undefined"!=typeof FlashCanvas)return FlashCanvas}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t,r){"use strict";var a=r(1),s=r.n(a),l=r(0),y=r.n(l),w=function ScaleCompensator(e,t){var r=this;this.id=y.a.uniqueId("lrn_scale_compensator_"),this.$el=e,this.opts=t,this.scale=y.a.debounce((function(){var e=y.a.bind(r.scaleAndPosition,r);window.requestAnimationFrame?window.requestAnimationFrame(e):e()}),t.debounceTime)};y.a.extend(w.prototype,{start:function start(e){return s()(window).on("resize."+this.id+" orientationchange."+this.id+" scroll."+this.id,this.scale),this},stop:function stop(){s()(window).off("."+this.id)},scaleAndPosition:function scaleAndPosition(){var e=document.documentElement.clientWidth,t=document.documentElement.clientHeight,r=window.innerWidth,a=window.innerHeight,s=r/e,l="scale("+s+") translateX("+window.pageXOffset/s+"px) translateY("+-(t-(window.pageYOffset+a))/s+"px)";s>.99?(this.$el.removeClass("lrn_scalable"),l=""):this.$el.addClass("lrn_scalable"),this.setTransform(l),this.opts.onUpdate(s)},setTransform:function setTransform(e){return this.$el.css({transform:e,"-moz-transform":e,"-o-transform":e,"-webkit-transform":e,"-ms-transform":e}),this},destroy:function destroy(){this.stop(),this.setTransform("").$el.removeClass("lrn_scalable"),this.$el=this.opts=null}}),t.a=w},function(e,t,r){"use strict";var a=r(5),s=r.n(a),l=r(127),y=r.n(l),w=r(130),E=r.n(w),S=r(153);function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var T=function(){function CustomDropdown(e,t){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,CustomDropdown),_defineProperty(this,"on",s.a.Events.on),_defineProperty(this,"once",s.a.Events.once),_defineProperty(this,"off",s.a.Events.off),_defineProperty(this,"trigger",s.a.Events.trigger),_defineProperty(this,"_selectedIndex",-1),_defineProperty(this,"_value",null),_defineProperty(this,"_onChange",(function(e){var t=e.index,a=e.value;r._selectedIndex=t,r._value=a,r.trigger("change",{value:a,selectedIndex:t})})),_defineProperty(this,"_onBlur",(function(){r.trigger("blur")})),_defineProperty(this,"_onUpdateComplete",(function(){r.trigger("updateComplete")})),this.el=e,this.menuOptions=t,this.options=a,this._render()}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(CustomDropdown,[{key:"selectedIndex",get:function get(){return this._selectedIndex},set:function set(e){this._selectedIndex=e,this.component.setSelectedIndex(e)}},{key:"value",get:function get(){return this._value}},{key:"open",value:function open(e){this.component.open(e)}},{key:"close",value:function close(){this.component.close()}},{key:"isOpen",value:function isOpen(){return this.component.isOpen()}},{key:"_render",value:function _render(){var e=this.menuOptions,t=this.options;this.component=E.a.render(y.a.createElement(S.a,_extends({},t,{containerClass:"lrn_theme_primary",menuOptions:e,onChange:this._onChange,onBlur:this._onBlur,updateComplete:this._onUpdateComplete,selectedIndex:this.selectedIndex})),this.el)}}]),CustomDropdown}();t.a=T},,,,,,,,,function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(127),y=r.n(l),w=r(130),E=r.n(w),S=r(160);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var T=function(e){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(ModalPortal,e);var t=_createSuper(ModalPortal);function ModalPortal(){return _classCallCheck(this,ModalPortal),t.apply(this,arguments)}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(ModalPortal,[{key:"componentDidUpdate",value:function componentDidUpdate(e){var t=this.props,r=t.isOpen,a=t.afterRender;!e.isOpen&&r&&a&&a(this)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._unmounted=!0}},{key:"render",value:function render(){var e=this.props,t=e.children,r=e.lazyRendering,a=e.isOpen;return r&&!a?null:y.a.Children.only(t)}},{key:"focus",value:function focus(){var e=this.node,t=e&&Object(S.a)(e);t&&t.length&&t[0].focus()}},{key:"node",get:function get(){return this._unmounted?null:E.a.findDOMNode(this)}}]),ModalPortal}(y.a.Component),O=r(185),N=r(137),A=r(190);function floatingModal_typeof(e){return(floatingModal_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function floatingModal_defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function floatingModal_setPrototypeOf(e,t){return(floatingModal_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function floatingModal_createSuper(e){var t=function floatingModal_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=floatingModal_getPrototypeOf(e);if(t){var s=floatingModal_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return floatingModal_possibleConstructorReturn(this,r)}}function floatingModal_possibleConstructorReturn(e,t){if(t&&("object"===floatingModal_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return floatingModal_assertThisInitialized(e)}function floatingModal_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function floatingModal_getPrototypeOf(e){return(floatingModal_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function getNode(e,t){var r=null;return s.a.isFunction(e)?r=e():s.a.isString(e)&&(r=document.querySelector(e)),r||t||document.body}var L=function(e){!function floatingModal_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&floatingModal_setPrototypeOf(e,t)}(FloatingModal,e);var t=floatingModal_createSuper(FloatingModal);function FloatingModal(e){var r;return function floatingModal_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,FloatingModal),_defineProperty(floatingModal_assertThisInitialized(r=t.call(this,e)),"state",{fadingOut:!1}),_defineProperty(floatingModal_assertThisInitialized(r),"onDocumentKeyDown",(function(e){var t=e.keyCode;if(9===t)Object(O.a)(r.node,e);else if(27===t){var a=r.props.onRequestClose;s.a.isFunction(a)&&a()}})),_defineProperty(floatingModal_assertThisInitialized(r),"updatePortalPosition",(function(e){var t,a=floatingModal_assertThisInitialized(r),s=a.props,l=a.node,y=a.relativeNode,w=s.animation,E=s.afterRender;if(s.shouldUpdatePosition&&y){var S=l.style;S.left=0,S.top=0,t=N.a.relativeToElement(y,e.node,{centerAlign:r.props.centerAlign}),S.left="".concat(t.left,"px"),S.top="".concat(t.top,"px")}E&&E(l,e.node,t&&t.position),!0!==s.preventFocusWhenAppear&&(w&&w.enter?w.enter(l,(function(){e.focus()})):e.focus())})),r.prepareDOMNode(e),r}return function floatingModal_createClass(e,t,r){return t&&floatingModal_defineProperties(e.prototype,t),r&&floatingModal_defineProperties(e,r),e}(FloatingModal,[{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(e){var t=this,r=this.props,a=r.isOpen,s=r.animation,l=this.parentNode,y=getNode(e.parentNode,e.defaultNode);if(this.relativeNode=getNode(e.relativeNode),y!==l&&(this.removePortal(),this.prepareDOMNode(e),this.appendPortal(e)),s&&a&&!e.isOpen){var w=s.leave;w&&(this.setState({fadingOut:!0}),w(this.node,(function(){t._unmounted||(t.setState({fadingOut:!1}),t.processEvents(e))})))}else this.node.style.display="",this.processEvents(e)}},{key:"componentDidMount",value:function componentDidMount(){this.appendPortal(this.props)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._unmounted=!0,document.removeEventListener("keydown",this.onDocumentKeyDown),this.removePortal()}},{key:"prepareDOMNode",value:function prepareDOMNode(e){var t=e.className,r=document.createElement("div"),a=r.style;t&&(r.className=t),a.position="absolute",a.top=0,a.left=0,this.node=r}},{key:"processEvents",value:function processEvents(e){var t=e.isOpen;e.onRequestClose&&(t&&!this._documentEventsAdded?(document.addEventListener("keydown",this.onDocumentKeyDown),this._documentEventsAdded=!0):t||(document.removeEventListener("keydown",this.onDocumentKeyDown),this._documentEventsAdded=!1))}},{key:"appendPortal",value:function appendPortal(e){var t=e.parentNode,r=e.defaultNode;this.parentNode=getNode(t,r),this.parentNode.appendChild(this.node)}},{key:"removePortal",value:function removePortal(){var e=this.node;e.parentNode&&e.parentNode.removeChild(e)}},{key:"render",value:function render(){var e=this.state,t=this.props,r=this.node;return(E.a.createPortal(y.a.createElement(T,_extends({},t,{lazyRendering:!s.a.isBoolean(t.lazyRendering)||t.lazyRendering,isOpen:e.fadingOut||t.isOpen,afterRender:this.updatePortalPosition})),r))}}]),FloatingModal}(y.a.Component);_defineProperty(L,"defaultProps",{shouldUpdatePosition:!0,centerAlign:!0});t.a=Object(A.a)(L,"defaultNode")},,function(e,t,r){"use strict";r.d(t,"a",(function(){return fadeIn})),r.d(t,"b",(function(){return fadeOut}));var a=r(1),s=r.n(a);function fadeIn(e,t){s()(e).hide().fadeIn({complete:t})}function fadeOut(e,t){s()(e).fadeOut({complete:t})}},,function(e,t,r){"use strict";var a=r(1),s=r.n(a),l=r(0),y=r.n(l),w=r(127),E=r.n(w),S=r(130),T=r.n(S),O=r(180),N=r(143),A=r(134),L=r(182);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var R=function(e){_inherits(CharacterMapModal,e);var t=_createSuper(CharacterMapModal);function CharacterMapModal(){var e;_classCallCheck(this,CharacterMapModal);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return _defineProperty(_assertThisInitialized(e=t.call.apply(t,[this].concat(a))),"buttons",[]),_defineProperty(_assertThisInitialized(e),"requestToClose",(function(){var t=e.props.onRequestClose;t&&t()})),_defineProperty(_assertThisInitialized(e),"onDocumentKeyDown",(function(t){var r=_assertThisInitialized(e).buttons,a=t.keyCode;Object(A.b)(a)&&(t.preventDefault(),t.stopPropagation(),a===A.a.LEFT?N.a.left(r):a===A.a.UP?N.a.top(r):a===A.a.RIGHT?N.a.right(r):a===A.a.DOWN&&N.a.bottom(r))})),_defineProperty(_assertThisInitialized(e),"onCharacterButtonClick",(function(t){var r=e.props,a=r.onSelect,s=r.characters,l=t.currentTarget.dataset.characterBtnIndex;a&&a(s[l])})),e}return _createClass(CharacterMapModal,[{key:"render",value:function render(){var e=this,t=this.props,r=t.ariaLabel,a=t.title,s=t.modalIsOpen,l=t.characters,w=t.relativeNode,S=t.onRequestClose,T=t.className;return E.a.createElement(O.a,{isOpen:s,onRequestClose:S,relativeNode:w,className:"lrn lrn_widget lrn_charactermap_wrapper ".concat(T||""),animation:{enter:L.a,leave:L.b}},E.a.createElement("div",{className:"lrn_bubble lrn_charactermap","aria-label":r},E.a.createElement("div",{className:"lrn_charactermap_title"},a),y.a.map(l,(function(t,r){return E.a.createElement("button",{key:r,className:"lrn_btn_grid lrn_characterbutton",type:"button",unselectable:"on",tabIndex:"0","data-character-btn-index":r,onClick:e.onCharacterButtonClick,ref:function ref(t){return e.buttons.push(t)}},t)}))))}},{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(){this.buttons=[]}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.removeAllEvents()}},{key:"componentDidUpdate",value:function componentDidUpdate(){var e=this.props.modalIsOpen;e&&!this._documentEventsAdded?(document.addEventListener("click",this.requestToClose),document.addEventListener("keydown",this.onDocumentKeyDown,!0),this._documentEventsAdded=!0):e||(this.removeAllEvents(),this._documentEventsAdded=!1)}},{key:"removeAllEvents",value:function removeAllEvents(){document.removeEventListener("click",this.requestToClose),document.removeEventListener("keydown",this.onDocumentKeyDown,!0)}}]),CharacterMapModal}(E.a.Component),D=function(e){_inherits(CharacterMapButton,e);var t=_createSuper(CharacterMapButton);function CharacterMapButton(e){var r;return _classCallCheck(this,CharacterMapButton),_defineProperty(_assertThisInitialized(r=t.call(this,e)),"closeModal",(function(){var e=r.props.recoverFocus;r._setModalIsOpen(!1),e?e():r.el.focus()})),_defineProperty(_assertThisInitialized(r),"onToggleButtonClicked",(function(e){var t=_assertThisInitialized(r),a=t.el,s=t.state,l=t.props;e.preventDefault(),e.stopPropagation(),r.toggleModal(),e.target===a&&s.modalIsOpen&&l.onSelect&&l.onSelect(null)})),_defineProperty(_assertThisInitialized(r),"toggleModal",(function(){var e=!r.state.modalIsOpen;r._setModalIsOpen(e)})),r.state={modalIsOpen:!1},r}return _createClass(CharacterMapButton,[{key:"render",value:function render(){var e=this,t=this.props,r=this.state,a=(this.toggleModal,this.closeModal),s=r.modalIsOpen,l=t.label,y=t.ariaLabel,w=t.title,S=t.disabled,T=t.characters,O=t.onSelect,N=t.onFocus,A=t.onBlur,L=t.modalClassName,D=t.onMouseEnter,M=t.onMouseLeave,B=s?"lrn_active":"",q=t.className||"";return E.a.createElement("button",{type:"button",className:"lrn_btn ".concat(q," ").concat(B),onFocus:N,onBlur:A,onMouseEnter:D,onMouseLeave:M,onClick:this.onToggleButtonClicked,title:w,ref:function ref(t){return e.el=t},disabled:S,tabIndex:t.tabIndex,"aria-label":y},l,E.a.createElement(R,{title:w,characters:T,relativeNode:function relativeNode(){return e.el},className:L,modalIsOpen:s,onSelect:O,onRequestClose:a}))}},{key:"_setModalIsOpen",value:function _setModalIsOpen(e){var t=this.props.onModalToggle;t&&t(e),this.setState({modalIsOpen:e})}}]),CharacterMapButton}(E.a.Component),M=function(e){_inherits(AnimatedCharacterMapButton,e);var t=_createSuper(AnimatedCharacterMapButton);function AnimatedCharacterMapButton(){var e;_classCallCheck(this,AnimatedCharacterMapButton);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return _defineProperty(_assertThisInitialized(e=t.call.apply(t,[this].concat(a))),"invalidateVisibilityState",y.a.debounce((function(){var t=_assertThisInitialized(e),r=t.$characterMapButtonEl,a=t._modalVisible,s=t._isCharacterMapButtonFocus,l=t.props.visible;l?r.stop().fadeIn():l||a||s||r.stop().fadeOut()}),100)),_defineProperty(_assertThisInitialized(e),"onCharacterMapButtonFocus",(function(){e._isCharacterMapButtonFocus=!0})),_defineProperty(_assertThisInitialized(e),"onCharacterMapButtonBlur",(function(){e._isCharacterMapButtonFocus=!1,e.invalidateVisibilityState()})),_defineProperty(_assertThisInitialized(e),"toggleModal",(function(t){var r=e.props.toggleModal;r&&r(t),e._modalVisible=t,e.invalidateVisibilityState()})),e}return _createClass(AnimatedCharacterMapButton,[{key:"componentDidMount",value:function componentDidMount(){this.$characterMapButtonEl=s()(T.a.findDOMNode(this.characterMapButton)),this.props.visible||this.$characterMapButtonEl.hide(),this.invalidateVisibilityState()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.invalidateVisibilityState()}},{key:"render",value:function render(){var e=this;return(E.a.createElement(D,_extends({},this.props,{ref:function ref(t){return e.characterMapButton=t},onFocus:this.onCharacterMapButtonFocus,onBlur:this.onCharacterMapButtonBlur,onModalToggle:this.toggleModal})))}}]),AnimatedCharacterMapButton}(E.a.Component);t.a={CharacterMapButton:D,AnimatedCharacterMapButton:M,CharacterMapModal:R}},function(e,t,r){"use strict";r.d(t,"a",(function(){return scopeTab}));var a=r(160);function scopeTab(e,t){var r=Object(a.a)(e);if(r.length){var s=t.shiftKey,l=r[0],y=r[r.length-1],w=l===document.activeElement&&s,E=y===document.activeElement&&!s;if(w||E||e===document.activeElement)t.preventDefault(),(s?y:l).focus()}else t.preventDefault()}},function(e,t,r){var a;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}void 0===(a=function(){"use strict";var e="h1, h2, h3, h4, h5, h6, p, pre, div, blockquote, table";function withPluginHandlers(e,t,r){return function(){var a=!1,s=r.parent.plugins;if(s)for(var l in s){var y;s.hasOwnProperty(l)&&s[l][t]&&(y=s[l])[t].apply(y,[r].concat(Array.prototype.slice.call(arguments)))&&(a=!0)}a||e.apply(void 0,arguments)}}var t={version:"0.6.0-beta1",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},editorExtenders:[],extendEditor:function extendEditor(e){this.editorExtenders.push(e)},INVISIBLE_SPACE:"\ufeff",INVISIBLE_SPACE_REG_EXP:/\uFEFF/g,VOID_ELEMENTS:"area, base, br, col, embed, hr, img, input, keygen, link, meta, param, source, track, wbr",PERMITTED_PHRASING_CONTENT_ONLY:"h1, h2, h3, h4, h5, h6, p, pre",EMPTY_FUNCTION:function EMPTY_FUNCTION(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,TAB_KEY:9,DELETE_KEY:46};t.polyfills=function(e,t){var r={normalizeHasCaretError:function normalizeHasCaretError(){if("createRange"in t&&"getSelection"in e){var r,a,s,l=window.pageYOffset,y=window.pageXOffset,w=t.createElement("div"),E=t.createTextNode("a"),S=t.createTextNode("a"),T=t.createTextNode("a"),O=t.createRange();return document.activeElement&&(1===document.activeElement.nodeType&&["INPUT","TEXTAREA","SELECT","BUTTON"].indexOf(document.activeElement.nodeName)>-1?r={type:"form",node:document.activeElement,start:document.activeElement.selectionStart,end:document.activeElement.selectionEnd}:(a=e.getSelection())&&a.anchorNode&&(r={type:"range",anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset})),w.setAttribute("contenteditable","true"),w.appendChild(E),w.appendChild(S),w.appendChild(T),t.body.appendChild(w),O.setStart(S,1),O.setEnd(S,1),(a=e.getSelection()).removeAllRanges(),a.addRange(O),w.normalize(),a=e.getSelection(),s=1!==w.childNodes.length||a.anchorNode!==w.firstChild||2!==a.anchorOffset,w.parentNode.removeChild(w),a.removeAllRanges(),r&&("form"===r.type?(void 0!==r.start&&void 0!==r.end&&null!==r.start&&null!==r.end&&r.node.setSelectionRange(r.start,r.end),r.node.focus()):"range"===r.type&&((O=t.createRange()).setStart(r.anchorNode,r.anchorOffset),O.setEnd(r.focusNode,r.focusOffset),a.addRange(O))),l===window.pageYOffset&&y===window.pageXOffset||e.scrollTo(y,l),s}},apply:function apply(){var a;(a=e.Element.prototype).matches=a.matches||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector||a.webkitMatchesSelector||function matches(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),r=0;t[r]&&t[r]!==this;)++r;return!!t[r]},a.closest=a.closest||function closest(e){for(var t=this;t&&!t.matches(e);)t=t.parentElement;return t},a.remove=a.remove||function remove(){this.parentNode&&this.parentNode.removeChild(this)},"classList"in t.documentElement||!e.Object.defineProperty||void 0===e.HTMLElement||e.Object.defineProperty(e.HTMLElement.prototype,"classList",{get:function get(){var t=this;function update(e){return function(r){var a=t.className.split(/\s+/),s=a.indexOf(r);e(a,s,r),t.className=a.join(" ")}}var r={add:update((function(e,t,r){~t||e.push(r)})),remove:update((function(e,t){~t&&e.splice(t,1)})),toggle:update((function(e,t,r){~t?e.splice(t,1):e.push(r)})),contains:function contains(e){return!!~t.className.split(/\s+/).indexOf(e)},item:function item(e){return t.className.split(/\s+/)[e]||null}};return e.Object.defineProperty(r,"length",{get:function get(){return t.className.split(/\s+/).length}}),r}});var s=function F(){e.removeEventListener("load",F),"Node"in e&&"normalize"in e.Node.prototype&&r.normalizeHasCaretError()&&function normalizeFix(){e.Node.prototype.normalize;e.Node.prototype.normalize=function nf(){var t=function getTextNodes(e){var t=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?t.push(e):t=t.concat(getTextNodes(e));return t}(this),r=this.ownerDocument.defaultView.getSelection(),a=r.anchorNode,s=r.anchorOffset,l=a&&1===a.nodeType&&a.childNodes.length>0?a.childNodes[s]:void 0,y=r.focusNode,w=r.focusOffset,E=y&&1===y.nodeType&&w>0?y.childNodes[w-1]:void 0,S=this.ownerDocument.createRange(),T=t.shift(),O=T?t.shift():null;for(E&&3===E.nodeType&&(y=E,w=E.nodeValue.length,E=void 0),l&&3===l.nodeType&&(a=l,s=0,l=void 0),(a===y&&w<s||a!==y&&a.compareDocumentPosition(y)&e.Node.DOCUMENT_POSITION_PRECEDING&&!(a.compareDocumentPosition(y)&e.Node.DOCUMENT_POSITION_CONTAINS))&&(y=[a,a=y][0],w=[s,s=w][0]);T&&O;)O.previousSibling&&O.previousSibling===T?(a===O&&(a=T,s=T.nodeValue.length+s),y===O&&(y=T,w=T.nodeValue.length+w),T.nodeValue=T.nodeValue+O.nodeValue,O.parentNode.removeChild(O),O=t.shift()):(T=O,O=t.shift());E&&(w=Array.prototype.indexOf.call(E.parentNode.childNodes,E)+1),l&&(s=Array.prototype.indexOf.call(l.parentNode.childNodes,l)),function isInDom(e){var t=e.ownerDocument,r=e;do{if(r===t)return!0;r=r.parentNode}while(r);return!1}(this)&&a&&a.parentNode&&y&&y.parentNode&&(S.setStart(a,s),S.setEnd(y,w),r.removeAllRanges(),r.addRange(S))}}()};"complete"!==t.readyState?e.addEventListener("load",s):s(),function(){if(!function nativeCustomEventSupported(){try{var t=new e.CustomEvent("cat",{detail:{foo:"bar"}});return"cat"===t.type&&"bar"===t.detail.foo}catch(e){}return!1}()&&"CustomEvent"in e){var r=function CustomEvent(e,r){r=r||{bubbles:!1,cancelable:!1,detail:void 0};var a=t.createEvent("CustomEvent");return a.initCustomEvent(e,r.bubbles,r.cancelable,r.detail),a};r.prototype=e.Event.prototype,e.CustomEvent=r}}()}};return r},t.polyfills(window,document).apply();var r,a,s,l,y,w,E,S,T,O,N,A,L,R,D,M,B,q=function Base(){};return t.Base||(t.Base=q),q.extend=function(e,t){var r=q.prototype.extend;q._prototyping=!0;var a=new this;r.call(a,e),a.base=function(){},delete q._prototyping;var s=a.constructor,l=a.constructor=function(){if(!q._prototyping)if(this._constructing||this.constructor==l)this._constructing=!0,s.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||r).call(arguments[0],a)};return l.ancestor=this,l.extend=this.extend,l.forEach=this.forEach,l.implement=this.implement,l.prototype=a,l.toString=this.toString,l.valueOf=function(e){return"object"==e?l:s.valueOf()},r.call(l,t),"function"==typeof l.init&&l.init(),l},q.prototype={extend:function extend(e,t){if(arguments.length>1){var r=this[e];if(r&&"function"==typeof t&&(!r.valueOf||r.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var a=t.valueOf();(t=function value(){var e=this.base||q.prototype.base;this.base=r;var t=a.apply(this,arguments);return this.base=e,t}).valueOf=function(e){return"object"==e?t:a},t.toString=q.toString}this[e]=t}else if(e){var extend=q.prototype.extend;q._prototyping||"function"==typeof this||(extend=this.extend||extend);for(var s={toSource:null},l=["constructor","toString","valueOf"],y=q._prototyping?0:1;w=l[y++];)e[w]!=s[w]&&extend.call(this,w,e[w]);for(var w in e)s[w]||extend.call(this,w,e[w])}return this}},q=q.extend({constructor:function constructor(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function forEach(e,t,r){for(var a in e)void 0===this.prototype[a]&&t.call(r,e[a],a,e)},implement:function implement(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function toString(){return String(this.valueOf())}}),function(){var e=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],t=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],a=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],s=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function isHostMethod(e,t){var r=_typeof(e[t]);return"function"==r||!("object"!=r||!e[t])||"unknown"==r}function isHostObject(e,t){return!("object"!=_typeof(e[t])||!e[t])}function isHostProperty(e,t){return"undefined"!=_typeof(e[t])}function createMultiplePropertyTest(e){return function(t,r){for(var a=r.length;a--;)if(!e(t,r[a]))return!1;return!0}}var l=createMultiplePropertyTest(isHostMethod),y=createMultiplePropertyTest(isHostObject),w=createMultiplePropertyTest(isHostProperty);function isTextRange(e){return e&&l(e,s)&&w(e,a)}function getBody(e){return isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}var E,S,T=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var r=0,a=e.length;r<a;++r)t(e[r],r)},O={},N="undefined"!=("undefined"==typeof window?"undefined":_typeof(window))&&"undefined"!=("undefined"==typeof document?"undefined":_typeof(document)),A={isHostMethod:isHostMethod,isHostObject:isHostObject,isHostProperty:isHostProperty,areHostMethods:l,areHostObjects:y,areHostProperties:w,isTextRange:isTextRange,getBody:getBody,forEach:T},L={version:"1.3.1-dev",initialized:!1,isBrowser:N,supported:!0,util:A,features:{},modules:O,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:"undefined"==("undefined"==typeof rangyAutoInitialize?"undefined":_typeof(rangyAutoInitialize))||rangyAutoInitialize}};function consoleLog(e){"undefined"!=("undefined"==typeof console?"undefined":_typeof(console))&&isHostMethod(console,"log")&&console.log(e)}function alertOrLog(e,t){N&&t?alert(e):consoleLog(e)}function fail(e){L.initialized=!0,L.supported=!1,alertOrLog("Rangy is not supported in this environment. Reason: "+e,L.config.alertOnFail)}L.fail=fail,L.warn=function warn(e){alertOrLog("Rangy warning: "+e,L.config.alertOnWarn)},!{}.hasOwnProperty?fail("hasOwnProperty not supported"):(A.extend=E=function extend(e,t,r){var a,s;for(var l in t)t.hasOwnProperty(l)&&(a=e[l],s=t[l],r&&null!==a&&"object"==_typeof(a)&&null!==s&&"object"==_typeof(s)&&E(a,s,!0),e[l]=s);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},A.createOptions=function(e,t){var r={};return E(r,t),e&&E(r,e),r}),N||fail("Rangy can only run in a browser"),function(){var e;if(N){var t=document.createElement("div");t.appendChild(document.createElement("span"));var r=[].slice;try{1==r.call(t.childNodes,0)[0].nodeType&&(e=function toArray(e){return r.call(e,0)})}catch(e){}}e||(e=function toArray(e){for(var t=[],r=0,a=e.length;r<a;++r)t[r]=e[r];return t}),A.toArray=e}(),N&&(isHostMethod(document,"addEventListener")?S=function addListener(e,t,r){e.addEventListener(t,r,!1)}:isHostMethod(document,"attachEvent")?S=function addListener(e,t,r){e.attachEvent("on"+t,r)}:fail("Document does not have required addEventListener or attachEvent method"),A.addListener=S);var R=[];function getErrorDesc(e){return e.message||e.description||String(e)}function init(){if(N&&!L.initialized){var r,a=!1,s=!1;isHostMethod(document,"createRange")&&(r=document.createRange(),l(r,t)&&w(r,e)&&(a=!0));var y=getBody(document);if(y&&"body"==y.nodeName.toLowerCase())if(y&&isHostMethod(y,"createTextRange")&&isTextRange(r=y.createTextRange())&&(s=!0),a||s){var E;for(var S in L.initialized=!0,L.features={implementsDomRange:a,implementsTextRange:s},O)(E=O[S])instanceof Module&&E.init(E,L);for(var T=0,A=R.length;T<A;++T)try{R[T](L)}catch(e){consoleLog("Rangy init listener threw an exception. Continuing. Detail: "+getErrorDesc(e))}}else fail("Neither Range nor TextRange are available");else fail("No body element found")}}function deprecationNotice(e,t,r){r&&(e+=" in module "+r.name),L.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function createAliasForDeprecatedMethod(e,t,r,a){e[t]=function(){return deprecationNotice(t,r,a),e[r].apply(e,A.toArray(arguments))}}A.deprecationNotice=deprecationNotice,A.createAliasForDeprecatedMethod=createAliasForDeprecatedMethod,L.init=init,L.addInitListener=function(e){L.initialized?e(L):R.push(e)};var D=[];function Module(e,t,r){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=r}function createModule(e,t,r){var a=new Module(e,t,(function(t){if(!t.initialized){t.initialized=!0;try{r(L,t),t.supported=!0}catch(t){consoleLog("Module '"+e+"' failed to load: "+getErrorDesc(t)),t.stack&&consoleLog(t.stack)}}}));return O[e]=a,a}function RangePrototype(){}L.addShimListener=function(e){D.push(e)},N&&(L.shim=L.createMissingNativeApi=function shim(e){e=e||window,init();for(var t=0,r=D.length;t<r;++t)D[t](e)},createAliasForDeprecatedMethod(L,"createMissingNativeApi","shim")),Module.prototype={init:function init(){for(var e,t,r=this.dependencies||[],a=0,s=r.length;a<s;++a){if(t=r[a],!((e=O[t])&&e instanceof Module))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function fail(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function warn(e){L.warn("Module "+this.name+": "+e)},deprecationNotice:function deprecationNotice(e,t){L.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function createError(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},L.createModule=function(e){var t,r;2==arguments.length?(t=arguments[1],r=[]):(t=arguments[2],r=arguments[1]);var a=createModule(e,r,t);L.initialized&&L.supported&&a.init()},L.createCoreModule=function(e,t,r){createModule(e,t,r)},L.RangePrototype=RangePrototype,L.rangePrototype=new RangePrototype,L.selectionPrototype=new function SelectionPrototype(){},L.createCoreModule("DomUtil",[],(function(e,t){var r="undefined",a=e.util,s=a.getBody;a.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),a.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var l=document.createElement("div");a.areHostMethods(l,["insertBefore","appendChild","cloneNode"]||!1)||t.fail("Incomplete Element implementation"),a.isHostProperty(l,"innerHTML")||t.fail("Element is missing innerHTML property");var y=document.createTextNode("test");a.areHostMethods(y,["splitText","deleteData","insertData","appendData","cloneNode"]||!1)||t.fail("Incomplete Text Node implementation");var w=function arrayContains(e,t){for(var r=e.length;r--;)if(e[r]===t)return!0;return!1};function getNodeIndex(e){for(var t=0;e=e.previousSibling;)++t;return t}function getCommonAncestor(e,t){var r,a=[];for(r=e;r;r=r.parentNode)a.push(r);for(r=t;r;r=r.parentNode)if(w(a,r))return r;return null}function isAncestorOf(e,t,r){for(var a=r?t:t.parentNode;a;){if(a===e)return!0;a=a.parentNode}return!1}function getClosestAncestorIn(e,t,r){for(var a,s=r?e:e.parentNode;s;){if((a=s.parentNode)===t)return s;s=a}return null}function isCharacterDataNode(e){var t=e.nodeType;return 3==t||4==t||8==t}function insertAfter(e,t){var r=t.nextSibling,a=t.parentNode;return r?a.insertBefore(e,r):a.appendChild(e),e}function getDocument(e){if(9==e.nodeType)return e;if(_typeof(e.ownerDocument)!=r)return e.ownerDocument;if(_typeof(e.document)!=r)return e.document;if(e.parentNode)return getDocument(e.parentNode);throw t.createError("getDocument: no document found for node")}function getWindow(e){var a=getDocument(e);if(_typeof(a.defaultView)!=r)return a.defaultView;if(_typeof(a.parentWindow)!=r)return a.parentWindow;throw t.createError("Cannot get a window object for node")}function getIframeDocument(e){if(_typeof(e.contentDocument)!=r)return e.contentDocument;if(_typeof(e.contentWindow)!=r)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function isWindow(e){return e&&a.isHostMethod(e,"setTimeout")&&a.isHostObject(e,"document")}var E,S=!1;function isBrokenNode(e){try{return e.parentNode,!1}catch(e){return!0}}function inspectNode(e){if(!e)return"[No node]";if(S&&isBrokenNode(e))return"[Broken node]";if(isCharacterDataNode(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+getNodeIndex(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function NodeIterator(e){this.root=e,this._next=e}function DomPosition(e,t){this.node=e,this.offset=t}function DOMException(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}!function(){var t=document.createElement("b");t.innerHTML="1";var r=t.firstChild;t.innerHTML="<br />",S=isBrokenNode(r),e.features.crashyTextNodes=S}(),_typeof(window.getComputedStyle)!=r?E=function getComputedStyleProperty(e,t){return getWindow(e).getComputedStyle(e,null)[t]}:_typeof(document.documentElement.currentStyle)!=r?E=function getComputedStyleProperty(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),NodeIterator.prototype={_current:null,hasNext:function hasNext(){return!!this._next},next:function next(){var e,next,t=this._current=this._next;if(this._current)if(e=t.firstChild)this._next=e;else{for(next=null;t!==this.root&&!(next=t.nextSibling);)t=t.parentNode;this._next=next}return this._current},detach:function detach(){this._current=this._next=this.root=null}},DomPosition.prototype={equals:function equals(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function inspect(){return"[DomPosition("+inspectNode(this.node)+":"+this.offset+")]"},toString:function toString(){return this.inspect()}},DOMException.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},DOMException.prototype.toString=function(){return this.message},e.dom={arrayContains:w,isHtmlNamespace:function isHtmlNamespace(e){var t;return _typeof(e.namespaceURI)==r||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function parentElement(e){var t=e.parentNode;return 1==t.nodeType?t:null},getNodeIndex:getNodeIndex,getNodeLength:function getNodeLength(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:getCommonAncestor,isAncestorOf:isAncestorOf,isOrIsAncestorOf:function isOrIsAncestorOf(e,t){return isAncestorOf(e,t,!0)},getClosestAncestorIn:getClosestAncestorIn,isCharacterDataNode:isCharacterDataNode,isTextOrCommentNode:function isTextOrCommentNode(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t},insertAfter:insertAfter,splitDataNode:function splitDataNode(e,t,r){var a=e.cloneNode(!1);if(a.deleteData(0,t),e.deleteData(t,e.length-t),insertAfter(a,e),r)for(var s,l=0;s=r[l++];)s.node==e&&s.offset>t?(s.node=a,s.offset-=t):s.node==e.parentNode&&s.offset>getNodeIndex(e)&&++s.offset;return a},getDocument:getDocument,getWindow:getWindow,getIframeWindow:function getIframeWindow(e){if(_typeof(e.contentWindow)!=r)return e.contentWindow;if(_typeof(e.contentDocument)!=r)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:getIframeDocument,getBody:s,isWindow:isWindow,getContentDocument:function getContentDocument(e,t,r){var s;if(e?a.isHostProperty(e,"nodeType")?s=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?getIframeDocument(e):getDocument(e):isWindow(e)&&(s=e.document):s=document,!s)throw t.createError(r+"(): Parameter must be a Window object or DOM node");return s},getRootContainer:function getRootContainer(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function comparePoints(e,r,a,s){var l,y,w,E,S;if(e==a)return r===s?0:r<s?-1:1;if(l=getClosestAncestorIn(a,e,!0))return r<=getNodeIndex(l)?-1:1;if(l=getClosestAncestorIn(e,a,!0))return getNodeIndex(l)<s?-1:1;if(!(y=getCommonAncestor(e,a)))throw new Error("comparePoints error: nodes have no common ancestor");if((w=e===y?y:getClosestAncestorIn(e,y,!0))===(E=a===y?y:getClosestAncestorIn(a,y,!0)))throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(S=y.firstChild;S;){if(S===w)return-1;if(S===E)return 1;S=S.nextSibling}},isBrokenNode:isBrokenNode,inspectNode:inspectNode,getComputedStyleProperty:E,createTestElement:function createTestElement(e,t,r){var a=s(e),l=e.createElement("div");l.contentEditable=""+!!r,t&&(l.innerHTML=t);var y=a.firstChild;return y?a.insertBefore(l,y):a.appendChild(l),l},removeNode:function removeNode(e){return e.parentNode.removeChild(e)},fragmentFromNodeChildren:function fragmentFromNodeChildren(e){for(var t,r=getDocument(e).createDocumentFragment();t=e.firstChild;)r.appendChild(t);return r},createIterator:function createIterator(e){return new NodeIterator(e)},DomPosition:DomPosition},e.DOMException=DOMException})),L.createCoreModule("DomRange",["DomUtil"],(function(e,t){var r=e.dom,a=e.util,s=r.DomPosition,l=e.DOMException,y=r.isCharacterDataNode,w=r.getNodeIndex,E=r.isOrIsAncestorOf,S=r.getDocument,T=r.comparePoints,O=r.splitDataNode,N=r.getClosestAncestorIn,A=r.getNodeLength,L=r.arrayContains,R=r.getRootContainer,D=e.features.crashyTextNodes,M=r.removeNode;function isNonTextPartiallySelected(e,t){return 3!=e.nodeType&&(E(e,t.startContainer)||E(e,t.endContainer))}function getRangeDocument(e){return e.document||S(e.startContainer)}function getBoundaryBeforeNode(e){return new s(e.parentNode,w(e))}function getBoundaryAfterNode(e){return new s(e.parentNode,w(e)+1)}function insertNodeAtPosition(e,t,a){var s=11==e.nodeType?e.firstChild:e;return y(t)?a==t.length?r.insertAfter(e,t):t.parentNode.insertBefore(e,0==a?t:O(t,a)):a>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[a]),s}function rangesIntersect(e,t,r){if(assertRangeValid(e),assertRangeValid(t),getRangeDocument(t)!=getRangeDocument(e))throw new l("WRONG_DOCUMENT_ERR");var a=T(e.startContainer,e.startOffset,t.endContainer,t.endOffset),s=T(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return r?a<=0&&s>=0:a<0&&s>0}function iterateSubtree(e,t,a){var s,l,y,w;for(a=a||{stop:!1};y=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(y))return void(a.stop=!0);if(iterateSubtree(w=e.getSubtreeIterator(),t,a),w.detach(),a.stop)return}else for(s=r.createIterator(y);l=s.next();)if(!1===t(l))return void(a.stop=!0)}function deleteSubtree(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(deleteSubtree(t=e.getSubtreeIterator()),t.detach()):e.remove()}function extractSubtree(e){for(var t,r,a=getRangeDocument(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(extractSubtree(r)),r.detach()):e.remove(),10==t.nodeType)throw new l("HIERARCHY_REQUEST_ERR");a.appendChild(t)}return a}function _inspect(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+r.inspectNode(e.startContainer)+":"+e.startOffset+", "+r.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function RangeIterator(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var r=e.commonAncestorContainer;this.sc===this.ec&&y(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==r||y(this.sc)?N(this.sc,r,!0):this.sc.childNodes[this.so],this._last=this.ec!==r||y(this.ec)?N(this.ec,r,!0):this.ec.childNodes[this.eo-1])}}RangeIterator.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function reset(){this._current=null,this._next=this._first},hasNext:function hasNext(){return!!this._next},next:function next(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,y(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function remove(){var e,t,r=this._current;!y(r)||r!==this.sc&&r!==this.ec?r.parentNode&&M(r):(e=r===this.sc?this.so:0)!=(t=r===this.ec?this.eo:r.length)&&r.deleteData(e,t-e)},isPartiallySelectedSubtree:function isPartiallySelectedSubtree(){return isNonTextPartiallySelected(this._current,this.range)},getSubtreeIterator:function getSubtreeIterator(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new Range(getRangeDocument(this.range));var t=this._current,r=t,a=0,s=t,l=A(t);E(t,this.sc)&&(r=this.sc,a=this.so),E(t,this.ec)&&(s=this.ec,l=this.eo),updateBoundaries(e,r,a,s,l)}return new RangeIterator(e,this.clonePartiallySelectedTextNodes)},detach:function detach(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var B=[1,3,4,5,7,8,10],q=[2,9,11],W=[1,3,4,5,7,8,10,11],j=[1,3,4,5,7,8];function createAncestorFinder(e){return function(t,r){for(var a,s=r?t:t.parentNode;s;){if(a=s.nodeType,L(e,a))return s;s=s.parentNode}return null}}var H=createAncestorFinder([9,11]),V=createAncestorFinder([5,6,10,12]),z=createAncestorFinder([6,10,12]);function assertNoDocTypeNotationEntityAncestor(e,t){if(z(e,t))throw new l("INVALID_NODE_TYPE_ERR")}function assertValidNodeType(e,t){if(!L(t,e.nodeType))throw new l("INVALID_NODE_TYPE_ERR")}function assertValidOffset(e,t){if(t<0||t>(y(e)?e.length:e.childNodes.length))throw new l("INDEX_SIZE_ERR")}function assertSameDocumentOrFragment(e,t){if(H(e,!0)!==H(t,!0))throw new l("WRONG_DOCUMENT_ERR")}function assertNodeNotReadOnly(e){if(V(e,!0))throw new l("NO_MODIFICATION_ALLOWED_ERR")}function assertNode(e,t){if(!e)throw new l(t)}function isValidOffset(e,t){return t<=(y(e)?e.length:e.childNodes.length)}function isRangeValid(e){return!!e.startContainer&&!!e.endContainer&&!(D&&(r.isBrokenNode(e.startContainer)||r.isBrokenNode(e.endContainer)))&&R(e.startContainer)==R(e.endContainer)&&isValidOffset(e.startContainer,e.startOffset)&&isValidOffset(e.endContainer,e.endOffset)}function assertRangeValid(e){if(!isRangeValid(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var U=document.createElement("style"),G=!1;try{U.innerHTML="<b>x</b>",G=3==U.firstChild.nodeType}catch(e){}e.features.htmlParsingConforms=G;var K=G?function(e){var t=this.startContainer,a=S(t);if(!t)throw new l("INVALID_STATE_ERR");var s=null;return 1==t.nodeType?s=t:y(t)&&(s=r.parentElement(t)),(s=null===s||"HTML"==s.nodeName&&r.isHtmlNamespace(S(s).documentElement)&&r.isHtmlNamespace(s)?a.createElement("body"):s.cloneNode(!1)).innerHTML=e,r.fragmentFromNodeChildren(s)}:function(e){var t=getRangeDocument(this).createElement("body");return t.innerHTML=e,r.fragmentFromNodeChildren(t)};function splitRangeBoundaries(e,t){assertRangeValid(e);var r=e.startContainer,a=e.startOffset,s=e.endContainer,l=e.endOffset,E=r===s;y(s)&&l>0&&l<s.length&&O(s,l,t),y(r)&&a>0&&a<r.length&&(r=O(r,a,t),E?(l-=a,s=r):s==r.parentNode&&l>=w(r)&&l++,a=0),e.setStartAndEnd(r,a,s,l)}function rangeToHtml(e){assertRangeValid(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}var $=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];function copyComparisonConstantsToObject(e){e.START_TO_START=0,e.START_TO_END=1,e.END_TO_END=2,e.END_TO_START=3,e.NODE_BEFORE=0,e.NODE_AFTER=1,e.NODE_BEFORE_AND_AFTER=2,e.NODE_INSIDE=3}function copyComparisonConstants(e){copyComparisonConstantsToObject(e),copyComparisonConstantsToObject(e.prototype)}function createRangeContentRemover(e,t){return function(){assertRangeValid(this);var r,a=this.startContainer,s=this.startOffset,l=this.commonAncestorContainer,y=new RangeIterator(this,!0);a!==l&&(a=(r=getBoundaryAfterNode(N(a,l,!0))).node,s=r.offset),iterateSubtree(y,assertNodeNotReadOnly),y.reset();var w=e(y);return y.detach(),t(this,a,s,a,s),w}}function createPrototypeRange(t,r){function createBeforeAfterNodeSetter(e,t){return function(r){assertValidNodeType(r,B),assertValidNodeType(R(r),q);var a=(e?getBoundaryBeforeNode:getBoundaryAfterNode)(r);(t?setRangeStart:setRangeEnd)(this,a.node,a.offset)}}function setRangeStart(e,t,a){var s=e.endContainer,l=e.endOffset;t===e.startContainer&&a===e.startOffset||(R(t)==R(s)&&1!=T(t,a,s,l)||(s=t,l=a),r(e,t,a,s,l))}function setRangeEnd(e,t,a){var s=e.startContainer,l=e.startOffset;t===e.endContainer&&a===e.endOffset||(R(t)==R(s)&&-1!=T(t,a,s,l)||(s=t,l=a),r(e,s,l,t,a))}var s=function F(){};s.prototype=e.rangePrototype,t.prototype=new s,a.extend(t.prototype,{setStart:function setStart(e,t){assertNoDocTypeNotationEntityAncestor(e,!0),assertValidOffset(e,t),setRangeStart(this,e,t)},setEnd:function setEnd(e,t){assertNoDocTypeNotationEntityAncestor(e,!0),assertValidOffset(e,t),setRangeEnd(this,e,t)},setStartAndEnd:function setStartAndEnd(){var e=arguments,t=e[0],a=e[1],s=t,l=a;switch(e.length){case 3:l=e[2];break;case 4:s=e[2],l=e[3]}r(this,t,a,s,l)},setBoundary:function setBoundary(e,t,r){this["set"+(r?"Start":"End")](e,t)},setStartBefore:createBeforeAfterNodeSetter(!0,!0),setStartAfter:createBeforeAfterNodeSetter(!1,!0),setEndBefore:createBeforeAfterNodeSetter(!0,!1),setEndAfter:createBeforeAfterNodeSetter(!1,!1),collapse:function collapse(e){assertRangeValid(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function selectNodeContents(e){assertNoDocTypeNotationEntityAncestor(e,!0),r(this,e,0,e,A(e))},selectNode:function selectNode(e){assertNoDocTypeNotationEntityAncestor(e,!1),assertValidNodeType(e,B);var t=getBoundaryBeforeNode(e),a=getBoundaryAfterNode(e);r(this,t.node,t.offset,a.node,a.offset)},extractContents:createRangeContentRemover(extractSubtree,r),deleteContents:createRangeContentRemover(deleteSubtree,r),canSurroundContents:function canSurroundContents(){assertRangeValid(this),assertNodeNotReadOnly(this.startContainer),assertNodeNotReadOnly(this.endContainer);var e=new RangeIterator(this,!0),t=e._first&&isNonTextPartiallySelected(e._first,this)||e._last&&isNonTextPartiallySelected(e._last,this);return e.detach(),!t},splitBoundaries:function splitBoundaries(){splitRangeBoundaries(this)},splitBoundariesPreservingPositions:function splitBoundariesPreservingPositions(e){splitRangeBoundaries(this,e)},normalizeBoundaries:function normalizeBoundaries(){assertRangeValid(this);var e,t=this.startContainer,a=this.startOffset,s=this.endContainer,l=this.endOffset,E=function mergeForward(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(s=e,l=e.length,e.appendData(t.data),M(t))},S=function mergeBackward(e){var r=e.previousSibling;if(r&&r.nodeType==e.nodeType){t=e;var y=e.length;if(a=r.length,e.insertData(0,r.data),M(r),t==s)l+=a,s=t;else if(s==e.parentNode){var E=w(e);l==E?(s=e,l=y):l>E&&l--}}},T=!0;if(y(s))l==s.length?E(s):0==l&&(e=s.previousSibling)&&e.nodeType==s.nodeType&&(l=e.length,t==s&&(T=!1),e.appendData(s.data),M(s),s=e);else{if(l>0){var O=s.childNodes[l-1];O&&y(O)&&E(O)}T=!this.collapsed}if(T){if(y(t))0==a?S(t):a==t.length&&(e=t.nextSibling)&&e.nodeType==t.nodeType&&(s==e&&(s=t,l+=t.length),t.appendData(e.data),M(e));else if(a<t.childNodes.length){var N=t.childNodes[a];N&&y(N)&&S(N)}}else t=s,a=l;r(this,t,a,s,l)},collapseToPoint:function collapseToPoint(e,t){assertNoDocTypeNotationEntityAncestor(e,!0),assertValidOffset(e,t),this.setStartAndEnd(e,t)}}),copyComparisonConstants(t)}function updateCollapsedAndCommonAncestor(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:r.getCommonAncestor(e.startContainer,e.endContainer)}function updateBoundaries(e,t,a,s,l){e.startContainer=t,e.startOffset=a,e.endContainer=s,e.endOffset=l,e.document=r.getDocument(t),updateCollapsedAndCommonAncestor(e)}function Range(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,updateCollapsedAndCommonAncestor(this)}a.extend(e.rangePrototype,{compareBoundaryPoints:function compareBoundaryPoints(e,t){var r,a,s,l;assertRangeValid(this),assertSameDocumentOrFragment(this.startContainer,t.startContainer);var y=3==e||0==e?"start":"end",w=1==e||0==e?"start":"end";return r=this[y+"Container"],a=this[y+"Offset"],s=t[w+"Container"],l=t[w+"Offset"],T(r,a,s,l)},insertNode:function insertNode(e){if(assertRangeValid(this),assertValidNodeType(e,W),assertNodeNotReadOnly(this.startContainer),E(e,this.startContainer))throw new l("HIERARCHY_REQUEST_ERR");var t=insertNodeAtPosition(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function cloneContents(){var e,t;if(assertRangeValid(this),this.collapsed)return getRangeDocument(this).createDocumentFragment();if(this.startContainer===this.endContainer&&y(this.startContainer))return(e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(t=getRangeDocument(this).createDocumentFragment()).appendChild(e),t;var r=new RangeIterator(this,!0);return e=function cloneSubtree(e){for(var t,r,a,s=getRangeDocument(e.range).createDocumentFragment();r=e.next();){if(t=e.isPartiallySelectedSubtree(),r=r.cloneNode(!t),t&&(a=e.getSubtreeIterator(),r.appendChild(cloneSubtree(a)),a.detach()),10==r.nodeType)throw new l("HIERARCHY_REQUEST_ERR");s.appendChild(r)}return s}(r),r.detach(),e},canSurroundContents:function canSurroundContents(){assertRangeValid(this),assertNodeNotReadOnly(this.startContainer),assertNodeNotReadOnly(this.endContainer);var e=new RangeIterator(this,!0),t=e._first&&isNonTextPartiallySelected(e._first,this)||e._last&&isNonTextPartiallySelected(e._last,this);return e.detach(),!t},surroundContents:function surroundContents(e){if(assertValidNodeType(e,j),!this.canSurroundContents())throw new l("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);insertNodeAtPosition(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function cloneRange(){assertRangeValid(this);for(var e,t=new Range(getRangeDocument(this)),r=$.length;r--;)t[e=$[r]]=this[e];return t},toString:function toString(){assertRangeValid(this);var e=this.startContainer;if(e===this.endContainer&&y(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],r=new RangeIterator(this,!0);return iterateSubtree(r,(function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)})),r.detach(),t.join("")},compareNode:function compareNode(e){assertRangeValid(this);var t=e.parentNode,r=w(e);if(!t)throw new l("NOT_FOUND_ERR");var a=this.comparePoint(t,r),s=this.comparePoint(t,r+1);return a<0?s>0?2:0:s>0?1:3},comparePoint:function comparePoint(e,t){return assertRangeValid(this),assertNode(e,"HIERARCHY_REQUEST_ERR"),assertSameDocumentOrFragment(e,this.startContainer),T(e,t,this.startContainer,this.startOffset)<0?-1:T(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:K,toHtml:function toHtml(){return rangeToHtml(this)},intersectsNode:function intersectsNode(e,t){if(assertRangeValid(this),R(e)!=function getRangeRoot(e){return R(e.startContainer)}(this))return!1;var r=e.parentNode,a=w(e);if(!r)return!0;var s=T(r,a,this.endContainer,this.endOffset),l=T(r,a+1,this.startContainer,this.startOffset);return t?s<=0&&l>=0:s<0&&l>0},isPointInRange:function isPointInRange(e,t){return assertRangeValid(this),assertNode(e,"HIERARCHY_REQUEST_ERR"),assertSameDocumentOrFragment(e,this.startContainer),T(e,t,this.startContainer,this.startOffset)>=0&&T(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function intersectsRange(e){return rangesIntersect(this,e,!1)},intersectsOrTouchesRange:function intersectsOrTouchesRange(e){return rangesIntersect(this,e,!0)},intersection:function intersection(e){if(this.intersectsRange(e)){var t=T(this.startContainer,this.startOffset,e.startContainer,e.startOffset),r=T(this.endContainer,this.endOffset,e.endContainer,e.endOffset),a=this.cloneRange();return-1==t&&a.setStart(e.startContainer,e.startOffset),1==r&&a.setEnd(e.endContainer,e.endOffset),a}return null},union:function union(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==T(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==T(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new l("Ranges do not intersect")},containsNode:function containsNode(e,t){return t?this.intersectsNode(e,!1):3==this.compareNode(e)},containsNodeContents:function containsNodeContents(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,A(e))<=0},containsRange:function containsRange(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function containsNodeText(e){var t=this.cloneRange();t.selectNode(e);var r=t.getNodes([3]);if(r.length>0){t.setStart(r[0],0);var a=r.pop();return t.setEnd(a,a.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function getNodes(e,t){return assertRangeValid(this),function getNodesInRange(e,t,r){var a,s=!(!t||!t.length),l=!!r;s&&(a=new RegExp("^("+t.join("|")+")$"));var w=[];return iterateSubtree(new RangeIterator(e,!1),(function(t){if((!s||a.test(t.nodeType))&&(!l||r(t))){var E=e.startContainer;if(t!=E||!y(E)||e.startOffset!=E.length){var S=e.endContainer;t==S&&y(S)&&0==e.endOffset||w.push(t)}}})),w}(this,e,t)},getDocument:function getDocument(){return getRangeDocument(this)},collapseBefore:function collapseBefore(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function collapseAfter(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function getBookmark(t){var a=getRangeDocument(this),s=e.createRange(a);t=t||r.getBody(a),s.selectNodeContents(t);var l=this.intersection(s),y=0,w=0;return l&&(s.setEnd(l.startContainer,l.startOffset),w=(y=s.toString().length)+l.toString().length),{start:y,end:w,containerNode:t}},moveToBookmark:function moveToBookmark(e){var t=e.containerNode,r=0;this.setStart(t,0),this.collapse(!0);for(var a,s,l,y,w=[t],E=!1,S=!1;!S&&(a=w.pop());)if(3==a.nodeType)s=r+a.length,!E&&e.start>=r&&e.start<=s&&(this.setStart(a,e.start-r),E=!0),E&&e.end>=r&&e.end<=s&&(this.setEnd(a,e.end-r),S=!0),r=s;else for(l=(y=a.childNodes).length;l--;)w.push(y[l])},getName:function getName(){return"DomRange"},equals:function equals(e){return Range.rangesEqual(this,e)},isValid:function isValid(){return isRangeValid(this)},inspect:function inspect(){return _inspect(this)},detach:function detach(){}}),createPrototypeRange(Range,updateBoundaries),a.extend(Range,{rangeProperties:$,RangeIterator:RangeIterator,copyComparisonConstants:copyComparisonConstants,createPrototypeRange:createPrototypeRange,inspect:_inspect,toHtml:rangeToHtml,getRangeDocument:getRangeDocument,rangesEqual:function rangesEqual(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=Range})),L.createCoreModule("WrappedRange",["DomRange"],(function(e,t){var r,a,s=e.dom,l=e.util,y=s.DomPosition,w=e.DomRange,E=s.getBody,S=s.getContentDocument,T=s.isCharacterDataNode;if(e.features.implementsDomRange&&function(){var a,y,T=w.rangeProperties;function updateRangeProperties(e){for(var t,r=T.length;r--;)e[t=T[r]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}r=function WrappedRange(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,updateRangeProperties(this)},w.createPrototypeRange(r,(function updateNativeRange(e,t,r,a,s){var l=e.startContainer!==t||e.startOffset!=r,y=e.endContainer!==a||e.endOffset!=s,w=!e.equals(e.nativeRange);(l||y||w)&&(e.setEnd(a,s),e.setStart(t,r))})),(a=r.prototype).selectNode=function(e){this.nativeRange.selectNode(e),updateRangeProperties(this)},a.cloneContents=function(){return this.nativeRange.cloneContents()},a.surroundContents=function(e){this.nativeRange.surroundContents(e),updateRangeProperties(this)},a.collapse=function(e){this.nativeRange.collapse(e),updateRangeProperties(this)},a.cloneRange=function(){return new r(this.nativeRange.cloneRange())},a.refresh=function(){updateRangeProperties(this)},a.toString=function(){return this.nativeRange.toString()};var O=document.createTextNode("test");E(document).appendChild(O);var N=document.createRange();N.setStart(O,0),N.setEnd(O,0);try{N.setStart(O,1),a.setStart=function(e,t){this.nativeRange.setStart(e,t),updateRangeProperties(this)},a.setEnd=function(e,t){this.nativeRange.setEnd(e,t),updateRangeProperties(this)},y=function createBeforeAfterNodeSetter(e){return function(t){this.nativeRange[e](t),updateRangeProperties(this)}}}catch(e){a.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(r){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}updateRangeProperties(this)},a.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(r){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}updateRangeProperties(this)},y=function createBeforeAfterNodeSetter(e,t){return function(r){try{this.nativeRange[e](r)}catch(a){this.nativeRange[t](r),this.nativeRange[e](r)}updateRangeProperties(this)}}}a.setStartBefore=y("setStartBefore","setEndBefore"),a.setStartAfter=y("setStartAfter","setEndAfter"),a.setEndBefore=y("setEndBefore","setStartBefore"),a.setEndAfter=y("setEndAfter","setStartAfter"),a.selectNodeContents=function(e){this.setStartAndEnd(e,0,s.getNodeLength(e))},N.selectNodeContents(O),N.setEnd(O,3);var A=document.createRange();A.selectNodeContents(O),A.setEnd(O,4),A.setStart(O,2),-1==N.compareBoundaryPoints(N.START_TO_END,A)&&1==N.compareBoundaryPoints(N.END_TO_START,A)?a.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:a.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var L=document.createElement("div");L.innerHTML="123";var R=L.firstChild,D=E(document);D.appendChild(L),N.setStart(R,1),N.setEnd(R,2),N.deleteContents(),"13"==R.data&&(a.deleteContents=function(){this.nativeRange.deleteContents(),updateRangeProperties(this)},a.extractContents=function(){var e=this.nativeRange.extractContents();return updateRangeProperties(this),e}),D.removeChild(L),D=null,l.isHostMethod(N,"createContextualFragment")&&(a.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),E(document).removeChild(O),a.getName=function(){return"WrappedRange"},e.WrappedRange=r,e.createNativeRange=function(e){return(e=S(e,t,"createNativeRange")).createRange()}}(),e.features.implementsTextRange){var O=function getTextRangeBoundaryPosition(e,t,r,a,l){var w=e.duplicate();w.collapse(r);var E=w.parentElement();if(s.isOrIsAncestorOf(t,E)||(E=t),!E.canHaveHTML){var S=new y(E.parentNode,s.getNodeIndex(E));return{boundaryPosition:S,nodeInfo:{nodeIndex:S.offset,containerElement:S.node}}}var O=s.getDocument(E).createElement("span");O.parentNode&&s.removeNode(O);for(var N,A,L,R,D,M=r?"StartToStart":"StartToEnd",B=l&&l.containerElement==E?l.nodeIndex:0,q=E.childNodes.length,W=q,j=W;j==q?E.appendChild(O):E.insertBefore(O,E.childNodes[j]),w.moveToElementText(O),0!=(N=w.compareEndPoints(M,e))&&B!=W;){if(-1==N){if(W==B+1)break;B=j}else W=W==B+1?B:j;j=Math.floor((B+W)/2),E.removeChild(O)}if(D=O.nextSibling,-1==N&&D&&T(D)){var H;if(w.setEndPoint(r?"EndToStart":"EndToEnd",e),/[\r\n]/.test(D.data)){var V=w.duplicate(),z=V.text.replace(/\r\n/g,"\r").length;for(H=V.moveStart("character",z);-1==(N=V.compareEndPoints("StartToEnd",V));)H++,V.moveStart("character",1)}else H=w.text.length;R=new y(D,H)}else A=(a||!r)&&O.previousSibling,R=(L=(a||r)&&O.nextSibling)&&T(L)?new y(L,0):A&&T(A)?new y(A,A.data.length):new y(E,s.getNodeIndex(O));return s.removeNode(O),{boundaryPosition:R,nodeInfo:{nodeIndex:j,containerElement:E}}},N=function createBoundaryTextRange(e,t){var r,a,l,y,w=e.offset,S=s.getDocument(e.node),O=E(S).createTextRange(),N=T(e.node);return N?a=(r=e.node).parentNode:(r=w<(y=e.node.childNodes).length?y[w]:null,a=e.node),(l=S.createElement("span")).innerHTML="&#feff;",r?a.insertBefore(l,r):a.appendChild(l),O.moveToElementText(l),O.collapse(!t),a.removeChild(l),N&&O[t?"moveStart":"moveEnd"]("character",w),O};((a=function WrappedTextRange(e){this.textRange=e,this.refresh()}).prototype=new w(document)).refresh=function(){var e,t,r,a=function getTextRangeContainerElement(e){var t=e.parentElement(),r=e.duplicate();r.collapse(!0);var a=r.parentElement();(r=e.duplicate()).collapse(!1);var l=r.parentElement(),y=a==l?a:s.getCommonAncestor(a,l);return y==t?y:s.getCommonAncestor(t,y)}(this.textRange);!function textRangeIsCollapsed(e){return 0==e.compareEndPoints("StartToEnd",e)}(this.textRange)?(e=(r=O(this.textRange,a,!0,!1)).boundaryPosition,t=O(this.textRange,a,!1,!1,r.nodeInfo).boundaryPosition):t=e=O(this.textRange,a,!0,!0).boundaryPosition,this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},a.prototype.getName=function(){return"WrappedTextRange"},w.copyComparisonConstants(a);var A=function rangeToTextRange(e){if(e.collapsed)return N(new y(e.startContainer,e.startOffset),!0);var t=N(new y(e.startContainer,e.startOffset),!0),r=N(new y(e.endContainer,e.endOffset),!1),a=E(w.getRangeDocument(e)).createTextRange();return a.setEndPoint("StartToStart",t),a.setEndPoint("EndToEnd",r),a};if(a.rangeToTextRange=A,a.prototype.toTextRange=function(){return A(this)},e.WrappedTextRange=a,!e.features.implementsDomRange||e.config.preferTextRange){var L=Function("return this;")();void 0===L.Range&&(L.Range=a),e.createNativeRange=function(e){return e=S(e,t,"createNativeRange"),E(e).createTextRange()},e.WrappedRange=a}}e.createRange=function(r){return r=S(r,t,"createRange"),new e.WrappedRange(e.createNativeRange(r))},e.createRangyRange=function(e){return e=S(e,t,"createRangyRange"),new w(e)},l.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),l.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener((function(t){var r=t.document;void 0===r.createRange&&(r.createRange=function(){return e.createRange(r)}),r=t=null}))})),L.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],(function(e,t){e.config.checkSelectionRanges=!0;var r,a,s=e.dom,l=e.util,y=l.isHostMethod,w=e.DomRange,E=e.WrappedRange,S=e.DOMException,T=s.DomPosition,O=e.features,N=s.getDocument,A=s.getBody,L=w.rangesEqual;function isDirectionBackward(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function getWindow(e,r){if(e){if(s.isWindow(e))return e;if(e instanceof WrappedSelection)return e.win;var a=s.getContentDocument(e,t,r);return s.getWindow(a)}return window}function getDocSelection(e){return getWindow(e,"getDocSelection").document.selection}function winSelectionIsBackward(e){var t=!1;return e.anchorNode&&(t=1==s.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}var R=y(window,"getSelection"),D=l.isHostObject(document,"selection");O.implementsWinGetSelection=R,O.implementsDocSelection=D;var M=D&&(!R||e.config.preferTextRange);if(M)r=getDocSelection,e.isSelectionValid=function(e){var t=getWindow(e,"isSelectionValid").document,r=t.selection;return"None"!=r.type||N(r.createRange().parentElement())==t};else{if(!R)return t.fail("Neither document.selection or window.getSelection() detected."),!1;r=function getWinSelection(e){return getWindow(e,"getWinSelection").getSelection()},e.isSelectionValid=function(){return!0}}e.getNativeSelection=r;var B=r();if(!B)return t.fail("Native selection was null (possibly issue 138?)"),!1;var q=e.createNativeRange(document),W=A(document),j=l.areHostProperties(B,["anchorNode","focusNode","anchorOffset","focusOffset"]);O.selectionHasAnchorAndFocus=j;var H=y(B,"extend");O.selectionHasExtend=H;var V="number"==_typeof(B.rangeCount);O.selectionHasRangeCount=V;var z=!1,U=!0,G=H?function(t,r){var a=w.getRangeDocument(r),s=e.createRange(a);s.collapseToPoint(r.endContainer,r.endOffset),t.addRange(getNativeRange(s)),t.extend(r.startContainer,r.startOffset)}:null;l.areHostMethods(B,["addRange","getRangeAt","removeAllRanges"])&&"number"==_typeof(B.rangeCount)&&O.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var r=t.rangeCount,a=r>1,l=[],y=winSelectionIsBackward(t),w=0;w<r;++w)l[w]=t.getRangeAt(w);var E=s.createTestElement(document,"",!1),S=E.appendChild(document.createTextNode("   ")),T=document.createRange();if(T.setStart(S,1),T.collapse(!0),t.removeAllRanges(),t.addRange(T),U=1==t.rangeCount,t.removeAllRanges(),!a){var O=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(O&&parseInt(O[1])>=36)z=!1;else{var N=T.cloneRange();T.setStart(S,0),N.setEnd(S,3),N.setStart(S,2),t.addRange(T),t.addRange(N),z=2==t.rangeCount}}for(s.removeNode(E),t.removeAllRanges(),w=0;w<r;++w)0==w&&y?G?G(t,l[w]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(l[w])):t.addRange(l[w])}}(),O.selectionSupportsMultipleRanges=z,O.collapsedNonEditableSelectionsSupported=U;var K,$,Q=!1;function updateAnchorAndFocusFromRange(e,t,r){var a=r?"end":"start",s=r?"start":"end";e.anchorNode=t[a+"Container"],e.anchorOffset=t[a+"Offset"],e.focusNode=t[s+"Container"],e.focusOffset=t[s+"Offset"]}function updateEmptySelection(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function getNativeRange(t){var r;return t instanceof w?((r=e.createNativeRange(t.getDocument())).setEnd(t.endContainer,t.endOffset),r.setStart(t.startContainer,t.startOffset)):t instanceof E?r=t.nativeRange:O.implementsDomRange&&t instanceof s.getWindow(t.startContainer).Range&&(r=t),r}function getSingleElementFromRange(e){var r=e.getNodes();if(!function rangeContainsSingleElement(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,r=e.length;t<r;++t)if(!s.isAncestorOf(e[0],e[t]))return!1;return!0}(r))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return r[0]}function isTextRange(e){return!!e&&void 0!==e.text}function updateFromTextRange(e,t){var r=new E(t);e._ranges=[r],updateAnchorAndFocusFromRange(e,r,!1),e.rangeCount=1,e.isCollapsed=r.collapsed}function updateControlSelection(t){if(t._ranges.length=0,"None"==t.docSelection.type)updateEmptySelection(t);else{var r=t.docSelection.createRange();if(isTextRange(r))updateFromTextRange(t,r);else{t.rangeCount=r.length;for(var a,s=N(r.item(0)),l=0;l<t.rangeCount;++l)(a=e.createRange(s)).selectNode(r.item(l)),t._ranges.push(a);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,updateAnchorAndFocusFromRange(t,t._ranges[t.rangeCount-1],!1)}}}function addRangeToControlSelection(e,r){for(var a=e.docSelection.createRange(),s=getSingleElementFromRange(r),l=N(a.item(0)),y=A(l).createControlRange(),w=0,E=a.length;w<E;++w)y.add(a.item(w));try{y.add(s)}catch(e){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}y.select(),updateControlSelection(e)}function WrappedSelection(e,t,r){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=r,this.refresh()}function deleteProperties(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}W&&y(W,"createControlRange")&&(K=W.createControlRange(),l.areHostProperties(K,["item","add"])&&(Q=!0)),O.implementsControlRange=Q,a=j?function selectionIsCollapsed(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function selectionIsCollapsed(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},y(B,"getRangeAt")?$=function getSelectionRangeAt(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:j&&($=function getSelectionRangeAt(t){var r=N(t.anchorNode),a=e.createRange(r);return a.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),a.collapsed!==this.isCollapsed&&a.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),a}),WrappedSelection.prototype=e.selectionPrototype;var Y=[];function actOnCachedSelection(e,t){for(var r,a,s=Y.length;s--;)if(a=(r=Y[s]).selection,"deleteAll"==t)deleteProperties(a);else if(r.win==e)return"delete"==t?(Y.splice(s,1),!0):a;return"deleteAll"==t&&(Y.length=0),null}var X=function getSelection(e){if(e&&e instanceof WrappedSelection)return e.refresh(),e;var t=actOnCachedSelection(e=getWindow(e,"getNativeSelection")),a=r(e),s=D?getDocSelection(e):null;return t?(t.nativeSelection=a,t.docSelection=s,t.refresh()):(t=new WrappedSelection(a,s,e),Y.push({win:e,selection:t})),t};e.getSelection=X,l.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var Z,J=WrappedSelection.prototype;function createControlSelection(e,r){for(var a,s=N(r[0].startContainer),l=A(s).createControlRange(),y=0,w=r.length;y<w;++y){a=getSingleElementFromRange(r[y]);try{l.add(a)}catch(e){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}l.select(),updateControlSelection(e)}if(!M&&j&&l.areHostMethods(B,["removeAllRanges","addRange"])){J.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),updateEmptySelection(this)};var ee=function addRangeBackward(e,t){G(e.nativeSelection,t),e.refresh()};J.addRange=V?function(t,r){if(Q&&D&&"Control"==this.docSelection.type)addRangeToControlSelection(this,t);else if(isDirectionBackward(r)&&H)ee(this,t);else{var s;z?s=this.rangeCount:(this.removeAllRanges(),s=0);var l=getNativeRange(t).cloneRange();try{this.nativeSelection.addRange(l)}catch(e){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==s+1){if(e.config.checkSelectionRanges){var y=$(this.nativeSelection,this.rangeCount-1);y&&!L(y,t)&&(t=new E(y))}this._ranges[this.rangeCount-1]=t,updateAnchorAndFocusFromRange(this,t,te(this.nativeSelection)),this.isCollapsed=a(this)}else this.refresh()}}:function(e,t){isDirectionBackward(t)&&H?ee(this,e):(this.nativeSelection.addRange(getNativeRange(e)),this.refresh())},J.setRanges=function(e){if(Q&&D&&e.length>1)createControlSelection(this,e);else{this.removeAllRanges();for(var t=0,r=e.length;t<r;++t)this.addRange(e[t])}}}else{if(!(y(B,"empty")&&y(q,"select")&&Q&&M))return t.fail("No means of selecting a Range or TextRange was found"),!1;J.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=N(this.anchorNode);else if("Control"==this.docSelection.type){var t=this.docSelection.createRange();t.length&&(e=N(t.item(0)))}if(e)A(e).createTextRange().select(),this.docSelection.empty()}}catch(e){}updateEmptySelection(this)},J.addRange=function(t){"Control"==this.docSelection.type?addRangeToControlSelection(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,updateAnchorAndFocusFromRange(this,t,!1))},J.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?createControlSelection(this,e):t&&this.addRange(e[0])}}if(J.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new S("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},M)Z=function refreshSelection(t){var r;e.isSelectionValid(t.win)?r=t.docSelection.createRange():(r=A(t.win.document).createTextRange()).collapse(!0),"Control"==t.docSelection.type?updateControlSelection(t):isTextRange(r)?updateFromTextRange(t,r):updateEmptySelection(t)};else if(y(B,"getRangeAt")&&"number"==_typeof(B.rangeCount))Z=function refreshSelection(t){if(Q&&D&&"Control"==t.docSelection.type)updateControlSelection(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var r=0,s=t.rangeCount;r<s;++r)t._ranges[r]=new e.WrappedRange(t.nativeSelection.getRangeAt(r));updateAnchorAndFocusFromRange(t,t._ranges[t.rangeCount-1],te(t.nativeSelection)),t.isCollapsed=a(t)}else updateEmptySelection(t)};else{if(!j||"boolean"!=_typeof(B.isCollapsed)||"boolean"!=_typeof(q.collapsed)||!O.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;Z=function refreshSelection(e){var t,r=e.nativeSelection;r.anchorNode?(t=$(r,0),e._ranges=[t],e.rangeCount=1,function updateAnchorAndFocusFromNativeSelection(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}(e),e.isCollapsed=a(e)):updateEmptySelection(e)}}J.refresh=function(e){var t=e?this._ranges.slice(0):null,r=this.anchorNode,a=this.anchorOffset;if(Z(this),e){var s=t.length;if(s!=this._ranges.length)return!0;if(this.anchorNode!=r||this.anchorOffset!=a)return!0;for(;s--;)if(!L(t[s],this._ranges[s]))return!0;return!1}};var te,ne=function removeRangeManually(e,t){var r=e.getAllRanges();e.removeAllRanges();for(var a=0,s=r.length;a<s;++a)L(t,r[a])||e.addRange(r[a]);e.rangeCount||updateEmptySelection(e)};function assertNodeInSameDocument(e,t){if(e.win.document!=N(t))throw new S("WRONG_DOCUMENT_ERR")}function createStartOrEndSetter(t){return function(r,a){var s;this.rangeCount?(s=this.getRangeAt(0))["set"+(t?"Start":"End")](r,a):(s=e.createRange(this.win.document)).setStartAndEnd(r,a),this.setSingleRange(s,this.isBackward())}}function inspect(e){var t=[],r=new T(e.anchorNode,e.anchorOffset),a=new T(e.focusNode,e.focusOffset),s="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var l=0,y=e.rangeCount;l<y;++l)t[l]=w.inspect(e.getRangeAt(l));return"["+s+"(Ranges: "+t.join(", ")+")(anchor: "+r.inspect()+", focus: "+a.inspect()+"]"}J.removeRange=Q&&D?function(e){if("Control"==this.docSelection.type){for(var t=this.docSelection.createRange(),r=getSingleElementFromRange(e),a=N(t.item(0)),s=A(a).createControlRange(),l=!1,y=0,w=t.length;y<w;++y)t.item(y)!==r||l?s.add(t.item(y)):l=!0;s.select(),updateControlSelection(this)}else ne(this,e)}:function(e){ne(this,e)},!M&&j&&O.implementsDomRange?(te=winSelectionIsBackward,J.isBackward=function(){return te(this)}):te=J.isBackward=function(){return!1},J.isBackwards=J.isBackward,J.toString=function(){for(var e=[],t=0,r=this.rangeCount;t<r;++t)e[t]=""+this._ranges[t];return e.join("")},J.collapse=function(t,r){assertNodeInSameDocument(this,t);var a=e.createRange(t);a.collapseToPoint(t,r),this.setSingleRange(a),this.isCollapsed=!0},J.collapseToStart=function(){if(!this.rangeCount)throw new S("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},J.collapseToEnd=function(){if(!this.rangeCount)throw new S("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},J.selectAllChildren=function(t){assertNodeInSameDocument(this,t);var r=e.createRange(t);r.selectNodeContents(t),this.setSingleRange(r)},J.deleteFromDocument=function(){if(Q&&D&&"Control"==this.docSelection.type){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),s.removeNode(e);this.refresh()}else if(this.rangeCount){var r=this.getAllRanges();if(r.length){this.removeAllRanges();for(var a=0,l=r.length;a<l;++a)r[a].deleteContents();this.addRange(r[l-1])}}},J.eachRange=function(e,t){for(var r=0,a=this._ranges.length;r<a;++r)if(e(this.getRangeAt(r)))return t},J.getAllRanges=function(){var e=[];return this.eachRange((function(t){e.push(t)})),e},J.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},J.callMethodOnEachRange=function(e,t){var r=[];return this.eachRange((function(a){r.push(a[e].apply(a,t||[]))})),r},J.setStart=createStartOrEndSetter(!0),J.setEnd=createStartOrEndSetter(!1),e.rangePrototype.select=function(e){X(this.getDocument()).setSingleRange(this,e)},J.changeEachRange=function(e){var t=[],r=this.isBackward();this.eachRange((function(r){e(r),t.push(r)})),this.removeAllRanges(),r&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},J.containsNode=function(e,t){return this.eachRange((function(r){return r.containsNode(e,t)}),!0)||!1},J.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},J.moveToBookmark=function(t){for(var r,a,s=[],l=0;r=t.rangeBookmarks[l++];)(a=e.createRange(this.win)).moveToBookmark(r),s.push(a);t.backward?this.setSingleRange(s[0],"backward"):this.setRanges(s)},J.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},J.restoreRanges=function(e){this.removeAllRanges();for(var t,r=0;t=e.ranges[r];++r)this.addRange(t,e.backward&&0==r)},J.toHtml=function(){var e=[];return this.eachRange((function(t){e.push(w.toHtml(t))})),e.join("")},O.implementsTextRange&&(J.getNativeTextRange=function(){var r;if(r=this.docSelection){var a=r.createRange();if(isTextRange(a))return a;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),J.getName=function(){return"WrappedSelection"},J.inspect=function(){return inspect(this)},J.detach=function(){actOnCachedSelection(this.win,"delete"),deleteProperties(this)},WrappedSelection.detachAll=function(){actOnCachedSelection(null,"deleteAll")},WrappedSelection.inspect=inspect,WrappedSelection.isDirectionBackward=isDirectionBackward,e.Selection=WrappedSelection,e.selectionPrototype=J,e.addShimListener((function(e){void 0===e.getSelection&&(e.getSelection=function(){return X(e)}),e=null}))}));var M=!1,B=function loadHandler(e){M||(M=!0,!L.initialized&&L.config.autoInitialize&&init())};N&&("complete"==document.readyState?B():(isHostMethod(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",B,!1),S(window,"load",B))),r=L}(),r.createModule("SaveRestore",["WrappedRange"],(function(e,t){var r=e.dom,a=r.removeNode,s=e.Selection.isDirectionBackward;function gEBI(e,t){return(t||document).getElementById(e)}function insertRangeBoundaryMarker(e,t){var a,s="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),l=r.getDocument(e.startContainer),y=e.cloneRange();return y.collapse(t),(a=l.createElement("span")).id=s,a.style.lineHeight="0",a.style.display="none",a.className="rangySelectionBoundary",a.appendChild(l.createTextNode("\ufeff")),y.insertNode(a),a}function setRangeBoundary(e,r,s,l){var y=gEBI(s,e);y?(r[l?"setStartBefore":"setEndBefore"](y),a(y)):t.warn("Marker element has been removed. Cannot restore selection.")}function compareRanges(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function saveRange(t,r){var a,l=e.DomRange.getRangeDocument(t),y=t.toString(),w=s(r);return t.collapsed?{document:l,markerId:(a=insertRangeBoundaryMarker(t,!1)).id,collapsed:!0}:(a=insertRangeBoundaryMarker(t,!1),{document:l,startMarkerId:insertRangeBoundaryMarker(t,!0).id,endMarkerId:a.id,collapsed:!1,backward:w,toString:function toString(){return"original text: '"+y+"', new text: '"+t.toString()+"'"}})}function restoreRange(r,s){var l=r.document;void 0===s&&(s=!0);var y=e.createRange(l);if(r.collapsed){var w=gEBI(r.markerId,l);if(w){w.style.display="inline";var E=w.previousSibling;E&&3==E.nodeType?(a(w),y.collapseToPoint(E,E.length)):(y.collapseBefore(w),a(w))}else t.warn("Marker element has been removed. Cannot restore selection.")}else setRangeBoundary(l,y,r.startMarkerId,!0),setRangeBoundary(l,y,r.endMarkerId,!1);return s&&y.normalizeBoundaries(),y}function saveRanges(t,r){var a,l,y=[],w=s(r);(t=t.slice(0)).sort(compareRanges);for(var E=0,S=t.length;E<S;++E)y[E]=saveRange(t[E],w);for(E=S-1;E>=0;--E)a=t[E],l=e.DomRange.getRangeDocument(a),a.collapsed?a.collapseAfter(gEBI(y[E].markerId,l)):(a.setEndBefore(gEBI(y[E].endMarkerId,l)),a.setStartAfter(gEBI(y[E].startMarkerId,l)));return y}function restoreRanges(e){for(var t=[],r=e.length-1;r>=0;r--)t[r]=restoreRange(e[r],!0);return t}function removeMarkerElement(e,t){var r=gEBI(t,e);r&&a(r)}e.util.extend(e,{saveRange:saveRange,restoreRange:restoreRange,saveRanges:saveRanges,restoreRanges:restoreRanges,saveSelection:function saveSelection(r){if(!e.isSelectionValid(r))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var a=e.getSelection(r),s=a.getAllRanges(),l=1==s.length&&a.isBackward(),y=saveRanges(s,l);return l?a.setSingleRange(s[0],l):a.setRanges(s),{win:r,rangeInfos:y,restored:!1}},restoreSelection:function restoreSelection(t,r){if(!t.restored){var a=t.rangeInfos,s=e.getSelection(t.win),l=restoreRanges(a);1==a.length&&r&&e.features.selectionHasExtend&&a[0].backward?(s.removeAllRanges(),s.addRange(l[0],!0)):s.setRanges(l),t.restored=!0}},removeMarkerElement:removeMarkerElement,removeMarkers:function removeMarkers(e){for(var t,r=e.rangeInfos,a=0,s=r.length;a<s;++a)(t=r[a]).collapsed?removeMarkerElement(e.doc,t.markerId):(removeMarkerElement(e.doc,t.startMarkerId),removeMarkerElement(e.doc,t.endMarkerId))}})})),r.createModule("TextRange",["WrappedSelection"],(function(e,t){var r,a,s,l=e.dom,y=e.util,w=y.extend,E=y.createOptions,S=l.getBody,T=/^[ \t\f\r\n]+$/,O=/^[ \t\f\r]+$/,N=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,A=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,L=e.Selection.isDirectionBackward,R=!1,D=!1;function convertCharRangeToToken(e,t){for(var r=e.slice(t.start,t.end),a={isWord:t.isWord,chars:r,toString:function toString(){return r.join("")}},s=0,l=r.length;s<l;++s)r[s].token=a;return a}function tokenize(e,t,r){for(var a,s=r(e,t),l=[],y=0;a=s[y++];)l.push(convertCharRangeToToken(e,a));return l}r=l.createTestElement(document,"<p>1 </p><p></p>",!0),a=r.firstChild,(s=e.getSelection()).collapse(a.lastChild,2),s.setStart(a.firstChild,0),r.innerHTML="1 <br />",s.collapse(r,2),s.setStart(r.firstChild,0),R=1==(""+s).length,r.innerHTML="1 <p>1</p>",s.collapse(r,2),s.setStart(r.firstChild,0),D=1==(""+s).length,l.removeNode(r),s.removeAllRanges();var M={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""};var B={includeBlockContentTrailingSpace:!1,includeSpaceBeforeBr:!R,includeSpaceBeforeBlock:!D,includePreLineTrailingSpace:!0},q={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:function defaultTokenizer(e,t){var r,a=e.join(""),s=[];function createTokenRange(e,t,r){s.push({start:e,end:t,isWord:r})}for(var l,y,w=0;r=t.wordRegex.exec(a);){if(y=(l=r.index)+r[0].length,l>w&&createTokenRange(w,l,!1),t.includeTrailingSpace)for(;A.test(e[y]);)++y;createTokenRange(l,y,!0),w=y}return w<e.length&&createTokenRange(w,e.length,!1),s}}},W={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},j={wordOptions:null,characterOptions:null},H={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},V={wordOptions:null,characterOptions:null,direction:"forward"};function createNestedOptions(e,t){var r=E(e,t);return t.hasOwnProperty("wordOptions")&&(r.wordOptions=function createWordOptions(e){var t,r;return e?(t=e.language||"en",w(r={},q[t]||q.en),w(r,e),r):q.en}(r.wordOptions)),t.hasOwnProperty("characterOptions")&&(r.characterOptions=E(r.characterOptions,M)),r}var z,U,G,K=l.getComputedStyleProperty;U=document.createElement("table"),(G=S(document)).appendChild(U),z="block"==K(U,"display"),G.removeChild(U);var $={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};function getComputedDisplay(e,t){var r=K(e,"display",t),a=e.tagName.toLowerCase();return"block"==r&&z&&$.hasOwnProperty(a)?$[a]:r}function isHidden(e){for(var t=function getAncestorsAndSelf(e){return function getAncestors(e){var t=[];for(;e.parentNode;)t.unshift(e.parentNode),e=e.parentNode;return t}(e).concat([e])}(e),r=0,a=t.length;r<a;++r)if(1==t[r].nodeType&&"none"==getComputedDisplay(t[r]))return!0;return!1}function nextNode(e,t){return!t&&e.hasChildNodes()?e.firstChild:function nextNodeDescendants(e){for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null}(e)}function previousNode(e){var t=e.previousSibling;if(t){for(e=t;e.hasChildNodes();)e=e.lastChild;return e}var r=e.parentNode;return r&&1==r.nodeType?r:null}function isWhitespaceNode(e){if(!e||3!=e.nodeType)return!1;var t=e.data;if(""===t)return!0;var r=e.parentNode;if(!r||1!=r.nodeType)return!1;var a=K(e.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(t)&&/^(normal|nowrap)$/.test(a)||/^[\t\r ]+$/.test(t)&&"pre-line"==a}function isCollapsedWhitespaceNode(e){return""===e.data||!!isWhitespaceNode(e)&&(!e.parentNode||!!isHidden(e))}function isCollapsedNode(e){var t=e.nodeType;return 7==t||8==t||isHidden(e)||/^(script|style)$/i.test(e.nodeName)||function isVisibilityHiddenTextNode(e){var t;return 3==e.nodeType&&(t=e.parentNode)&&"hidden"==K(t,"visibility")}(e)||isCollapsedWhitespaceNode(e)}function isIgnoredNode(e,t){var r=e.nodeType;return 7==r||8==r||1==r&&"none"==getComputedDisplay(e,t)}function Cache(){this.store={}}Cache.prototype={get:function get(e){return this.store.hasOwnProperty(e)?this.store[e]:null},set:function set(e,t){return this.store[e]=t}};function createCachingGetter(e,t,r){return function(a){var s=this.cache;if(s.hasOwnProperty(e))return s[e];0;var l=t.call(this,r?this[r]:this,a);return s[e]=l,l}}function NodeWrapper(e,t){this.node=e,this.session=t,this.cache=new Cache,this.positions=new Cache}var Q={getPosition:function getPosition(e){var t=this.positions;return t.get(e)||t.set(e,new Position(this,e))},toString:function toString(){return"[NodeWrapper("+l.inspectNode(this.node)+")]"}};NodeWrapper.prototype=Q;function Position(e,t){this.offset=t,this.nodeWrapper=e,this.node=e.node,this.session=e.session,this.cache=new Cache}w(Q,{isCharacterDataNode:createCachingGetter("isCharacterDataNode",l.isCharacterDataNode,"node"),getNodeIndex:createCachingGetter("nodeIndex",l.getNodeIndex,"node"),getLength:createCachingGetter("nodeLength",l.getNodeLength,"node"),containsPositions:createCachingGetter("containsPositions",(function containsPositions(e){return l.isCharacterDataNode(e)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(e.nodeName)}),"node"),isWhitespace:createCachingGetter("isWhitespace",isWhitespaceNode,"node"),isCollapsedWhitespace:createCachingGetter("isCollapsedWhitespace",isCollapsedWhitespaceNode,"node"),getComputedDisplay:createCachingGetter("computedDisplay",getComputedDisplay,"node"),isCollapsed:createCachingGetter("collapsed",isCollapsedNode,"node"),isIgnored:createCachingGetter("ignored",isIgnoredNode,"node"),next:createCachingGetter("nextPos",nextNode,"node"),previous:createCachingGetter("previous",previousNode,"node"),getTextNodeInfo:createCachingGetter("textNodeInfo",(function(e){var t=null,r=!1,a=K(e.parentNode,"whiteSpace"),s="pre-line"==a;return s?(t=O,r=!0):"normal"!=a&&"nowrap"!=a||(t=T,r=!0),{node:e,text:e.data,spaceRegex:t,collapseSpaces:r,preLine:s}}),"node"),hasInnerText:createCachingGetter("hasInnerText",(function(e,t){for(var r=this.session,a=r.getPosition(e.parentNode,this.getNodeIndex()+1),s=r.getPosition(e,0),l=t?a:s,y=t?s:a;l!==y;){if(l.prepopulateChar(),l.isDefinitelyNonEmpty())return!0;l=t?l.previousVisible():l.nextVisible()}return!1}),"node"),isRenderedBlock:createCachingGetter("isRenderedBlock",(function(e){for(var t=e.getElementsByTagName("br"),r=0,a=t.length;r<a;++r)if(!isCollapsedNode(t[r]))return!0;return this.hasInnerText()}),"node"),getTrailingSpace:createCachingGetter("trailingSpace",(function(e){if("br"==e.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var t=e.lastChild;t;){if(!isIgnoredNode(t))return 1==t.nodeType?this.session.getNodeWrapper(t).getTrailingSpace():"";t=t.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"\t";default:return this.isRenderedBlock(!0)?"\n":""}return""}),"node"),getLeadingSpace:createCachingGetter("leadingSpace",(function(e){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""}),"node")});var Y={character:"",characterType:"EMPTY",isBr:!1,prepopulateChar:function prepopulateChar(){var e=this;if(!e.prepopulatedChar){var t=e.node,r=e.offset,a="",s="EMPTY",l=!1;if(r>0)if(3==t.nodeType){var y=t.data,w=y.charAt(r-1),E=e.nodeWrapper.getTextNodeInfo(),S=E.spaceRegex;E.collapseSpaces?S.test(w)?r>1&&S.test(y.charAt(r-2))||(E.preLine&&"\n"===y.charAt(r)?(a=" ",s="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK"):(a=" ",s="COLLAPSIBLE_SPACE")):(a=w,s="NON_SPACE",l=!0):(a=w,s="UNCOLLAPSIBLE_SPACE",l=!0)}else{var T=t.childNodes[r-1];if(T&&1==T.nodeType&&!isCollapsedNode(T)&&("br"==T.tagName.toLowerCase()?(a="\n",e.isBr=!0,s="COLLAPSIBLE_SPACE",l=!1):e.checkForTrailingSpace=!0),!a){var O=t.childNodes[r];O&&1==O.nodeType&&!isCollapsedNode(O)&&(e.checkForLeadingSpace=!0)}}e.prepopulatedChar=!0,e.character=a,e.characterType=s,e.isCharInvariant=l}},isDefinitelyNonEmpty:function isDefinitelyNonEmpty(){var e=this.characterType;return"NON_SPACE"==e||"UNCOLLAPSIBLE_SPACE"==e},resolveLeadingAndTrailingSpaces:function resolveLeadingAndTrailingSpaces(){if(this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace){var e=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();e&&(this.isTrailingSpace=!0,this.character=e,this.characterType="COLLAPSIBLE_SPACE"),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var t=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();t&&(this.isLeadingSpace=!0,this.character=t,this.characterType="COLLAPSIBLE_SPACE"),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function getPrecedingUncollapsedPosition(e){for(var t=this;t=t.previousVisible();)if(""!==t.getCharacter(e))return t;return null},getCharacter:function getCharacter(e){this.resolveLeadingAndTrailingSpaces();var t=this.character,r=function normalizeIgnoredCharacters(e){var t=e||"",r="string"==typeof t?t.split(""):t;return r.sort((function(e,t){return e.charCodeAt(0)-t.charCodeAt(0)})),r.join("").replace(/(.)\1+/g,"$1")}(e.ignoreCharacters),a=""!==t&&r.indexOf(t)>-1;if(this.isCharInvariant)return a?"":t;var s=["character",e.includeSpaceBeforeBr,e.includeBlockContentTrailingSpace,e.includePreLineTrailingSpace,r].join("_"),l=this.cache.get(s);if(null!==l)return l;var y,w,E="",S="COLLAPSIBLE_SPACE"==this.characterType,T=!1,O=this;function getPreviousPos(){return T||(w=O.getPrecedingUncollapsedPosition(e),T=!0),w}return S&&("INCLUDED_TRAILING_LINE_BREAK_AFTER_BR"==this.type?E="\n":" "==t&&(!getPreviousPos()||w.isTrailingSpace||"\n"==w.character||" "==w.character&&"COLLAPSIBLE_SPACE"==w.characterType)||("\n"==t&&this.isLeadingSpace?getPreviousPos()&&"\n"!=w.character&&(E="\n"):(y=this.nextUncollapsed())&&(y.isBr?this.type="TRAILING_SPACE_BEFORE_BR":y.isTrailingSpace&&"\n"==y.character?this.type="TRAILING_SPACE_IN_BLOCK":y.isLeadingSpace&&"\n"==y.character&&(this.type="TRAILING_SPACE_BEFORE_BLOCK"),"\n"==y.character?("TRAILING_SPACE_BEFORE_BR"!=this.type||e.includeSpaceBeforeBr)&&("TRAILING_SPACE_BEFORE_BLOCK"!=this.type||e.includeSpaceBeforeBlock)&&("TRAILING_SPACE_IN_BLOCK"==this.type&&y.isTrailingSpace&&!e.includeBlockContentTrailingSpace||("PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK"!=this.type||"NON_SPACE"!=y.type||e.includePreLineTrailingSpace)&&("\n"==t?y.isTrailingSpace?this.isTrailingSpace||this.isBr&&(y.type="TRAILING_LINE_BREAK_AFTER_BR",getPreviousPos()&&w.isLeadingSpace&&!w.isTrailingSpace&&"\n"==w.character?y.character="":y.type="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR"):E="\n":" "==t&&(E=" "))):E=t))),r.indexOf(E)>-1&&(E=""),this.cache.set(s,E),E},equals:function equals(e){return!!e&&this.node===e.node&&this.offset===e.offset},inspect:function inspectPosition(){return"[Position("+l.inspectNode(this.node)+":"+this.offset+")]"},toString:function toString(){return this.character}};Position.prototype=Y,w(Y,{next:createCachingGetter("nextPos",(function(e){var t,r,a,s=e.nodeWrapper,l=e.node,y=e.offset,w=s.session;return l?(y==s.getLength()?r=(t=l.parentNode)?s.getNodeIndex()+1:0:s.isCharacterDataNode()?(t=l,r=y+1):(a=l.childNodes[y],w.getNodeWrapper(a).containsPositions()?(t=a,r=0):(t=l,r=y+1)),t?w.getPosition(t,r):null):null})),previous:createCachingGetter("previous",(function(e){var t,r,a,s=e.nodeWrapper,y=e.node,w=e.offset,E=s.session;return 0==w?r=(t=y.parentNode)?s.getNodeIndex():0:s.isCharacterDataNode()?(t=y,r=w-1):(a=y.childNodes[w-1],E.getNodeWrapper(a).containsPositions()?(t=a,r=l.getNodeLength(a)):(t=y,r=w-1)),t?E.getPosition(t,r):null})),nextVisible:createCachingGetter("nextVisible",(function(e){var t=e.next();if(!t)return null;var r=t.nodeWrapper,a=t.node,s=t;return r.isCollapsed()&&(s=r.session.getPosition(a.parentNode,r.getNodeIndex()+1)),s})),nextUncollapsed:createCachingGetter("nextUncollapsed",(function(e){for(var t=e;t=t.nextVisible();)if(t.resolveLeadingAndTrailingSpaces(),""!==t.character)return t;return null})),previousVisible:createCachingGetter("previousVisible",(function(e){var t=e.previous();if(!t)return null;var r=t.nodeWrapper,a=t.node,s=t;return r.isCollapsed()&&(s=r.session.getPosition(a.parentNode,r.getNodeIndex())),s}))});var X=null,Z=function(){function createWrapperCache(e){var t=new Cache;return{get:function get(r){var a=t.get(r[e]);if(a)for(var s,l=0;s=a[l++];)if(s.node===r)return s;return null},set:function set(r){var a=r.node[e];(t.get(a)||t.set(a,[])).push(r)}}}var e=y.isHostProperty(document.documentElement,"uniqueID");function Session(){this.initCaches()}return Session.prototype={initCaches:function initCaches(){var t;this.elementCache=e?(t=new Cache,{get:function get(e){return t.get(e.uniqueID)},set:function set(e){t.set(e.node.uniqueID,e)}}):createWrapperCache("tagName"),this.textNodeCache=createWrapperCache("data"),this.otherNodeCache=createWrapperCache("nodeName")},getNodeWrapper:function getNodeWrapper(e){var t;switch(e.nodeType){case 1:t=this.elementCache;break;case 3:t=this.textNodeCache;break;default:t=this.otherNodeCache}var r=t.get(e);return r||(r=new NodeWrapper(e,this),t.set(r)),r},getPosition:function getPosition(e,t){return this.getNodeWrapper(e).getPosition(t)},getRangeBoundaryPosition:function getRangeBoundaryPosition(e,t){var r=t?"start":"end";return this.getPosition(e[r+"Container"],e[r+"Offset"])},detach:function detach(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},Session}();function getSession(){return X||function startSession(){return endSession(),X=new Z}()}function endSession(){X&&X.detach(),X=null}function createCharacterIterator(e,r,a,s){a&&(r?isCollapsedNode(a.node)&&(a=e.previousVisible()):isCollapsedNode(a.node)&&(a=a.nextVisible()));var l=e,y=!1;function _next(){var e=null;return r?(e=l,y||(l=l.previousVisible(),y=!l||a&&l.equals(a))):y||(e=l=l.nextVisible(),y=!l||a&&l.equals(a)),y&&(l=null),e}var w,E=!1;return{next:function next(){if(E)return E=!1,w;for(var e;e=_next();)if(e.getCharacter(s))return w=e,e;return null},rewind:function rewind(){if(!w)throw t.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");E=!0},dispose:function dispose(){e=a=null}}}w(l,{nextNode:nextNode,previousNode:previousNode});var J=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=0,a=e.length;r<a;++r)if(e[r]===t)return r;return-1};function createTokenizedTextProvider(e,t,r){var a=createCharacterIterator(e,!1,null,t),s=createCharacterIterator(e,!0,null,t),l=r.tokenizer;function consumeWord(e){for(var t,r,l=[],y=e?a:s,w=!1,E=!1;t=y.next();){if(r=t.character,N.test(r))E&&(E=!1,w=!0);else{if(w){y.rewind();break}E=!0}l.push(t)}return l}var y=consumeWord(!0),w=consumeWord(!1).reverse(),E=tokenize(w.concat(y),r,l),S=y.length?E.slice(J(E,y[0].token)):[],T=w.length?E.slice(0,J(E,w.pop().token)+1):[];return{nextEndToken:function nextEndToken(){for(var e,t;1==S.length&&!(e=S[0]).isWord&&(t=consumeWord(!0)).length>0;)S=tokenize(e.chars.concat(t),r,l);return S.shift()},previousStartToken:function previousStartToken(){for(var e,t;1==T.length&&!(e=T[0]).isWord&&(t=consumeWord(!1)).length>0;)T=tokenize(t.reverse().concat(e.chars),r,l);return T.pop()},dispose:function dispose(){a.dispose(),s.dispose(),S=T=null}}}function createRangeCharacterIterator(e,t,r,a){var s=e.getRangeBoundaryPosition(t,!0),l=e.getRangeBoundaryPosition(t,!1);return createCharacterIterator(a?l:s,!!a,a?s:l,r)}function findTextFromPosition(t,r,a,s,l){var y,w,E,S,T,O,N=L(l.direction),A=createCharacterIterator(t,N,t.session.getRangeBoundaryPosition(s,N),l.characterOptions),R="",D=[],M=null;function handleMatch(t,r){var a=D[t].previousVisible(),s=D[r-1];return{startPos:a,endPos:s,valid:!l.wholeWordsOnly||function isWholeWord(t,r,a){var s=e.createRange(t.node);return s.setStartAndEnd(t.node,t.offset,r.node,r.offset),!s.expand("word",{wordOptions:a})}(a,s,l.wordOptions)}}for(;y=A.next();)if(w=y.character,a||l.caseSensitive||(w=w.toLowerCase()),N?(D.unshift(y),R=w+R):(D.push(y),R+=w),a){if(T=r.exec(R))if(S=(E=T.index)+T[0].length,O){if(!N&&S<R.length||N&&E>0){M=handleMatch(E,S);break}}else O=!0}else if(-1!=(E=R.indexOf(r))){M=handleMatch(E,E+r.length);break}return O&&(M=handleMatch(E,S)),A.dispose(),M}function createEntryPointFunction(e){return function(){var t=!!X,r=getSession(),a=[r].concat(y.toArray(arguments)),s=e.apply(this,a);return t||endSession(),s}}function createRangeBoundaryMover(e,t){return createEntryPointFunction((function(r,a,s,l){"undefined"==_typeof(s)&&(s=a,a="character"),l=createNestedOptions(l,j);var y=e;t&&(y=s>=0,this.collapse(!y));var w=function movePositionBy(e,t,r,a,s){var l,y,w,E,S=0,T=e,O=Math.abs(r);if(0!==r){var N=r<0;switch(t){case"character":for(y=createCharacterIterator(e,N,null,a);(l=y.next())&&S<O;)++S,T=l;w=l,y.dispose();break;case"word":for(var A=createTokenizedTextProvider(e,a,s),L=N?A.previousStartToken:A.nextEndToken;(E=L())&&S<O;)E.isWord&&(++S,T=N?E.chars[0]:E.chars[E.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+t+"' not implemented")}N?(T=T.previousVisible(),S=-S):T&&T.isLeadingSpace&&!T.isTrailingSpace&&("word"==t&&(w=(y=createCharacterIterator(e,!1,null,a)).next(),y.dispose()),w&&(T=w.previousVisible()))}return{position:T,unitsMoved:S}}(r.getRangeBoundaryPosition(this,y),a,s,l.characterOptions,l.wordOptions),E=w.position;return this[y?"setStart":"setEnd"](E.node,E.offset),w.unitsMoved}))}function createRangeTrimmer(e){return createEntryPointFunction((function(t,r){for(var a,s=createRangeCharacterIterator(t,this,r=E(r,M),!e),l=0;(a=s.next())&&N.test(a.character);)++l;s.dispose();var y=l>0;return y&&this[e?"moveStart":"moveEnd"]("character",e?l:-l,{characterOptions:r}),y}))}function createSelectionTrimmer(e){return createEntryPointFunction((function(t,r){var a=!1;return this.changeEachRange((function(t){a=t[e](r)||a})),a}))}w(e.rangePrototype,{moveStart:createRangeBoundaryMover(!0,!1),moveEnd:createRangeBoundaryMover(!1,!1),move:createRangeBoundaryMover(!0,!0),trimStart:createRangeTrimmer(!0),trimEnd:createRangeTrimmer(!1),trim:createEntryPointFunction((function(e,t){var r=this.trimStart(t),a=this.trimEnd(t);return r||a})),expand:createEntryPointFunction((function(e,t,r){var a=!1,s=(r=createNestedOptions(r,H)).characterOptions;if(t||(t="character"),"word"==t){var l,y,w=r.wordOptions,E=e.getRangeBoundaryPosition(this,!0),S=e.getRangeBoundaryPosition(this,!1),T=createTokenizedTextProvider(E,s,w).nextEndToken(),O=T.chars[0].previousVisible();if(this.collapsed)l=T;else l=createTokenizedTextProvider(S,s,w).previousStartToken();return y=l.chars[l.chars.length-1],O.equals(E)||(this.setStart(O.node,O.offset),a=!0),y&&!y.equals(S)&&(this.setEnd(y.node,y.offset),a=!0),r.trim&&(r.trimStart&&(a=this.trimStart(s)||a),r.trimEnd&&(a=this.trimEnd(s)||a)),a}return this.moveEnd("character",1,r)})),text:createEntryPointFunction((function(e,t){return this.collapsed?"":function getRangeCharacters(e,t,r){for(var a,s=[],l=createRangeCharacterIterator(e,t,r);a=l.next();)s.push(a);return l.dispose(),s}(e,this,E(t,M)).join("")})),selectCharacters:createEntryPointFunction((function(e,t,r,a,s){var l={characterOptions:s};t||(t=S(this.getDocument())),this.selectNodeContents(t),this.collapse(!0),this.moveStart("character",r,l),this.collapse(!0),this.moveEnd("character",a-r,l)})),toCharacterRange:createEntryPointFunction((function(e,t,r){t||(t=S(this.getDocument()));var a,s=t.parentNode,y=l.getNodeIndex(t),w=-1==l.comparePoints(this.startContainer,this.endContainer,s,y),E=this.cloneRange();return w?(E.setStartAndEnd(this.startContainer,this.startOffset,s,y),a=-E.text(r).length):(E.setStartAndEnd(s,y,this.startContainer,this.startOffset),a=E.text(r).length),{start:a,end:a+this.text(r).length}})),findText:createEntryPointFunction((function(t,r,a){(a=createNestedOptions(a,W)).wholeWordsOnly&&(a.wordOptions.includeTrailingSpace=!1);var s=L(a.direction),l=a.withinRange;l||(l=e.createRange()).selectNodeContents(this.getDocument());var y=r,w=!1;"string"==typeof y?a.caseSensitive||(y=y.toLowerCase()):w=!0;var E=t.getRangeBoundaryPosition(this,!s),S=l.comparePoint(E.node,E.offset);-1===S?E=t.getRangeBoundaryPosition(l,!0):1===S&&(E=t.getRangeBoundaryPosition(l,!1));for(var T,O=E,N=!1;;)if(T=findTextFromPosition(O,y,w,l,a)){if(T.valid)return this.setStartAndEnd(T.startPos.node,T.startPos.offset,T.endPos.node,T.endPos.offset),!0;O=s?T.startPos:T.endPos}else{if(!a.wrap||N)return!1;l=l.cloneRange(),O=t.getRangeBoundaryPosition(l,!s),l.setBoundary(E.node,E.offset,s),N=!0}})),pasteHtml:function pasteHtml(e){if(this.deleteContents(),e){var t=this.createContextualFragment(e),r=t.lastChild;this.insertNode(t),this.collapseAfter(r)}}}),w(e.selectionPrototype,{expand:createEntryPointFunction((function(e,t,r){this.changeEachRange((function(e){e.expand(t,r)}))})),move:createEntryPointFunction((function(e,t,r,a){var s=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var l=this.getRangeAt(0);a||(a={}),a.characterOptions=E(a.characterOptions,B),s=l.move(t,r,a),this.setSingleRange(l)}return s})),trimStart:createSelectionTrimmer("trimStart"),trimEnd:createSelectionTrimmer("trimEnd"),trim:createSelectionTrimmer("trim"),selectCharacters:createEntryPointFunction((function(t,r,a,s,l,y){var w=e.createRange(r);w.selectCharacters(r,a,s,y),this.setSingleRange(w,l)})),saveCharacterRanges:createEntryPointFunction((function(e,t,r){for(var a=this.getAllRanges(),s=[],l=1==a.length&&this.isBackward(),y=0,w=a.length;y<w;++y)s[y]={characterRange:a[y].toCharacterRange(t,r),backward:l,characterOptions:r};return s})),restoreCharacterRanges:createEntryPointFunction((function(t,r,a){this.removeAllRanges();for(var s,l,y,w=0,E=a.length;w<E;++w)y=(l=a[w]).characterRange,(s=e.createRange(r)).selectCharacters(r,y.start,y.end,l.characterOptions),this.addRange(s,l.backward)})),text:createEntryPointFunction((function(e,t){for(var r=[],a=0,s=this.rangeCount;a<s;++a)r[a]=this.getRangeAt(a).text(t);return r.join("")}))}),e.innerText=function(t,r){var a=e.createRange(t);return a.selectNodeContents(t),a.text(r)},e.createWordIterator=function(e,t,r){var a=getSession();r=createNestedOptions(r,V);var s=createTokenizedTextProvider(a.getPosition(e,t),r.characterOptions,r.wordOptions),l=L(r.direction);return{next:function next(){return l?s.previousStartToken():s.nextEndToken()},dispose:function dispose(){s.dispose(),this.next=function(){}}}},e.noMutation=function(e){e(getSession()),endSession()},e.noMutation.createEntryPointFunction=createEntryPointFunction,e.textRange={isBlockNode:function isBlockNode(e){return e&&(1==e.nodeType&&!/^(inline(-block|-table)?|none)$/.test(getComputedDisplay(e))||9==e.nodeType||11==e.nodeType)},isCollapsedWhitespaceNode:isCollapsedWhitespaceNode,createPosition:createEntryPointFunction((function(e,t,r){return e.getPosition(t,r)}))}})),t.browser=function(){var e,t,r=navigator.userAgent,a=document.createElement("div"),s=-1!==r.indexOf("Gecko")&&-1===r.indexOf("KHTML")&&!isIE(),l=-1!==r.indexOf("AppleWebKit/")&&!isIE(),y=-1!==r.indexOf("Chrome/")&&!isIE(),w=-1!==r.indexOf("Opera/")&&!isIE();function isIE(e,t){var r,a=-1;return"Microsoft Internet Explorer"==navigator.appName?r=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(navigator.userAgent.indexOf("Trident")>-1?r=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"):/Edge\/(\d+)./i.test(navigator.userAgent)&&(r=/Edge\/(\d+)./i)),r&&null!=r.exec(navigator.userAgent)&&(a=parseFloat(RegExp.$1)),-1!==a&&(!e||(t?"<"===t?e<a:">"===t?e>a:"<="===t?e<=a:">="===t?e>=a:void 0:e===a))}return{USER_AGENT:r,isIE:isIE,supported:function supported(){var e=this.USER_AGENT.toLowerCase(),t="contentEditable"in a,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,s=document.querySelector&&document.querySelectorAll,l=this.isIos()&&function iosVersion(e){return+(/ipad|iphone|ipod/.test(e)&&e.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}(e)<5||this.isAndroid()&&function androidVersion(e){return+(e.match(/android (\d+)/)||[void 0,0])[1]}(e)<4||-1!==e.indexOf("opera mobi")||-1!==e.indexOf("hpwos/");return t&&r&&s&&!l},isTouchDevice:function isTouchDevice(){return this.supportsEvent("touchmove")},isIos:function isIos(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function isAndroid(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function supportsSandboxedIframes(){return isIE()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function throwsMixedContentWarningWhenIframeSrcIsEmpty(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function displaysCaretInEmptyContentEditableCorrectly(){return isIE(12,">")},hasCurrentStyleProperty:function hasCurrentStyleProperty(){return"currentStyle"in a},insertsLineBreaksOnReturn:function insertsLineBreaksOnReturn(){return s},supportsPlaceholderAttributeOn:function supportsPlaceholderAttributeOn(e){return"placeholder"in e},supportsEvent:function supportsEvent(e){return"on"+e in a||(a.setAttribute("on"+e,"return;"),"function"==typeof a["on"+e])},supportsEventsInIframeCorrectly:function supportsEventsInIframeCorrectly(){return!w},supportsHTML5Tags:function supportsHTML5Tags(e){var t=e.createElement("div"),r="<article>foo</article>";return t.innerHTML=r,t.innerHTML.toLowerCase()===r},supportsCommand:(e={formatBlock:isIE(10,"<="),insertUnorderedList:isIE(),insertOrderedList:isIE()},t={insertHTML:s},function(r,a){if(!e[a]){try{return r.queryCommandSupported(a)}catch(e){}try{return r.queryCommandEnabled(a)}catch(e){return!!t[a]}}return!1}),doesAutoLinkingInContentEditable:function doesAutoLinkingInContentEditable(){return isIE()},canDisableAutoLinking:function canDisableAutoLinking(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function clearsContentEditableCorrectly(){return s||w||l},supportsGetAttributeCorrectly:function supportsGetAttributeCorrectly(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function canSelectImagesInContentEditable(){return s||isIE()||w},autoScrollsToCaret:function autoScrollsToCaret(){return!l},autoClosesUnclosedTags:function autoClosesUnclosedTags(){var e,t,r=a.cloneNode(!1);return r.innerHTML="<p><div></div>",t=r.innerHTML.toLowerCase(),e="<p></p><div></div>"===t||"<p><div></div></p>"===t,this.autoClosesUnclosedTags=function(){return e},e},supportsNativeGetElementsByClassName:function supportsNativeGetElementsByClassName(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function supportsSelectionModify(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function needsSpaceAfterLineBreak(){return w},supportsSpeechApiOn:function supportsSpeechApiOn(e){return(r.match(/Chrome\/(\d+)/)||[void 0,0])[1]>=11&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function crashesWhenDefineProperty(e){return isIE(9)&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function doesAsyncFocus(){return isIE(12,">")},hasProblemsSettingCaretAfterImg:function hasProblemsSettingCaretAfterImg(){return isIE()},hasLiDeletingProblem:function hasLiDeletingProblem(){return isIE()},hasUndoInContextMenu:function hasUndoInContextMenu(){return s||y||w},hasInsertNodeIssue:function hasInsertNodeIssue(){return w},hasIframeFocusIssue:function hasIframeFocusIssue(){return isIE()},createsNestedInvalidMarkupAfterPaste:function createsNestedInvalidMarkupAfterPaste(){return l},hasCaretBlockElementIssue:function hasCaretBlockElementIssue(){return l},supportsMutationEvents:function supportsMutationEvents(){return"MutationEvent"in window},supportsModernPaste:function supportsModernPaste(){return!isIE()},fixStyleKey:function fixStyleKey(e){return"cssFloat"===e?"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat":e},usesControlRanges:function usesControlRanges(){return document.body&&"createControlRange"in document.body},hasCaretAtLinkEndInsertionProblems:function hasCaretAtLinkEndInsertionProblems(){return l}}}(),t.lang.array=function(e){return{contains:function contains(r){if(Array.isArray(r)){for(var a=r.length;a--;)if(-1!==t.lang.array(e).indexOf(r[a]))return!0;return!1}return-1!==t.lang.array(e).indexOf(r)},indexOf:function indexOf(t){if(e.indexOf)return e.indexOf(t);for(var r=0,a=e.length;r<a;r++)if(e[r]===t)return r;return-1},without:function without(r){r=t.lang.array(r);for(var a=[],s=0,l=e.length;s<l;s++)r.contains(e[s])||a.push(e[s]);return a},get:function get(){for(var t=0,r=e.length,a=[];t<r;t++)a.push(e[t]);return a},map:function map(t,r){if(Array.prototype.map)return e.map(t,r);for(var a=e.length>>>0,s=new Array(a),l=0;l<a;l++)s[l]=t.call(r,e[l],l,e);return s},unique:function unique(){for(var r=[],a=e.length,s=0;s<a;)t.lang.array(r).contains(e[s])||r.push(e[s]),s++;return r}}},t.lang.Dispatcher=q.extend({on:function on(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},off:function off(e,t){this.events=this.events||{};var r,a,s=0;if(e){for(r=this.events[e]||[],a=[];s<r.length;s++)r[s]!==t&&t&&a.push(r[s]);this.events[e]=a}else this.events={};return this},fire:function fire(e,t){this.events=this.events||{};for(var r=this.events[e]||[],a=0;a<r.length;a++)r[a].call(this,t);return this},observe:function observe(){return this.on.apply(this,arguments)},stopObserving:function stopObserving(){return this.off.apply(this,arguments)}}),t.lang.object=function(e){return{merge:function merge(r,a){for(var s in r)a&&t.lang.object(r[s]).isPlainObject()&&(void 0===e[s]||t.lang.object(e[s]).isPlainObject())?void 0===e[s]?e[s]=t.lang.object(r[s]).clone(!0):t.lang.object(e[s]).merge(t.lang.object(r[s]).clone(!0)):e[s]=t.lang.object(r[s]).isPlainObject()?t.lang.object(r[s]).clone(!0):r[s];return this},difference:function difference(t){var r={};for(var a in e)e.hasOwnProperty(a)&&(t.hasOwnProperty(a)||(r[a]=e[a]));for(var s in t)t.hasOwnProperty(s)&&(e.hasOwnProperty(s)&&e[s]===t[s]||(r[0]=e[0]));return r},get:function get(){return e},clone:function clone(r){var a,s={};if(null===e||!t.lang.object(e).isPlainObject())return e;for(a in e)e.hasOwnProperty(a)&&(s[a]=r?t.lang.object(e[a]).clone(r):e[a]);return s},isArray:function isArray(){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function isFunction(){return"[object Function]"===Object.prototype.toString.call(e)},isPlainObject:function isPlainObject(){return e&&"[object Object]"===Object.prototype.toString.call(e)&&!("Node"in window?e instanceof Node:e instanceof Element||e instanceof Text)},isEmpty:function isEmpty(){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}}},a=/^\s+/,s=/\s+$/,l=/[&<>\t"]/g,y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\t":"&nbsp; "},t.lang.string=function(e){return e=String(e),{trim:function trim(){return e.replace(a,"").replace(s,"")},interpolate:function interpolate(t){for(var r in t)e=this.replace("#{"+r+"}").by(t[r]);return e},replace:function replace(t){return{by:function by(r){return e.split(t).join(r)}}},escapeHTML:function escapeHTML(t,r){var a=e.replace(l,(function(e){return y[e]}));return t&&(a=a.replace(/(?:\r\n|\r|\n)/g,"<br />")),r&&(a=a.replace(/  /gi,"&nbsp; ")),a}}},function(e){var t=e.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),r=/((https?:\/\/|www\.)[^\s<]{3,})/gi,a=/([^\w\/\-](,?))$/i,s={")":"(","]":"[","}":"{"};e.dom.autoLink=function autoLink(l,y){return function _hasParentThatShouldBeIgnored(r,a){var s;for(;r.parentNode;){if(r=r.parentNode,s=r.nodeName,r.className&&e.lang.array(r.className.split(" ")).contains(a))return!0;if(t.contains(s))return!0;if("body"===s)return!1}return!1}(l,y)?l:(l===l.ownerDocument.documentElement&&(l=l.ownerDocument.body),function _parseNode(l,y){if(t.contains(l.nodeName))return;if(l.className&&e.lang.array(l.className.split(" ")).contains(y))return;if(l.nodeType===e.TEXT_NODE&&l.data.match(r))return void function _wrapMatchesInNode(t){var l=t.parentNode,y=e.lang.string(t.data).escapeHTML(),w=function _getTempElement(e){var t=e._wysihtml_tempElement;t||(t=e._wysihtml_tempElement=e.createElement("div"));return t}(l.ownerDocument);w.innerHTML="<span></span>"+function _convertUrlsToLinks(e){return e.replace(r,(function(e,t){var r=(t.match(a)||[])[1]||"",l=s[r];(t=t.replace(a,"")).split(l).length>t.split(r).length&&(t+=r,r="");var y=t,w=t;return t.length>100&&(w=w.substr(0,100)+"..."),"www."===y.substr(0,4)&&(y="http://"+y),'<a href="'+y+'">'+w+"</a>"+r}))}(y),w.removeChild(w.firstChild);for(;w.firstChild;)l.insertBefore(w.firstChild,t);l.removeChild(t)}(l);for(var w=e.lang.array(l.childNodes).get(),E=w.length,S=0;S<E;S++)_parseNode(w[S],y);return l}(l,y))},e.dom.autoLink.URL_REG_EXP=r}(t),function(e){var t=e.dom;t.addClass=function(e,r){var a=e.classList;if(a)return a.add(r);t.hasClass(e,r)||(e.className+=" "+r)},t.removeClass=function(e,t){var r=e.classList;if(r)return r.remove(t);e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")},t.hasClass=function(e,t){var r=e.classList;if(r)return r.contains(t);var a=e.className;return a.length>0&&(a==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(a))}}(t),t.dom.compareDocumentPosition=document.documentElement.compareDocumentPosition?function(e,t){return e.compareDocumentPosition(t)}:function(e,r){var a,s;if(a=9===e.nodeType?e:e.ownerDocument,s=9===r.nodeType?r:r.ownerDocument,e===r)return 0;if(e===r.ownerDocument)return 20;if(e.ownerDocument===r)return 10;if(a!==s)return 1;if(2===e.nodeType&&e.childNodes&&-1!==t.lang.array(e.childNodes).indexOf(r))return 20;if(2===r.nodeType&&r.childNodes&&-1!==t.lang.array(r.childNodes).indexOf(e))return 10;for(var l=e,y=[],w=null;l;){if(l==r)return 10;y.push(l),l=l.parentNode}for(l=r,w=null;l;){if(l==e)return 20;var E=t.lang.array(y).indexOf(l);if(-1!==E){var S=y[E];return t.lang.array(S.childNodes).indexOf(y[E-1])>t.lang.array(S.childNodes).indexOf(w)?2:4}w=l,l=l.parentNode}return 1},t.dom.contains=(w=document.documentElement).contains?function(e,r){if(r.nodeType!==t.ELEMENT_NODE){if(r.parentNode===e)return!0;r=r.parentNode}return e!==r&&e.contains(r)}:w.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:void 0,function(e){var t=document;e.dom.ContentEditableArea=q.extend({getContentEditable:function getContentEditable(){return this.element},getWindow:function getWindow(){return this.element.ownerDocument.defaultView||this.element.ownerDocument.parentWindow},getDocument:function getDocument(){return this.element.ownerDocument},constructor:function constructor(t,r,a){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(r).get(),this.config.className||(this.config.className="wysihtml-sandbox"),this.element=a?this._bindElement(a):this._createElement()},destroy:function destroy(){},_createElement:function _createElement(){var e=t.createElement("div");return e.className=this.config.className,this._loadElement(e),e},_bindElement:function _bindElement(e){return e.className=e.className?e.className+" wysihtml-sandbox":"wysihtml-sandbox",this._loadElement(e,!0),e},_loadElement:function _loadElement(e,t){var r=this;if(!t){var a=this._getHtml();e.innerHTML=a}this.loaded=!0,setTimeout((function(){r.callback(r)}),0)},_getHtml:function _getHtml(e){return""}})}(t),t.dom.convertToList=function(){function _createListItem(e,t){var r=e.createElement("li");return t.appendChild(r),r}return function convertToList(e,r,a){if("UL"===e.nodeName||"OL"===e.nodeName||"MENU"===e.nodeName)return e;var s,l,y,w,E,S,T,O,N,A=e.ownerDocument,L=function _createList(e,t){return e.createElement(t)}(A,r),R=e.querySelectorAll("br"),D=R.length;for(N=0;N<D;N++)for(w=R[N];(E=w.parentNode)&&E!==e&&E.lastChild===w;){if("block"===t.dom.getStyle("display").from(E)){E.removeChild(w);break}t.dom.insert(w).after(w.parentNode)}for(l=(s=t.lang.array(e.childNodes).get()).length,N=0;N<l;N++)O=O||_createListItem(A,L),y=s[N],S="block"===t.dom.getStyle("display").from(y),T="BR"===y.nodeName,!S||a&&t.dom.hasClass(y,a)?T?O=O.firstChild?null:O:O.appendChild(y):((O=O.firstChild?_createListItem(A,L):O).appendChild(y),O=null);return 0===s.length&&_createListItem(A,L),e.parentNode.replaceChild(L,e),L}}(),t.dom.copyAttributes=function(e){return{from:function from(t){return{to:function pasteElementAttributesTo(r){for(var a,s=0,l=e.length;s<l;s++)a=e[s],void 0!==t[a]&&""!==t[a]&&(r[a]=t[a]);return{andTo:pasteElementAttributesTo}}}}}},E=t.dom,S=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],T=function hasBoxSizingBorderBox(e){for(var t=0,r=S.length;t<r;t++)if("border-box"===E.getStyle(S[t]).from(e))return S[t]},E.copyStyles=function(e){return{from:function from(r){(function shouldIgnoreBoxSizingBorderBox(e){return!!T(e)&&parseInt(E.getStyle("width").from(e),10)<e.offsetWidth})(r)&&(e=t.lang.array(e).without(S));for(var a,s="",l=e.length,y=0;y<l;y++)a=e[y],s+=a+":"+E.getStyle(a).from(r)+";";return{to:function pasteStylesTo(e){return E.setStyles(s).on(e),{andTo:pasteStylesTo}}}}}},function(e){e.dom.delegate=function(e,t,r,a){var s=function callback(r){for(var s=r.target,l=3===s.nodeType?s.parentNode:s,y=e.querySelectorAll(t),w=0,E=y.length;w<E;w++)y[w].contains(l)&&a.call(y[w],r)};return e.addEventListener(r,s,!1),{stop:function stop(){e.removeEventListener(r,s,!1)}}}}(t),function(e){function parents(e,t){for(var r=[e],a=e;t&&a&&a!==t||!t&&a;)r.unshift(a),a=a.parentNode;return r}e.dom.domNode=function(t){var r=[e.ELEMENT_NODE,e.TEXT_NODE];return{is:{emptyTextNode:function emptyTextNode(r){var a=r?/^\s*$/g:/^[\r\n]*$/g;return t&&t.nodeType===e.TEXT_NODE&&a.test(t.data)},rangyBookmark:function rangyBookmark(){return t&&1===t.nodeType&&t.classList.contains("rangySelectionBoundary")},visible:function visible(){var r=!/^\s*$/g.test(e.dom.getTextContent(t));return r||1===t.nodeType&&t.querySelector("img, br, hr, object, embed, canvas, input, textarea")&&(r=!0),r},lineBreak:function lineBreak(){return t&&1===t.nodeType&&"BR"===t.nodeName},block:function block(){return t&&1===t.nodeType&&"block"===t.ownerDocument.defaultView.getComputedStyle(t).display},voidElement:function voidElement(){return e.dom.domNode(t).test({query:e.VOID_ELEMENTS})}},prev:function prev(a){var s=t.previousSibling,l=a&&a.nodeTypes?a.nodeTypes:r;return s?e.dom.domNode(s).is.rangyBookmark()||!e.lang.array(l).contains(s.nodeType)||a&&a.ignoreBlankTexts&&e.dom.domNode(s).is.emptyTextNode(!0)?e.dom.domNode(s).prev(a):s:null},next:function next(a){var s=t.nextSibling,l=a&&a.nodeTypes?a.nodeTypes:r;return s?e.dom.domNode(s).is.rangyBookmark()||!e.lang.array(l).contains(s.nodeType)||a&&a.ignoreBlankTexts&&e.dom.domNode(s).is.emptyTextNode(!0)?e.dom.domNode(s).next(a):s:null},commonAncestor:function commonAncestor(e,r){var a=parents(t,r),s=parents(e,r);if(a[0]!=s[0])return null;for(var l=0;l<a.length;l++)if(a[l]!=s[l])return a[l-1];return null},lastLeafNode:function lastLeafNode(r){var a;if(1!==t.nodeType)return t;if(!(a=t.lastChild))return t;if(r&&r.leafClasses)for(var s=r.leafClasses.length;s--;)if(e.dom.hasClass(t,r.leafClasses[s]))return t;return e.dom.domNode(a).lastLeafNode(r)},escapeParent:function escapeParent(r,a){var s,l,y,w=t;if(!e.dom.contains(r,t))throw new Error("Child is not a descendant of node.");do{for(l=(s=w.parentNode).cloneNode(!1);s.lastChild&&s.lastChild!==w;)l.insertBefore(s.lastChild,l.firstChild);if(s!==r&&((y=s.cloneNode(!1)).appendChild(w),w=y),s.parentNode.insertBefore(w,s.nextSibling),""!==l.innerHTML)if(/^\s+$/.test(l.innerHTML))for(;l.lastChild;)s.parentNode.insertBefore(l.lastChild,w.nextSibling);else s.parentNode.insertBefore(l,w.nextSibling);if(""===s.innerHTML)s.parentNode.removeChild(s);else if(/^\s+$/.test(s.innerHTML)){for(;s.firstChild;)s.parentNode.insertBefore(s.firstChild,s);s.parentNode.removeChild(s)}}while(s&&s!==r);a&&w&&(w.parentNode.insertBefore(a,w),a.appendChild(w))},transferContentTo:function transferContentTo(r,a){if(1===t.nodeType){if(e.dom.domNode(r).is.voidElement()||3===r.nodeType)for(;t.lastChild;)r.parentNode.insertBefore(t.lastChild,r.nextSibling);else for(;t.firstChild;)r.appendChild(t.firstChild);a&&t.parentNode.removeChild(t)}else 3!==t.nodeType&&8!==t.nodeType||(e.dom.domNode(r).is.voidElement()?r.parentNode.insertBefore(t,r.nextSibling):r.appendChild(t))},test:function test(r){var a;if(!r)return!1;if(1!==t.nodeType)return!1;if(r.query&&!t.matches(r.query))return!1;if(r.nodeName&&t.nodeName.toLowerCase()!==r.nodeName.toLowerCase())return!1;if(r.className&&!t.classList.contains(r.className))return!1;if(r.classRegExp&&0===((t.className||"").match(r.classRegExp)||[]).length)return!1;if(r.styleProperty&&r.styleProperty.length>0)for(var s=!1,l=Array.isArray(r.styleProperty)?r.styleProperty:[r.styleProperty],y=0,w=l.length;y<w;y++){if(a=e.browser.fixStyleKey(l[y]),t.style&&t.style[a]){if(!r.styleValue){s=!0;break}if(r.styleValue instanceof RegExp){if(t.style[a].trim().match(r.styleValue).length>0){s=!0;break}}else if(Array.isArray(r.styleValue)){if(r.styleValue.indexOf(t.style[a].trim())){s=!0;break}}else if(r.styleValue===t.style[a].trim().replace(/, /g,",")){s=!0;break}}if(!s)return!1}if(r.attribute){var E=e.dom.getAttributes(t),S=[],T=!1;for(var O in Array.isArray(r.attribute)?S=r.attribute:S[r.attribute]=r.attributeValue,S)if(S.hasOwnProperty(O))if(void 0===S[O]){if(void 0!==E[O]){T=!0;break}}else if(E[O]===S[O]){T=!0;break}if(!T)return!1}return!0}}}}(t),t.dom.getAsDom=(O=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"],function(e,r){var a;return r=r||document,"object"===_typeof(e)&&e.nodeType?(a=r.createElement("div")).appendChild(e):t.browser.supportsHTML5Tags(r)?(a=r.createElement("div")).innerHTML=e:(function _ensureHTML5Compatibility(e){if(!e._wysihtml_supportsHTML5Tags){for(var t=0,r=O.length;t<r;t++)e.createElement(O[t]);e._wysihtml_supportsHTML5Tags=!0}}(r),a=function _innerHTMLShiv(e,t){var r=t.createElement("div");r.style.display="none",t.body.appendChild(r);try{r.innerHTML=e}catch(e){}return t.body.removeChild(r),r}(e,r)),a}),t.dom.getAttribute=function(e,r){var a=!t.browser.supportsGetAttributeCorrectly();return r=r.toLowerCase(),"IMG"==e.nodeName&&"src"==r&&!0===t.dom.isLoadedImage(e)?e.src:a&&"outerHTML"in e?-1!=e.outerHTML.toLowerCase().indexOf(" "+r+"=")?e.getAttribute(r):null:e.getAttribute(r)},t.dom.getAttributes=function(e){var r,a=!t.browser.supportsGetAttributeCorrectly(),s=e.nodeName,l=[];for(r in e.attributes)(e.attributes.hasOwnProperty&&e.attributes.hasOwnProperty(r)||!e.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(e.attributes,r))&&e.attributes[r].specified&&("IMG"==s&&"src"==e.attributes[r].name.toLowerCase()&&!0===t.dom.isLoadedImage(e)?l.src=e.src:t.lang.array(["rowspan","colspan"]).contains(e.attributes[r].name.toLowerCase())&&a?1!==e.attributes[r].value&&(l[e.attributes[r].name]=e.attributes[r].value):l[e.attributes[r].name]=e.attributes[r].value);return l},t.dom.getParentElement=function(e,r,a,s){for(a=a||50;a--&&e&&"BODY"!==e.nodeName&&(!s||e!==s);){if(t.dom.domNode(e).test(r))return e;e=e.parentNode}return null},t.dom.getPastedHtml=function(e){var r;return t.browser.supportsModernPaste()&&e.clipboardData&&(t.lang.array(e.clipboardData.types).contains("text/html")?r=e.clipboardData.getData("text/html"):t.lang.array(e.clipboardData.types).contains("text/plain")&&(r=t.lang.string(e.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),r},t.dom.getPastedHtmlWithDiv=function(e,t){var r=e.selection.getBookmark(),a=e.element.ownerDocument,s=a.createElement("DIV"),l=e.getScrollPos();a.body.appendChild(s),s.style.width="1px",s.style.height="1px",s.style.overflow="hidden",s.style.position="absolute",s.style.top=l.y+"px",s.style.left=l.x+"px",s.setAttribute("contenteditable","true"),s.focus(),setTimeout((function(){var a;e.selection.setBookmark(r),(a=s.innerHTML)&&/^<br\/?>$/i.test(a.trim())&&(a=!1),t(a),s.parentNode.removeChild(s)}),0)},t.dom.getStyle=(N={float:"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},A=/\-[a-z]/g,function(e){return{from:function from(r){if(r.nodeType===t.ELEMENT_NODE){var a=r.ownerDocument,s=N[e]||function camelize(e){return e.replace(A,(function(e){return e.charAt(1).toUpperCase()}))}(e),l=r.style,y=r.currentStyle,w=l[s];if(w)return w;if(y)try{return y[s]}catch(e){}var E,S,T=a.defaultView||a.parentWindow,O=("height"===e||"width"===e)&&"TEXTAREA"===r.nodeName;return T.getComputedStyle?(O&&(E=l.overflow,l.overflow="hidden"),S=T.getComputedStyle(r,null).getPropertyValue(e),O&&(l.overflow=E||""),S):void 0}}}}),t.dom.getTextNodes=function(e,r){var a=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?r&&/^\s*$/.test(e.innerText||e.textContent)||a.push(e):a=a.concat(t.dom.getTextNodes(e,r));return a},function(e){var t={},r=1;e.dom.hasElementWithClassName=function(a,s){if(!e.browser.supportsNativeGetElementsByClassName())return!!a.querySelector("."+s);var l=function _getDocumentIdentifier(e){return e._wysihtml_identifier||(e._wysihtml_identifier=r++)}(a)+":"+s,y=t[l];return y||(y=t[l]=a.getElementsByClassName(s)),y.length>0}}(t),t.dom.hasElementWithTagName=(L={},R=1,function(e,t){var r=function _getDocumentIdentifier(e){return e._wysihtml_identifier||(e._wysihtml_identifier=R++)}(e)+":"+t,a=L[r];return a||(a=L[r]=e.getElementsByTagName(t)),a.length>0}),t.dom.insert=function(e){return{after:function after(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function before(t){t.parentNode.insertBefore(e,t)},into:function into(t){t.appendChild(e)}}},t.dom.insertCSS=function(e){return e=e.join("\n"),{into:function into(t){var r=t.createElement("style");r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(t.createTextNode(e));var a=t.querySelector("head link");if(a)a.parentNode.insertBefore(r,a);else{var s=t.querySelector("head");s&&s.appendChild(r)}}}},t.dom.isLoadedImage=function(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(t){if(e.complete&&"complete"===e.readyState)return!0}},function(e){e.dom.lineBreaks=function(t){function _isLineBreak(e){return"BR"===e.nodeName}function _isLineBreakOrBlockElement(t){return!!_isLineBreak(t)||"block"===e.dom.getStyle("display").from(t)}return{add:function add(r){var a=t.ownerDocument,s=e.dom.domNode(t).next({ignoreBlankTexts:!0}),l=e.dom.domNode(t).prev({ignoreBlankTexts:!0});s&&!_isLineBreakOrBlockElement(s)&&e.dom.insert(a.createElement("br")).after(t),l&&!_isLineBreakOrBlockElement(l)&&e.dom.insert(a.createElement("br")).before(t)},remove:function remove(r){var a=e.dom.domNode(t).next({ignoreBlankTexts:!0}),s=e.dom.domNode(t).prev({ignoreBlankTexts:!0});a&&_isLineBreak(a)&&a.parentNode.removeChild(a),s&&_isLineBreak(s)&&s.parentNode.removeChild(s)}}}}(t),t.dom.observe=function(e,t,r){for(var a,s,l=0,y=(t="string"==typeof t?[t]:t).length;l<y;l++)s=t[l],e.addEventListener?e.addEventListener(s,r,!1):(a=function handlerWrapper(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},r.call(e,t)},e.attachEvent("on"+s,a));return{stop:function stop(){for(var s,l=0,y=t.length;l<y;l++)s=t[l],e.removeEventListener?e.removeEventListener(s,r,!1):e.detachEvent("on"+s,a)}}},t.dom.parse=function(e,r){var a={1:function _handleElement(e,r){var a,s,l,w=y.tags,E=e.nodeName.toLowerCase(),S=e.scopeName;if(e._wysihtml)return null;if(e._wysihtml=1,"wysihtml-temp"===e.className)return null;S&&"HTML"!=S&&(E=S+":"+E);"outerHTML"in e&&(t.browser.autoClosesUnclosedTags()||"P"!==e.nodeName||"</p>"===e.outerHTML.slice(-4).toLowerCase()||(E="div"));if(E in w){if(!(a=w[E])||a.remove)return null;if(a.unwrap)return!1;a="string"==typeof a?{rename_tag:a}:a}else{if(!e.firstChild)return null;a={rename_tag:"span"}}if(a.one_of_type&&!function _testTypes(e,t,r,a){var s,l;if("SPAN"===e.nodeName&&!a&&("_wysihtml-temp-placeholder"===e.className||"rangySelectionBoundary"===e.className))return!0;for(l in r)if(r.hasOwnProperty(l)&&t.type_definitions&&t.type_definitions[l]&&(s=t.type_definitions[l],_testType(e,s)))return!0;return!1}(e,y,a.one_of_type,r)){if(!a.remove_action)return null;if("unwrap"===a.remove_action)return!1;if("rename"!==a.remove_action)return null;l=a.remove_action_rename_to||"span"}s=e.ownerDocument.createElement(l||a.rename_tag||E),_handleAttributes(e,s,a,r),_handleStyles(e,s,a),e=null,s.normalize&&s.normalize();return s},3:function _handleText(e){var r=e.nextSibling;if(!r||r.nodeType!==t.TEXT_NODE){var a=e.data.replace(t.INVISIBLE_SPACE_REG_EXP,"");return e.ownerDocument.createTextNode(a)}r.data=e.data.replace(t.INVISIBLE_SPACE_REG_EXP,"")+r.data.replace(t.INVISIBLE_SPACE_REG_EXP,"")},8:function _handleComment(e){if(y.comments)return e.ownerDocument.createComment(e.nodeValue)}},s=/\s+/,l={tags:{},classes:{}},y={},w=["ADDRESS","BLOCKQUOTE","CENTER","DIR","DIV","DL","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","ISINDEX","MENU","NOFRAMES","NOSCRIPT","OL","P","PRE","TABLE","UL"];function _convert(e,r,s,l){var y,E,S,T,O=e.nodeType,N=e.childNodes,A=N.length,L=a[O],R=0;if(l&&1===O&&t.dom.hasClass(e,l))return e;if(!(E=L&&L(e,s))){if(!1===E){for(y=e.ownerDocument.createDocumentFragment(),R=A;R--;)N[R]&&(S=_convert(N[R],r,s,l))&&(N[R]===S&&R--,y.insertBefore(S,y.firstChild));return""===(T=t.dom.getStyle("display").from(e))&&(T=t.lang.array(w).contains(e.tagName)?"block":""),t.lang.array(["block","flex","table"]).contains(T)&&y.appendChild(e.ownerDocument.createElement("br")),t.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(e.nodeName.toLowerCase())&&e.parentNode.lastChild!==e&&(e.nextSibling&&3===e.nextSibling.nodeType&&/^\s/.test(e.nextSibling.nodeValue)||y.appendChild(e.ownerDocument.createTextNode(" "))),y.normalize&&y.normalize(),y}return null}for(R=0;R<A;R++)N[R]&&(S=_convert(N[R],r,s,l))&&(N[R]===S&&R--,E.appendChild(S));if(r&&"span"===E.nodeName.toLowerCase()&&(!E.childNodes.length||/^\s*$/gi.test(E.innerHTML)&&(s||"_wysihtml-temp-placeholder"!==e.className&&"rangySelectionBoundary"!==e.className)||!E.attributes.length)){for(y=E.ownerDocument.createDocumentFragment();E.firstChild;)y.appendChild(E.firstChild);return y.normalize&&y.normalize(),y}return E.normalize&&E.normalize(),E}function _testType(e,r){var a,l,y,w,E,S=e.getAttribute("class"),T=e.getAttribute("style");if(r.methods)for(var O in r.methods)if(r.methods.hasOwnProperty(O)&&R[O]&&R[O](e))return!0;if(S&&r.classes){a=(S=S.replace(/^\s+/g,"").replace(/\s+$/g,"").split(s)).length;for(var N=0;N<a;N++)if(r.classes[S[N]])return!0}if(T&&r.styles)for(l in T=T.split(";"),r.styles)if(r.styles.hasOwnProperty(l))for(var A=T.length;A--;)if((E=T[A].split(":"))[0].replace(/\s/g,"").toLowerCase()===l&&(!0===r.styles[l]||1===r.styles[l]||t.lang.array(r.styles[l]).contains(E[1].replace(/\s/g,"").toLowerCase())))return!0;if(r.attrs)for(y in r.attrs)if(r.attrs.hasOwnProperty(y)&&"string"==typeof(w=t.dom.getAttribute(e,y))&&w.search(r.attrs[y])>-1)return!0;return!1}function _handleStyles(e,t,r){var a,s;if(r&&r.keep_styles)for(a in r.keep_styles)if(r.keep_styles.hasOwnProperty(a)){if(s="float"===a?e.style.styleFloat||e.style.cssFloat:e.style[a],r.keep_styles[a]instanceof RegExp&&!r.keep_styles[a].test(s))continue;"float"===a?t.style[e.style.styleFloat?"styleFloat":"cssFloat"]=s:e.style[a]&&(t.style[a]=s)}}function _getAttributesBeginningWith(e,t){var r=[];for(var a in t)t.hasOwnProperty(a)&&0===a.indexOf(e)&&r.push(a);return r}function _checkAttribute(e,r,a,s){var l,y=t.lang.object(a).isFunction()?a:N[a];return!(!y||"string"!=typeof(l=y(r,s)))&&l}function _handleAttributes(e,r,a,l){var w,E,S,T,O,N,R={},D=a.set_class,M=a.add_class,B=a.add_style,q=a.set_attributes,W=y.classes,j=0,H=[],V=[],z=[],U=[];if(q&&(R=t.lang.object(q).clone()),R=t.lang.object(R).merge(function _checkAttributes(e,r){var a,s,l,w=t.lang.object(y.attributes||{}).clone(),E=t.lang.object(w).merge(t.lang.object(r||{}).clone()).get(),S={},T=t.dom.getAttributes(e);for(a in E)if(/\*$/.test(a))for(var O=0,N=(l=_getAttributesBeginningWith(a.slice(0,-1),T)).length;O<N;O++)!1!==(s=_checkAttribute(l[O],T[l[O]],E[a],e.nodeName))&&(S[l[O]]=s);else!1!==(s=_checkAttribute(0,T[a],E[a],e.nodeName))&&(S[a]=s);return S}(e,a.check_attributes)).get(),D&&H.push(D),M)for(O in M)(N=L[M[O]])&&"string"==typeof(T=N(t.dom.getAttribute(e,O)))&&H.push(T);if(B)for(O in B)(N=A[B[O]])&&"string"==typeof(S=N(t.dom.getAttribute(e,O)))&&V.push(S);if("string"==typeof W&&"any"===W)if(e.getAttribute("class"))if(y.classes_blacklist){for((U=e.getAttribute("class"))&&(H=H.concat(U.split(s))),w=H.length;j<w;j++)E=H[j],y.classes_blacklist[E]||z.push(E);z.length&&(R.class=t.lang.array(z).unique().join(" "))}else R.class=e.getAttribute("class");else H&&H.length>0&&(R.class=t.lang.array(H).unique().join(" "));else{for(l||(W["_wysihtml-temp-placeholder"]=1,W._rangySelectionBoundary=1,W["wysiwyg-tmp-selected-cell"]=1),(U=e.getAttribute("class"))&&(H=H.concat(U.split(s))),w=H.length;j<w;j++)W[E=H[j]]&&z.push(E);z.length&&(R.class=t.lang.array(z).unique().join(" "))}for(O in R.class&&l&&(R.class=R.class.replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(R.class)&&delete R.class),V.length&&(R.style=t.lang.array(V).unique().join(" ")),R)try{r.setAttribute(O,R[O])}catch(e){}R.src&&(void 0!==R.width&&r.setAttribute("width",R.width),void 0!==R.height&&r.setAttribute("height",R.height))}var E,S,T,O,N={url:(E=/^https?:\/\//i,function(e){return e&&e.match(E)?e.replace(E,(function(e){return e.toLowerCase()})):null}),src:function(){var e=/^(\/|https?:\/\/)/i;return function(t){return t&&t.match(e)?t.replace(e,(function(e){return e.toLowerCase()})):null}}(),href:function(){var e=/^(#|\/|https?:\/\/|mailto:|tel:)/i;return function(t){return t&&t.match(e)?t.replace(e,(function(e){return e.toLowerCase()})):null}}(),alt:function(){var e=/[^ a-z0-9_\-]/gi;return function(t,r){return t?t.replace(e,""):"IMG"===r?"":null}}(),numbers:function(){var e=/\D/g;return function(t){return(t=(t||"").replace(e,""))||null}}(),dimension:function(){var e=/\D*(\d+)(\.\d+)?\s?(%)?\D*/;return function(t){return(t=(t||"").replace(e,"$1$2$3"))||null}}(),any:function(e){return e||null}},A={align_text:(S={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"},function(e){return S[String(e).toLowerCase()]})},L={align_img:function(){var e={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return e[String(t).toLowerCase()]}}(),align_text:function(){var e={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return e[String(t).toLowerCase()]}}(),clear_br:function(){var e={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return e[String(t).toLowerCase()]}}(),size_font:function(){var e={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return e[String(t).charAt(0)]}}()},R={has_visible_contet:(O=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"],function(e){if((T=(e.innerText||e.textContent).replace(/\s/g,""))&&T.length>0)return!0;for(var t=O.length;t--;)if(e.querySelector(O[t]))return!0;return!!(e.offsetWidth&&e.offsetWidth>0&&e.offsetHeight&&e.offsetHeight>0)})},D={unwrap:function unwrap(e){t.dom.unwrap(e)},remove:function remove(e){e.parentNode.removeChild(e)}};return function parse(e,r){t.lang.object(y).merge(l).merge(r.rules).get();var a,s,w,E=r.context||e.ownerDocument||document,S=E.createDocumentFragment(),T="string"==typeof e,O=!1;for(!0===r.clearInternals&&(O=!0),a=T?t.dom.getAsDom(e,E):e,y.selectors&&function _applySelectorRules(e,r){var a,s,l;for(a in r)if(r.hasOwnProperty(a)){t.lang.object(r[a]).isFunction()?s=r[a]:"string"==typeof r[a]&&D[r[a]]&&(s=D[r[a]]);for(var y=(l=e.querySelectorAll(a)).length;y--;)s(l[y])}}(a,y.selectors);a.firstChild;)(s=_convert(w=a.firstChild,r.cleanUp,O,r.uneditableClass))&&S.appendChild(s),w!==s&&a.removeChild(w);if(r.unjoinNbsps)for(var N=t.dom.getTextNodes(S),A=N.length;A--;)N[A].nodeValue=N[A].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return a.innerHTML="",a.appendChild(S),T?t.quirks.getCorrectInnerHTML(a):a}(e,r)},t.dom.query=function(e,t){var r,a=[];e.nodeType&&(e=[e]);for(var s=0,l=e.length;s<l;s++)if(r=e[s].querySelectorAll(t))for(var y=r.length;y--;a.unshift(r[y]));return a},t.dom.removeEmptyTextNodes=function(e){for(var r,a=t.lang.array(e.childNodes).get(),s=a.length,l=0;l<s;l++)(r=a[l]).nodeType===t.TEXT_NODE&&/^[\n\r]*$/.test(r.data)&&r.parentNode.removeChild(r)},t.dom.removeInvisibleSpaces=function(e){for(var r=t.dom.getTextNodes(e),a=r.length;a--;)r[a].nodeValue=r[a].nodeValue.replace(t.INVISIBLE_SPACE_REG_EXP,"")},t.dom.renameElement=function(e,r){for(var a,s=e.ownerDocument.createElement(r);a=e.firstChild;)s.appendChild(a);return t.dom.copyAttributes(["align","className"]).from(e).to(s),e.parentNode&&e.parentNode.replaceChild(s,e),s},t.dom.replaceWithChildNodes=function(e){if(e.parentNode){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}},function(e){function _isBlockElement(t){return"block"===e.getStyle("display").from(t)}function _isLineBreak(e){return"BR"===e.nodeName}function _appendLineBreak(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}e.resolveList=function resolveList(e,r){if(e.nodeName.match(/^(MENU|UL|OL)$/)){var a,s,l,y,w,E,S,T=e.ownerDocument,O=T.createDocumentFragment(),N=t.dom.domNode(e).prev({ignoreBlankTexts:!0}),A=t.dom.domNode(e).next({ignoreBlankTexts:!0}),L=e.lastElementChild||e.lastChild;if(r)for(!N||_isBlockElement(N)||_isLineBreak(N)||_appendLineBreak(O);E=e.firstElementChild||e.firstChild;){for(s=E.lastChild,S=E===L;a=E.firstChild;)l=a===s,y=(!S||A&&!_isBlockElement(A))&&l&&!_isBlockElement(a)&&!_isLineBreak(a),O.appendChild(a),y&&_appendLineBreak(O);E.parentNode.removeChild(E)}else for(;E=e.firstElementChild||e.firstChild;){if(E.querySelector&&E.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;a=E.firstChild;)O.appendChild(a);else{for(w=T.createElement("p");a=E.firstChild;)w.appendChild(a);O.appendChild(w)}E.parentNode.removeChild(E)}e.parentNode.replaceChild(O,e)}}}(t.dom),function(e){var t=document,r=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],a=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],s=["referrer","write","open","close"];e.dom.Sandbox=q.extend({constructor:function constructor(t,r){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(r).get(),this.config.className||(this.config.className="wysihtml-sandbox"),this.editableArea=this._createIframe()},insertInto:function insertInto(e){"string"==typeof e&&(e=t.getElementById(e)),e.appendChild(this.editableArea)},getIframe:function getIframe(){return this.editableArea},getWindow:function getWindow(){this._readyError()},getDocument:function getDocument(){this._readyError()},destroy:function destroy(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function _readyError(){throw new Error("wysihtml.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function _createIframe(){var r=this,a=t.createElement("iframe");return a.className=this.config.className,e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(a),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(a.src="javascript:'<html></html>'"),a.onload=function(){a.onreadystatechange=a.onload=null,r._onLoadIframe(a)},a.onreadystatechange=function(){/loaded|complete/.test(a.readyState)&&(a.onreadystatechange=a.onload=null,r._onLoadIframe(a))},a},_onLoadIframe:function _onLoadIframe(l){if(e.dom.contains(t.documentElement,l)){var y=this,w=l.contentWindow,E=l.contentWindow.document,S=t.characterSet||t.charset||"utf-8",T=this._getHtml({charset:S,stylesheets:this.config.stylesheets});if(E.open("text/html","replace"),E.write(T),E.close(),this.getWindow=function(){return l.contentWindow},this.getDocument=function(){return l.contentWindow.document},w.onerror=function(e,t,r){throw new Error("wysihtml.Sandbox: "+e,t,r)},!e.browser.supportsSandboxedIframes()){var O,N;for(O=0,N=r.length;O<N;O++)this._unset(w,r[O]);for(O=0,N=a.length;O<N;O++)this._unset(w,a[O],e.EMPTY_FUNCTION);for(O=0,N=s.length;O<N;O++)this._unset(E,s[O]);this._unset(E,"cookie","",!0)}e.polyfills&&e.polyfills(w,E).apply(),this.loaded=!0,setTimeout((function(){y.callback(y)}),0)}},_getHtml:function _getHtml(t){var r,a=t.stylesheets,s="",l=0;if(a="string"==typeof a?[a]:a)for(r=a.length;l<r;l++)s+='<link rel="stylesheet" href="'+a[l]+'">';return t.stylesheets=s,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function _unset(t,r,a,s){try{t[r]=a}catch(e){}try{t.__defineGetter__(r,(function(){return a}))}catch(e){}if(s)try{t.__defineSetter__(r,(function(){}))}catch(e){}if(!e.browser.crashesWhenDefineProperty(r))try{var l={get:function get(){return a}};s&&(l.set=function(){}),Object.defineProperty(t,r,l)}catch(e){}}})}(t),D={className:"class"},t.dom.setAttributes=function(e){return{on:function on(t){for(var r in e)t.setAttribute(D[r]||r,e[r])}}},t.dom.setStyles=function(e){return{on:function on(t){var r=t.style;if("string"!=typeof e)for(var a in e)"float"===a?(r.cssFloat=e[a],r.styleFloat=e[a]):r[a]=e[a];else r.cssText+=";"+e}}},function(e){e.simulatePlaceholder=function(t,r,a,s){var l=s||"wysihtml-placeholder",y=function unset(){r.placeholderSet=!1,e.removeClass(r.element,l)},w=function set(){r.isEmpty()&&!r.placeholderSet&&(r.placeholderSet=!0,e.addClass(r.element,l))};t.on("set_placeholder",w).on("unset_placeholder",y).on("focus:composer",y).on("paste:composer",y).on("blur:composer",w),w()}}(t.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(t.dom),t.dom.unwrap=function(e){var r=[];if(e.parentNode){for(;e.lastChild;)r.unshift(e.lastChild),t.dom.insert(e.lastChild).after(e);e.parentNode.removeChild(e)}return r},t.quirks.cleanPastedHTML=(M=function styleToRegex(e){var r=t.lang.string(e).trim().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^((?!^"+r+"$).)*$","i")},function(e,r){var a={color:t.dom.getStyle("color").from(r.referenceNode),fontSize:t.dom.getStyle("font-size").from(r.referenceNode)},s=function extendRulesWithStyleExceptions(e,r){var a,s,l=t.lang.object(e).clone(!0);for(a in l.tags)if(l.tags.hasOwnProperty(a)&&l.tags[a].keep_styles)for(s in l.tags[a].keep_styles)l.tags[a].keep_styles.hasOwnProperty(s)&&r[s]&&(l.tags[a].keep_styles[s]=M(r[s]));return l}(function pickRuleset(e,t){var r;if(!e)return null;for(var a=0,s=e.length;a<s;a++)if(e[a].condition||(r=e[a].set),e[a].condition&&e[a].condition.test(t))return e[a].set;return r}(r.rules,e)||{},a);return t.dom.parse(e,{rules:s,cleanUp:!0,context:r.referenceNode.ownerDocument,uneditableClass:r.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}),t.quirks.ensureProperClearing=(B=function clearIfNecessary(){var e=this;setTimeout((function(){var t=e.innerHTML.toLowerCase();"<p>&nbsp;</p>"!=t&&"<p>&nbsp;</p><p>&nbsp;</p>"!=t||(e.innerHTML="")}),0)},function(e){t.dom.observe(e.element,["cut","keydown"],B)}),function(e){e.quirks.getCorrectInnerHTML=function(t){var r=t.innerHTML;if(-1===r.indexOf("%7E"))return r;var a,s,l,y,w=t.querySelectorAll("[href*='~'], [src*='~']");for(y=0,l=w.length;y<l;y++)a=w[y].href||w[y].src,s=e.lang.string(a).replace("~").by("%7E"),r=e.lang.string(r).replace(s).by(a);return r}}(t),function(e){e.quirks.redraw=function(t){e.dom.addClass(t,"wysihtml-quirks-redraw"),e.dom.removeClass(t,"wysihtml-quirks-redraw");try{var r=t.ownerDocument;r.execCommand("italic",!1,null),r.execCommand("italic",!1,null)}catch(e){}}}(t),function(e){var t={rgba:{regex:/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,name:"rgba"},rgb:{regex:/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,name:"rgb"},hex6:{regex:/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,name:"hex",radix:16},hex3:{regex:/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,name:"hex",radix:16}},r=function makeParamRegExp(e){return new RegExp("(^|\\s|;)"+e+"\\s*:\\s*[^;$]+","gi")};function getColorParseMethod(e){var r,a;for(r in t)if(t.hasOwnProperty(r)&&(a=t[r]).regex.test(e))return a}e.quirks.styleParser={getColorParseMethod:getColorParseMethod,getColorFormat:function getColorFormat(e){var t=getColorParseMethod(e);return t?t.name:void 0},parseColor:function parseColor(a,s){var l,y,w,E,S,T=a;if(s){if(l=r(s),!(y=a.match(l)))return!1;y=y.pop().split(":")[1],T=e.lang.string(y).trim()}return!!(w=getColorParseMethod(T))&&(!!(E=T.match(w.regex))&&(S=w.radix||10,w===t.hex3?(E.shift(),E.push(1),e.lang.array(E).map((function(e,t){return t<3?parseInt(e,S)*S+parseInt(e,S):parseFloat(e)}))):(E.shift(),E[3]||E.push(1),e.lang.array(E).map((function(e,t){return t<3?parseInt(e,S):parseFloat(e)})))))},unparseColor:function unparseColor(e,t){return"hex"===t?(e[0].toString(16)+e[1].toString(16)+e[2].toString(16)).toUpperCase():"hash"===t?"#"+(e[0].toString(16)+e[1].toString(16)+e[2].toString(16)).toUpperCase():"rgb"===t?"rgb("+e[0]+","+e[1]+","+e[2]+")":"rgba"===t?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"csv"===t?e[0]+","+e[1]+","+e[2]+","+e[3]:e[3]&&1!==e[3]?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"rgb("+e[0]+","+e[1]+","+e[2]+")"},parseFontSize:function parseFontSize(t){var a=t.match(r("font-size"));return!!a&&e.lang.string(a[a.length-1].split(":")[1]).trim()}}}(t),function(t){var a=t.dom;function getDepth(e,t){for(var r=0;t!==e;)if(r++,!(t=t.parentNode))throw new Error("not a descendant of ancestor!");return r}function getRangeNode(e,t){return e?3===e.nodeType?e:e.childNodes[t]||e:e}function getWebkitSelectionFixNode(e){var r=document.createElement("span"),a=function placeholderRemover(t){e.removeEventListener("mouseup",placeholderRemover),e.removeEventListener("keydown",placeholderRemover),e.removeEventListener("touchstart",placeholderRemover),e.removeEventListener("focus",placeholderRemover),e.removeEventListener("blur",placeholderRemover),e.removeEventListener("paste",s),e.removeEventListener("drop",s),e.removeEventListener("beforepaste",s),r&&r.parentNode&&r.parentNode.removeChild(r)},s=function delayedPlaceholderRemover(e){r&&r.parentNode&&setTimeout(a,0)};return r.appendChild(e.ownerDocument.createTextNode(t.INVISIBLE_SPACE)),r.className="_wysihtml-temp-caret-fix",r.style.display="block",r.style.minWidth="1px",r.style.height="0px",e.addEventListener("mouseup",a),e.addEventListener("keydown",a),e.addEventListener("touchstart",a),e.addEventListener("focus",a),e.addEventListener("blur",a),e.addEventListener("paste",s),e.addEventListener("drop",s),e.addEventListener("beforepaste",s),r}t.Selection=q.extend({constructor:function constructor(e,t,a){r.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc,this.win=this.composer.win,this.contain=t,this.unselectableClass=a||!1},getBookmark:function getBookmark(){var e=this.getRange();return e&&e.cloneRange()},setBookmark:function setBookmark(e){e&&this.setSelection(e)},setBefore:function setBefore(e){var t=r.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},createTemporaryCaretSpaceAfter:function createTemporaryCaretSpaceAfter(e){var r=this.doc.createElement("span"),a=this.doc.createTextNode(t.INVISIBLE_SPACE),s=function(e){var a;this.contain.removeEventListener("mouseup",s),this.contain.removeEventListener("keydown",y),this.contain.removeEventListener("touchstart",s),this.contain.removeEventListener("focus",s),this.contain.removeEventListener("blur",s),this.contain.removeEventListener("paste",l),this.contain.removeEventListener("drop",l),this.contain.removeEventListener("beforepaste",l),r&&r.parentNode&&(r.innerHTML=r.innerHTML.replace(t.INVISIBLE_SPACE_REG_EXP,""),/[^\s]+/.test(r.innerHTML)?(a=r.lastChild,t.dom.unwrap(r),this.setAfter(a)):r.parentNode.removeChild(r))}.bind(this),l=function delayedPlaceholderRemover(e){r&&r.parentNode&&setTimeout(s,0)},y=function keyDownHandler(e){8===e.which||91===e.which||17===e.which||86===e.which&&(e.ctrlKey||e.metaKey)||s()};return r.className="_wysihtml-temp-caret-fix",r.style.position="absolute",r.style.display="block",r.style.minWidth="1px",r.style.zIndex="99999",r.appendChild(a),e.parentNode.insertBefore(r,e.nextSibling),this.setBefore(a),this.contain.addEventListener("mouseup",s),this.contain.addEventListener("keydown",y),this.contain.addEventListener("touchstart",s),this.contain.addEventListener("focus",s),this.contain.addEventListener("blur",s),this.contain.addEventListener("paste",l),this.contain.addEventListener("drop",l),this.contain.addEventListener("beforepaste",l),r},setAfter:function setAfter(e,a,s){var l,y=this.win,w=r.createRange(this.doc),E=function(){var r=e.parentNode,s=r?r.childNodes[r.childNodes.length-1]:null;if(!l||s===e&&1===e.nodeType&&"block"===y.getComputedStyle(e).display)if(a){var w=this.doc.createTextNode(t.INVISIBLE_SPACE);e.parentNode.insertBefore(w,e.nextSibling),this.selectNode(w),setTimeout((function(){w&&w.parentNode&&w.parentNode.removeChild(w)}),0)}else this.createTemporaryCaretSpaceAfter(e)}.bind(this);w.setStartAfter(e),w.setEndAfter(e),document.activeElement&&document.activeElement===this.composer.element?(l=this.setSelection(w),E(),s&&s(l)):setTimeout(function(){l=this.setSelection(w),E(),s&&s(l)}.bind(this),0)},selectNode:function selectNode(e,s){var l=r.createRange(this.doc),y=e.nodeType===t.ELEMENT_NODE,w="canHaveHTML"in e?e.canHaveHTML:"IMG"!==e.nodeName,E=y?e.innerHTML:e.data,S=""===E||E===t.INVISIBLE_SPACE,T=a.getStyle("display").from(e),O="block"===T||"list-item"===T;if(S&&y&&w&&!s)try{e.innerHTML=t.INVISIBLE_SPACE}catch(e){}w?l.selectNodeContents(e):l.selectNode(e),w&&S&&y?l.collapse(O):w&&S&&(l.setStartAfter(e),l.setEndAfter(e)),this.setSelection(l)},getSelectedNode:function getSelectedNode(e){var t,r;return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(r=this.doc.selection.createRange())&&r.length?r.item(0):(t=this.getSelection(this.doc)).focusNode===t.anchorNode?t.focusNode:(r=this.getRange(this.doc))?r.commonAncestorContainer:this.doc.body},fixSelBorders:function fixSelBorders(){var e=this.getRange();!function expandRangeToSurround(e){if(!e.canSurroundContents())for(var t=e.commonAncestorContainer,r=getDepth(t,e.startContainer),a=getDepth(t,e.endContainer);!e.canSurroundContents();)r>a?(e.setStartBefore(e.startContainer),r=getDepth(t,e.startContainer)):(e.setEndAfter(e.endContainer),a=getDepth(t,e.endContainer))}(e),this.setSelection(e)},getSelectedOwnNodes:function getSelectedOwnNodes(e){for(var t=this.getOwnRanges(),r=[],a=0,s=t.length;a<s;a++)r.push(t[a].commonAncestorContainer||this.doc.body);return r},findNodesInSelection:function findNodesInSelection(e){for(var r,a=this.getOwnRanges(),s=[],l=0,y=a.length;l<y;l++)r=a[l].getNodes([1],(function(r){return t.lang.array(e).contains(r.nodeName)})),s=s.concat(r);return s},filterElements:function filterElements(e){for(var t,r=this.getOwnRanges(),a=[],s=0,l=r.length;s<l;s++)t=r[s].getNodes([1],(function(t){return e(t,r[s])})),a=a.concat(t);return a},containsUneditable:function containsUneditable(){for(var e=this.getOwnUneditables(),t=this.getSelection(),r=0,a=e.length;r<a;r++)if(t.containsNode(e[r]))return!0;return!1},deleteContents:function deleteContents(){var e=this.getRange();this.deleteRangeContents(e),this.setSelection(e)},deleteRangeContents:function deleteRangeContents(e){var r,a,s,l;if(this.unselectableClass){(r=t.dom.getParentElement(e.startContainer,{query:"."+this.unselectableClass},!1,this.contain))&&e.setStartBefore(r),(a=t.dom.getParentElement(e.endContainer,{query:"."+this.unselectableClass},!1,this.contain))&&e.setEndAfter(a);for(var y=(s=e.getNodes([1],function(e){return t.dom.hasClass(e,this.unselectableClass)}.bind(this))).length;y--;)try{l=new CustomEvent("wysihtml:uneditable:delete"),s[y].dispatchEvent(l)}catch(e){}}e.deleteContents()},getCaretNode:function getCaretNode(){var e=this.getSelection();return e&&e.anchorNode?getRangeNode(e.anchorNode,e.anchorOffset):null},getPreviousNode:function getPreviousNode(e,r){var a;if(!e){var s=this.getSelection();e=s&&s.anchorNode?getRangeNode(s.anchorNode,s.anchorOffset):null}if(!e||e===this.contain)return!1;var l,y=e.previousSibling;return y!==this.contain&&(y&&3!==y.nodeType&&1!==y.nodeType||y&&3===y.nodeType&&/^\s*$/.test(y.textContent)?y=this.getPreviousNode(y,r):r&&y&&1===y.nodeType?(a=t.dom.getStyle("display").from(y),t.lang.array(["BR","HR","IMG"]).contains(y.nodeName)||t.lang.array(["block","inline-block","flex","list-item","table"]).contains(a)||!/^[\s]*$/.test(y.innerHTML)||(y=this.getPreviousNode(y,r))):y||e===this.contain||(l=e.parentNode)!==this.contain&&(y=this.getPreviousNode(l,r)),y!==this.contain&&y)},getNodesNearCaret:function getNodesNearCaret(){if(!this.isCollapsed())throw"Selection must be caret when using selection.getNodesNearCaret()";var e,t,r,a,s=this.getOwnRanges();return s&&s.length>0?(1===s[0].startContainer.nodeType?(e=s[0].startContainer.childNodes[s[0].startOffset-1])||0!==s[0].startOffset?e&&(t=e.previousSibling,r=e.nextSibling):r=s[0].startContainer.childNodes[0]:(0===s[0].startOffset&&s[0].startContainer.previousSibling?3===(e=s[0].startContainer.previousSibling).nodeType&&(a=e.data.length):(e=s[0].startContainer,a=s[0].startOffset),t=e.previousSibling,r=e.nextSibling),{caretNode:e,prevNode:t,nextNode:r,textOffset:a}):null},getSelectionParentsByTag:function getSelectionParentsByTag(e){for(var r,a=this.getSelectedOwnNodes(),s=[],l=0,y=a.length;l<y;l++)(r=a[l].nodeName&&"LI"===a[l].nodeName?a[l]:t.dom.getParentElement(a[l],{query:"li"},!1,this.contain))&&s.push(r);return s.length?s:null},getRangeToNodeEnd:function getRangeToNodeEnd(){if(this.isCollapsed()){var e,t,a,s=this.getRange();if(s)return e=s.startContainer,t=s.startOffset,(a=r.createRange(this.doc)).selectNodeContents(e),a.setStart(e,t),a}},getRangeToNodeBeginning:function getRangeToNodeBeginning(){if(this.isCollapsed()){var e=this.getRange(),t=e.startContainer,a=e.startOffset,s=r.createRange(this.doc);return s.selectNodeContents(t),s.setEnd(t,a),s}},caretIsInTheEndOfNode:function caretIsInTheEndOfNode(e){r.createRange(this.doc),this.getSelection();var t,a,s=this.getRangeToNodeEnd();return!!s&&(t=s.cloneContents().textContent,!!/^\s*$/.test(t)&&(!e||(a=this.getRangeToNodeBeginning().cloneContents().textContent,!/[\u00A0 ][\s\uFEFF]*$/.test(a))))},caretIsFirstInSelection:function caretIsFirstInSelection(e){var a=r.createRange(this.doc),s=this.getSelection(),l=this.getRange(),y=getRangeNode(l.startContainer,l.startOffset);if(y){if(y.nodeType===t.TEXT_NODE){if(!y.parentNode)return!1;if(!this.isCollapsed()||y.parentNode.firstChild!==y&&!t.dom.domNode(y.previousSibling).is.block())return!1;var w=this.win.getComputedStyle(y.parentNode).whiteSpace;return"pre"===w||"pre-wrap"===w?0===l.startOffset:/^\s*$/.test(y.data.substr(0,l.startOffset))}return!(!e||!t.dom.domNode(y).is.lineBreak())||(a.selectNodeContents(this.getRange().commonAncestorContainer),a.collapse(!0),this.isCollapsed()&&(a.startContainer===s.anchorNode||a.endContainer===s.anchorNode)&&a.startOffset===s.anchorOffset)}},caretIsInTheBeginnig:function caretIsInTheBeginnig(e){var r=this.getSelection(),a=r.anchorNode,s=r.anchorOffset;return e&&a?0===s&&(a.nodeName&&a.nodeName===e.toUpperCase()||t.dom.getParentElement(a.parentNode,{query:e},1)):a?0===s&&!this.getPreviousNode(a,!0):void 0},getBeforeSelection:function getBeforeSelection(e){var r,a,s=this.getSelection(),l=s.isBackwards()?s.focusNode:s.anchorNode,y=s.isBackwards()?s.focusOffset:s.anchorOffset,w=this.createRange();if(l&&3===l.nodeType&&/^\s*$/.test(l.data.slice(0,y))&&(y=0),(a=t.dom.getParentElement(l,{query:"._wysihtml-temp-caret-fix"},1))&&(l=a.parentNode,y=Array.prototype.indexOf.call(l.childNodes,a)),l){if(y>0)return 3===l.nodeType?(w.setStart(l,0),w.setEnd(l,y),{type:"text",range:w,offset:y,node:l}):(w.setStartBefore(l.childNodes[0]),r=l.childNodes[y-1],w.setEndAfter(r),{type:"element",range:w,offset:y,node:r});if(w.setStartAndEnd(l,0),e){var E=this.getPreviousNode(l,!0),S=null;if(E&&(S=1===E.nodeType&&t.dom.hasClass(E,this.unselectableClass)?E:t.dom.domNode(E).lastLeafNode()),S)return{type:"leafnode",range:w,offset:y,node:S}}return{type:"none",range:w,offset:y,node:l}}return null},executeAndRestoreRangy:function executeAndRestoreRangy(e,t){var a=r.saveSelection(this.win);if(a)try{e()}catch(e){setTimeout((function(){throw e}),0)}else e();r.restoreSelection(a)},executeAndRestore:function executeAndRestore(e,s){var l,y,w,E,S,T,O,N,A=this.doc.body,L=s&&A.scrollTop,R=s&&A.scrollLeft,D="_wysihtml-temp-placeholder",M='<span class="'+D+'">'+t.INVISIBLE_SPACE+"</span>",B=this.getRange(!0);if(B){B.collapsed||(T=(O=B.cloneRange()).createContextualFragment(M),O.collapse(!1),O.insertNode(T),O.detach()),S=B.createContextualFragment(M),B.insertNode(S),T&&(l=this.contain.querySelectorAll("."+D),B.setStartBefore(l[0]),B.setEndAfter(l[l.length-1])),this.setSelection(B);try{e(B.startContainer,B.endContainer)}catch(e){setTimeout((function(){throw e}),0)}if((l=this.contain.querySelectorAll("."+D))&&l.length){N=r.createRange(this.doc),w=l[0].nextSibling,l.length>1&&(E=l[l.length-1].previousSibling),E&&w?(N.setStartBefore(w),N.setEndAfter(E)):(y=this.doc.createTextNode(t.INVISIBLE_SPACE),a.insert(y).after(l[0]),N.setStartBefore(y),N.setEndAfter(y)),this.setSelection(N);for(var q=l.length;q--;)l[q].parentNode.removeChild(l[q])}else this.contain.focus();s&&(A.scrollTop=L,A.scrollLeft=R);try{l.parentNode.removeChild(l)}catch(e){}}else e(A,A)},set:function set(e,t){var a=r.createRange(this.doc);a.setStart(e,t||0),this.setSelection(a)},insertHTML:function insertHTML(t){var r,a,s=this.getRange(),l=this.doc.createElement("DIV"),y=this.doc.createDocumentFragment();if(s){var w;if(l.innerHTML=t,r=l.lastChild,3!==l.firstChild.nodeType&&l.firstChild.matches&&l.firstChild.matches(e)){var E=s.endContainer;if(E&&3!==E.nodeType&&E.matches(e))w=E;else for(w=E.parentNode;w&&!w.matches(e);)w=w.parentNode}for(;l.firstChild;)y.appendChild(l.firstChild);for(s.deleteContents(),w===this.editor.editableElement&&(w=w.lastChild),w?w.parentNode.insertBefore(y,w.nextSibling):s.insertNode(y),a=this.contain.lastChild;a&&3===a.nodeType&&a.previousSibling&&/^\s*$/.test(a.data);)a=a.previousSibling;if(r){if(a&&r===a&&1===r.nodeType){var S=this.doc.createElement(function defaultNodeName(e){return e.config.useLineBreaks?"DIV":"P"}(this.composer));S.innerHTML="<br>",this.contain.appendChild(S)}this.setAfter(r)}}},insertNode:function insertNode(e){var t=this.getRange();t&&(t.deleteContents(),t.insertNode(e))},canAppendChild:function canAppendChild(e){var t,r,a=this.getRange();return(t=e||a.startContainer)&&(r=(t.tagName||t.nodeName).toLowerCase()),-1===["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].indexOf(r)},splitElementAtCaret:function splitElementAtCaret(e,r){var a,s,l,y,w,E=this.getSelection();if(E.rangeCount>0){(a=E.getRangeAt(0).cloneRange()).setEndAfter(e);for(var S=(w=(s=a.extractContents()).childNodes).length;S--;)t.dom.domNode(w[S]).is.visible()||s.removeChild(w[S]);if(e.parentNode.insertBefore(s,e.nextSibling),r?(l=r.firstChild||r,y=r.lastChild||r,e.parentNode.insertBefore(r,e.nextSibling),l&&y&&(a.setStartBefore(l),a.setEndAfter(y),this.setSelection(a))):(a.setStartAfter(e),a.setEndAfter(e)),!t.dom.domNode(e).is.visible()){var T=t.dom.getTextContent(e);""===T||T===t.INVISIBLE_SPACE?e.parentNode.removeChild(e):e.parentNode.replaceChild(this.doc.createTextNode(" "),e)}}},surround:function surround(e){var t,r=this.getOwnRanges(),a=[];if(0==r.length)return a;for(var s=r.length;s--;){t=this.doc.createElement(e.nodeName),a.push(t),e.className&&(t.className=e.className),e.cssStyle&&t.setAttribute("style",e.cssStyle);try{r[s].surroundContents(t),this.selectNode(t)}catch(e){t.appendChild(r[s].extractContents()),r[s].insertNode(t)}}return a},scrollIntoView:function scrollIntoView(){var e,r,a=this.doc,s=a.documentElement.scrollHeight>a.documentElement.offsetHeight,l=a._wysihtmlScrollIntoViewElement=a._wysihtmlScrollIntoViewElement||((r=a.createElement("span")).innerHTML=t.INVISIBLE_SPACE,r);s&&(this.insertNode(l),e=function _getCumulativeOffsetTop(e){var t=0;if(e.parentNode)do{t+=e.offsetTop||0,e=e.offsetParent}while(e);return t}(l),l.parentNode.removeChild(l),e>=a.body.scrollTop+a.documentElement.offsetHeight-5&&(a.body.scrollTop=e))},selectLine:function selectLine(){var e=r.createRange();t.browser.supportsSelectionModify()?this._selectLine_W3C():e.nativeRange&&e.nativeRange.getBoundingClientRect&&this._selectLineUniversal()},includeRangyRangeHelpers:function includeRangyRangeHelpers(){var e=this.getSelection(),t=e.getRangeAt(0),r=function isHelperNode(e){return e&&1===e.nodeType&&e.classList.contains("rangySelectionBoundary")},a=1===e.anchorNode.nodeType?e.anchorNode.childNodes[e.anchorOffset]:e.anchorNode,s=1===e.focusNode.nodeType?e.focusNode.childNodes[e.focusOffset]:e.focusNode;s&&e.focusOffset===function getNodeLength(e){return 1===e.nodeType?e.childNodes&&e.childNodes.length||0:e.data&&e.data.length||0}(s)&&s.nextSibling&&r(s.nextSibling)&&t.setEndAfter(s.nextSibling),a&&0===e.anchorOffset&&a.previousSibling&&r(a.previousSibling)&&t.setStartBefore(a.previousSibling),t.select()},_selectLine_W3C:function _selectLine_W3C(){var e=this.win.getSelection(),t=[e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset];e.modify("move","left","lineboundary"),e.modify("extend","right","lineboundary"),e.anchorNode===t[0]&&e.anchorOffset===t[1]&&e.focusNode===t[2]&&e.focusOffset===t[3]?this._selectLineUniversal():this.includeRangyRangeHelpers()},toLineBoundary:function toLineBoundary(e,r){if(r=void 0!==r&&r,t.browser.supportsSelectionModify()){var a=this.win.getSelection();a.modify("extend",e,"lineboundary"),r&&("left"===e?a.collapseToStart():"right"===e&&a.collapseToEnd())}},getRangeRect:function getRangeRect(e){this.doc.createTextNode("i");var t,r=this.doc.createTextNode("i");return e.collapsed?(e.insertNode(r),e.selectNode(r),t=e.nativeRange.getBoundingClientRect(),e.deleteContents()):t=e.nativeRange.getBoundingClientRect(),t},_selectLineUniversal:function _selectLineUniversal(){var e,r,a,s,l=this.getSelection().getRangeAt(0),y=0,w=this;l.cloneRange(),l.cloneRange(),l.collapsed&&(3===l.startContainer.nodeType&&l.startOffset<l.startContainer.data.length||1===l.startContainer.nodeType&&l.startContainer.childNodes[l.startOffset]&&3===l.startContainer.childNodes[l.startOffset].nodeType&&l.startContainer.childNodes[l.startOffset].data.length>0?l.moveEnd("character",1):l.startOffset>0&&(3===l.startContainer.nodeType||1===l.startContainer.nodeType&&!function isLineBreakingElement(e){return e&&1===e.nodeType&&("block"===w.win.getComputedStyle(e).display||t.lang.array(["BR","HR"]).contains(e.nodeName))}(function prevNode(e){var t=e;if(t)for(;t&&(1===t.nodeType&&t.classList.contains("rangySelectionBoundary")||3===t.nodeType&&/^\s*$/.test(t.data));)t=t.previousSibling;return t}(l.startContainer.childNodes[l.startOffset-1])))&&l.moveStart("character",-1)),l.collapsed,e=l.nativeRange.getBoundingClientRect();do{r=l.moveStart("character",-1),(a=l.nativeRange.getBoundingClientRect())&&Math.floor(a.top)===Math.floor(e.top)||(l.moveStart("character",1),s=!0),y++}while(0!==r&&!s&&y<2e3);if(y=0,s=!1,e=l.nativeRange.getBoundingClientRect(),l.endContainer!==this.contain||this.contain.lastChild&&this.contain.childNodes[l.endOffset]!==this.contain.lastChild)do{r=l.moveEnd("character",1),(a=l.nativeRange.getBoundingClientRect())&&Math.floor(a.bottom)===Math.floor(e.bottom)||(l.moveEnd("character",-1),l.endContainer&&1===l.endContainer.nodeType&&l.endContainer.childNodes[l.endOffset]&&1===l.endContainer.childNodes[l.endOffset].nodeType&&"BR"===l.endContainer.childNodes[l.endOffset].nodeName&&l.endContainer.childNodes[l.endOffset].previousSibling&&(1===l.endContainer.childNodes[l.endOffset].previousSibling.nodeType?l.setEnd(l.endContainer.childNodes[l.endOffset].previousSibling,l.endContainer.childNodes[l.endOffset].previousSibling.childNodes.length):3===l.endContainer.childNodes[l.endOffset].previousSibling.nodeType&&l.setEnd(l.endContainer.childNodes[l.endOffset].previousSibling,l.endContainer.childNodes[l.endOffset].previousSibling.data.length)),s=!0),y++}while(0!==r&&!s&&y<2e3);l.select(),this.includeRangyRangeHelpers()},getText:function getText(){var e=this.getSelection();return e?e.toString():""},getNodes:function getNodes(e,t){var r=this.getRange();return r?r.getNodes(Array.isArray(e)?e:[e],t):[]},getOwnNodes:function getOwnNodes(e,t,r){for(var a=this.getOwnRanges(),s=[],l=0,y=a.length;l<y;l++)a[l]&&(r&&a[l].splitBoundaries(),s=s.concat(a[l].getNodes(Array.isArray(e)?e:[e],t)));return s},fixRangeOverflow:function fixRangeOverflow(e){if(this.contain&&this.contain.firstChild&&e){var t=e.compareNode(this.contain);if(2!==t)1===t&&e.setStartBefore(this.contain.firstChild),0===t&&e.setEndAfter(this.contain.lastChild),3===t&&(e.setStartBefore(this.contain.firstChild),e.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(e)){var r=e.endContainer.previousElementSibling;r&&e.setEnd(r,this._endOffsetForNode(r))}}},_endOffsetForNode:function _endOffsetForNode(e){var t=document.createRange();return t.selectNodeContents(e),t.endOffset},_detectInlineRangeProblems:function _detectInlineRangeProblems(e){var t=a.compareDocumentPosition(e.startContainer,e.endContainer);return 0==e.endOffset&&4&t},getRange:function getRange(e){var t=this.getSelection(),r=t&&t.rangeCount&&t.getRangeAt(0);return!0!==e&&this.fixRangeOverflow(r),r},getOwnUneditables:function getOwnUneditables(){var e=a.query(this.contain,"."+this.unselectableClass),r=a.query(e,"."+this.unselectableClass);return t.lang.array(e).without(r)},getOwnRanges:function getOwnRanges(){var e,t=[],r=this.getRange();if(r&&t.push(r),this.unselectableClass&&this.contain&&r){var a,s=this.getOwnUneditables();if(s.length>0)for(var l=0,y=s.length;l<y;l++){e=[];for(var w=0,E=t.length;w<E;w++){if(t[w])switch(t[w].compareNode(s[l])){case 2:break;case 3:(a=t[w].cloneRange()).setEndBefore(s[l]),e.push(a),(a=t[w].cloneRange()).setStartAfter(s[l]),e.push(a);break;default:e.push(t[w])}t=e}}}return t},getSelection:function getSelection(){return r.getSelection(this.win)},setSelection:function setSelection(e){var t=r.getSelection(this.win);return t.setSingleRange(e),t&&t.anchorNode&&t.focusNode?t:null},selectAll:function selectAll(){var e,r=this.createRange(),a=this.composer,s=this,l=getWebkitSelectionFixNode(this.composer.element),y=getWebkitSelectionFixNode(this.composer.element),w=function doSelect(){r.setStart(a.element,0),r.setEnd(a.element,a.element.childNodes.length),e=s.setSelection(r)},E=function notSelected(){return!e||e.nativeSelection&&e.nativeSelection.type&&("Caret"===e.nativeSelection.type||"None"===e.nativeSelection.type)};t.dom.removeInvisibleSpaces(this.composer.element),w(),this.composer.element.firstChild&&E()&&(this.composer.element.appendChild(l),w(),E()&&(l.parentNode.removeChild(l),this.composer.element.insertBefore(y,this.composer.element.firstChild),w(),E()&&(this.composer.element.appendChild(l),w())))},createRange:function createRange(){return r.createRange(this.doc)},isCollapsed:function isCollapsed(){return this.getSelection().isCollapsed},getHtml:function getHtml(){return this.getSelection().toHtml()},getPlainText:function getPlainText(){return this.getSelection().toString()},isEndToEndInNode:function isEndToEndInNode(e){var r=this.getRange(),a=r.commonAncestorContainer,s=r.startContainer,l=r.endContainer;if(a.nodeType===t.TEXT_NODE&&(a=a.parentNode),s.nodeType===t.TEXT_NODE&&!/^\s*$/.test(s.data.substr(r.startOffset)))return!1;if(l.nodeType===t.TEXT_NODE&&!/^\s*$/.test(l.data.substr(r.endOffset)))return!1;for(;s&&s!==a;){if(s.nodeType!==t.TEXT_NODE&&!t.dom.contains(a,s))return!1;if(t.dom.domNode(s).prev({ignoreBlankTexts:!0}))return!1;s=s.parentNode}for(;l&&l!==a;){if(l.nodeType!==t.TEXT_NODE&&!t.dom.contains(a,l))return!1;if(t.dom.domNode(l).next({ignoreBlankTexts:!0}))return!1;l=l.parentNode}return!!t.lang.array(e).contains(a.nodeName)&&a},isInThisEditable:function isInThisEditable(){var e=this.getSelection(),r=e.focusNode,a=e.anchorNode;return r&&1!==r.nodeType&&(r=r.parentNode),a&&1!==a.nodeType&&(a=a.parentNode),a&&r&&(t.dom.contains(this.composer.element,r)||this.composer.element===r)&&(t.dom.contains(this.composer.element,a)||this.composer.element===a)},deselect:function deselect(){var e=this.getSelection();e&&e.removeAllRanges()}})}(t),t.Commands=q.extend({constructor:function constructor(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function support(e){return t.browser.supportsCommand(this.doc,e)},exec:function exec(e,r){var a=t.commands[e],s=t.lang.array(arguments).get(),l=a&&a.exec,y=null;if(this.composer.hasPlaceholderSet()&&!t.lang.array(["styleWithCSS","enableObjectResizing","enableInlineTableEditing"]).contains(e)&&(this.composer.element.innerHTML="",this.composer.selection.selectNode(this.composer.element)),this.editor.fire("beforecommand:composer",{command:e}),l)s.unshift(this.composer),y=l.apply(a,s);else try{y=this.doc.execCommand(e,!1,r)}catch(e){}return this.editor.fire("aftercommand:composer",{command:e}),y},remove:function remove(e,r){var a=t.commands[e],s=t.lang.array(arguments).get(),l=a&&a.remove;if(l)return s.unshift(this.composer),l.apply(a,s)},state:function state(e,r){var a=t.commands[e],s=t.lang.array(arguments).get(),l=a&&a.state;if(l)return s.unshift(this.composer),l.apply(a,s);try{return this.doc.queryCommandState(e)}catch(e){return!1}},stateValue:function stateValue(e){var r=t.commands[e],a=t.lang.array(arguments).get(),s=r&&r.stateValue;return!!s&&(a.unshift(this.composer),s.apply(r,a))}}),function(e){var t={nodeName:"A",toggle:!1};e.commands.createLink={exec:function exec(r,a,s){var l=function getOptions(r){return _typeof(r),e.lang.object({}).merge(t).merge({attribute:r}).get()}(s);if(r.selection.isCollapsed()&&!this.state(r,a)){var y=r.doc.createTextNode(l.attribute.href);r.selection.insertNode(y),r.selection.selectNode(y)}e.commands.formatInline.exec(r,a,l)},state:function state(r,a){return e.commands.formatInline.state(r,a,t)}}}(t),function(t){var a=t.dom;function getRangeNode(e,t){return 3===e.nodeType?e:e.childNodes[t]||e}function isBr(e){return e&&1===e.nodeType&&"BR"===e.nodeName}function isBookmark(e){return e&&1===e.nodeType&&e.classList.contains("rangySelectionBoundary")}function isLineBreaking(e,t){return isBr(e)||function isBlock(e,t){return e&&1===e.nodeType&&"block"===t.win.getComputedStyle(e).display}(e,t)}function cleanup(r,a){t.dom.removeInvisibleSpaces(r.element);for(var s,l=r.element,y=l.querySelectorAll(e),w="."+r.config.classNames.uneditableContainer+[""].concat(e.split(",")).join(", ."+r.config.classNames.uneditableContainer+" ")+', [contenteditable="false"]'+[""].concat(e.split(",")).join(', [contenteditable="false"] '),E=l.querySelectorAll(w),S=t.lang.array(y).without(E),T=S.length;T--;)""!==S[T].innerHTML.replace(/[\uFEFF]/g,"")||0!==a.length&&S[T]===a[a.length-1]||((s=t.lang.array(a).indexOf(S[T]))>-1&&a.splice(s,1),S[T].parentNode.removeChild(S[T]));return a}function defaultNodeName(e){return e.config.useLineBreaks?"DIV":"P"}function findOuterBlock(t,r,a){for(var s=t,l=null;s&&r&&s!==r;)1===s.nodeType&&s.matches(a?e:"h1, h2, h3, h4, h5, h6, p, pre")&&(l=s),s=s.parentNode;return l}function applyOptionsToElement(e,r,s){return e||(e=s.doc.createElement(r.nodeName||defaultNodeName(s))).appendChild(s.doc.createTextNode(t.INVISIBLE_SPACE)),r.nodeName&&e.nodeName!==r.nodeName&&(e=a.renameElement(e,r.nodeName)),r.classRegExp&&(e.className=e.className.replace(r.classRegExp,"")),r.className&&e.classList.add(r.className),r.styleProperty&&void 0!==r.styleValue&&(e.style[t.browser.fixStyleKey(r.styleProperty)]=r.styleValue),e}function removeOptionsFromElement(e,r,s){var l,y=e.previousSibling,w=e.nextSibling,E=!1;r.styleProperty&&(e.style[t.browser.fixStyleKey(r.styleProperty)]=""),r.className&&e.classList.remove(r.className),r.classRegExp&&(e.className=e.className.replace(r.classRegExp,"")),null!==e.getAttribute("class")&&""===e.getAttribute("class").trim()&&e.removeAttribute("class"),r.nodeName&&e.nodeName.toLowerCase()===r.nodeName.toLowerCase()&&((l=e.getAttribute("style"))&&""!==l.trim()?e=a.renameElement(e,defaultNodeName(s)):(a.unwrap(e),E=!0)),null!==e.getAttribute("style")&&""===e.getAttribute("style").trim()&&e.removeAttribute("style"),E&&function applySurroundingLineBreaks(e,t,r){e&&isBookmark(e)&&(e=e.previousSibling);t&&isBookmark(t)&&(t=t.nextSibling);e&&e.previousSibling,e&&(1!==e.nodeType||"block"!==r.win.getComputedStyle(e).display&&!isBr(e))&&e.parentNode&&e.parentNode.insertBefore(r.doc.createElement("br"),e.nextSibling);t&&(1!==t.nodeType||"block"!==r.win.getComputedStyle(t).display)&&t.parentNode&&t.parentNode.insertBefore(r.doc.createElement("br"),t)}(y,w,s)}function unwrapBlocksFromContent(r){for(var a,s=r.querySelectorAll(e)||[],l=s.length;l--;)a=t.dom.domNode(s[l]).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),t.dom.domNode(s[l]).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),a&&1!==a.nodeType&&"BR"!==a.nodeName&&""!==(s[l].innerHTML||s[l].nodeValue||"").trim()&&s[l].parentNode.insertBefore(s[l].ownerDocument.createElement("BR"),a),a&&1!==a.nodeType&&"BR"!==a.nodeName&&""!==(s[l].innerHTML||s[l].nodeValue||"").trim()&&s[l].parentNode.insertBefore(s[l].ownerDocument.createElement("BR"),a),t.dom.unwrap(s[l])}function fixRangeCoverage(e,t){var r,a=e.startContainer,s=e.endContainer;a&&1===a.nodeType&&a===s?a.firstChild===a.lastChild&&1===e.endOffset&&a!==t.element&&"LI"!==a.nodeName&&"TD"!==a.nodeName&&(e.setStartBefore(a),e.setEndAfter(s)):a&&1===a.nodeType&&3===s.nodeType?a.firstChild===s&&e.endOffset===s.data.length&&a!==t.element&&"LI"!==a.nodeName&&"TD"!==a.nodeName&&e.setEndAfter(a):s&&1===s.nodeType&&3===a.nodeType?s.firstChild===a&&0===e.startOffset&&s!==t.element&&"LI"!==s.nodeName&&"TD"!==s.nodeName&&e.setStartBefore(s):a&&3===a.nodeType&&a===s&&1===a.parentNode.childNodes.length&&e.endOffset==s.data.length&&0===e.startOffset&&(r=a.parentNode)!==t.element&&"LI"!==r.nodeName&&"TD"!==r.nodeName&&(e.setStartBefore(r),e.setEndAfter(r))}function getOptionsWithNodename(e,r,a){var s=e?t.lang.object(e).clone(!0):null;return s&&(s.nodeName=s.nodeName||r||defaultNodeName(a)),s}function injectFragmentToRange(e,r,a,s){var l,y,w,E,S,T=r.startContainer;if(s=s||findOuterBlock(T,a.element,!0))y=e.firstChild,w=e.lastChild,a.selection.splitElementAtCaret(s,e),S=t.dom.domNode(w).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),E=t.dom.domNode(y).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),y&&!isLineBreaking(y,a)&&E&&!isLineBreaking(E,a)&&y.parentNode.insertBefore(a.doc.createElement("br"),y),w&&!isLineBreaking(w,a)&&S&&!isLineBreaking(S,a)&&S.parentNode.insertBefore(a.doc.createElement("br"),S);else if((l=function cloneOuterInlines(e,t){for(var r,a,s,l=e,y=null;l&&t&&l!==t;)1===l.nodeType&&l.matches("b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u")&&(a=l,null===y?r=y=l.cloneNode(!1):((s=l.cloneNode(!1)).appendChild(y),y=s)),l=l.parentNode;return{parent:a,outerNode:y,innerNode:r}}(T,a.element)).outerNode&&l.innerNode&&l.parent){if(1===e.childNodes.length){for(;e.firstChild.firstChild;)l.innerNode.appendChild(e.firstChild.firstChild);e.firstChild.appendChild(l.outerNode)}a.selection.splitElementAtCaret(l.parent,e)}else{var O=e.firstChild,N=e.lastChild;r.insertNode(e),r.setStartBefore(O),r.setEndAfter(N)}}function clearRangeBlockFromating(r,a,s){for(var l,y,w=r.cloneRange(),E=getRangeNode(w.startContainer,w.startOffset).previousSibling,S=getRangeNode(w.endContainer,w.endOffset).nextSibling,T=w.extractContents(),O=s.doc.createDocumentFragment();T.firstChild;){if(1===T.firstChild.nodeType&&T.firstChild.matches(e)){unwrapBlocksFromContent(T.firstChild),(l=t.dom.unwrap(T.firstChild)).length>0&&(O.lastChild&&(1!==O.lastChild.nodeType||!isLineBreaking(O.lastChild,s))||!O.lastChild&&E&&(1!==E.nodeType||isLineBreaking(E,s)))&&O.appendChild(s.doc.createElement("BR"));for(var N=0,A=l.length;N<A;N++)O.appendChild(l[N]);l.length>0&&(1===O.lastChild.nodeType&&isLineBreaking(O.lastChild,s)||(S||O.lastChild!==T.lastChild)&&O.appendChild(s.doc.createElement("BR")))}else O.appendChild(T.firstChild);!1}return y=t.lang.array(O.childNodes).get(),injectFragmentToRange(O,w,s),y}t.findOuterBlock=findOuterBlock;var s=function isWhitespaceAfter(e,t){var r=e.data?e.data.slice(t):"";return/^\s*$/.test(r)};function wrapRangeWithElement(r,a,l,y){var w,E,S=a?function correctOptionsForSimilarityCheck(e){return{nodeName:e.nodeName||null,className:e.classRegExp?null:e.className||null,classRegExp:e.classRegExp||null,styleProperty:e.styleProperty||null}}(a):null,T=r.cloneRange(),O=T.startContainer,N=getRangeNode(T.startContainer,T.startOffset),A=getRangeNode(T.endContainer,T.endOffset),L=T.startContainer!==N||3!==N.nodeType||function isWhitespaceBefore(e,t){var r=e.data?e.data.slice(0,t):"";return/^\s*$/.test(r)}(N,T.startOffset)?t.dom.domNode(N).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}):N,R=1===T.endContainer.nodeType&&T.endContainer.childNodes[T.endOffset]===A&&(1===A.nodeType||!s(A,T.endOffset)&&!t.dom.domNode(A).is.rangyBookmark())||T.endContainer===A&&3===A.nodeType&&!s(A,T.endOffset)?A:t.dom.domNode(A).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),D=T.extractContents(),M=y.doc.createDocumentFragment(),B=S?t.dom.getParentElement(O,S,null,y.element):null,q=!l||!a||"BLOCKQUOTE"===a.nodeName&&"BLOCKQUOTE"===l,W=B||findOuterBlock(O,y.element,q);if(t.dom.domNode(R).is.rangyBookmark()&&(R=(A=R).nextSibling),function trimBlankTextsAndBreaks(e){if(e){for(;e.firstChild&&3===e.firstChild.nodeType&&/^\s*$/.test(e.firstChild.data)&&e.lastChild!==e.firstChild;)e.removeChild(e.firstChild);for(;e.lastChild&&3===e.lastChild.nodeType&&/^\s*$/.test(e.lastChild.data)&&e.lastChild!==e.firstChild;)e.removeChild(e.lastChild);e.firstChild&&1===e.firstChild.nodeType&&"BR"===e.firstChild.nodeName&&e.lastChild!==e.firstChild&&e.removeChild(e.firstChild),e.lastChild&&1===e.lastChild.nodeType&&"BR"===e.lastChild.nodeName&&e.lastChild!==e.firstChild&&e.removeChild(e.lastChild)}}(D),a&&"BLOCKQUOTE"===a.nodeName){var j=applyOptionsToElement(null,a,y);j.appendChild(D),M.appendChild(j),E=[j]}else{if(D.firstChild)for(;D.firstChild;)if(1==D.firstChild.nodeType&&D.firstChild.matches(e))applyOptionsToElement(D.firstChild,a,y),D.firstChild.matches("h1, h2, h3, h4, h5, h6, p, pre")&&unwrapBlocksFromContent(D.firstChild),M.appendChild(D.firstChild);else{for(w=applyOptionsToElement(null,getOptionsWithNodename(a,l,y),y);D.firstChild&&(1!==D.firstChild.nodeType||!D.firstChild.matches(e));)1==D.firstChild.nodeType&&w.matches("h1, h2, h3, h4, h5, h6, p, pre")&&unwrapBlocksFromContent(D.firstChild),w.appendChild(D.firstChild);M.appendChild(w)}else M.appendChild(applyOptionsToElement(null,a,y));E=t.lang.array(M.childNodes).get()}return injectFragmentToRange(M,T,y,W),function removeSurroundingLineBreaks(e,r,a){var s=e&&t.dom.domNode(e).prev({nodeTypes:[1,3],ignoreBlankTexts:!0});isBr(r)&&r.parentNode.removeChild(r),!isBr(e)||s&&1===s.nodeType&&"block"===a.win.getComputedStyle(s).display||e.parentNode.removeChild(e)}(L,R,y),E.length>0&&(void 0===E[E.length-1].lastChild||t.dom.domNode(E[E.length-1].lastChild).is.rangyBookmark())&&E[E.length-1].appendChild(y.doc.createElement("br")),E}function getParentBlockNodeName(r,a){var s=t.dom.getParentElement(r,{query:e},null,a.element);return s?s.nodeName:null}function expandCaretToBlock(e,r){var a,s=t.dom.getParentElement(e.selection.getOwnRanges()[0].startContainer,{query:"h1, h2, h3, h4, h5, h6, p, pre, "+(r?r.toLowerCase():"div")},null,e.element);s?((a=e.selection.createRange()).selectNode(s),e.selection.setSelection(a)):e.isEmpty()||e.selection.selectLine()}function selectElements(e,t){var r=t.selection.createRange(),a=e[e.length-1],s=1===a.nodeType&&a.childNodes?0|a.childNodes.length:a.length||0;r.setStart(e[0],0),r.setEnd(a,s),r.select()}function formatSelection(e,r,a){for(var s,l=r.selection.getOwnRanges(),y=[],w=(l=function fixNotPermittedInsertionPoints(e){for(var r,a,s,l,y,w,E=[],S=0,T=e.length;S<T;S++)if(1===e[S].startContainer.nodeType&&e[S].startContainer.matches("ul, ol")&&e[S].setStart(e[S].startContainer.childNodes[e[S].startOffset],0),1===e[S].endContainer.nodeType&&e[S].endContainer.matches("ul, ol")&&(w=e[S].endContainer.childNodes[Math.max(e[S].endOffset-1,0)]).childNodes&&e[S].setEnd(w,w.childNodes.length),(r=e[S].getNodes([1],(function(e){return"LI"===e.nodeName}))).length>0){for(a=0,s=r.length;a<s;a++)(y=e[S].compareNode(r[a]))!==e[S].NODE_AFTER&&y!==e[S].NODE_INSIDE||(l=e[S].cloneRange(),(w=t.dom.domNode(r[a]).prev({nodeTypes:[1]}))?l.setEnd(w,w.childNodes.length):r[a].closest("ul, ol")?l.setEndBefore(r[a].closest("ul, ol")):l.setEndBefore(r[a]),E.push(l),e[S].setStart(r[a],0)),y!==e[S].NODE_BEFORE&&y!==e[S].NODE_INSIDE||((l=e[S].cloneRange()).setEnd(r[a],r[a].childNodes.length),E.push(l),(w=t.dom.domNode(r[a]).next({nodeTypes:[1]}))?e[S].setStart(w,0):r[a].closest("ul, ol")?e[S].setStartAfter(r[a].closest("ul, ol")):e[S].setStartAfter(r[a]));E.push(e[S])}else E.push(e[S]);return E}(l)).length;w--;)fixRangeCoverage(l[w],r),s=getParentBlockNodeName(l[w].startContainer,r),y="remove"===e?y.concat(clearRangeBlockFromating(l[w],0,r)):y.concat(wrapRangeWithElement(l[w],a,s,r));return y}function parseOptions(e){return"string"==typeof e&&(e={nodeName:e.toUpperCase()}),e}t.commands.formatBlock={exec:function exec(e,a,s){var l,y,w=[];if((s=parseOptions(s))&&s.toggle&&(y=this.state(e,a,s)),y){l=r.saveSelection(e.win);for(var E=0,S=y.length;E<S;E++)removeOptionsFromElement(y[E],s,e)}else e.selection.isCollapsed()&&(l=r.saveSelection(e.win),!function caretIsOnEmptyLine(e){var r;return!!(e.selection.isCollapsed()&&(r=e.selection.getNodesNearCaret())&&r.caretNode&&(t.dom.domNode(r.caretNode).is.lineBreak()||3===r.caretNode.nodeType&&0===r.textOffset&&(!r.prevNode||t.dom.domNode(r.prevNode).is.lineBreak())||1===r.caretNode.nodeType&&r.caretNode.classList.contains("rangySelectionBoundary")&&(!r.prevNode||t.dom.domNode(r.prevNode).is.lineBreak()||t.dom.domNode(r.prevNode).is.block())&&(!r.nextNode||t.dom.domNode(r.nextNode).is.lineBreak()||t.dom.domNode(r.nextNode).is.block())))}(e)?expandCaretToBlock(e,s&&s.nodeName?s.nodeName.toUpperCase():void 0):e.selection.selectLine()),w=s?formatSelection("apply",e,s):formatSelection("remove",e);return w=cleanup(e,w),l?r.restoreSelection(l):selectElements(w,e),w},remove:function remove(e,t,a){var s,l;a=parseOptions(a),e.selection.isCollapsed()&&(l=r.saveSelection(e.win),expandCaretToBlock(e,a&&a.nodeName?a.nodeName.toUpperCase():void 0)),s=cleanup(e,s=formatSelection("remove",e)),l?r.restoreSelection(l):selectElements(s,e)},state:function state(r,s,l){l=parseOptions(l);for(var y,w=r.selection.filterElements(function(r){return t.dom.domNode(r).test(l||{query:e})}.bind(this)),E=r.selection.getSelectedOwnNodes(),S=0,T=E.length;S<T;S++)(y=a.getParentElement(E[S],l||{query:e},null,r.element))&&-1===w.indexOf(y)&&w.push(y);return 0!==w.length&&w}}}(t),function(e){var t={b:"b, strong",strong:"b, strong",em:"em, i",i:"em, i"};function hasNoClass(e){return/^\s*$/.test(e.className)}function hasNoStyle(e){return!e.getAttribute("style")||/^\s*$/.test(e.getAttribute("style"))}function isSameNode(t,r){var a,s,l,y;return 1===t.nodeType&&1===r.nodeType&&(t.nodeName===r.nodeName&&(a=t.className.trim().replace(/\s+/g," ").split(" "),s=r.className.trim().replace(/\s+/g," ").split(" "),!(e.lang.array(a).without(s).length>0)&&(l=e.dom.getAttributes(t),y=e.dom.getAttributes(r),!(l.length!==y.length||!e.lang.object(e.lang.object(l).difference(y)).isEmpty()))))}function createWrapNode(t,r){var a=r&&r.nodeName||"SPAN",s=t.ownerDocument.createElement(a);if(r.classRegExp&&(s.className=s.className.replace(r.classRegExp,"")),r.className&&s.classList.add(r.className),r.styleProperty&&void 0!==r.styleValue&&(s.style[e.browser.fixStyleKey(r.styleProperty)]=r.styleValue),r.attribute)if("object"===_typeof(r.attribute))for(var l in r.attribute)r.attribute.hasOwnProperty(l)&&s.setAttribute(l,r.attribute[l]);else void 0!==r.attributeValue&&s.setAttribute(r.attribute,r.attributeValue);return s}function updateElementAttributes(t,r,a){var s,l=e.dom.getAttributes(t),y=function containsSameAttributes(e,t){for(var r in e)if(e.hasOwnProperty(r)&&(void 0===_typeof(t[r])||t[r]!==e[r]))return!1;return!0}(r,l);e.lang.object(l).difference(r);if(y&&!1!==a)for(s in r)r.hasOwnProperty(s)&&t.removeAttribute(s);else for(s in r)r.hasOwnProperty(s)&&t.setAttribute(s,r[s])}function updateFormatOfElement(r,a){var s,l,y;a.className&&(!1!==a.toggle&&r.classList.contains(a.className)?r.classList.remove(a.className):(a.classRegExp&&(r.className=r.className.replace(a.classRegExp,"")),r.classList.add(a.className)),hasNoClass(r)&&r.removeAttribute("class")),a.styleProperty&&(!1!==a.toggle&&r.style[e.browser.fixStyleKey(a.styleProperty)].trim().replace(/, /g,",")===a.styleValue?r.style[e.browser.fixStyleKey(a.styleProperty)]="":r.style[e.browser.fixStyleKey(a.styleProperty)]=a.styleValue),hasNoStyle(r)&&r.removeAttribute("style"),a.attribute&&("object"===_typeof(a.attribute)?s=a.attribute:(s={})[a.attribute]=a.attributeValue||"",updateElementAttributes(r,s,a.toggle)),y=!!(l=a.nodeName?t[a.nodeName.toLowerCase()]||a.nodeName.toLowerCase():null)&&e.dom.domNode(r).test({query:l}),a.nodeName&&"SPAN"!==a.nodeName&&!y||(!1!==a.toggle&&y||!a.nodeName&&"SPAN"===r.nodeName)&&hasNoClass(r)&&hasNoStyle(r)&&function hasNoAttributes(t){var r=e.dom.getAttributes(t);return e.lang.object(r).isEmpty()}(r)&&e.dom.unwrap(r)}function getSelectedTextNodes(t,r){var a=[];return t.isCollapsed()||(a=a.concat(t.getOwnNodes([3],(function(t){return!e.dom.domNode(t).is.emptyTextNode()}),r))),a}function findSimilarTextNodeWrapper(e,t,r,a){var s=e,l=a?t:function correctOptionsForSimilarityCheck(e){return{nodeName:e.nodeName||null,className:e.classRegExp?null:e.className||null,classRegExp:e.classRegExp||null,styleProperty:e.styleProperty||null}}(t);do{if(1===s.nodeType&&isSimilarNode(s,l))return s;s=s.parentNode}while(s&&s!==r);return null}function isSimilarNode(r,a){var s;if(a.nodeName){var l=t[a.nodeName.toLowerCase()]||a.nodeName.toLowerCase();return e.dom.domNode(r).test({query:l})}return(s=e.lang.object(a).clone()).query="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u",e.dom.domNode(r).test(s)}function selectRange(t,a){var s=document.documentElement||document.body,l=s.scrollTop,y=s.scrollLeft;r.getSelection(t.win);r.getSelection(t.win).removeAllRanges();try{r.getSelection(t.win).addRange(a)}catch(e){}t.doc.activeElement&&e.dom.contains(t.element,t.doc.activeElement)||(t.element.focus(),s.scrollTop=l,s.scrollLeft=y,r.getSelection(t.win).addRange(a))}function selectTextNodes(e,t){var a=r.createRange(t.doc),s=e[e.length-1];e[0]&&s&&(a.setStart(e[0],0),a.setEnd(s,s.length),selectRange(t,a))}function selectTextNode(e,t,a,s){var l=r.createRange(e.doc);t&&(l.setStart(t,a),l.setEnd(t,void 0!==s?s:a),selectRange(e,l))}function getState(e,t,r){var a,s,l,y=getSelectedTextNodes(e.selection),w=[],E=!1;if(e.selection.isInThisEditable()){if(0===y.length&&e.selection.isCollapsed()){if(!(l=e.selection.getSelection().anchorNode))return{nodes:[],partial:!1};3===l.nodeType&&(y=[l])}y.length||(s=e.selection.getOwnRanges()[0])&&(y=[s.endContainer]);for(var S=0,T=y.length;S<T;S++)(a=findSimilarTextNodeWrapper(y[S],t,e.element,r))?w.push(a):E=!0}return{nodes:w,partial:E}}function caretIsInsideWord(e){var t,r,a,s;return!!(e&&(t=e.anchorNode,r=e.anchorOffset,t&&3===t.nodeType&&r>0&&r<t.data.length))&&(a=t.data[r-1],s=t.data[r],/\w/.test(a)&&/\w/.test(s))}function getRangeForWord(t){var a,s,l,y,w,E,S=[];if(t&&(a=t.anchorNode,s=w=E=t.anchorOffset,l=a.ownerDocument,y=r.createRange(l),a&&3===a.nodeType)){for(;w>0&&/\w/.test(a.data[w-1]);)w--;for(;E<a.data.length&&/\w/.test(a.data[E]);)E++;return y.setStartAndEnd(a,w,E),y.splitBoundaries(),S=y.getNodes([3],(function(t){return!e.dom.domNode(t).is.emptyTextNode()})),{wordOffset:s-w,range:y,textNode:S[0]}}return!1}function mergeContents(e,t){for(;t.firstChild;)e.appendChild(t.firstChild);t.parentNode.removeChild(t)}function mergeConsequentSimilarElements(e){for(var t=e.length;t--;)e[t]&&e[t].parentNode&&(e[t].nextSibling&&isSameNode(e[t],e[t].nextSibling)&&mergeContents(e[t],e[t].nextSibling),e[t].previousSibling&&isSameNode(e[t],e[t].previousSibling)&&mergeContents(e[t].previousSibling,e[t]))}function cleanupAndSetSelection(e,t,r){t.length>0&&selectTextNodes(t,e),mergeConsequentSimilarElements(getState(e,r).nodes),t.length>0&&selectTextNodes(t,e)}function cleanupAndSetCaret(e,t,r,a){selectTextNode(e,t,r),mergeConsequentSimilarElements(getState(e,a).nodes),selectTextNode(e,t,r)}function formatTextNode(e,t){var r=createWrapNode(e,t);e.parentNode.insertBefore(r,e),r.appendChild(e)}function unformatTextNode(t,r,a){var s,l=findSimilarTextNodeWrapper(t,a,r.element);l&&(s=l.cloneNode(!1),e.dom.domNode(t).escapeParent(l,s),updateFormatOfElement(s,a))}function removeFormatFromTextNode(t,r,a){var s=findSimilarTextNodeWrapper(t,a,r.element);s&&e.dom.domNode(t).escapeParent(s)}function applyFormat(e,t,r){var a,s,l=e.selection.getSelection();if(t.length){for(s=t.length;s--;)formatTextNode(t[s],r);cleanupAndSetSelection(e,t,r)}else if(caretIsInsideWord(l))formatTextNode((a=getRangeForWord(l)).textNode,r),cleanupAndSetCaret(e,a.textNode,a.wordOffset,r);else{var y=e.selection.getOwnRanges()[0];y&&function formatTextRange(e,t,r){var a=createWrapNode(e.endContainer,r);e.surroundContents(a),t.selection.selectNode(a)}(y,e,r)}}function fixOptions(e){return(e="string"==typeof e?{nodeName:e}:e).nodeName&&(e.nodeName=e.nodeName.toUpperCase()),e}e.commands.formatInline={exec:function exec(t,r,a){a=fixOptions(a),t.element.normalize();var s=getSelectedTextNodes(t.selection,!0),l=getState(t,a);l.nodes.length>0?function updateFormat(t,r,a,s){var l,y,w,E,S=getState(t,s,!0),T=t.selection.getSelection();if(r.length){if(S.partial||!1===s.toggle)for(E=r.length;E--;)findSimilarTextNodeWrapper(r[E],s,t.element)&&unformatTextNode(r[E],t,s),findSimilarTextNodeWrapper(r[E],s,t.element)||formatTextNode(r[E],s);else for(E=r.length;E--;)unformatTextNode(r[E],t,s);cleanupAndSetSelection(t,r,s)}else if(!1!==s.toggle)if(caretIsInsideWord(T))y=(l=getRangeForWord(T)).textNode,unformatTextNode(l.textNode,t,s),cleanupAndSetCaret(t,l.textNode,l.wordOffset,s);else{y=t.doc.createTextNode(e.INVISIBLE_SPACE),(w=a.nodes[0].cloneNode(!1)).appendChild(y),t.selection.splitElementAtCaret(a.nodes[0],w),updateFormatOfElement(w,s),cleanupAndSetSelection(t,[y],s);var O=t.selection.getSelection();if(O.anchorNode&&O.focusNode)try{O.collapseToEnd()}catch(e){}}else for(E=a.nodes.length;E--;)updateFormatOfElement(a.nodes[E],s)}(t,s,l,a):applyFormat(t,s,a),t.element.normalize()},remove:function remove(t,r,a){a=fixOptions(a),t.element.normalize();var s=getSelectedTextNodes(t.selection,!0),l=getState(t,a);l.nodes.length>0&&function removeFormat(t,r,a,s){var l,y,w,E=t.selection.getSelection();if(r.length){for(w=r.length;w--;)removeFormatFromTextNode(r[w],t,s);cleanupAndSetSelection(t,r,s)}else{for(l=E.anchorNode,y=E.anchorOffset,w=a.nodes.length;w--;)e.dom.unwrap(a.nodes[w]);cleanupAndSetCaret(t,l,y,s)}}(t,s,l,a),t.element.normalize()},state:function state(e,t,r){var a=getState(e,r=fixOptions(r),!0).nodes;return 0!==a.length&&a}}}(t),function(e){e.commands.indentList={exec:function exec(e,t,r){var a=e.selection.getSelectionParentsByTag("LI");return!!a&&this.tryToPushLiLevel(a,e.selection)},state:function state(e,t){return!1},tryToPushLiLevel:function tryToPushLiLevel(t,r){var a,s,l,y,w,E=!1;return r.executeAndRestoreRangy((function(){for(var r=t.length;r--;)y=t[r],a="OL"===y.parentNode.nodeName?"OL":"UL",s=y.ownerDocument.createElement(a),l=e.dom.domNode(y).prev({nodeTypes:[e.ELEMENT_NODE]}),w=l?l.querySelector("ul, ol"):null,l&&(w?w.appendChild(y):(s.appendChild(y),l.appendChild(s)),E=!0)})),E}}}(t),function(e){e.commands.insertHTML={exec:function exec(e,t,r){e.selection.insertHTML(r)},state:function state(){return!1}}}(t),function(e){var t="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function exec(e,r){e.selection.insertHTML(t)},state:function state(){return!1}}}(t),t.commands.insertList=function(e){var t=function isNode(e,t){if(e&&e.nodeName){"string"==typeof t&&(t=[t]);for(var r=t.length;r--;)if(e.nodeName===t[r])return!0}return!1},r=function findListEl(r,a,s){var l={el:null,other:!1};if(r){var y=e.dom.getParentElement(r,{query:"li"},!1,s.element),w="UL"===a?"OL":"UL";t(r,a)?l.el=r:t(r,w)?l={el:r,other:!0}:y&&(t(y.parentNode,a)?l.el=y.parentNode:t(y.parentNode,w)&&(l={el:y.parentNode,other:!0}))}return l.el&&!s.element.contains(l.el)&&(l.el=null),l};return{exec:function exec(e,t,r){var a=e.doc,s="OL"===r?"insertOrderedList":"insertUnorderedList",l=e.selection.getSelection();1===l.anchorNode.nodeType&&l.anchorNode.firstChild?l.anchorNode.childNodes[l.anchorOffset]:l.anchorNode,1===l.focusNode.nodeType&&l.focusNode.firstChild?l.focusNode.childNodes[l.focusOffset]||l.focusNode.lastChild:l.focusNode;a.execCommand(s,!1,null)},state:function state(e,t,a){var s=e.selection.getSelectedNode(),l=r(s,a,e);return!(!l.el||l.other)&&l.el}}}(t),function(e){e.commands.outdentList={exec:function exec(e,t,r){var a=e.selection.getSelectionParentsByTag("LI");return!!a&&this.tryToPullLiLevel(a,e)},state:function state(e,t){return!1},tryToPullLiLevel:function tryToPullLiLevel(t,r){var a,s,l,y,w,E=!1,S=this;return r.selection.executeAndRestoreRangy((function(){for(var T=t.length;T--;)if((y=t[T]).parentNode&&("OL"===(a=y.parentNode).tagName||"UL"===a.tagName)){if(E=!0,s=e.dom.getParentElement(a.parentNode,{query:"ol, ul"},!1,r.element),l=e.dom.getParentElement(a.parentNode,{query:"li"},!1,r.element),s&&l)y.nextSibling&&(w=S.getAfterList(a,y),y.appendChild(w)),s.insertBefore(y,l.nextSibling);else{y.nextSibling&&(w=S.getAfterList(a,y),y.appendChild(w));for(var O=y.childNodes.length;O--;)a.parentNode.insertBefore(y.childNodes[O],a.nextSibling);a.parentNode.insertBefore(document.createElement("br"),a.nextSibling),y.parentNode.removeChild(y)}0===a.childNodes.length&&a.parentNode.removeChild(a)}})),E},getAfterList:function getAfterList(e,t){for(var r=e.nodeName,a=document.createElement(r);t.nextSibling;)a.appendChild(t.nextSibling);return a}}}(t),function(e){e.commands.redo={exec:function exec(e){return e.undoManager.redo()},state:function state(e){return!1}}}(t),function(e){var t={nodeName:"A"};e.commands.removeLink={exec:function exec(r,a){e.commands.formatInline.remove(r,a,t)},state:function state(r,a){return e.commands.formatInline.state(r,a,t)}}}(t),function(e){e.commands.undo={exec:function exec(e){return e.undoManager.undo()},state:function state(e){return!1}}}(t),function(e){var t="data-wysihtml-selection-node",r="data-wysihtml-selection-offset",a=(e.INVISIBLE_SPACE,e.INVISIBLE_SPACE,e.dom);e.UndoManager=e.lang.Dispatcher.extend({constructor:function constructor(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this.undo=withPluginHandlers(this.undo.bind(this),"handleUndo",this.composer),this.redo=withPluginHandlers(this.redo.bind(this),"handleRedo",this.composer),this._observe()},_observe:function _observe(){var e,t=this;this.composer.sandbox.getDocument();a.observe(this.element,"keydown",(function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey)){var r=e.keyCode,a=90===r&&!e.shiftKey,s=90===r&&e.shiftKey||89===r;a?(t.undo(e),e.preventDefault()):s&&(t.redo(e),e.preventDefault())}})),a.observe(this.element,"keydown",(function(r){var a=r.keyCode;a!==e&&(e=a,8!==a&&46!==a||t.transact())})),this.editor.on("newword:composer",(function(){t.transact()})).on("beforecommand:composer",(function(){t.transact()}))},transact:function transact(){var a,s,l,y,w,E=this.historyStr[this.position-1],S=this.composer.getValue(!1,!1),T=this.element.offsetWidth>0&&this.element.offsetHeight>0;if(S!==E){(this.historyStr.length=this.historyDom.length=this.position)>25&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,T&&(s=(a=this.composer.selection.getRange())&&a.startContainer?a.startContainer:this.element,l=a&&a.startOffset?a.startOffset:0,s.nodeType===e.ELEMENT_NODE?y=s:(y=s.parentNode,w=this.getChildNodeIndex(y,s)),y.setAttribute(r,l),void 0!==w&&y.setAttribute(t,w));var O=this.element.cloneNode(!!S);this.historyDom.push(O),this.historyStr.push(S),y&&(y.removeAttribute(r),y.removeAttribute(t))}},undo:function undo(){document.execCommand("undo",!1,null),this.editor.fire("undo:composer")},redo:function redo(){document.execCommand("redo",!1,null),this.editor.fire("redo:composer")},undoPossible:function undoPossible(){return this.position>1},redoPossible:function redoPossible(){return this.position<this.historyStr.length},set:function set(e){this.element.innerHTML="";for(var a,s,l,y=0,w=e.childNodes,E=e.childNodes.length;y<E;y++)this.element.appendChild(w[y].cloneNode(!0));e.hasAttribute(r)?(a=e.getAttribute(r),l=e.getAttribute(t),s=this.element):(a=(s=this.element.querySelector("["+r+"]")||this.element).getAttribute(r),l=s.getAttribute(t),s.removeAttribute(r),s.removeAttribute(t)),null!==l&&(s=this.getChildNodeByIndex(s,+l)),this.composer.selection.set(s,a)},getChildNodeIndex:function getChildNodeIndex(e,t){for(var r=0,a=e.childNodes,s=a.length;r<s;r++)if(a[r]===t)return r},getChildNodeByIndex:function getChildNodeByIndex(e,t){return e.childNodes[t]}})}(t),t.views.View=q.extend({constructor:function constructor(e,t,r){this.parent=e,this.element=t,this.config=r,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function _observeViewChange(){var e=this;this.parent.on("beforeload",(function(){e.parent.on("change_view",(function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout((function(){e.focus()}),0)):e.hide()}))}))},focus:function focus(){if(!this.element||!this.element.ownerDocument||this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element&&this.element.focus()}catch(e){}},hide:function hide(){this.element.style.display="none"},show:function show(){this.element.style.display=""},disable:function disable(){this.element.setAttribute("disabled","disabled")},enable:function enable(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,a=e.browser;e.views.Composer=e.views.View.extend({name:"composer",constructor:function constructor(e,t,r){this.base(e,t,r),this.config.noTextarea?this.editableArea=t:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function clear(){this.element.innerHTML=a.displaysCaretInEmptyContentEditableCorrectly()?"":"<br>"},getValue:function getValue(t,r){var a=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return!1!==t&&(a=this.parent.parse(a,!1!==r)),a},setValue:function setValue(e,t){!1!==t&&(e=this.parent.parse(e));try{this.element.innerHTML=e}catch(t){this.element.innerText=e}},cleanUp:function cleanUp(e){var t;this.selection&&this.selection.isInThisEditable()&&(t=r.saveSelection(this.win)),this.parent.parse(this.element,void 0,e),t&&r.restoreSelection(t)},show:function show(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function hide(){this._displayStyle=t.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function disable(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function enable(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function focus(t){e.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var r=this.element.lastChild;t&&r&&this.selection&&("BR"===r.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getScrollPos:function getScrollPos(){if(this.doc&&this.win){var e={};return void 0!==this.win.pageYOffset?e.y=this.win.pageYOffset:e.y=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollTop,void 0!==this.win.pageXOffset?e.x=this.win.pageXOffset:e.x=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollLeft,e}},setScrollPos:function setScrollPos(e){e&&void 0!==e.x&&void 0!==e.y&&this.win.scrollTo(e.x,e.y)},getTextContent:function getTextContent(){return t.getTextContent(this.element)},hasPlaceholderSet:function hasPlaceholderSet(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function isEmpty(){var e=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(e)||""===e||"<br>"===e||"<p></p>"===e||"<p><br></p>"===e||this.hasPlaceholderSet()},_initContentEditableArea:function _initContentEditableArea(){var e=this;this.config.noTextarea?this.sandbox=new t.ContentEditableArea((function(){e._create()}),{className:this.config.classNames.sandbox},this.editableArea):(this.sandbox=new t.ContentEditableArea((function(){e._create()}),{className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getContentEditable(),t.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function _initSandbox(){var e=this;this.sandbox=new t.Sandbox((function(){e._create()}),{stylesheets:this.config.stylesheets,className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getIframe();var r=this.textarea.element;t.insert(this.editableArea).after(r),this._createWysiwygFormField()},_createWysiwygFormField:function _createWysiwygFormField(){if(this.textarea.element.form){var e=document.createElement("input");e.type="hidden",e.name="_wysihtml_mode",e.value=1,t.insert(e).after(this.textarea.element)}},_create:function _create(){var r=this;this.doc=this.sandbox.getDocument(),this.win=this.sandbox.getWindow(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new e.Selection(this.parent,this.element,this.config.classNames.uneditableContainer),this.commands=new e.Commands(this.parent),this.config.noTextarea||t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),this._initAutoLinking(),t.addClass(this.element,this.config.classNames.composer),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var s=this.config.name;s&&(t.addClass(this.element,s),this.config.contentEditableMode||t.addClass(this.editableArea,s)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var l="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");l&&t.simulatePlaceholder(this.parent,this,l,this.config.classNames.placeholder),this.commands.exec("styleWithCSS",!1),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||a.isIos()||setTimeout((function(){r.focus(!0)}),100),a.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function _initAutoLinking(){var r=this,s=a.canDisableAutoLinking(),l=a.doesAutoLinkingInContentEditable();if(s&&this.commands.exec("AutoUrlDetect",!1,!1),this.config.autoLink){(!l||l&&s)&&(this.parent.on("newword:composer",(function(){if(t.getTextContent(r.element).match(t.autoLink.URL_REG_EXP)){for(var a=r.selection.getSelectedNode(),s=r.element.querySelectorAll("."+r.config.classNames.uneditableContainer),l=!1,y=s.length;y--;)e.dom.contains(s[y],a)&&(l=!0);l||t.autoLink(a,[r.config.classNames.uneditableContainer])}})),t.observe(this.element,"blur",(function(){t.autoLink(r.element,[r.config.classNames.uneditableContainer])})));var y=this.sandbox.getDocument().getElementsByTagName("a"),w=t.autoLink.URL_REG_EXP,E=function getTextContent(r){var a=e.lang.string(t.getTextContent(r)).trim();return"www."===a.substr(0,4)&&(a="http://"+a),a};t.observe(this.element,"keydown",(function(e){if(y.length){var a,s=r.selection.getSelectedNode(e.target.ownerDocument),l=t.getParentElement(s,{query:"a"},4);l&&(a=E(l),setTimeout((function(){var e=E(l);e!==a&&e.match(w)&&l.setAttribute("href",e)}),0))}}))}},_initObjectResizing:function _initObjectResizing(){if(this.commands.exec("enableObjectResizing",!0),a.supportsEvent("resizeend")){var r=["width","height"],s=r.length,l=this.element;t.observe(l,"resizeend",(function(t){var a,y=t.target||t.srcElement,w=y.style,E=0;if("IMG"===y.nodeName){for(;E<s;E++)w[a=r[E]]&&(y.setAttribute(a,parseInt(w[a],10)),w[a]="");e.quirks.redraw(l)}}))}},_initUndoManager:function _initUndoManager(){this.undoManager=new e.UndoManager(this.parent)},_initLineBreaking:function _initLineBreaking(){var r=this;function adjust(e){var a=t.getParentElement(e,{query:"p, div"},2);a&&t.contains(r.element,a)&&r.selection.executeAndRestoreRangy((function(){r.config.useLineBreaks?((!a.firstChild||a.firstChild===a.lastChild&&1===a.firstChild.nodeType&&a.firstChild.classList.contains("rangySelectionBoundary"))&&a.appendChild(r.doc.createElement("br")),t.replaceWithChildNodes(a)):"P"!==a.nodeName&&t.renameElement(a,"p")}))}this.config.useLineBreaks||t.observe(this.element,["focus"],(function(){r.isEmpty()&&setTimeout((function(){if(r.isEmpty()){var e=r.doc.createElement("P");r.element.innerHTML="",r.element.appendChild(e),a.displaysCaretInEmptyContentEditableCorrectly()?r.selection.selectNode(e,!0):(e.innerHTML="<br>",r.selection.setBefore(e.firstChild))}}),0)})),t.observe(this.element,"keydown",(function(a){var s=a.keyCode;if(!(a.shiftKey||a.ctrlKey||a.defaultPrevented||s!==e.ENTER_KEY&&s!==e.BACKSPACE_KEY)){var l=t.getParentElement(r.selection.getSelectedNode(),{query:"li, p, h1, h2, h3, h4, h5, h6"},4);l?setTimeout((function(){var a=r.selection.getSelectedNode();if("LI"===l.nodeName){if(!a)return;t.getParentElement(a,{query:"ul, ol, menu"},2)||adjust(a)}s===e.ENTER_KEY&&l.nodeName.match(/^H[1-6]$/)&&adjust(a)}),0):r.config.useLineBreaks&&s===e.ENTER_KEY&&!e.browser.insertsLineBreaksOnReturn()&&(a.preventDefault(),r.commands.exec("insertLineBreak"))}}))}})}(t),function(e){var t=e.dom,r=document,a=window,s=r.createElement("div"),l=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],y=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],w=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml-temp     { display: none; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],E=function focusWithoutScrolling(e){if(e.setActive)try{e.setActive()}catch(e){}else{var s=e.style,l=r.documentElement.scrollTop||r.body.scrollTop,y=r.documentElement.scrollLeft||r.body.scrollLeft,w={position:s.position,top:s.top,left:s.left,WebkitUserSelect:s.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),t.setStyles(w).on(e),a.scrollTo&&a.scrollTo(y,l)}};e.views.Composer.prototype.style=function(){var a,S=this,T=r.querySelector(":focus"),O=this.textarea.element,N=O.hasAttribute("placeholder"),A=N&&O.getAttribute("placeholder"),L=O.style.display,R=O.disabled;this.focusStylesHost=s.cloneNode(!1),this.blurStylesHost=s.cloneNode(!1),this.disabledStylesHost=s.cloneNode(!1),N&&O.removeAttribute("placeholder"),O===T&&O.blur(),O.disabled=!1,O.style.display=a="none",(O.getAttribute("rows")&&"auto"===t.getStyle("height").from(O)||O.getAttribute("cols")&&"auto"===t.getStyle("width").from(O))&&(O.style.display=a=L),t.copyStyles(y).from(O).to(this.editableArea).andTo(this.blurStylesHost),t.copyStyles(l).from(O).to(this.element).andTo(this.blurStylesHost),t.insertCSS(w).into(this.element.ownerDocument),O.disabled=!0,t.copyStyles(y).from(O).to(this.disabledStylesHost),t.copyStyles(l).from(O).to(this.disabledStylesHost),O.disabled=R,O.style.display=L,E(O),O.style.display=a,t.copyStyles(y).from(O).to(this.focusStylesHost),t.copyStyles(l).from(O).to(this.focusStylesHost),O.style.display=L,t.copyStyles(["display"]).from(O).to(this.editableArea);var D=e.lang.array(y).without(["display"]);return T?E(T):O.blur(),N&&O.setAttribute("placeholder",A),this.parent.on("focus:composer",(function(){t.copyStyles(D).from(S.focusStylesHost).to(S.editableArea),t.copyStyles(l).from(S.focusStylesHost).to(S.element)})),this.parent.on("blur:composer",(function(){t.copyStyles(D).from(S.blurStylesHost).to(S.editableArea),t.copyStyles(l).from(S.blurStylesHost).to(S.element)})),this.parent.observe("disable:composer",(function(){t.copyStyles(D).from(S.disabledStylesHost).to(S.editableArea),t.copyStyles(l).from(S.disabledStylesHost).to(S.element)})),this.parent.observe("enable:composer",(function(){t.copyStyles(D).from(S.blurStylesHost).to(S.editableArea),t.copyStyles(l).from(S.blurStylesHost).to(S.element)})),this}}(t),function(e){var t,r,a,s,l,y=e.dom,w=y.domNode,E=e.browser,S={66:"bold",73:"italic",85:"underline"},T={addListeners:function addListeners(e,t,r){for(var a=0,s=t.length;a<s;a++)e.addEventListener(t[a],r,!1)},removeListeners:function removeListeners(e,t,r){for(var a=0,s=t.length;a<s;a++)e.removeEventListener(t[a],r,!1)},fixLastBrDeletionInTable:function fixLastBrDeletionInTable(t,r){if(t.selection.caretIsInTheEndOfNode()){var a=t.selection.getSelection(),s=a.anchorNode;if(s&&1===s.nodeType&&(e.dom.getParentElement(s,{query:"td, th"},!1,t.element)||r)){var l=s.childNodes[a.anchorOffset];if(l&&1===l.nodeType&"BR"===l.nodeName)return l.parentNode.removeChild(l),!0}}return!1},handleUneditableDeletion:function handleUneditableDeletion(e){var t=e.selection.getBeforeSelection(!0);if(t&&("element"===t.type||"leafnode"===t.type)&&1===t.node.nodeType&&t.node.classList.contains(e.config.classNames.uneditableContainer)){if(T.fixLastBrDeletionInTable(e,!0))return!0;try{var r=new CustomEvent("wysihtml:uneditable:delete",{bubbles:!0,cancelable:!1});t.node.dispatchEvent(r)}catch(e){}return t.node.parentNode.removeChild(t.node),!0}return!1},fixDeleteInTheBeginningOfBlock:function fixDeleteInTheBeginningOfBlock(t){var r=t.selection,a=r.getPreviousNode();if(r.caretIsFirstInSelection(e.browser.usesControlRanges())&&a&&1===a.nodeType&&e.dom.domNode(a).is.block()&&!w(a).test({query:"ol, ul, table, tr, dl"})){if(/^\s*$/.test(a.textContent||a.innerText))return a.parentNode.removeChild(a),!0;if(a.lastChild){var s=a.lastChild,l=r.getSelectedNode(),y=w(a).commonAncestor(l,t.element),E=e.dom.getParentElement(l,{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"},!1,y||t.element);if(E)return w(E).transferContentTo(a,!0),r.setAfter(s),!0;if(e.browser.usesControlRanges())return l=r.getCaretNode(),w(l).transferContentTo(a,!0),r.setAfter(s),!0}}return!1},fixDeleteInTheBeginningOfLi:function fixDeleteInTheBeginningOfLi(t){if(e.browser.hasLiDeletingProblem()){var r,a,s,l=t.selection.getSelection(),y=l.anchorNode,E=t.selection.caretIsFirstInSelection();if(3===y.nodeType&&0===l.anchorOffset&&y===y.parentNode.firstChild&&(y=y.parentNode,E=!0),E&&y&&1===y.nodeType&&"LI"===y.nodeName&&((a=w(y).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}))||!y.parentNode||"UL"!==y.parentNode.nodeName&&"OL"!==y.parentNode.nodeName||(a=w(y.parentNode).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),s=y.parentNode),a))return r=y.firstChild,w(y).transferContentTo(a,!0),s&&0===s.children.length&&s.remove(),r?t.selection.setBefore(r):a&&(1===a.nodeType?a.lastChild?t.selection.setAfter(a.lastChild):t.selection.selectNode(a):t.selection.setAfter(a)),!0}return!1},fixDeleteInTheBeginningOfControlSelection:function fixDeleteInTheBeginningOfControlSelection(e){var t,r=e.selection,a=r.getPreviousNode(),s=r.getSelectedNode();return!!r.caretIsFirstInSelection()&&(3===s.nodeType&&(s=s.parentNode),t=s.firstChild,w(s).transferContentTo(a,!0),t&&e.selection.setBefore(t),!0)},doLineBreaksModeEnterWithCaret:function doLineBreaksModeEnterWithCaret(t){var r,a,s=!1;if((r=t.selection.getNodesNearCaret())&&((r.caretNode||r.nextNode)&&(a=y.getParentElement(r.caretNode||r.nextNode,{query:"p, pre, div, blockquote"},2))===t.element&&(a=void 0),a&&r.caretNode))if(w(r.caretNode).is.lineBreak()){if(t.config.doubleLineBreakEscapesBlock){s=!0,r.caretNode.parentNode.removeChild(r.caretNode),w(r.nextNode).is.lineBreak()&&r.nextNode.parentNode.removeChild(r.nextNode);var l=t.doc.createElement("br");w(r.nextNode).is.lineBreak()&&r.nextNode===a.lastChild?a.parentNode.insertBefore(l,a.nextSibling):t.selection.splitElementAtCaret(a,l),r.nextNode&&3===r.nextNode.nodeType&&(r.nextNode.data=r.nextNode.data.replace(/^ *[\r\n]+/,"")),t.selection.setBefore(l)}}else if(3===r.caretNode.nodeType&&e.browser.hasCaretBlockElementIssue()&&r.textOffset===r.caretNode.data.length&&!r.nextNode){s=!0;var E=t.doc.createElement("br"),S=t.doc.createElement("br"),T=t.doc.createDocumentFragment();T.appendChild(E),T.appendChild(S),t.selection.insertNode(T),t.selection.setBefore(S)}return s}},O=function handleDeleteKeyPress(t,r){var a=r.selection;r.element;if(a.isCollapsed()){if(r.isEmpty()&&!r.config.useLineBreaks)return void t.preventDefault();if(T.handleUneditableDeletion(r))return void t.preventDefault();if(T.fixDeleteInTheBeginningOfLi(r))return void t.preventDefault();if(T.fixDeleteInTheBeginningOfBlock(r))return void t.preventDefault();if(T.fixLastBrDeletionInTable(r))return void t.preventDefault();if(e.browser.usesControlRanges()&&T.fixDeleteInTheBeginningOfControlSelection(r))return void t.preventDefault()}else a.containsUneditable()&&(t.preventDefault(),a.deleteContents())},N=function handleDomNodeRemoved(e){this.domNodeRemovedInterval&&clearInterval(domNodeRemovedInterval),this.parent.fire("destroy:composer")},A=function handleUserInteraction(e){this.parent.fire("beforeinteraction",e).fire("beforeinteraction:composer",e),setTimeout(function(){this.parent.fire("interaction",e).fire("interaction:composer",e)}.bind(this),0)},L=function handleFocus(e){this.parent.fire("focus",e).fire("focus:composer",e),setTimeout(function(){this.focusState=this.getValue(!1,!1)}.bind(this),0)},R=function handleBlur(e){if(this.focusState!==this.getValue(!1,!1)){var t=e;"function"==typeof Object.create&&(t=Object.create(e,{type:{value:"change"}})),this.parent.fire("change",t).fire("change:composer",t)}this.parent.fire("blur",e).fire("blur:composer",e)},D=function handlePaste(e){this.parent.fire(e.type,e).fire(e.type+":composer",e),"paste"===e.type&&setTimeout(function(){this.parent.fire("newword:composer")}.bind(this),0)},M=function handleCopy(r){t||(t=withPluginHandlers(function(t){this.config.copyedFromMarking&&(e.browser.supportsModernPaste()&&(t.clipboardData.setData("text/html",this.config.copyedFromMarking+this.selection.getHtml()),t.clipboardData.setData("text/plain",this.selection.getPlainText()),t.preventDefault(),"cut"===t.type&&window.getSelection().deleteFromDocument()),this.parent.fire(t.type,t).fire(t.type+":composer",t))}.bind(this),"handleCopy",this)),t(r)},B=function handleKeyUp(t){var r=t.keyCode;r!==e.SPACE_KEY&&r!==e.ENTER_KEY||this.parent.fire("newword:composer")},q=function handleMouseDown(t){if(!E.canSelectImagesInContentEditable()){var r=t.target,a=this.element.querySelectorAll("img"),s=this.element.querySelectorAll("."+this.config.classNames.uneditableContainer+" img"),l=e.lang.array(a).without(s);"IMG"===r.nodeName&&e.lang.array(l).contains(r)&&this.selection.selectNode(r)}e.browser.usesControlRanges()&&(this.selection.lastMouseDownPos={x:t.clientX,y:t.clientY},setTimeout(function(){delete this.selection.lastMouseDownPos}.bind(this),0))},W=function handleIEControlSelect(e){e.target;var t=this.selection.lastMouseDownPos;if(t){var r=document.body.createTextRange();setTimeout(function(){try{r.moveToPoint(t.x,t.y),r.select()}catch(e){}}.bind(this),0)}},j=function handleClick(t){if(this.config.classNames.uneditableContainer){var r=e.dom.getParentElement(t.target,{query:"."+this.config.classNames.uneditableContainer},!1,this.element);r&&this.selection.setAfter(r)}},H=function handleDragStart(e){var t=e.dataTransfer.getData("text/html"),r=this.config.copyedFromMarking+t;e.dataTransfer.setData("text/html",r)},V=function handleDrop(e){E.canSelectImagesInContentEditable()||setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)},z=function handleKeyDown(t){var y,w=t.keyCode,N=S[w],A=this.selection.getSelectedNode(!0);A&&3===A.nodeType&&A.parentNode;if((t.ctrlKey||t.metaKey)&&!t.altKey&&65===w)return s||(s=withPluginHandlers((function(e){e.selectAll()}),"handleSelectAllShortcut",this)),s(this.selection),void t.preventDefault();(t.ctrlKey||t.metaKey)&&!t.altKey&&N&&(l||(l=withPluginHandlers((function(e,t){e.exec(t)}),"handleShortcut",this)),l(this.commands,N,t),t.preventDefault()),w===e.BACKSPACE_KEY&&(r||(r=withPluginHandlers(O,"handleBackspaceKeyPress",this)),r(t,this)),w===e.DELETE_KEY&&(a||(a=withPluginHandlers((function(){}),"handleDeleteKeyPress",this)),a(t,this)),w!==e.BACKSPACE_KEY&&w!==e.DELETE_KEY||A&&"IMG"===A.nodeName&&(t.preventDefault(),(y=A.parentNode).removeChild(A),"A"!==y.nodeName||y.firstChild||y.parentNode.removeChild(y),setTimeout(function(){e.quirks.redraw(this.element)}.bind(this),0)),this.config.handleTabKey&&w===e.TAB_KEY&&(t.preventDefault(),function handleTabKeyDown(e,t,r){if(e.selection.isCollapsed()){if(e.selection.caretIsInTheBeginnig("li"))if(r){if(e.commands.exec("outdentList"))return}else if(e.commands.exec("indentList"))return}else e.selection.deleteContents();e.commands.exec("insertHTML","&emsp;")}(this,this.element,t.shiftKey)),w===e.ENTER_KEY&&function handleEnterKeyPress(e,t){if(t.config.useLineBreaks&&!e.shiftKey&&!e.ctrlKey){t.selection.isCollapsed()&&T.doLineBreaksModeEnterWithCaret(t)&&e.preventDefault()}if(E.hasCaretAtLinkEndInsertionProblems()&&t.selection.caretIsInTheEndOfNode()){var r=t.selection.getSelectedNode(!0),a=r&&3===r.nodeType?r.parentNode:r;a&&a.closest("a")&&3===r.nodeType&&r===a.lastChild&&t.selection.setAfter(a)}}(t,this)},U=function handleKeyPress(t){if(0!==t.which&&this.selection.caretIsInTheEndOfNode()){var r,a,s=this.selection.getSelectedNode(!0),l=s&&3===s.nodeType?s.parentNode:s;l&&l.closest("a")&&s===l.lastChild&&(32!==t.which||this.selection.caretIsInTheEndOfNode(!0)&&E.hasCaretAtLinkEndInsertionProblems()?(r=this.doc.createTextNode(e.INVISIBLE_SPACE),this.selection.insertNode(r),this.selection.setBefore(r),setTimeout(function(){r.textContent.length>1?(r.textContent=r.textContent.replace(e.INVISIBLE_SPACE_REG_EXP,""),this.selection.setAfter(r)):r.remove()}.bind(this),0)):32===t.which&&3===s.nodeType&&/[\u00A0 ]$/.test(s.textContent)&&(s.textContent=s.textContent.replace(/[\u00A0 ]$/,""),a=this.doc.createTextNode(" "),l.parentNode.insertBefore(a,l.nextSibling),this.selection.setAfter(a,!1),t.preventDefault()))}};e.views.Composer.prototype.observeActions=T,e.views.Composer.prototype.observe=function(){var t=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),r=(this.element,E.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?this.element:this.sandbox.getWindow());this.focusState=this.getValue(!1,!1),this.actions=T,t.addEventListener(["DOMNodeRemoved"],N.bind(this),!1),E.supportsMutationEvents()||(this.domNodeRemovedInterval=setInterval((function(){y.contains(document.documentElement,t)||N.call(this)}),250)),T.addListeners(r,["drop","paste","mouseup","focus","keyup"],A.bind(this)),r.addEventListener("focus",L.bind(this),!1),r.addEventListener("blur",R.bind(this),!1),T.addListeners(this.element,["drop","paste","beforepaste"],D.bind(this),!1),this.element.addEventListener("copy",M.bind(this),!1),this.element.addEventListener("cut",M.bind(this),!1),this.element.addEventListener("mousedown",q.bind(this),!1),this.element.addEventListener("click",j.bind(this),!1),this.element.addEventListener("dragstart",H.bind(this),!1),this.element.addEventListener("drop",V.bind(this),!1),this.element.addEventListener("keyup",B.bind(this),!1),this.element.addEventListener("keydown",z.bind(this),!1),this.element.addEventListener("keypress",U.bind(this),!1),e.browser.usesControlRanges()&&this.element.addEventListener("mscontrolselect",W.bind(this),!1),this.element.addEventListener("dragenter",function(){this.parent.fire("unset_placeholder")}.bind(this),!1)}}(t),function(e){e.views.Synchronizer=q.extend({constructor:function constructor(e,t,r){this.editor=e,this.textarea=t,this.composer=r,this._observe()},fromComposerToTextarea:function fromComposerToTextarea(t){this.textarea.setValue(e.lang.string(this.composer.getValue(!1,!1)).trim(),t)},fromTextareaToComposer:function fromTextareaToComposer(e){var t=this.textarea.getValue(!1,!1);t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function sync(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function _observe(){var t,r=this,a=this.textarea.element.form,s=function startInterval(){t=setInterval((function(){r.fromComposerToTextarea()}),400)},l=function stopInterval(){clearInterval(t),t=null};s(),a&&(e.dom.observe(a,"submit",(function(){r.sync(!0)})),e.dom.observe(a,"reset",(function(){setTimeout((function(){r.fromTextareaToComposer()}),0)}))),this.editor.on("change_view",(function(e){"composer"!==e||t?"textarea"===e&&(r.fromComposerToTextarea(!0),l()):(r.fromTextareaToComposer(!0),s())})),this.editor.on("destroy:composer",l)}})}(t),function(e){e.views.SourceView=q.extend({constructor:function constructor(e,t){this.editor=e,this.composer=t,this._observe()},switchToTextarea:function switchToTextarea(e){var t=this.composer.win.getComputedStyle(this.composer.element),r=parseFloat(t.width),a=Math.max(parseFloat(t.height),100);this.textarea||(this.textarea=this.composer.doc.createElement("textarea"),this.textarea.className="wysihtml-source-view"),this.textarea.style.width=r+"px",this.textarea.style.height=a+"px",this.textarea.value=this.editor.getValue(e,!0),this.composer.element.parentNode.insertBefore(this.textarea,this.composer.element),this.editor.currentView="source",this.composer.element.style.display="none"},switchToComposer:function switchToComposer(e){var t=this.textarea.value;t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder")),this.textarea.parentNode.removeChild(this.textarea),this.editor.currentView=this.composer,this.composer.element.style.display=""},_observe:function _observe(){this.editor.on("change_view",function(e){"composer"===e?this.switchToComposer(!0):"textarea"===e&&this.switchToTextarea(!0)}.bind(this))}})}(t),t.views.Textarea=t.views.View.extend({name:"textarea",constructor:function constructor(e,t,r){this.base(e,t,r),this._observe()},clear:function clear(){this.element.value=""},getValue:function getValue(e){var t=this.isEmpty()?"":this.element.value;return!1!==e&&(t=this.parent.parse(t)),t},setValue:function setValue(e,t){!1!==t&&(e=this.parent.parse(e)),this.element.value=e},cleanUp:function cleanUp(e){var t=this.parent.parse(this.element.value,void 0,e);this.element.value=t},hasPlaceholderSet:function hasPlaceholderSet(){var e=t.browser.supportsPlaceholderAttributeOn(this.element),r=this.element.getAttribute("placeholder")||null,a=this.element.value;return e&&!a||a===r},isEmpty:function isEmpty(){return!t.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function _observe(){var e=this.element,r=this.parent,a={focusin:"focus",focusout:"blur"},s=t.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];r.on("beforeload",(function(){t.dom.observe(e,s,(function(e){var t=a[e.type]||e.type;r.fire(t).fire(t+":textarea")})),t.dom.observe(e,["paste","drop"],(function(){setTimeout((function(){r.fire("paste").fire("paste:textarea")}),0)}))}))}}),function(e){e.Editor=e.lang.Dispatcher.extend({defaults:{name:void 0,style:!0,autoLink:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{},b:{},i:{},u:{}},classes:{}},pasteParserRulesets:null,parser:e.dom.parse,useLineBreaks:!0,doubleLineBreakEscapesBlock:!0,stylesheets:[],placeholderText:void 0,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,classNames:{composer:"wysihtml-editor",body:"wysihtml-supported",sandbox:"wysihtml-sandbox",placeholder:"wysihtml-placeholder",uneditableContainer:"wysihtml-uneditable-container"},copyedFromMarking:'<meta name="copied-from" content="wysihtml">'},constructor:function constructor(t,r){if(this.editableElement="string"==typeof t?document.getElementById(t):t,this.config=e.lang.object({}).merge(this.defaults).merge(r).get(),this._isCompatible=e.browser.supported(),r&&r.classNames&&e.lang.object(this.config.classNames).merge(r.classNames),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new e.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&e.browser.isTouchDevice()){var a=this;setTimeout((function(){a.fire("beforeload").fire("load")}),0)}else e.dom.addClass(document.body,this.config.classNames.body),this.composer=new e.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function handleBeforeLoad(){this.config.noTextarea?this.sourceView=new e.views.SourceView(this,this.composer):this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer),this.runEditorExtenders()},runEditorExtenders:function runEditorExtenders(){e.editorExtenders.forEach(function(e){e(this)}.bind(this))},isCompatible:function isCompatible(){return this._isCompatible},clear:function clear(){return this.currentView.clear(),this},getValue:function getValue(e,t){return this.currentView.getValue(e,t)},setValue:function setValue(e,t){return this.fire("unset_placeholder"),e?(this.currentView.setValue(e,t),this):this.clear()},cleanUp:function cleanUp(e){this.currentView.cleanUp(e)},focus:function focus(e){return this.currentView.focus(e),this},disable:function disable(){return this.currentView.disable(),this},enable:function enable(){return this.currentView.enable(),this},isEmpty:function isEmpty(){return this.currentView.isEmpty()},hasPlaceholderSet:function hasPlaceholderSet(){return this.currentView.hasPlaceholderSet()},destroy:function destroy(){this.composer&&this.composer.sandbox&&this.composer.sandbox.destroy(),this.fire("destroy:composer"),this.off()},parse:function parse(t,r,a){var s=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,l=this.config.parser(t,{rules:a||this.config.parserRules,cleanUp:this.config.cleanUp,context:s,uneditableClass:this.config.classNames.uneditableContainer,clearInternals:r});return"object"===_typeof(t)&&e.quirks.redraw(t),l},_initParser:function _initParser(){var t;this.on("drop:composer",withPluginHandlers(function(e){var t=e.dataTransfer.getData("text/html"),r=!1;if(!(t.indexOf(this.config.copyedFromMarking)>=0)){if(e.preventDefault(),e.dataTransfer.types)for(var a=0;a<e.dataTransfer.types.length;a++)if("Files"===e.dataTransfer.types[a]){r=!0;break}!r&&t.length&&(this._cleanAndDrop(t),setTimeout(function(){this.fire("newword:composer")}.bind(this),0))}}.bind(this),"handleDrop",this.composer)),e.browser.supportsModernPaste()?this.on("paste:composer",withPluginHandlers(function(r){r.preventDefault(),(t=e.dom.getPastedHtml(r))&&this._cleanAndPaste(t)}.bind(this),"handlePaste",this.composer)):this.on("beforepaste:composer",withPluginHandlers(function(t){t.preventDefault();var r=this.composer.getScrollPos();e.dom.getPastedHtmlWithDiv(this.composer,function(e){e&&this._cleanAndPaste(e),this.composer.setScrollPos(r)}.bind(this))}.bind(this),"handlePaste",this.composer))},_cleanAndDrop:function _cleanAndDrop(t){var r=e.quirks.cleanPastedHTML(t,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.classNames.uneditableContainer});this.additionalCleanBeforePaste&&(r=this.additionalCleanBeforePaste(r)),this.composer.selection.insertHTML(r)},_cleanAndPaste:function _cleanAndPaste(t){var r=e.quirks.cleanPastedHTML(t,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.classNames.uneditableContainer});this.composer.selection&&this.composer.selection.deleteContents(),this.additionalCleanBeforePaste&&(r=this.additionalCleanBeforePaste(r,{isCopiedFromWysihtml:t.indexOf(this.config.copyedFromMarking)>=0})),""!==r&&this.composer.selection.insertHTML(r)}})}(t),t}.call(t,r,t,e))||(e.exports=a)},,,,function(e,t,r){"use strict";r.d(t,"a",(function(){return y}));var a=r(127),s=r.n(a),l=r(132);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var y=function withFullscreenObserver(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fullscreenElement";return(function(r){_inherits(FullScreen,r);var a=_createSuper(FullScreen);function FullScreen(){var e;_classCallCheck(this,FullScreen);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return _defineProperty(_assertThisInitialized(e=a.call.apply(a,[this].concat(r))),"state",{el:null}),_defineProperty(_assertThisInitialized(e),"onFullscreen",(function(t){return e.setState({el:t})})),e}return _createClass(FullScreen,[{key:"render",value:function render(){var r=_defineProperty({},t,this.state.el);return(s.a.createElement(e,_extends({},this.props,r)))}},{key:"componentDidMount",value:function componentDidMount(){this.fullscreenObserver=l.b.fullScreen.observe(this.onFullscreen)}},{key:"componentWillUnmount",value:function componentWillUnmount(){l.b.fullScreen.unobserve(this.fullscreenObserver)}}]),FullScreen}(s.a.Component))}},,,,,function(e,t,r){"use strict";var a=r(1),s=r.n(a),l=r(0),y=r.n(l),w=r(241),E=r.n(w);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var S=[],T={lineNumbers:!0,readOnly:!1},O={CODE_EDITOR_WIDGET_SELECTOR:'[data-lrn-wysihtml-widget="codeEditorWidget"]',CODE_MIRROR_SELECTOR:".CodeMirror",CODE_EDITOR_ATTR:"data-lrn-code-editor-id",parse:function parse(e){var t=s()("<div />").html(e);return t.find(O.CODE_EDITOR_WIDGET_SELECTOR).each((function(){var e=s()(this);if(!e.attr(O.CODE_EDITOR_ATTR)){var t=y.a.uniqueId();e.attr(O.CODE_EDITOR_ATTR,t).attr("contenteditable",!1),S.push(t)}})),t.html()},render:function render(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[];return y.a.each(S,(function(r){var a='[data-lrn-code-editor-id="'.concat(r,'"]'),l=s()(a);if(l.length){var w=y.a.unescape(l.html()||"");l.empty();var S=E()(l.get(0),_objectSpread(_objectSpread({},T),{},{value:w,autofocus:!!e.autofocus,historyEventDelay:400,readOnly:e.readOnly}));S.on("beforeChange",(function(e,t){!e.isReadOnly()||"undo"!==t.origin&&"redo"!==t.origin?(e.__previousValue=e.getValue(),e.__previousCursorLine=e.getCursor().line):t.cancel()})),t.push({$el:l,instance:S})}})),S=[],t},getFocusEditorInstance:function getFocusEditorInstance(e){var t;return s()(e).find(O.CODE_MIRROR_SELECTOR).each((function(){var e=this.CodeMirror;e&&e.hasFocus&&e.hasFocus()&&(t=e)})),t},getAllInstances:function getAllInstances(e){return y.a.map(e.querySelectorAll(O.CODE_MIRROR_SELECTOR),(function(e){return e.CodeMirror}))},getInstanceFromNode:function getInstanceFromNode(e){var t=e.getAttribute(O.CODE_EDITOR_ATTR),r=document.querySelector('[data-lrn-code-editor-id="'.concat(t,'"]'));if(r){var a=r.querySelector(O.CODE_MIRROR_SELECTOR);return a&&a.CodeMirror}},getData:function getData(e){var t=O.getInstanceFromNode(e);if(t){var r=t.getValue(),a=y.a.escape(r);return'<div data-lrn-wysihtml-widget="codeEditorWidget">'.concat(a,"</div>")}return""},remove:function remove(e){if(!e)return!1;var t=e.getWrapperElement();return s()(t).closest(O.CODE_EDITOR_WIDGET_SELECTOR).remove(),!0}};t.a=O},function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(18),y={jpg:{jpg:"image/jpeg",jpeg:"image/jpeg",jfif:"image/jpeg"},png:"image/png",gif:"image/gif",bmp:"image/bmp",pdf:"application/pdf",csv:"text/csv",rtf:"application/rtf",txt:"text/plain",xps:"application/vnd.ms-xpsdocument",ms_word:{doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",docm:"application/vnd.ms-word.document.macroenabled.12",dotm:"application/vnd.ms-word.template.macroenabled.12"},ms_excel:{xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroenabled.12",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12"},ms_powerpoint:{ppt:"application/vnd.ms-powerpoint",pps:"application/vnd.ms-powerpoint",pot:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",pptm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",potm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppsm:"application/vnd.ms-powerpoint.slideshow.macroenabled.12"},ms_publisher:{pub:"application/vnd.ms-publisher"},open_office:{odf:"application/vnd.oasis.opendocument.formula",odt:"application/vnd.oasis.opendocument.text",ods:"application/vnd.oasis.opendocument.spreadsheet",odp:"application/vnd.oasis.opendocument.presentation"},video:{mp4:"video/mp4",mov:"video/quicktime",webm:"video/webm",avi:"video/avi",asf:"video/x-ms-asf",wmv:"video/x-ms-wmv"},zip:"application/zip",matlab:{m:"text/plain",fig:"application/octet-stream",mat:"application/octet-stream"},altera_quartus:{bdf:"text/plain",bsf:"text/plain"},verilog:{sv:"text/plain"},c:"text/plain",h:"text/plain",s:"text/plain",v:"text/plain",cpp:"text/plain",assembly:{asm:"text/plain"},labview:{vi:"text/plain"}},w={createBasePath:function createBasePath(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new Date(e.get("security").getTimestamp()),a=r.getUTCFullYear(),s=new Date(Date.UTC(a,0,1)),l=Math.ceil((r-s)/864e5),y=e.get("consumer"),w=y.get("id"),E=e.get("user_id"),S=t?"userupload/":"";return"".concat(S).concat(w,"/questionresponse/").concat(a,"/").concat(l,"/").concat(w,"_").concat(E)},createFullPath:function createFullPath(e,t,r,a){var s=this.createBasePath(e,a),y=l.a.v4(),w=this.getValidExtension(r);return"".concat(s,"_").concat(t,"/").concat(y,".").concat(w)},getValidExtension:function getValidExtension(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this.getFlattenedExtensions(),r=e.lastIndexOf(".")+1,a=r>0?e.slice(r).toLowerCase():"";return t[a]?a:""},getFlattenedExtensions:function getFlattenedExtensions(){var e={};return s.a.mapObject(y,(function buildExtensionMime(t,r){s.a.isString(t)?e[r]=t:s.a.isObject(t)&&s.a.mapObject(t,buildExtensionMime)})),e},getExtensions:function getExtensions(e){var t=y[e],r=[];return s.a.isString(t)?r.push(e):s.a.isObject(t)&&(r=s.a.keys(t)),r},getMimeTypeByExtension:function getMimeTypeByExtension(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this.getFlattenedExtensions(),r=t[e.toLowerCase()];return r||""}};t.a=w},,,,,function(e,t,r){"use strict";r.d(t,"a",(function(){return getImageDimension})),r.d(t,"c",(function(){return loadImageFromFile})),r.d(t,"b",(function(){return getSVGDimensions}));var a=r(174),s=r.n(a);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l={width:100,height:100};function getImageDimension(e,t){return new Promise((function(r,a){if(!e)return r(t||l);var s=new Image,y=function removeListeners(){s.onload=null,s.onerror=null};s.onload=function(){y(),r({width:s.naturalWidth,height:s.naturalHeight})},s.onerror=function(){y(),a(t||l)},s.src=e}))}function loadImageFromFile(e){return new Promise((function(t,r){var a=new FileReader;a.onload=function(e){var a=e.target.result;getImageDimension(a).then((function(e){t(_objectSpread(_objectSpread({},e),{},{src:a}))})).catch((function(e){r(e)}))},a.onerror=function(e){r({src:null,error:e})},a.readAsDataURL(e)}))}function getSVGDimensions(e,t){return new Promise((function(r){e&&t?s.a.xml(e).mimeType("image/svg+xml").get((function(e,a){if(e)r(t||l);else{var s=a.documentElement.attributes,y=s.viewBox&&s.viewBox.value.split(" "),w=y?y[2]/y[3]:1,E=s.width?parseInt(s.width.value.replace("px","")):t.width,S=E/w||t.height;r({width:E,height:S})}})):r(t||l)}))}},function(e,t,r){"use strict";r.d(t,"d",(function(){return getSpellCheckValue})),r.d(t,"a",(function(){return getAutoCapitalizeValue})),r.d(t,"b",(function(){return getAutoCompleteValue})),r.d(t,"c",(function(){return getAutoCorrectValue}));var a=r(0),s=r.n(a);function getSpellCheckValue(e){return s.a.isBoolean(e)?e:!!s.a.isString(e)&&"true"===e}function getAutoCapitalizeValue(e){return defaultCheck(e)}function getAutoCompleteValue(e){return defaultCheck(e)}function getAutoCorrectValue(e){return defaultCheck(e)}function defaultCheck(e){return s.a.isString(e)?"true"===e?"on":"off":s.a.isBoolean(e)&&e?"on":"off"}},function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(5),y=r.n(l),w=r(205),E=(r(2),r(9),r(6)),S=r(196),T="".concat(E.a.apiHost,"/asset/view"),O="".concat(E.a.apiHost,"/asset/viewProcessed"),N={uploading:"uploading",failed:"failed",complete:"complete"};t.a=y.a.Model.extend({UPLOAD_STATUS:N,initialize:function initialize(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.file,a=t.eventBus,l=t.activity,y=t.securityObject,w=t.hasVideoSupport,E=t.hasVideoRecordingSupport,S=t.assetExtension,T=t.assetMimeType,O=t.assetPath,A=t.responseId;if(this.options=t,this.eventBus=a,this.activity=l,this.securityToken=this._uriEncodeObject(y),this.responseId=A,this.hasVideoSupport=w,this.hasVideoRecordingSupport=E,this.set("id",s.a.uniqueId()),!s.a.isUndefined(r)&&this.validateFile(r)){if(this.file=r,this.set({name:r.name,originalName:r.name,extension:S,size:r.size,mimetype:T||r.type,status:N.uploading,hasUploaded:this.hasUploaded(),description:"",hasFailed:!1,hasNotifiedFailure:!0,assetPath:O}),(E||w)&&this.isVideoFile()){var L=O.substr(0,O.lastIndexOf(".")),R=this.get("name").substr(0,this.get("name").lastIndexOf("."));this.set({assetProcessedPath:"".concat(L,".").concat("mp4"),extension:"mp4",name:"".concat(R,".").concat("mp4")})}this.uploadAndHandle()}else this.set({status:N.complete,hasUploaded:!0});this.set("colorClass",this.getIconColorClass(this.get("extension")))},validateFile:function validateFile(e){return e instanceof File||e instanceof Blob&&!!e.name},hasUploaded:function hasUploaded(){return this.get("status")===N.complete},upload:function upload(){return w.a.upload({file:this.file,activity:this.activity,responseId:this.responseId,extension:this.get("extension"),mimeType:this.get("mimetype"),assetPath:this.get("assetPath"),assetProcessedPath:this.get("assetProcessedPath"),hasVideoSupport:this.hasVideoSupport})},uploadAndHandle:function uploadAndHandle(){var e=this;return this.upload().then((function(){e.handleUploadSuccess()})).catch((function(){e.handleUploadFail()}))},abortUpload:function abortUpload(){w.a.abort(this.get("assetPath"))},isSubmitPractice:function isSubmitPractice(){return this.options.activity.get("type")===this.activity.TYPE.SUBMIT_PRACTICE},isVideoFile:function isVideoFile(){var e=S.a.getExtensions("video"),t=this.get("extension");return s.a.contains(e,t)},handleUploadSuccess:function handleUploadSuccess(){var e=this.options.onUploadSuccess;this.set({status:N.complete,hasUploaded:!0,hasNotifiedFailure:!0}),s.a.isUndefined(this.eventBus)||this.eventBus.trigger("fileUploaded",this),e&&e()},handleUploadFail:function handleUploadFail(){var e=this.options.onUploadError;this.set({status:N.failed,hasFailed:!0,hasNotifiedFailure:!1}),s.a.isUndefined(this.eventBus)||this.eventBus.trigger("fileUploadFailed",this),e&&e()},getViewUrl:function getViewUrl(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={assetPath:this.get("assetPath")},r=T;this.get("assetProcessedPath")&&(t.assetProcessedPath=this.get("assetProcessedPath"),t.assetOriginalName=this.get("originalName"),r=O),e&&(t.assetName=this.get("name"));var a=this._uriEncodeObject(t);return"".concat(r,"?action=get&security=").concat(this.securityToken,"&usrequest=").concat(a)},retryUpload:function retryUpload(){this.get("hasFailed")&&(this.set({hasFailed:!1,status:N.uploading}),this.uploadAndHandle())},clearFailNotification:function clearFailNotification(){this.set("hasNotifiedFailure",!0)},getIconColorClass:function getIconColorClass(e){var t="default";switch(e){case"png":case"gif":case"pdf":case"csv":case"rtf":case"txt":case"xps":t=e;break;case"jpg":case"jpeg":t="jpg";break;case"doc":case"docx":case"dot":case"dotx":case"docm":case"dotm":t="word";break;case"xls":case"xlsx":case"xlt":case"xltm":case"xlsm":t="excel";break;case"ppt":case"pps":case"pot":case"pptx":case"pptm":case"potx":case"potm":case"ppsx":case"ppsm":t="powerpoint";break;case"pub":t="publisher";break;case"odf":case"odt":case"ods":case"odp":t="open-office";break;case"mp4":case"mov":case"avi":t="video"}return"".concat("lrn-file-").concat(t)},updateDescription:function updateDescription(e){this.set({description:e})},_uriEncodeObject:function _uriEncodeObject(e){return encodeURIComponent(JSON.stringify(e))}})},,function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=(r(229),r(2)),y=(r(18),r(9));function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var w=function(){function S3(){var e=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,S3),this.promise=new l.default((function(t,r){e.resolve=t,e.reject=r}))}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(S3,[{key:"request",value:function request(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.send(e),this.promise}},{key:"handleSuccess",value:function handleSuccess(e){e.target.status<400?this.resolve(e):this.handleFailure(e)}},{key:"handleFailure",value:function handleFailure(e){this.reject(e.target.status)}},{key:"send",value:function send(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new FormData,a=t.data.data.file,l="".concat(t.data.data.name,".").concat(t.data.data.extension),y=new XMLHttpRequest,w=a.slice(0,a.size,a.type),E=0;s.a.each(t.formInputs,(function(e,t){r.append(t,e)})),r.append("file",w,l),y.addEventListener("load",(function(t){e.handleSuccess(t)})),y.addEventListener("error",(function(t){e.handleFailure(t)})),y.upload.addEventListener("progress",(function(e){E=e.loaded})),y.open(t.formAttributes.method,t.formAttributes.action),y.send(r),t.onSendStart&&t.onSendStart({abort:function abort(){return y.abort()},getUploadedBytes:function getUploadedBytes(){return E}})}}]),S3}(),E=r(7),S=(E.a.isMicrosoft,[]),T=[],O=!1,N=[],A={MAX_ATTEMPTS:3,RETRY_DELAY:8e3,upload:function upload(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.validate(t);var r=t.activity,a=t.extension,s=t.file,y=t.assetPath,w=t.mimeType,E=r.get("security"),S={extension:a,file:s,assetPath:y,mimeType:w};return new l.default((function(t,r){var a={security:E.getRequestParameters(),data:S,success:function success(){e.removeFromQueue(a),e.resumeQueue(),t(S)},failure:function failure(t){e.removeFromQueue(a),e.resumeQueue(),r(t)}};e.addToQueue(a)}))},validate:function validate(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.file)throw new Error("FileUpload missing file");if(!s.a.isObject(e.activity))throw new Error("FileUpload missing activity");if(!s.a.isString(e.responseId))throw new Error("FileUpload missing responseId");if(!s.a.isString(e.extension))throw new Error("FileUpload missing file extension")},addToQueue:function addToQueue(e){if(this.getQueueItem(e.data.assetPath))throw new Error("Attempting to add duplicate assetPath to upload queue: ".concat(e.data.assetPath));N.push({config:e,isProcessing:!1,attempts:0}),this.processQueue()},abort:function abort(e){var t=this.getQueueItem(e);if(t){var r=t.config.s3Upload;r&&r.abort(),this.removeFromQueue(t),t.isProcessing&&this.resumeQueue()}},removeFromQueue:function removeFromQueue(e){clearTimeout(e.retryTimeoutId),N=s.a.filter(N,(function(t){return e.data.assetPath!==t.config.data.assetPath}))},resumeQueue:function resumeQueue(){O=!1,this.processQueue()},processQueue:function processQueue(){if(!O){var e=s()(N).find((function(e){return!e.isProcessing}));e&&this.processQueueItem(e)}},processQueueItem:function processQueueItem(e){var t=this,r=e.config,a=r.data,l=a.assetPath,w=a.mimeType;s.a.contains(N,e)&&(O=!0,e.isProcessing=!0,e.attempts++,y.a.request({url:"/asset/uploadform",security:r.security,action:y.a.ACTION.GET,data:{assetPath:l,mimeType:w},success:function success(r){t.handleTokenSuccess(e,r)},failure:function failure(){t.handleFailure(e)}}))},handleTokenSuccess:function handleTokenSuccess(e,t){var r=this,a=e.config;if(s.a.contains(N,e)){var l=new w;s.a.getNested(t,"response.data")?l.request({formAttributes:t.response.data.formAttributes,formInputs:t.response.data.formInputs,data:a,onSendStart:function onSendStart(e){a.s3Upload=e}}).then((function(){a.success()})).catch((function(){r.handleFailure(e)})):this.handleFailure(e)}},handleFailure:function handleFailure(e){var t=this;e.attempts<this.MAX_ATTEMPTS?(clearTimeout(e.retryTimeoutId),e.retryTimeoutId=setTimeout((function(){return t.processQueueItem(e)}),this.RETRY_DELAY)):e.config.failure.call(null,"Could not upload after ".concat(this.MAX_ATTEMPTS," attempts"))},isSafeToUnload:function isSafeToUnload(){var e=s.a.find(N,(function(e){return e.isProcessing}));return!O&&!e},isAssetPathInQueue:function isAssetPathInQueue(e){return s.a.some(N,(function(t){return t.config.data.assetPath===e}))},getQueueItem:function getQueueItem(e){return s()(N).find((function(t){return e===t.config.data.assetPath}))},getUploadStatus:function getUploadStatus(){var e=0,t=0;return s.a.each(T,(function(r){r.each((function(r){t+=r.get("size"),r.get("hasUploaded")&&(e+=r.get("size"))}))})),N.forEach((function(t){var r=t.config.s3Upload;r&&(e+=r.getUploadedBytes())})),{uploadComplete:this.isSafeToUnload(),totalBytes:t,bytesUploaded:e}},hookToActivity:function hookToActivity(e,t){s.a.contains(T,t)||T.push(t),s.a.isEmpty(e)||s.a.contains(S,e)||(e.hooks.unload.push(this.isSafeToUnload),e.hooks.saveProgress.push(s.a.bind(this.getUploadStatus,this)),S.push(e))}};t.a=A},,function(e,t,r){"use strict";r.r(t);var a=r(0),s=r.n(a),l=r(212),y={WIDGET:"data-lrn-wysihtml-widget",WIDGET_DATA:"data-lrn-wysihtml-widget-data",WIDGET_ID:"data-lrn-wysihtml-widget-id"},w={LATEX_WIDGET:"lrn-wysihtml-math-widget"},E={OPENING:'<span class="lrn_hide">[lrnwysimath]</span>',CLOSING:'<span class="lrn_hide">[/lrnwysimath]</span>'},S={LATEX:/(?:\$\$)(.*?)(?:\$\$)|(?:\\\()(.*?)(?:\\\))|(?:\\\[)(.*?)(?:\\\])/gi,MATH_WIDGET_FORMULA:/<script type="math\/tex">(.*?)<\/script>/,MATH_WIDGET_REMNANTS:/\[lrnwysimath\](.*?)\[\/lrnwysimath\]/g,MATH_WIDGET_TAGS:{OPENING:/<span class="lrn_hide">\[lrnwysimath]<\/span>/g,CLOSING:/<span class="lrn_hide">\[\/lrnwysimath]<\/span>/g}},T={WIDGET:"[".concat(y.WIDGET,"]"),LATEX:".".concat(w.LATEX_WIDGET),WIDGET_MOCK_DISPLAY_CONTENT:"[data-lrn-wysihtml-widget-mock-content]"},O=l.a.stripFormattingTags;function wrapLatexWithWidgetTags(e){var t=E,r=t.OPENING,a=t.CLOSING;return"".concat(r).concat(e).concat(a)}function stripMathWidgetTags(e){var t=S.MATH_WIDGET_TAGS,r=t.OPENING,a=t.CLOSING,l=e;return l=function stripFormattingTagsFromWidgets(e){var t=e.match(S.MATH_WIDGET_REMNANTS),r=e;return s.a.isEmpty(t)||t.forEach((function(e){r=r.replace(e,O(e))})),r}(l).replace(r,"").replace(a,"")}function wrapFormula(e){return"\\(".concat(e,"\\)")}t.default={ATTR:y,CLASSES:w,PATTERNS:S,SELECTOR:T,addLatexWrappers:function addLatexWrappers(e){var t=document.createElement("div");return t.innerHTML=e,function addWidgetWrappersToAllLatexChildNodes(e){if(e.nodeType===Node.TEXT_NODE)!function addWidgetWrapperForText(e){var t=e.textContent.replace(/\r?\n|\r/g,"");if(t.search(S.LATEX)>-1&&!function isWrapperElement(e){return-1!==e.className.indexOf(w.LATEX_WIDGET)}(e.parentNode))if(function shouldReuseParentForWrapper(e){var t=Array.prototype.slice.call(e.attributes),r=1===t.length&&"aria-label"===t[0].name,a="span"===e.nodeName.toLowerCase(),s="div"===e.nodeName.toLowerCase();return(a||s)&&r}(e.parentNode)){var r=e.parentNode.className;e.parentNode.className=(r+" "+w.LATEX_WIDGET).trim()}else{var a=t.replace(S.LATEX,(function(e,t,r,a){var s="span";a&&(s="div");var l=wrapLatexWithWidgetTags(e=e.replace(/(<|\&lt;)/g," &lt; "));return"<".concat(s,' class="').concat(w.LATEX_WIDGET,'">').concat(l,"</").concat(s,">")})),s=document.createElement("div");for(s.innerHTML=a;s.childNodes.length;)e.parentNode.insertBefore(s.childNodes[0],e);e.parentNode.removeChild(e)}}(e);else for(var t=0;t<e.childNodes.length;++t)addWidgetWrappersToAllLatexChildNodes(e.childNodes[t])}(t),t.innerHTML},createHtml:function createHtml(e){var t=w.LATEX_WIDGET,r=wrapFormula(e);return'<span class="'.concat(t,'">').concat(wrapLatexWithWidgetTags(r),"</span>")},formatMathJaxRemnants:function formatMathJaxRemnants(e){var t=e.match(S.MATH_WIDGET_REMNANTS),r=e;return s.a.isEmpty(t)||t.forEach((function(e){r=r.replace(e,function formatMathJaxRemnant(e){var t=S.MATH_WIDGET_FORMULA.exec(e)[1];return wrapFormula(O(t))}(e))})),r},getDataFromEvent:function getDataFromEvent(e){var t=e.event,r=e.data;return{element:t.target.closest("[".concat(y.WIDGET,"]")),latex:stripMathWidgetTags(r).match(/^\\\((.*)\\\)$/)[1]}},stripFormattingTags:O,stripMathWidgetTags:stripMathWidgetTags}},function(e,t,r){"use strict";r.d(t,"a",(function(){return enhanceWithCharacterMap}));var a=r(0),s=r.n(a),l=r(17),y=r.n(l),w=r(158);function enhanceWithCharacterMap(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ignoreFormattingOptions:!1},r=e.data,a=e.question,l=e.activity,E=l.get("i18n");Object(w.a)(e,{characterMap:function characterMap(){if(s.a.isUndefined(r.characterMap)){var characterMap=a.character_map;(function(){if(t.ignoreFormattingOptions)return s.a.isEmpty(characterMap);var e=s.a.isArray(a.formatting_options)?a.formatting_options:[];return(s.a.isUndefined(characterMap)||s.a.isArray(characterMap)&&!characterMap.length)&&e.indexOf("charactermap")>=0})()?r.characterMap=!0:s.a.isArray(characterMap)?r.characterMap=characterMap.map((function(e){return y.a.stripHTML(y.a.createImageDescriptions(e),!0)})):s.a.isBoolean(characterMap)?r.characterMap=characterMap:r.characterMap=!1}return r.characterMap},characterMathMap:function characterMathMap(){return s.a.isUndefined(r.characterMathMap)&&(r.characterMathMap=E.labels.characterMapMathCharacters),r.characterMathMap}})}},,,,function(e,t,r){"use strict";var a=r(0),s=r.n(a),l={TAGS:s()(["b","i","u","sup","sub"]).map((function(e){return{OPENING:new RegExp("<".concat(e,">"),"gi"),CLOSING:new RegExp("</".concat(e,">"),"gi")}}))};t.a={hasFormatting:function hasFormatting(e){var t=!1;return s()(l.TAGS).forEach((function(r){var a=r.OPENING,s=r.CLOSING;(e.match(a)||e.match(s))&&(t=!0)})),t},stripFormattingTags:function stripFormattingTags(e){var t=e;return s()(l.TAGS).forEach((function(e){var r=e.OPENING,a=e.CLOSING;t=t.replace(r,"").replace(a,"")})),t}}},,,,,,,function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(5),y=r.n(l),w=r(203);t.a=y.a.Collection.extend({model:w.a,comparator:"name",ATTRS_FOR_RESPONSE:["name","description","originalName","extension","size","assetPath","assetProcessedPath"],getResponseValueFormat:function getResponseValueFormat(){var e=this,t=this.where({hasUploaded:!0});return s()(t).map((function(t){return t.pick(e.ATTRS_FOR_RESPONSE)}))}})},,,,,,,,,function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(205),y=r(203),w=r(219),E=r(196),S=r(243);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var T=-90,O=-180,N=-270;function getImageConversionOrientation(e){return e===T?8:e===O?3:e===N?6:void 0}function ImageUploader(e){this.activity=e.activity,this.modelId=e.modelId,this.responseId=e.responseId,this.eventBus=e.eventBus,this.compression=e.compression,this.assets=new w.a,l.a.hookToActivity(this.activity,this.assets)}s.a.extend(ImageUploader.prototype,{compressImage:function compressImage(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=s.a.extend(this.compression,t);var r=.001*Math.min(e.size,t.size),a=parseInt(r-Math.max(.1*r,1),10),l=_objectSpread(_objectSpread({},t),{},{size:Math.abs(a),orientation:getImageConversionOrientation(t.rotation)});return delete l.rotation,S.compressAccurately(e,l).then((function(t){return t.name=e.name,t.lastModified=e.lastModified,t.lastModifiedDate=e.lastModifiedDate,t}))},upload:function upload(e){var t=E.a.createFullPath(this.activity,this.modelId,e.name,!0),r=E.a.getValidExtension(e.name),a=E.a.getMimeTypeByExtension(r);return this.assets.add({file:e},{assetPath:t,assetExtension:r,assetMimeType:a,activity:this.activity,responseId:this.responseId,eventBus:this.eventBus,securityObject:this.getSecurityObject()})},resume:function resume(e){return this.assets.add({assetPath:e},{securityObject:this.getSecurityObject()})},getSecurityObject:function getSecurityObject(){return this.activity.get("security").getRequestParameters()},currentUploadsCount:function currentUploadsCount(){return this.assets.where({status:y.a.prototype.UPLOAD_STATUS.uploading}).length}}),t.a=ImageUploader},function(e,t,r){"use strict";t.a={encode:function base64_encode(e){var t,r,a,s,l,y,w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E=0,S=0,T="",O=[];if(!e)return e;do{t=(l=e.charCodeAt(E++)<<16|e.charCodeAt(E++)<<8|e.charCodeAt(E++))>>18&63,r=l>>12&63,a=l>>6&63,s=63&l,O[S++]=w.charAt(t)+w.charAt(r)+w.charAt(a)+w.charAt(s)}while(E<e.length);return T=O.join(""),((y=e.length%3)?T.slice(0,y-3):T)+"===".slice(y||3)},decode:function base64_decode(e){var t,r,a,s,l,y,w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E=0,S=0,T=[];if(!e)return e;e+="";do{t=(y=w.indexOf(e.charAt(E++))<<18|w.indexOf(e.charAt(E++))<<12|(s=w.indexOf(e.charAt(E++)))<<6|(l=w.indexOf(e.charAt(E++))))>>16&255,r=y>>8&255,a=255&y,T[S++]=64===s?String.fromCharCode(t):64===l?String.fromCharCode(t,r):String.fromCharCode(t,r,a)}while(E<e.length);return T.join("")}}},,,,,,,,,,function(e,t,r){"use strict";r.d(t,"a",(function(){return Spinner}));var a=r(127),s=r.n(a);function Spinner(){return s.a.createElement("span",{className:"lrn-loader"},s.a.createElement("span",{className:"lrn_spinner"},s.a.createElement("span",{className:"lrn_bounce1"}),s.a.createElement("span",{className:"lrn_bounce2"}),s.a.createElement("span",{className:"lrn_bounce3"})))}},function(e,t,r){"use strict";var a,s,l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};s=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=document.createElement("input");return"object"===l(t[0])&&(!0===t[0].multiple&&a.setAttribute("multiple",""),void 0!==t[0].accept&&a.setAttribute("accept",t[0].accept)),a.setAttribute("type","file"),a.style.display="none",a.setAttribute("id","hidden-file"),document.body.appendChild(a),new Promise((function(e){a.addEventListener("change",(function(){e(a.files);var r=t[t.length-1];"function"==typeof r&&r(a.files),document.body.removeChild(a)}));var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(r)}))},void 0===(a=function(){return s}.call(t,r,t,e))||(e.exports=a)},function(e,t,r){e.exports=function(){"use strict";var e=navigator.userAgent,t=navigator.platform,r=/gecko\/\d/i.test(e),a=/MSIE \d/.test(e),s=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e),l=/Edge\/(\d+)/.exec(e),y=a||s||l,w=y&&(a?document.documentMode||6:+(l||s)[1]),E=!l&&/WebKit\//.test(e),S=E&&/Qt\/\d+\.\d+/.test(e),T=!l&&/Chrome\//.test(e),O=/Opera\//.test(e),N=/Apple Computer/.test(navigator.vendor),A=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e),L=/PhantomJS/.test(e),R=N&&(/Mobile\/\w+/.test(e)||navigator.maxTouchPoints>2),D=/Android/.test(e),M=R||D||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e),B=R||/Mac/.test(t),q=/\bCrOS\b/.test(e),W=/win/i.test(t),j=O&&e.match(/Version\/(\d*\.\d*)/);j&&(j=Number(j[1])),j&&j>=15&&(O=!1,E=!0);var H=B&&(S||O&&(null==j||j<12.11)),V=r||y&&w>=9;function classTest(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}var z,rmClass=function(e,t){var r=e.className,a=classTest(t).exec(r);if(a){var s=r.slice(a.index+a[0].length);e.className=r.slice(0,a.index)+(s?a[1]+s:"")}};function removeChildren(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function removeChildrenAndAdd(e,t){return removeChildren(e).appendChild(t)}function elt(e,t,r,a){var s=document.createElement(e);if(r&&(s.className=r),a&&(s.style.cssText=a),"string"==typeof t)s.appendChild(document.createTextNode(t));else if(t)for(var l=0;l<t.length;++l)s.appendChild(t[l]);return s}function eltP(e,t,r,a){var s=elt(e,t,r,a);return s.setAttribute("role","presentation"),s}function contains(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function activeElt(){var e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function addClass(e,t){var r=e.className;classTest(t).test(r)||(e.className+=(r?" ":"")+t)}function joinClasses(e,t){for(var r=e.split(" "),a=0;a<r.length;a++)r[a]&&!classTest(r[a]).test(t)&&(t+=" "+r[a]);return t}z=document.createRange?function(e,t,r,a){var s=document.createRange();return s.setEnd(a||e,r),s.setStart(e,t),s}:function(e,t,r){var a=document.body.createTextRange();try{a.moveToElementText(e.parentNode)}catch(e){return a}return a.collapse(!0),a.moveEnd("character",r),a.moveStart("character",t),a};var selectInput=function(e){e.select()};function bind(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function copyObj(e,t,r){for(var a in t||(t={}),e)!e.hasOwnProperty(a)||!1===r&&t.hasOwnProperty(a)||(t[a]=e[a]);return t}function countColumn(e,t,r,a,s){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var l=a||0,y=s||0;;){var w=e.indexOf("\t",l);if(w<0||w>=t)return y+(t-l);y+=w-l,y+=r-y%r,l=w+1}}R?selectInput=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:y&&(selectInput=function(e){try{e.select()}catch(e){}});var Delayed=function(){this.id=null,this.f=null,this.time=0,this.handler=bind(this.onTimeout,this)};function indexOf(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return r;return-1}Delayed.prototype.onTimeout=function(e){e.id=0,e.time<=+new Date?e.f():setTimeout(e.handler,e.time-+new Date)},Delayed.prototype.set=function(e,t){this.f=t;var r=+new Date+e;(!this.id||r<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,e),this.time=r)};var U={toString:function(){return"CodeMirror.Pass"}},G={scroll:!1},K={origin:"*mouse"},$={origin:"+move"};function findColumn(e,t,r){for(var a=0,s=0;;){var l=e.indexOf("\t",a);-1==l&&(l=e.length);var y=l-a;if(l==e.length||s+y>=t)return a+Math.min(y,t-s);if(s+=l-a,a=l+1,(s+=r-s%r)>=t)return a}}var Q=[""];function spaceStr(e){for(;Q.length<=e;)Q.push(lst(Q)+" ");return Q[e]}function lst(e){return e[e.length-1]}function map(e,t){for(var r=[],a=0;a<e.length;a++)r[a]=t(e[a],a);return r}function nothing(){}function createObj(e,t){var r;return Object.create?r=Object.create(e):(nothing.prototype=e,r=new nothing),t&&copyObj(t,r),r}var Y=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function isWordCharBasic(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Y.test(e))}function isWordChar(e,t){return t?!!(t.source.indexOf("\\w")>-1&&isWordCharBasic(e))||t.test(e):isWordCharBasic(e)}function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}var X=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function isExtendingChar(e){return e.charCodeAt(0)>=768&&X.test(e)}function skipExtendingChars(e,t,r){for(;(r<0?t>0:t<e.length)&&isExtendingChar(e.charAt(t));)t+=r;return t}function findFirst(e,t,r){for(var a=t>r?-1:1;;){if(t==r)return t;var s=(t+r)/2,l=a<0?Math.ceil(s):Math.floor(s);if(l==t)return e(l)?t:r;e(l)?r=l:t=l+a}}var Z=null;function getBidiPartAt(e,t,r){var a;Z=null;for(var s=0;s<e.length;++s){var l=e[s];if(l.from<t&&l.to>t)return s;l.to==t&&(l.from!=l.to&&"before"==r?a=s:Z=s),l.from==t&&(l.from!=l.to&&"before"!=r?a=s:Z=s)}return null!=a?a:Z}var J=function(){var e=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,t=/[stwN]/,r=/[LRr]/,a=/[Lb1n]/,s=/[1n]/;function BidiSpan(e,t,r){this.level=e,this.from=t,this.to=r}return function(l,y){var w="ltr"==y?"L":"R";if(0==l.length||"ltr"==y&&!e.test(l))return!1;for(var E,S=l.length,T=[],O=0;O<S;++O)T.push((E=l.charCodeAt(O))<=247?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(E):1424<=E&&E<=1524?"R":1536<=E&&E<=1785?"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(E-1536):1774<=E&&E<=2220?"r":8192<=E&&E<=8203?"w":8204==E?"b":"L");for(var N=0,A=w;N<S;++N){var L=T[N];"m"==L?T[N]=A:A=L}for(var R=0,D=w;R<S;++R){var M=T[R];"1"==M&&"r"==D?T[R]="n":r.test(M)&&(D=M,"r"==M&&(T[R]="R"))}for(var B=1,q=T[0];B<S-1;++B){var W=T[B];"+"==W&&"1"==q&&"1"==T[B+1]?T[B]="1":","!=W||q!=T[B+1]||"1"!=q&&"n"!=q||(T[B]=q),q=W}for(var j=0;j<S;++j){var H=T[j];if(","==H)T[j]="N";else if("%"==H){var V=void 0;for(V=j+1;V<S&&"%"==T[V];++V);for(var z=j&&"!"==T[j-1]||V<S&&"1"==T[V]?"1":"N",U=j;U<V;++U)T[U]=z;j=V-1}}for(var G=0,K=w;G<S;++G){var $=T[G];"L"==K&&"1"==$?T[G]="L":r.test($)&&(K=$)}for(var Q=0;Q<S;++Q)if(t.test(T[Q])){var Y=void 0;for(Y=Q+1;Y<S&&t.test(T[Y]);++Y);for(var X="L"==(Q?T[Q-1]:w),Z=X==("L"==(Y<S?T[Y]:w))?X?"L":"R":w,J=Q;J<Y;++J)T[J]=Z;Q=Y-1}for(var ee,te=[],ne=0;ne<S;)if(a.test(T[ne])){var re=ne;for(++ne;ne<S&&a.test(T[ne]);++ne);te.push(new BidiSpan(0,re,ne))}else{var ie=ne,oe=te.length,ae="rtl"==y?1:0;for(++ne;ne<S&&"L"!=T[ne];++ne);for(var se=ie;se<ne;)if(s.test(T[se])){ie<se&&(te.splice(oe,0,new BidiSpan(1,ie,se)),oe+=ae);var le=se;for(++se;se<ne&&s.test(T[se]);++se);te.splice(oe,0,new BidiSpan(2,le,se)),oe+=ae,ie=se}else++se;ie<ne&&te.splice(oe,0,new BidiSpan(1,ie,ne))}return"ltr"==y&&(1==te[0].level&&(ee=l.match(/^\s+/))&&(te[0].from=ee[0].length,te.unshift(new BidiSpan(0,0,ee[0].length))),1==lst(te).level&&(ee=l.match(/\s+$/))&&(lst(te).to-=ee[0].length,te.push(new BidiSpan(0,S-ee[0].length,S)))),"rtl"==y?te.reverse():te}}();function getOrder(e,t){var r=e.order;return null==r&&(r=e.order=J(e.text,t)),r}var ee=[],on=function(e,t,r){if(e.addEventListener)e.addEventListener(t,r,!1);else if(e.attachEvent)e.attachEvent("on"+t,r);else{var a=e._handlers||(e._handlers={});a[t]=(a[t]||ee).concat(r)}};function getHandlers(e,t){return e._handlers&&e._handlers[t]||ee}function off(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,!1);else if(e.detachEvent)e.detachEvent("on"+t,r);else{var a=e._handlers,s=a&&a[t];if(s){var l=indexOf(s,r);l>-1&&(a[t]=s.slice(0,l).concat(s.slice(l+1)))}}}function signal(e,t){var r=getHandlers(e,t);if(r.length)for(var a=Array.prototype.slice.call(arguments,2),s=0;s<r.length;++s)r[s].apply(null,a)}function signalDOMEvent(e,t,r){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),signal(e,r||t.type,e,t),e_defaultPrevented(t)||t.codemirrorIgnore}function signalCursorActivity(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var r=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),a=0;a<t.length;++a)-1==indexOf(r,t[a])&&r.push(t[a])}function hasHandler(e,t){return getHandlers(e,t).length>0}function eventMixin(e){e.prototype.on=function(e,t){on(this,e,t)},e.prototype.off=function(e,t){off(this,e,t)}}function e_preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function e_stopPropagation(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function e_defaultPrevented(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function e_stop(e){e_preventDefault(e),e_stopPropagation(e)}function e_target(e){return e.target||e.srcElement}function e_button(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),B&&e.ctrlKey&&1==t&&(t=3),t}var te,ne,re=function(){if(y&&w<9)return!1;var e=elt("div");return"draggable"in e||"dragDrop"in e}();function zeroWidthElement(e){if(null==te){var t=elt("span","​");removeChildrenAndAdd(e,elt("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(te=t.offsetWidth<=1&&t.offsetHeight>2&&!(y&&w<8))}var r=te?elt("span","​"):elt("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return r.setAttribute("cm-text",""),r}function hasBadBidiRects(e){if(null!=ne)return ne;var t=removeChildrenAndAdd(e,document.createTextNode("AخA")),r=z(t,0,1).getBoundingClientRect(),a=z(t,1,2).getBoundingClientRect();return removeChildren(e),!(!r||r.left==r.right)&&(ne=a.right-r.right<3)}var ie,oe=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,r=[],a=e.length;t<=a;){var s=e.indexOf("\n",t);-1==s&&(s=e.length);var l=e.slice(t,"\r"==e.charAt(s-1)?s-1:s),y=l.indexOf("\r");-1!=y?(r.push(l.slice(0,y)),t+=y+1):(r.push(l),t=s+1)}return r}:function(e){return e.split(/\r\n?|\n/)},ae=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},se="oncopy"in(ie=elt("div"))||(ie.setAttribute("oncopy","return;"),"function"==typeof ie.oncopy),le=null,ce={},ue={};function defineMode(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),ce[e]=t}function resolveMode(e){if("string"==typeof e&&ue.hasOwnProperty(e))e=ue[e];else if(e&&"string"==typeof e.name&&ue.hasOwnProperty(e.name)){var t=ue[e.name];"string"==typeof t&&(t={name:t}),(e=createObj(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return resolveMode("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return resolveMode("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function getMode(e,t){t=resolveMode(t);var r=ce[t.name];if(!r)return getMode(e,"text/plain");var a=r(e,t);if(de.hasOwnProperty(t.name)){var s=de[t.name];for(var l in s)s.hasOwnProperty(l)&&(a.hasOwnProperty(l)&&(a["_"+l]=a[l]),a[l]=s[l])}if(a.name=t.name,t.helperType&&(a.helperType=t.helperType),t.modeProps)for(var y in t.modeProps)a[y]=t.modeProps[y];return a}var de={};function extendMode(e,t){copyObj(t,de.hasOwnProperty(e)?de[e]:de[e]={})}function copyState(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var r={};for(var a in t){var s=t[a];s instanceof Array&&(s=s.concat([])),r[a]=s}return r}function innerMode(e,t){for(var r;e.innerMode&&(r=e.innerMode(t))&&r.mode!=e;)t=r.state,e=r.mode;return r||{mode:e,state:t}}function startState(e,t,r){return!e.startState||e.startState(t,r)}var StringStream=function(e,t,r){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=r};function getLine(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var r=e;!r.lines;)for(var a=0;;++a){var s=r.children[a],l=s.chunkSize();if(t<l){r=s;break}t-=l}return r.lines[t]}function getBetween(e,t,r){var a=[],s=t.line;return e.iter(t.line,r.line+1,(function(e){var l=e.text;s==r.line&&(l=l.slice(0,r.ch)),s==t.line&&(l=l.slice(t.ch)),a.push(l),++s})),a}function getLines(e,t,r){var a=[];return e.iter(t,r,(function(e){a.push(e.text)})),a}function updateLineHeight(e,t){var r=t-e.height;if(r)for(var a=e;a;a=a.parent)a.height+=r}function lineNo(e){if(null==e.parent)return null;for(var t=e.parent,r=indexOf(t.lines,e),a=t.parent;a;t=a,a=a.parent)for(var s=0;a.children[s]!=t;++s)r+=a.children[s].chunkSize();return r+t.first}function lineAtHeight(e,t){var r=e.first;e:do{for(var a=0;a<e.children.length;++a){var s=e.children[a],l=s.height;if(t<l){e=s;continue e}t-=l,r+=s.chunkSize()}return r}while(!e.lines);for(var y=0;y<e.lines.length;++y){var w=e.lines[y].height;if(t<w)break;t-=w}return r+y}function isLine(e,t){return t>=e.first&&t<e.first+e.size}function lineNumberFor(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function Pos(e,t,r){if(void 0===r&&(r=null),!(this instanceof Pos))return new Pos(e,t,r);this.line=e,this.ch=t,this.sticky=r}function cmp(e,t){return e.line-t.line||e.ch-t.ch}function equalCursorPos(e,t){return e.sticky==t.sticky&&0==cmp(e,t)}function copyPos(e){return Pos(e.line,e.ch)}function maxPos(e,t){return cmp(e,t)<0?t:e}function minPos(e,t){return cmp(e,t)<0?e:t}function clipLine(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function clipPos(e,t){if(t.line<e.first)return Pos(e.first,0);var r=e.first+e.size-1;return t.line>r?Pos(r,getLine(e,r).text.length):function clipToLen(e,t){var r=e.ch;return null==r||r>t?Pos(e.line,t):r<0?Pos(e.line,0):e}(t,getLine(e,t.line).text.length)}function clipPosArray(e,t){for(var r=[],a=0;a<t.length;a++)r[a]=clipPos(e,t[a]);return r}StringStream.prototype.eol=function(){return this.pos>=this.string.length},StringStream.prototype.sol=function(){return this.pos==this.lineStart},StringStream.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},StringStream.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},StringStream.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},StringStream.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},StringStream.prototype.eatSpace=function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},StringStream.prototype.skipToEnd=function(){this.pos=this.string.length},StringStream.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},StringStream.prototype.backUp=function(e){this.pos-=e},StringStream.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)},StringStream.prototype.indentation=function(){return countColumn(this.string,null,this.tabSize)-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)},StringStream.prototype.match=function(e,t,r){if("string"!=typeof e){var a=this.string.slice(this.pos).match(e);return a&&a.index>0?null:(a&&!1!==t&&(this.pos+=a[0].length),a)}var cased=function(e){return r?e.toLowerCase():e};if(cased(this.string.substr(this.pos,e.length))==cased(e))return!1!==t&&(this.pos+=e.length),!0},StringStream.prototype.current=function(){return this.string.slice(this.start,this.pos)},StringStream.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},StringStream.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)},StringStream.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)};var SavedContext=function(e,t){this.state=e,this.lookAhead=t},Context=function(e,t,r,a){this.state=t,this.doc=e,this.line=r,this.maxLookAhead=a||0,this.baseTokens=null,this.baseTokenPos=1};function highlightLine(e,t,r,a){var s=[e.state.modeGen],l={};runMode(e,t.text,e.doc.mode,r,(function(e,t){return s.push(e,t)}),l,a);for(var y=r.state,loop=function(a){r.baseTokens=s;var w=e.state.overlays[a],E=1,S=0;r.state=!0,runMode(e,t.text,w.mode,r,(function(e,t){for(var r=E;S<e;){var a=s[E];a>e&&s.splice(E,1,e,s[E+1],a),E+=2,S=Math.min(e,a)}if(t)if(w.opaque)s.splice(r,E-r,e,"overlay "+t),E=r+2;else for(;r<E;r+=2){var l=s[r+1];s[r+1]=(l?l+" ":"")+"overlay "+t}}),l),r.state=y,r.baseTokens=null,r.baseTokenPos=1},w=0;w<e.state.overlays.length;++w)loop(w);return{styles:s,classes:l.bgClass||l.textClass?l:null}}function getLineStyles(e,t,r){if(!t.styles||t.styles[0]!=e.state.modeGen){var a=getContextBefore(e,lineNo(t)),s=t.text.length>e.options.maxHighlightLength&&copyState(e.doc.mode,a.state),l=highlightLine(e,t,a);s&&(a.state=s),t.stateAfter=a.save(!s),t.styles=l.styles,l.classes?t.styleClasses=l.classes:t.styleClasses&&(t.styleClasses=null),r===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function getContextBefore(e,t,r){var a=e.doc,s=e.display;if(!a.mode.startState)return new Context(a,!0,t);var l=function findStartLine(e,t,r){for(var a,s,l=e.doc,y=r?-1:t-(e.doc.mode.innerMode?1e3:100),w=t;w>y;--w){if(w<=l.first)return l.first;var E=getLine(l,w-1),S=E.stateAfter;if(S&&(!r||w+(S instanceof SavedContext?S.lookAhead:0)<=l.modeFrontier))return w;var T=countColumn(E.text,null,e.options.tabSize);(null==s||a>T)&&(s=w-1,a=T)}return s}(e,t,r),y=l>a.first&&getLine(a,l-1).stateAfter,w=y?Context.fromSaved(a,y,l):new Context(a,startState(a.mode),l);return a.iter(l,t,(function(r){processLine(e,r.text,w);var a=w.line;r.stateAfter=a==t-1||a%5==0||a>=s.viewFrom&&a<s.viewTo?w.save():null,w.nextLine()})),r&&(a.modeFrontier=w.line),w}function processLine(e,t,r,a){var s=e.doc.mode,l=new StringStream(t,e.options.tabSize,r);for(l.start=l.pos=a||0,""==t&&callBlankLine(s,r.state);!l.eol();)readToken(s,l,r.state),l.start=l.pos}function callBlankLine(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var r=innerMode(e,t);return r.mode.blankLine?r.mode.blankLine(r.state):void 0}}function readToken(e,t,r,a){for(var s=0;s<10;s++){a&&(a[0]=innerMode(e,r).mode);var l=e.token(t,r);if(t.pos>t.start)return l}throw new Error("Mode "+e.name+" failed to advance stream.")}Context.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},Context.prototype.baseToken=function(e){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=e;)this.baseTokenPos+=2;var t=this.baseTokens[this.baseTokenPos+1];return{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-e}},Context.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},Context.fromSaved=function(e,t,r){return t instanceof SavedContext?new Context(e,copyState(e.mode,t.state),r,t.lookAhead):new Context(e,copyState(e.mode,t),r)},Context.prototype.save=function(e){var t=!1!==e?copyState(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new SavedContext(t,this.maxLookAhead):t};var Token=function(e,t,r){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=r};function takeToken(e,t,r,a){var s,l,y=e.doc,w=y.mode,E=getLine(y,(t=clipPos(y,t)).line),S=getContextBefore(e,t.line,r),T=new StringStream(E.text,e.options.tabSize,S);for(a&&(l=[]);(a||T.pos<t.ch)&&!T.eol();)T.start=T.pos,s=readToken(w,T,S.state),a&&l.push(new Token(T,s,copyState(y.mode,S.state)));return a?l:new Token(T,s,S.state)}function extractLineClasses(e,t){if(e)for(;;){var r=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!r)break;e=e.slice(0,r.index)+e.slice(r.index+r[0].length);var a=r[1]?"bgClass":"textClass";null==t[a]?t[a]=r[2]:new RegExp("(?:^|\\s)"+r[2]+"(?:$|\\s)").test(t[a])||(t[a]+=" "+r[2])}return e}function runMode(e,t,r,a,s,l,y){var w=r.flattenSpans;null==w&&(w=e.options.flattenSpans);var E,S=0,T=null,O=new StringStream(t,e.options.tabSize,a),N=e.options.addModeClass&&[null];for(""==t&&extractLineClasses(callBlankLine(r,a.state),l);!O.eol();){if(O.pos>e.options.maxHighlightLength?(w=!1,y&&processLine(e,t,a,O.pos),O.pos=t.length,E=null):E=extractLineClasses(readToken(r,O,a.state,N),l),N){var A=N[0].name;A&&(E="m-"+(E?A+" "+E:A))}if(!w||T!=E){for(;S<O.start;)s(S=Math.min(O.start,S+5e3),T);T=E}O.start=O.pos}for(;S<O.pos;){var L=Math.min(O.pos,S+5e3);s(L,T),S=L}}var he=!1,pe=!1;function MarkedSpan(e,t,r){this.marker=e,this.from=t,this.to=r}function getMarkedSpanFor(e,t){if(e)for(var r=0;r<e.length;++r){var a=e[r];if(a.marker==t)return a}}function removeMarkedSpan(e,t){for(var r,a=0;a<e.length;++a)e[a]!=t&&(r||(r=[])).push(e[a]);return r}function stretchSpansOverChange(e,t){if(t.full)return null;var r=isLine(e,t.from.line)&&getLine(e,t.from.line).markedSpans,a=isLine(e,t.to.line)&&getLine(e,t.to.line).markedSpans;if(!r&&!a)return null;var s=t.from.ch,l=t.to.ch,y=0==cmp(t.from,t.to),w=function markedSpansBefore(e,t,r){var a;if(e)for(var s=0;s<e.length;++s){var l=e[s],y=l.marker;if(null==l.from||(y.inclusiveLeft?l.from<=t:l.from<t)||l.from==t&&"bookmark"==y.type&&(!r||!l.marker.insertLeft)){var w=null==l.to||(y.inclusiveRight?l.to>=t:l.to>t);(a||(a=[])).push(new MarkedSpan(y,l.from,w?null:l.to))}}return a}(r,s,y),E=function markedSpansAfter(e,t,r){var a;if(e)for(var s=0;s<e.length;++s){var l=e[s],y=l.marker;if(null==l.to||(y.inclusiveRight?l.to>=t:l.to>t)||l.from==t&&"bookmark"==y.type&&(!r||l.marker.insertLeft)){var w=null==l.from||(y.inclusiveLeft?l.from<=t:l.from<t);(a||(a=[])).push(new MarkedSpan(y,w?null:l.from-t,null==l.to?null:l.to-t))}}return a}(a,l,y),S=1==t.text.length,T=lst(t.text).length+(S?s:0);if(w)for(var O=0;O<w.length;++O){var N=w[O];if(null==N.to){var A=getMarkedSpanFor(E,N.marker);A?S&&(N.to=null==A.to?null:A.to+T):N.to=s}}if(E)for(var L=0;L<E.length;++L){var R=E[L];null!=R.to&&(R.to+=T),null==R.from?getMarkedSpanFor(w,R.marker)||(R.from=T,S&&(w||(w=[])).push(R)):(R.from+=T,S&&(w||(w=[])).push(R))}w&&(w=clearEmptySpans(w)),E&&E!=w&&(E=clearEmptySpans(E));var D=[w];if(!S){var M,B=t.text.length-2;if(B>0&&w)for(var q=0;q<w.length;++q)null==w[q].to&&(M||(M=[])).push(new MarkedSpan(w[q].marker,null,null));for(var W=0;W<B;++W)D.push(M);D.push(E)}return D}function clearEmptySpans(e){for(var t=0;t<e.length;++t){var r=e[t];null!=r.from&&r.from==r.to&&!1!==r.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function detachMarkedSpans(e){var t=e.markedSpans;if(t){for(var r=0;r<t.length;++r)t[r].marker.detachLine(e);e.markedSpans=null}}function attachMarkedSpans(e,t){if(t){for(var r=0;r<t.length;++r)t[r].marker.attachLine(e);e.markedSpans=t}}function extraLeft(e){return e.inclusiveLeft?-1:0}function extraRight(e){return e.inclusiveRight?1:0}function compareCollapsedMarkers(e,t){var r=e.lines.length-t.lines.length;if(0!=r)return r;var a=e.find(),s=t.find(),l=cmp(a.from,s.from)||extraLeft(e)-extraLeft(t);if(l)return-l;var y=cmp(a.to,s.to)||extraRight(e)-extraRight(t);return y||t.id-e.id}function collapsedSpanAtSide(e,t){var r,a=pe&&e.markedSpans;if(a)for(var s=void 0,l=0;l<a.length;++l)(s=a[l]).marker.collapsed&&null==(t?s.from:s.to)&&(!r||compareCollapsedMarkers(r,s.marker)<0)&&(r=s.marker);return r}function collapsedSpanAtStart(e){return collapsedSpanAtSide(e,!0)}function collapsedSpanAtEnd(e){return collapsedSpanAtSide(e,!1)}function collapsedSpanAround(e,t){var r,a=pe&&e.markedSpans;if(a)for(var s=0;s<a.length;++s){var l=a[s];l.marker.collapsed&&(null==l.from||l.from<t)&&(null==l.to||l.to>t)&&(!r||compareCollapsedMarkers(r,l.marker)<0)&&(r=l.marker)}return r}function conflictingCollapsedRange(e,t,r,a,s){var l=getLine(e,t),y=pe&&l.markedSpans;if(y)for(var w=0;w<y.length;++w){var E=y[w];if(E.marker.collapsed){var S=E.marker.find(0),T=cmp(S.from,r)||extraLeft(E.marker)-extraLeft(s),O=cmp(S.to,a)||extraRight(E.marker)-extraRight(s);if(!(T>=0&&O<=0||T<=0&&O>=0)&&(T<=0&&(E.marker.inclusiveRight&&s.inclusiveLeft?cmp(S.to,r)>=0:cmp(S.to,r)>0)||T>=0&&(E.marker.inclusiveRight&&s.inclusiveLeft?cmp(S.from,a)<=0:cmp(S.from,a)<0)))return!0}}}function visualLine(e){for(var t;t=collapsedSpanAtStart(e);)e=t.find(-1,!0).line;return e}function visualLineNo(e,t){var r=getLine(e,t),a=visualLine(r);return r==a?t:lineNo(a)}function visualLineEndNo(e,t){if(t>e.lastLine())return t;var r,a=getLine(e,t);if(!lineIsHidden(e,a))return t;for(;r=collapsedSpanAtEnd(a);)a=r.find(1,!0).line;return lineNo(a)+1}function lineIsHidden(e,t){var r=pe&&t.markedSpans;if(r)for(var a=void 0,s=0;s<r.length;++s)if((a=r[s]).marker.collapsed){if(null==a.from)return!0;if(!a.marker.widgetNode&&0==a.from&&a.marker.inclusiveLeft&&lineIsHiddenInner(e,t,a))return!0}}function lineIsHiddenInner(e,t,r){if(null==r.to){var a=r.marker.find(1,!0);return lineIsHiddenInner(e,a.line,getMarkedSpanFor(a.line.markedSpans,r.marker))}if(r.marker.inclusiveRight&&r.to==t.text.length)return!0;for(var s=void 0,l=0;l<t.markedSpans.length;++l)if((s=t.markedSpans[l]).marker.collapsed&&!s.marker.widgetNode&&s.from==r.to&&(null==s.to||s.to!=r.from)&&(s.marker.inclusiveLeft||r.marker.inclusiveRight)&&lineIsHiddenInner(e,t,s))return!0}function heightAtLine(e){for(var t=0,r=(e=visualLine(e)).parent,a=0;a<r.lines.length;++a){var s=r.lines[a];if(s==e)break;t+=s.height}for(var l=r.parent;l;l=(r=l).parent)for(var y=0;y<l.children.length;++y){var w=l.children[y];if(w==r)break;t+=w.height}return t}function lineLength(e){if(0==e.height)return 0;for(var t,r=e.text.length,a=e;t=collapsedSpanAtStart(a);){var s=t.find(0,!0);a=s.from.line,r+=s.from.ch-s.to.ch}for(a=e;t=collapsedSpanAtEnd(a);){var l=t.find(0,!0);r-=a.text.length-l.from.ch,r+=(a=l.to.line).text.length-l.to.ch}return r}function findMaxLine(e){var t=e.display,r=e.doc;t.maxLine=getLine(r,r.first),t.maxLineLength=lineLength(t.maxLine),t.maxLineChanged=!0,r.iter((function(e){var r=lineLength(e);r>t.maxLineLength&&(t.maxLineLength=r,t.maxLine=e)}))}var Line=function(e,t,r){this.text=e,attachMarkedSpans(this,t),this.height=r?r(this):1};function cleanUpLine(e){e.parent=null,detachMarkedSpans(e)}Line.prototype.lineNo=function(){return lineNo(this)},eventMixin(Line);var fe={},me={};function interpretTokenStyle(e,t){if(!e||/^\s*$/.test(e))return null;var r=t.addModeClass?me:fe;return r[e]||(r[e]=e.replace(/\S+/g,"cm-$&"))}function buildLineContent(e,t){var r=eltP("span",null,null,E?"padding-right: .1px":null),a={pre:eltP("pre",[r],"CodeMirror-line"),content:r,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:e.getOption("lineWrapping")};t.measure={};for(var s=0;s<=(t.rest?t.rest.length:0);s++){var l=s?t.rest[s-1]:t.line,y=void 0;a.pos=0,a.addToken=buildToken,hasBadBidiRects(e.display.measure)&&(y=getOrder(l,e.doc.direction))&&(a.addToken=buildTokenBadBidi(a.addToken,y)),a.map=[],insertLineContent(l,a,getLineStyles(e,l,t!=e.display.externalMeasured&&lineNo(l))),l.styleClasses&&(l.styleClasses.bgClass&&(a.bgClass=joinClasses(l.styleClasses.bgClass,a.bgClass||"")),l.styleClasses.textClass&&(a.textClass=joinClasses(l.styleClasses.textClass,a.textClass||""))),0==a.map.length&&a.map.push(0,0,a.content.appendChild(zeroWidthElement(e.display.measure))),0==s?(t.measure.map=a.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(a.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(E){var w=a.content.lastChild;(/\bcm-tab\b/.test(w.className)||w.querySelector&&w.querySelector(".cm-tab"))&&(a.content.className="cm-tab-wrap-hack")}return signal(e,"renderLine",e,t.line,a.pre),a.pre.className&&(a.textClass=joinClasses(a.pre.className,a.textClass||"")),a}function defaultSpecialCharPlaceholder(e){var t=elt("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function buildToken(e,t,r,a,s,l,E){if(t){var S,T=e.splitSpaces?function splitSpaces(e,t){if(e.length>1&&!/  /.test(e))return e;for(var r=t,a="",s=0;s<e.length;s++){var l=e.charAt(s);" "!=l||!r||s!=e.length-1&&32!=e.charCodeAt(s+1)||(l=" "),a+=l,r=" "==l}return a}(t,e.trailingSpace):t,O=e.cm.state.specialChars,N=!1;if(O.test(t)){S=document.createDocumentFragment();for(var A=0;;){O.lastIndex=A;var L=O.exec(t),R=L?L.index-A:t.length-A;if(R){var D=document.createTextNode(T.slice(A,A+R));y&&w<9?S.appendChild(elt("span",[D])):S.appendChild(D),e.map.push(e.pos,e.pos+R,D),e.col+=R,e.pos+=R}if(!L)break;A+=R+1;var M=void 0;if("\t"==L[0]){var B=e.cm.options.tabSize,q=B-e.col%B;(M=S.appendChild(elt("span",spaceStr(q),"cm-tab"))).setAttribute("role","presentation"),M.setAttribute("cm-text","\t"),e.col+=q}else"\r"==L[0]||"\n"==L[0]?((M=S.appendChild(elt("span","\r"==L[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",L[0]),e.col+=1):((M=e.cm.options.specialCharPlaceholder(L[0])).setAttribute("cm-text",L[0]),y&&w<9?S.appendChild(elt("span",[M])):S.appendChild(M),e.col+=1);e.map.push(e.pos,e.pos+1,M),e.pos++}}else e.col+=t.length,S=document.createTextNode(T),e.map.push(e.pos,e.pos+t.length,S),y&&w<9&&(N=!0),e.pos+=t.length;if(e.trailingSpace=32==T.charCodeAt(t.length-1),r||a||s||N||l||E){var W=r||"";a&&(W+=a),s&&(W+=s);var j=elt("span",[S],W,l);if(E)for(var H in E)E.hasOwnProperty(H)&&"style"!=H&&"class"!=H&&j.setAttribute(H,E[H]);return e.content.appendChild(j)}e.content.appendChild(S)}}function buildTokenBadBidi(e,t){return function(r,a,s,l,y,w,E){s=s?s+" cm-force-border":"cm-force-border";for(var S=r.pos,T=S+a.length;;){for(var O=void 0,N=0;N<t.length&&!((O=t[N]).to>S&&O.from<=S);N++);if(O.to>=T)return e(r,a,s,l,y,w,E);e(r,a.slice(0,O.to-S),s,l,null,w,E),l=null,a=a.slice(O.to-S),S=O.to}}}function buildCollapsedSpan(e,t,r,a){var s=!a&&r.widgetNode;s&&e.map.push(e.pos,e.pos+t,s),!a&&e.cm.display.input.needsContentAttribute&&(s||(s=e.content.appendChild(document.createElement("span"))),s.setAttribute("cm-marker",r.id)),s&&(e.cm.display.input.setUneditable(s),e.content.appendChild(s)),e.pos+=t,e.trailingSpace=!1}function insertLineContent(e,t,r){var a=e.markedSpans,s=e.text,l=0;if(a)for(var y,w,E,S,T,O,N,A=s.length,L=0,R=1,D="",M=0;;){if(M==L){E=S=T=w="",N=null,O=null,M=1/0;for(var B=[],q=void 0,W=0;W<a.length;++W){var j=a[W],H=j.marker;if("bookmark"==H.type&&j.from==L&&H.widgetNode)B.push(H);else if(j.from<=L&&(null==j.to||j.to>L||H.collapsed&&j.to==L&&j.from==L)){if(null!=j.to&&j.to!=L&&M>j.to&&(M=j.to,S=""),H.className&&(E+=" "+H.className),H.css&&(w=(w?w+";":"")+H.css),H.startStyle&&j.from==L&&(T+=" "+H.startStyle),H.endStyle&&j.to==M&&(q||(q=[])).push(H.endStyle,j.to),H.title&&((N||(N={})).title=H.title),H.attributes)for(var V in H.attributes)(N||(N={}))[V]=H.attributes[V];H.collapsed&&(!O||compareCollapsedMarkers(O.marker,H)<0)&&(O=j)}else j.from>L&&M>j.from&&(M=j.from)}if(q)for(var z=0;z<q.length;z+=2)q[z+1]==M&&(S+=" "+q[z]);if(!O||O.from==L)for(var U=0;U<B.length;++U)buildCollapsedSpan(t,0,B[U]);if(O&&(O.from||0)==L){if(buildCollapsedSpan(t,(null==O.to?A+1:O.to)-L,O.marker,null==O.from),null==O.to)return;O.to==L&&(O=!1)}}if(L>=A)break;for(var G=Math.min(A,M);;){if(D){var K=L+D.length;if(!O){var $=K>G?D.slice(0,G-L):D;t.addToken(t,$,y?y+E:E,T,L+$.length==M?S:"",w,N)}if(K>=G){D=D.slice(G-L),L=G;break}L=K,T=""}D=s.slice(l,l=r[R++]),y=interpretTokenStyle(r[R++],t.cm.options)}}else for(var Q=1;Q<r.length;Q+=2)t.addToken(t,s.slice(l,l=r[Q]),interpretTokenStyle(r[Q+1],t.cm.options))}function LineView(e,t,r){this.line=t,this.rest=function visualLineContinued(e){for(var t,r;t=collapsedSpanAtEnd(e);)e=t.find(1,!0).line,(r||(r=[])).push(e);return r}(t),this.size=this.rest?lineNo(lst(this.rest))-r+1:1,this.node=this.text=null,this.hidden=lineIsHidden(e,t)}function buildViewArray(e,t,r){for(var a,s=[],l=t;l<r;l=a){var y=new LineView(e.doc,getLine(e.doc,l),l);a=l+y.size,s.push(y)}return s}var ge=null,ye=null;function signalLater(e,t){var r=getHandlers(e,t);if(r.length){var a,s=Array.prototype.slice.call(arguments,2);ge?a=ge.delayedCallbacks:ye?a=ye:(a=ye=[],setTimeout(fireOrphanDelayed,0));for(var loop=function(e){a.push((function(){return r[e].apply(null,s)}))},l=0;l<r.length;++l)loop(l)}}function fireOrphanDelayed(){var e=ye;ye=null;for(var t=0;t<e.length;++t)e[t]()}function updateLineForChanges(e,t,r,a){for(var s=0;s<t.changes.length;s++){var l=t.changes[s];"text"==l?updateLineText(e,t):"gutter"==l?updateLineGutter(e,t,r,a):"class"==l?updateLineClasses(e,t):"widget"==l&&updateLineWidgets(e,t,a)}t.changes=null}function ensureLineWrapped(e){return e.node==e.text&&(e.node=elt("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),y&&w<8&&(e.node.style.zIndex=2)),e.node}function getLineContent(e,t){var r=e.display.externalMeasured;return r&&r.line==t.line?(e.display.externalMeasured=null,t.measure=r.measure,r.built):buildLineContent(e,t)}function updateLineText(e,t){var r=t.text.className,a=getLineContent(e,t);t.text==t.node&&(t.node=a.pre),t.text.parentNode.replaceChild(a.pre,t.text),t.text=a.pre,a.bgClass!=t.bgClass||a.textClass!=t.textClass?(t.bgClass=a.bgClass,t.textClass=a.textClass,updateLineClasses(e,t)):r&&(t.text.className=r)}function updateLineClasses(e,t){!function updateLineBackground(e,t){var r=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(r&&(r+=" CodeMirror-linebackground"),t.background)r?t.background.className=r:(t.background.parentNode.removeChild(t.background),t.background=null);else if(r){var a=ensureLineWrapped(t);t.background=a.insertBefore(elt("div",null,r),a.firstChild),e.display.input.setUneditable(t.background)}}(e,t),t.line.wrapClass?ensureLineWrapped(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var r=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=r||""}function updateLineGutter(e,t,r,a){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var s=ensureLineWrapped(t);t.gutterBackground=elt("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?a.fixedPos:-a.gutterTotalWidth)+"px; width: "+a.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),s.insertBefore(t.gutterBackground,t.text)}var l=t.line.gutterMarkers;if(e.options.lineNumbers||l){var y=ensureLineWrapped(t),w=t.gutter=elt("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?a.fixedPos:-a.gutterTotalWidth)+"px");if(w.setAttribute("aria-hidden","true"),e.display.input.setUneditable(w),y.insertBefore(w,t.text),t.line.gutterClass&&(w.className+=" "+t.line.gutterClass),!e.options.lineNumbers||l&&l["CodeMirror-linenumbers"]||(t.lineNumber=w.appendChild(elt("div",lineNumberFor(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+a.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),l)for(var E=0;E<e.display.gutterSpecs.length;++E){var S=e.display.gutterSpecs[E].className,T=l.hasOwnProperty(S)&&l[S];T&&w.appendChild(elt("div",[T],"CodeMirror-gutter-elt","left: "+a.gutterLeft[S]+"px; width: "+a.gutterWidth[S]+"px"))}}}function updateLineWidgets(e,t,r){t.alignable&&(t.alignable=null);for(var a=classTest("CodeMirror-linewidget"),s=t.node.firstChild,l=void 0;s;s=l)l=s.nextSibling,a.test(s.className)&&t.node.removeChild(s);insertLineWidgets(e,t,r)}function buildLineElement(e,t,r,a){var s=getLineContent(e,t);return t.text=t.node=s.pre,s.bgClass&&(t.bgClass=s.bgClass),s.textClass&&(t.textClass=s.textClass),updateLineClasses(e,t),updateLineGutter(e,t,r,a),insertLineWidgets(e,t,a),t.node}function insertLineWidgets(e,t,r){if(insertLineWidgetsFor(e,t.line,t,r,!0),t.rest)for(var a=0;a<t.rest.length;a++)insertLineWidgetsFor(e,t.rest[a],t,r,!1)}function insertLineWidgetsFor(e,t,r,a,s){if(t.widgets)for(var l=ensureLineWrapped(r),y=0,w=t.widgets;y<w.length;++y){var E=w[y],S=elt("div",[E.node],"CodeMirror-linewidget"+(E.className?" "+E.className:""));E.handleMouseEvents||S.setAttribute("cm-ignore-events","true"),positionLineWidget(E,S,r,a),e.display.input.setUneditable(S),s&&E.above?l.insertBefore(S,r.gutter||r.text):l.appendChild(S),signalLater(E,"redraw")}}function positionLineWidget(e,t,r,a){if(e.noHScroll){(r.alignable||(r.alignable=[])).push(t);var s=a.wrapperWidth;t.style.left=a.fixedPos+"px",e.coverGutter||(s-=a.gutterTotalWidth,t.style.paddingLeft=a.gutterTotalWidth+"px"),t.style.width=s+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-a.gutterTotalWidth+"px"))}function widgetHeight(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!contains(document.body,e.node)){var r="position: relative;";e.coverGutter&&(r+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(r+="width: "+t.display.wrapper.clientWidth+"px;"),removeChildrenAndAdd(t.display.measure,elt("div",[e.node],null,r))}return e.height=e.node.parentNode.offsetHeight}function eventInWidget(e,t){for(var r=e_target(t);r!=e.wrapper;r=r.parentNode)if(!r||1==r.nodeType&&"true"==r.getAttribute("cm-ignore-events")||r.parentNode==e.sizer&&r!=e.mover)return!0}function paddingTop(e){return e.lineSpace.offsetTop}function paddingVert(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function paddingH(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=removeChildrenAndAdd(e.measure,elt("pre","x","CodeMirror-line-like")),r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,a={left:parseInt(r.paddingLeft),right:parseInt(r.paddingRight)};return isNaN(a.left)||isNaN(a.right)||(e.cachedPaddingH=a),a}function scrollGap(e){return 50-e.display.nativeBarWidth}function displayWidth(e){return e.display.scroller.clientWidth-scrollGap(e)-e.display.barWidth}function displayHeight(e){return e.display.scroller.clientHeight-scrollGap(e)-e.display.barHeight}function mapFromLineView(e,t,r){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var a=0;a<e.rest.length;a++)if(e.rest[a]==t)return{map:e.measure.maps[a],cache:e.measure.caches[a]};for(var s=0;s<e.rest.length;s++)if(lineNo(e.rest[s])>r)return{map:e.measure.maps[s],cache:e.measure.caches[s],before:!0}}function measureChar(e,t,r,a){return measureCharPrepared(e,prepareMeasureForLine(e,t),r,a)}function findViewForLine(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[findViewIndex(e,t)];var r=e.display.externalMeasured;return r&&t>=r.lineN&&t<r.lineN+r.size?r:void 0}function prepareMeasureForLine(e,t){var r=lineNo(t),a=findViewForLine(e,r);a&&!a.text?a=null:a&&a.changes&&(updateLineForChanges(e,a,r,getDimensions(e)),e.curOp.forceUpdate=!0),a||(a=function updateExternalMeasurement(e,t){var r=lineNo(t=visualLine(t)),a=e.display.externalMeasured=new LineView(e.doc,t,r);a.lineN=r;var s=a.built=buildLineContent(e,a);return a.text=s.pre,removeChildrenAndAdd(e.display.lineMeasure,s.pre),a}(e,t));var s=mapFromLineView(a,t,r);return{line:t,view:a,rect:null,map:s.map,cache:s.cache,before:s.before,hasHeights:!1}}function measureCharPrepared(e,t,r,a,s){t.before&&(r=-1);var l,E=r+(a||"");return t.cache.hasOwnProperty(E)?l=t.cache[E]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(function ensureLineHeights(e,t,r){var a=e.options.lineWrapping,s=a&&displayWidth(e);if(!t.measure.heights||a&&t.measure.width!=s){var l=t.measure.heights=[];if(a){t.measure.width=s;for(var y=t.text.firstChild.getClientRects(),w=0;w<y.length-1;w++){var E=y[w],S=y[w+1];Math.abs(E.bottom-S.bottom)>2&&l.push((E.bottom+S.top)/2-r.top)}}l.push(r.bottom-r.top)}}(e,t.view,t.rect),t.hasHeights=!0),(l=function measureCharInner(e,t,r,a){var s,l=nodeAndOffsetInLineMap(t.map,r,a),E=l.node,S=l.start,T=l.end,O=l.collapse;if(3==E.nodeType){for(var N=0;N<4;N++){for(;S&&isExtendingChar(t.line.text.charAt(l.coverStart+S));)--S;for(;l.coverStart+T<l.coverEnd&&isExtendingChar(t.line.text.charAt(l.coverStart+T));)++T;if((s=y&&w<9&&0==S&&T==l.coverEnd-l.coverStart?E.parentNode.getBoundingClientRect():getUsefulRect(z(E,S,T).getClientRects(),a)).left||s.right||0==S)break;T=S,S-=1,O="right"}y&&w<11&&(s=function maybeUpdateRectForZooming(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!function hasBadZoomedRects(e){if(null!=le)return le;var t=removeChildrenAndAdd(e,elt("span","x")),r=t.getBoundingClientRect(),a=z(t,0,1).getBoundingClientRect();return le=Math.abs(r.left-a.left)>1}(e))return t;var r=screen.logicalXDPI/screen.deviceXDPI,a=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*r,right:t.right*r,top:t.top*a,bottom:t.bottom*a}}(e.display.measure,s))}else{var A;S>0&&(O=a="right"),s=e.options.lineWrapping&&(A=E.getClientRects()).length>1?A["right"==a?A.length-1:0]:E.getBoundingClientRect()}if(y&&w<9&&!S&&(!s||!s.left&&!s.right)){var L=E.parentNode.getClientRects()[0];s=L?{left:L.left,right:L.left+charWidth(e.display),top:L.top,bottom:L.bottom}:be}for(var R=s.top-t.rect.top,D=s.bottom-t.rect.top,M=(R+D)/2,B=t.view.measure.heights,q=0;q<B.length-1&&!(M<B[q]);q++);var W=q?B[q-1]:0,j=B[q],H={left:("right"==O?s.right:s.left)-t.rect.left,right:("left"==O?s.left:s.right)-t.rect.left,top:W,bottom:j};return s.left||s.right||(H.bogus=!0),e.options.singleCursorHeightPerLine||(H.rtop=R,H.rbottom=D),H}(e,t,r,a)).bogus||(t.cache[E]=l)),{left:l.left,right:l.right,top:s?l.rtop:l.top,bottom:s?l.rbottom:l.bottom}}var ve,be={left:0,right:0,top:0,bottom:0};function nodeAndOffsetInLineMap(e,t,r){for(var a,s,l,y,w,E,S=0;S<e.length;S+=3)if(w=e[S],E=e[S+1],t<w?(s=0,l=1,y="left"):t<E?l=1+(s=t-w):(S==e.length-3||t==E&&e[S+3]>t)&&(s=(l=E-w)-1,t>=E&&(y="right")),null!=s){if(a=e[S+2],w==E&&r==(a.insertLeft?"left":"right")&&(y=r),"left"==r&&0==s)for(;S&&e[S-2]==e[S-3]&&e[S-1].insertLeft;)a=e[2+(S-=3)],y="left";if("right"==r&&s==E-w)for(;S<e.length-3&&e[S+3]==e[S+4]&&!e[S+5].insertLeft;)a=e[(S+=3)+2],y="right";break}return{node:a,start:s,end:l,collapse:y,coverStart:w,coverEnd:E}}function getUsefulRect(e,t){var r=be;if("left"==t)for(var a=0;a<e.length&&(r=e[a]).left==r.right;a++);else for(var s=e.length-1;s>=0&&(r=e[s]).left==r.right;s--);return r}function clearLineMeasurementCacheFor(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function clearLineMeasurementCache(e){e.display.externalMeasure=null,removeChildren(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)clearLineMeasurementCacheFor(e.display.view[t])}function clearCaches(e){clearLineMeasurementCache(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function pageScrollX(){return T&&D?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function pageScrollY(){return T&&D?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function widgetTopHeight(e){var t=0;if(e.widgets)for(var r=0;r<e.widgets.length;++r)e.widgets[r].above&&(t+=widgetHeight(e.widgets[r]));return t}function intoCoordSystem(e,t,r,a,s){if(!s){var l=widgetTopHeight(t);r.top+=l,r.bottom+=l}if("line"==a)return r;a||(a="local");var y=heightAtLine(t);if("local"==a?y+=paddingTop(e.display):y-=e.display.viewOffset,"page"==a||"window"==a){var w=e.display.lineSpace.getBoundingClientRect();y+=w.top+("window"==a?0:pageScrollY());var E=w.left+("window"==a?0:pageScrollX());r.left+=E,r.right+=E}return r.top+=y,r.bottom+=y,r}function fromCoordSystem(e,t,r){if("div"==r)return t;var a=t.left,s=t.top;if("page"==r)a-=pageScrollX(),s-=pageScrollY();else if("local"==r||!r){var l=e.display.sizer.getBoundingClientRect();a+=l.left,s+=l.top}var y=e.display.lineSpace.getBoundingClientRect();return{left:a-y.left,top:s-y.top}}function charCoords(e,t,r,a,s){return a||(a=getLine(e.doc,t.line)),intoCoordSystem(e,a,measureChar(e,a,t.ch,s),r)}function cursorCoords(e,t,r,a,s,l){function get(t,y){var w=measureCharPrepared(e,s,t,y?"right":"left",l);return y?w.left=w.right:w.right=w.left,intoCoordSystem(e,a,w,r)}a=a||getLine(e.doc,t.line),s||(s=prepareMeasureForLine(e,a));var y=getOrder(a,e.doc.direction),w=t.ch,E=t.sticky;if(w>=a.text.length?(w=a.text.length,E="before"):w<=0&&(w=0,E="after"),!y)return get("before"==E?w-1:w,"before"==E);function getBidi(e,t,r){return get(r?e-1:e,1==y[t].level!=r)}var S=getBidiPartAt(y,w,E),T=Z,O=getBidi(w,S,"before"==E);return null!=T&&(O.other=getBidi(w,T,"before"!=E)),O}function estimateCoords(e,t){var r=0;t=clipPos(e.doc,t),e.options.lineWrapping||(r=charWidth(e.display)*t.ch);var a=getLine(e.doc,t.line),s=heightAtLine(a)+paddingTop(e.display);return{left:r,right:r,top:s,bottom:s+a.height}}function PosWithInfo(e,t,r,a,s){var l=Pos(e,t,r);return l.xRel=s,a&&(l.outside=a),l}function coordsChar(e,t,r){var a=e.doc;if((r+=e.display.viewOffset)<0)return PosWithInfo(a.first,0,null,-1,-1);var s=lineAtHeight(a,r),l=a.first+a.size-1;if(s>l)return PosWithInfo(a.first+a.size-1,getLine(a,l).text.length,null,1,1);t<0&&(t=0);for(var y=getLine(a,s);;){var w=coordsCharInner(e,y,s,t,r),E=collapsedSpanAround(y,w.ch+(w.xRel>0||w.outside>0?1:0));if(!E)return w;var S=E.find(1);if(S.line==s)return S;y=getLine(a,s=S.line)}}function wrappedLineExtent(e,t,r,a){a-=widgetTopHeight(t);var s=t.text.length,l=findFirst((function(t){return measureCharPrepared(e,r,t-1).bottom<=a}),s,0);return{begin:l,end:s=findFirst((function(t){return measureCharPrepared(e,r,t).top>a}),l,s)}}function wrappedLineExtentChar(e,t,r,a){return r||(r=prepareMeasureForLine(e,t)),wrappedLineExtent(e,t,r,intoCoordSystem(e,t,measureCharPrepared(e,r,a),"line").top)}function boxIsAfter(e,t,r,a){return!(e.bottom<=r)&&(e.top>r||(a?e.left:e.right)>t)}function coordsCharInner(e,t,r,a,s){s-=heightAtLine(t);var l=prepareMeasureForLine(e,t),y=widgetTopHeight(t),w=0,E=t.text.length,S=!0,T=getOrder(t,e.doc.direction);if(T){var O=(e.options.lineWrapping?coordsBidiPartWrapped:coordsBidiPart)(e,t,r,l,T,a,s);w=(S=1!=O.level)?O.from:O.to-1,E=S?O.to:O.from-1}var N,A,L=null,R=null,D=findFirst((function(t){var r=measureCharPrepared(e,l,t);return r.top+=y,r.bottom+=y,!!boxIsAfter(r,a,s,!1)&&(r.top<=s&&r.left<=a&&(L=t,R=r),!0)}),w,E),M=!1;if(R){var B=a-R.left<R.right-a,q=B==S;D=L+(q?0:1),A=q?"after":"before",N=B?R.left:R.right}else{S||D!=E&&D!=w||D++,A=0==D?"after":D==t.text.length?"before":measureCharPrepared(e,l,D-(S?1:0)).bottom+y<=s==S?"after":"before";var W=cursorCoords(e,Pos(r,D,A),"line",t,l);N=W.left,M=s<W.top?-1:s>=W.bottom?1:0}return PosWithInfo(r,D=skipExtendingChars(t.text,D,1),A,M,a-N)}function coordsBidiPart(e,t,r,a,s,l,y){var w=findFirst((function(w){var E=s[w],S=1!=E.level;return boxIsAfter(cursorCoords(e,Pos(r,S?E.to:E.from,S?"before":"after"),"line",t,a),l,y,!0)}),0,s.length-1),E=s[w];if(w>0){var S=1!=E.level,T=cursorCoords(e,Pos(r,S?E.from:E.to,S?"after":"before"),"line",t,a);boxIsAfter(T,l,y,!0)&&T.top>y&&(E=s[w-1])}return E}function coordsBidiPartWrapped(e,t,r,a,s,l,y){var w=wrappedLineExtent(e,t,a,y),E=w.begin,S=w.end;/\s/.test(t.text.charAt(S-1))&&S--;for(var T=null,O=null,N=0;N<s.length;N++){var A=s[N];if(!(A.from>=S||A.to<=E)){var L=measureCharPrepared(e,a,1!=A.level?Math.min(S,A.to)-1:Math.max(E,A.from)).right,R=L<l?l-L+1e9:L-l;(!T||O>R)&&(T=A,O=R)}}return T||(T=s[s.length-1]),T.from<E&&(T={from:E,to:T.to,level:T.level}),T.to>S&&(T={from:T.from,to:S,level:T.level}),T}function textHeight(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==ve){ve=elt("pre",null,"CodeMirror-line-like");for(var t=0;t<49;++t)ve.appendChild(document.createTextNode("x")),ve.appendChild(elt("br"));ve.appendChild(document.createTextNode("x"))}removeChildrenAndAdd(e.measure,ve);var r=ve.offsetHeight/50;return r>3&&(e.cachedTextHeight=r),removeChildren(e.measure),r||1}function charWidth(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=elt("span","xxxxxxxxxx"),r=elt("pre",[t],"CodeMirror-line-like");removeChildrenAndAdd(e.measure,r);var a=t.getBoundingClientRect(),s=(a.right-a.left)/10;return s>2&&(e.cachedCharWidth=s),s||10}function getDimensions(e){for(var t=e.display,r={},a={},s=t.gutters.clientLeft,l=t.gutters.firstChild,y=0;l;l=l.nextSibling,++y){var w=e.display.gutterSpecs[y].className;r[w]=l.offsetLeft+l.clientLeft+s,a[w]=l.clientWidth}return{fixedPos:compensateForHScroll(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:r,gutterWidth:a,wrapperWidth:t.wrapper.clientWidth}}function compensateForHScroll(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function estimateHeight(e){var t=textHeight(e.display),r=e.options.lineWrapping,a=r&&Math.max(5,e.display.scroller.clientWidth/charWidth(e.display)-3);return function(s){if(lineIsHidden(e.doc,s))return 0;var l=0;if(s.widgets)for(var y=0;y<s.widgets.length;y++)s.widgets[y].height&&(l+=s.widgets[y].height);return r?l+(Math.ceil(s.text.length/a)||1)*t:l+t}}function estimateLineHeights(e){var t=e.doc,r=estimateHeight(e);t.iter((function(e){var t=r(e);t!=e.height&&updateLineHeight(e,t)}))}function posFromMouse(e,t,r,a){var s=e.display;if(!r&&"true"==e_target(t).getAttribute("cm-not-content"))return null;var l,y,w=s.lineSpace.getBoundingClientRect();try{l=t.clientX-w.left,y=t.clientY-w.top}catch(e){return null}var E,S=coordsChar(e,l,y);if(a&&S.xRel>0&&(E=getLine(e.doc,S.line).text).length==S.ch){var T=countColumn(E,E.length,e.options.tabSize)-E.length;S=Pos(S.line,Math.max(0,Math.round((l-paddingH(e.display).left)/charWidth(e.display))-T))}return S}function findViewIndex(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var r=e.display.view,a=0;a<r.length;a++)if((t-=r[a].size)<0)return a}function regChange(e,t,r,a){null==t&&(t=e.doc.first),null==r&&(r=e.doc.first+e.doc.size),a||(a=0);var s=e.display;if(a&&r<s.viewTo&&(null==s.updateLineNumbers||s.updateLineNumbers>t)&&(s.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=s.viewTo)pe&&visualLineNo(e.doc,t)<s.viewTo&&resetView(e);else if(r<=s.viewFrom)pe&&visualLineEndNo(e.doc,r+a)>s.viewFrom?resetView(e):(s.viewFrom+=a,s.viewTo+=a);else if(t<=s.viewFrom&&r>=s.viewTo)resetView(e);else if(t<=s.viewFrom){var l=viewCuttingPoint(e,r,r+a,1);l?(s.view=s.view.slice(l.index),s.viewFrom=l.lineN,s.viewTo+=a):resetView(e)}else if(r>=s.viewTo){var y=viewCuttingPoint(e,t,t,-1);y?(s.view=s.view.slice(0,y.index),s.viewTo=y.lineN):resetView(e)}else{var w=viewCuttingPoint(e,t,t,-1),E=viewCuttingPoint(e,r,r+a,1);w&&E?(s.view=s.view.slice(0,w.index).concat(buildViewArray(e,w.lineN,E.lineN)).concat(s.view.slice(E.index)),s.viewTo+=a):resetView(e)}var S=s.externalMeasured;S&&(r<S.lineN?S.lineN+=a:t<S.lineN+S.size&&(s.externalMeasured=null))}function regLineChange(e,t,r){e.curOp.viewChanged=!0;var a=e.display,s=e.display.externalMeasured;if(s&&t>=s.lineN&&t<s.lineN+s.size&&(a.externalMeasured=null),!(t<a.viewFrom||t>=a.viewTo)){var l=a.view[findViewIndex(e,t)];if(null!=l.node){var y=l.changes||(l.changes=[]);-1==indexOf(y,r)&&y.push(r)}}}function resetView(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function viewCuttingPoint(e,t,r,a){var s,l=findViewIndex(e,t),y=e.display.view;if(!pe||r==e.doc.first+e.doc.size)return{index:l,lineN:r};for(var w=e.display.viewFrom,E=0;E<l;E++)w+=y[E].size;if(w!=t){if(a>0){if(l==y.length-1)return null;s=w+y[l].size-t,l++}else s=w-t;t+=s,r+=s}for(;visualLineNo(e.doc,r)!=r;){if(l==(a<0?0:y.length-1))return null;r+=a*y[l-(a<0?1:0)].size,l+=a}return{index:l,lineN:r}}function countDirtyView(e){for(var t=e.display.view,r=0,a=0;a<t.length;a++){var s=t[a];s.hidden||s.node&&!s.changes||++r}return r}function updateSelection(e){e.display.input.showSelection(e.display.input.prepareSelection())}function prepareSelection(e,t){void 0===t&&(t=!0);for(var r=e.doc,a={},s=a.cursors=document.createDocumentFragment(),l=a.selection=document.createDocumentFragment(),y=0;y<r.sel.ranges.length;y++)if(t||y!=r.sel.primIndex){var w=r.sel.ranges[y];if(!(w.from().line>=e.display.viewTo||w.to().line<e.display.viewFrom)){var E=w.empty();(E||e.options.showCursorWhenSelecting)&&drawSelectionCursor(e,w.head,s),E||drawSelectionRange(e,w,l)}}return a}function drawSelectionCursor(e,t,r){var a=cursorCoords(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),s=r.appendChild(elt("div"," ","CodeMirror-cursor"));if(s.style.left=a.left+"px",s.style.top=a.top+"px",s.style.height=Math.max(0,a.bottom-a.top)*e.options.cursorHeight+"px",a.other){var l=r.appendChild(elt("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));l.style.display="",l.style.left=a.other.left+"px",l.style.top=a.other.top+"px",l.style.height=.85*(a.other.bottom-a.other.top)+"px"}}function cmpCoords(e,t){return e.top-t.top||e.left-t.left}function drawSelectionRange(e,t,r){var a=e.display,s=e.doc,l=document.createDocumentFragment(),y=paddingH(e.display),w=y.left,E=Math.max(a.sizerWidth,displayWidth(e)-a.sizer.offsetLeft)-y.right,S="ltr"==s.direction;function add(e,t,r,a){t<0&&(t=0),t=Math.round(t),a=Math.round(a),l.appendChild(elt("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==r?E-e:r)+"px;\n                             height: "+(a-t)+"px"))}function drawForLine(t,r,a){var l,y,T=getLine(s,t),O=T.text.length;function coords(r,a){return charCoords(e,Pos(t,r),"div",T,a)}function wrapX(t,r,a){var s=wrappedLineExtentChar(e,T,null,t),l="ltr"==r==("after"==a)?"left":"right";return coords("after"==a?s.begin:s.end-(/\s/.test(T.text.charAt(s.end-1))?2:1),l)[l]}var N=getOrder(T,s.direction);return function iterateBidiSections(e,t,r,a){if(!e)return a(t,r,"ltr",0);for(var s=!1,l=0;l<e.length;++l){var y=e[l];(y.from<r&&y.to>t||t==r&&y.to==t)&&(a(Math.max(y.from,t),Math.min(y.to,r),1==y.level?"rtl":"ltr",l),s=!0)}s||a(t,r,"ltr")}(N,r||0,null==a?O:a,(function(e,t,s,T){var A="ltr"==s,L=coords(e,A?"left":"right"),R=coords(t-1,A?"right":"left"),D=null==r&&0==e,M=null==a&&t==O,B=0==T,q=!N||T==N.length-1;if(R.top-L.top<=3){var W=(S?M:D)&&q,j=(S?D:M)&&B?w:(A?L:R).left,H=W?E:(A?R:L).right;add(j,L.top,H-j,L.bottom)}else{var V,z,U,G;A?(V=S&&D&&B?w:L.left,z=S?E:wrapX(e,s,"before"),U=S?w:wrapX(t,s,"after"),G=S&&M&&q?E:R.right):(V=S?wrapX(e,s,"before"):w,z=!S&&D&&B?E:L.right,U=!S&&M&&q?w:R.left,G=S?wrapX(t,s,"after"):E),add(V,L.top,z-V,L.bottom),L.bottom<R.top&&add(w,L.bottom,null,R.top),add(U,R.top,G-U,R.bottom)}(!l||cmpCoords(L,l)<0)&&(l=L),cmpCoords(R,l)<0&&(l=R),(!y||cmpCoords(L,y)<0)&&(y=L),cmpCoords(R,y)<0&&(y=R)})),{start:l,end:y}}var T=t.from(),O=t.to();if(T.line==O.line)drawForLine(T.line,T.ch,O.ch);else{var N=getLine(s,T.line),A=getLine(s,O.line),L=visualLine(N)==visualLine(A),R=drawForLine(T.line,T.ch,L?N.text.length+1:null).end,D=drawForLine(O.line,L?0:null,O.ch).start;L&&(R.top<D.top-2?(add(R.right,R.top,null,R.bottom),add(w,D.top,D.left,D.bottom)):add(R.right,R.top,D.left-R.right,R.bottom)),R.bottom<D.top&&add(w,R.bottom,null,D.top)}r.appendChild(l)}function restartBlink(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var r=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval((function(){e.hasFocus()||onBlur(e),t.cursorDiv.style.visibility=(r=!r)?"":"hidden"}),e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function ensureFocus(e){e.hasFocus()||(e.display.input.focus(),e.state.focused||onFocus(e))}function delayBlurEvent(e){e.state.delayingBlurEvent=!0,setTimeout((function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,e.state.focused&&onBlur(e))}),100)}function onFocus(e,t){e.state.delayingBlurEvent&&!e.state.draggingText&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(signal(e,"focus",e,t),e.state.focused=!0,addClass(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),E&&setTimeout((function(){return e.display.input.reset(!0)}),20)),e.display.input.receivedFocus()),restartBlink(e))}function onBlur(e,t){e.state.delayingBlurEvent||(e.state.focused&&(signal(e,"blur",e,t),e.state.focused=!1,rmClass(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout((function(){e.state.focused||(e.display.shift=!1)}),150))}function updateHeightsInViewport(e){for(var t=e.display,r=t.lineDiv.offsetTop,a=0;a<t.view.length;a++){var s=t.view[a],l=e.options.lineWrapping,E=void 0,S=0;if(!s.hidden){if(y&&w<8){var T=s.node.offsetTop+s.node.offsetHeight;E=T-r,r=T}else{var O=s.node.getBoundingClientRect();E=O.bottom-O.top,!l&&s.text.firstChild&&(S=s.text.firstChild.getBoundingClientRect().right-O.left-1)}var N=s.line.height-E;if((N>.005||N<-.005)&&(updateLineHeight(s.line,E),updateWidgetHeight(s.line),s.rest))for(var A=0;A<s.rest.length;A++)updateWidgetHeight(s.rest[A]);if(S>e.display.sizerWidth){var L=Math.ceil(S/charWidth(e.display));L>e.display.maxLineLength&&(e.display.maxLineLength=L,e.display.maxLine=s.line,e.display.maxLineChanged=!0)}}}}function updateWidgetHeight(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t){var r=e.widgets[t],a=r.node.parentNode;a&&(r.height=a.offsetHeight)}}function visibleLines(e,t,r){var a=r&&null!=r.top?Math.max(0,r.top):e.scroller.scrollTop;a=Math.floor(a-paddingTop(e));var s=r&&null!=r.bottom?r.bottom:a+e.wrapper.clientHeight,l=lineAtHeight(t,a),y=lineAtHeight(t,s);if(r&&r.ensure){var w=r.ensure.from.line,E=r.ensure.to.line;w<l?(l=w,y=lineAtHeight(t,heightAtLine(getLine(t,w))+e.wrapper.clientHeight)):Math.min(E,t.lastLine())>=y&&(l=lineAtHeight(t,heightAtLine(getLine(t,E))-e.wrapper.clientHeight),y=E)}return{from:l,to:Math.max(y,l+1)}}function calculateScrollPos(e,t){var r=e.display,a=textHeight(e.display);t.top<0&&(t.top=0);var s=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:r.scroller.scrollTop,l=displayHeight(e),y={};t.bottom-t.top>l&&(t.bottom=t.top+l);var w=e.doc.height+paddingVert(r),E=t.top<a,S=t.bottom>w-a;if(t.top<s)y.scrollTop=E?0:t.top;else if(t.bottom>s+l){var T=Math.min(t.top,(S?w:t.bottom)-l);T!=s&&(y.scrollTop=T)}var O=e.options.fixedGutter?0:r.gutters.offsetWidth,N=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:r.scroller.scrollLeft-O,A=displayWidth(e)-r.gutters.offsetWidth,L=t.right-t.left>A;return L&&(t.right=t.left+A),t.left<10?y.scrollLeft=0:t.left<N?y.scrollLeft=Math.max(0,t.left+O-(L?0:10)):t.right>A+N-3&&(y.scrollLeft=t.right+(L?0:10)-A),y}function addToScrollTop(e,t){null!=t&&(resolveScrollToPos(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function ensureCursorVisible(e){resolveScrollToPos(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function scrollToCoords(e,t,r){null==t&&null==r||resolveScrollToPos(e),null!=t&&(e.curOp.scrollLeft=t),null!=r&&(e.curOp.scrollTop=r)}function resolveScrollToPos(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,scrollToCoordsRange(e,estimateCoords(e,t.from),estimateCoords(e,t.to),t.margin))}function scrollToCoordsRange(e,t,r,a){var s=calculateScrollPos(e,{left:Math.min(t.left,r.left),top:Math.min(t.top,r.top)-a,right:Math.max(t.right,r.right),bottom:Math.max(t.bottom,r.bottom)+a});scrollToCoords(e,s.scrollLeft,s.scrollTop)}function updateScrollTop(e,t){Math.abs(e.doc.scrollTop-t)<2||(r||updateDisplaySimple(e,{top:t}),setScrollTop(e,t,!0),r&&updateDisplaySimple(e),startWorker(e,100))}function setScrollTop(e,t,r){t=Math.max(0,Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t)),(e.display.scroller.scrollTop!=t||r)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function setScrollLeft(e,t,r,a){t=Math.max(0,Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth)),(r?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!a||(e.doc.scrollLeft=t,alignHorizontally(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function measureForScrollbars(e){var t=e.display,r=t.gutters.offsetWidth,a=Math.round(e.doc.height+paddingVert(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?r:0,docHeight:a,scrollHeight:a+scrollGap(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:r}}var NativeScrollbars=function(e,t,r){this.cm=r;var a=this.vert=elt("div",[elt("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),s=this.horiz=elt("div",[elt("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");a.tabIndex=s.tabIndex=-1,e(a),e(s),on(a,"scroll",(function(){a.clientHeight&&t(a.scrollTop,"vertical")})),on(s,"scroll",(function(){s.clientWidth&&t(s.scrollLeft,"horizontal")})),this.checkedZeroWidth=!1,y&&w<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};NativeScrollbars.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,r=e.scrollHeight>e.clientHeight+1,a=e.nativeBarWidth;if(r){this.vert.style.display="block",this.vert.style.bottom=t?a+"px":"0";var s=e.viewHeight-(t?a:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+s)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=r?a+"px":"0",this.horiz.style.left=e.barLeft+"px";var l=e.viewWidth-e.barLeft-(r?a:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+l)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==a&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:r?a:0,bottom:t?a:0}},NativeScrollbars.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},NativeScrollbars.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},NativeScrollbars.prototype.zeroWidthHack=function(){var e=B&&!A?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Delayed,this.disableVert=new Delayed},NativeScrollbars.prototype.enableZeroWidthBar=function(e,t,r){e.style.pointerEvents="auto",t.set(1e3,(function maybeDisable(){var a=e.getBoundingClientRect();("vert"==r?document.elementFromPoint(a.right-1,(a.top+a.bottom)/2):document.elementFromPoint((a.right+a.left)/2,a.bottom-1))!=e?e.style.pointerEvents="none":t.set(1e3,maybeDisable)}))},NativeScrollbars.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var NullScrollbars=function(){};function updateScrollbars(e,t){t||(t=measureForScrollbars(e));var r=e.display.barWidth,a=e.display.barHeight;updateScrollbarsInner(e,t);for(var s=0;s<4&&r!=e.display.barWidth||a!=e.display.barHeight;s++)r!=e.display.barWidth&&e.options.lineWrapping&&updateHeightsInViewport(e),updateScrollbarsInner(e,measureForScrollbars(e)),r=e.display.barWidth,a=e.display.barHeight}function updateScrollbarsInner(e,t){var r=e.display,a=r.scrollbars.update(t);r.sizer.style.paddingRight=(r.barWidth=a.right)+"px",r.sizer.style.paddingBottom=(r.barHeight=a.bottom)+"px",r.heightForcer.style.borderBottom=a.bottom+"px solid transparent",a.right&&a.bottom?(r.scrollbarFiller.style.display="block",r.scrollbarFiller.style.height=a.bottom+"px",r.scrollbarFiller.style.width=a.right+"px"):r.scrollbarFiller.style.display="",a.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(r.gutterFiller.style.display="block",r.gutterFiller.style.height=a.bottom+"px",r.gutterFiller.style.width=t.gutterWidth+"px"):r.gutterFiller.style.display=""}NullScrollbars.prototype.update=function(){return{bottom:0,right:0}},NullScrollbars.prototype.setScrollLeft=function(){},NullScrollbars.prototype.setScrollTop=function(){},NullScrollbars.prototype.clear=function(){};var we={native:NativeScrollbars,null:NullScrollbars};function initScrollbars(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&rmClass(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new we[e.options.scrollbarStyle]((function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),on(t,"mousedown",(function(){e.state.focused&&setTimeout((function(){return e.display.input.focus()}),0)})),t.setAttribute("cm-not-content","true")}),(function(t,r){"horizontal"==r?setScrollLeft(e,t):updateScrollTop(e,t)}),e),e.display.scrollbars.addClass&&addClass(e.display.wrapper,e.display.scrollbars.addClass)}var _e=0;function startOperation(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++_e},function pushOperation(e){ge?ge.ops.push(e):e.ownsGroup=ge={ops:[e],delayedCallbacks:[]}}(e.curOp)}function endOperation(e){var t=e.curOp;t&&function finishOperation(e,t){var r=e.ownsGroup;if(r)try{!function fireCallbacksForOps(e){var t=e.delayedCallbacks,r=0;do{for(;r<t.length;r++)t[r].call(null);for(var a=0;a<e.ops.length;a++){var s=e.ops[a];if(s.cursorActivityHandlers)for(;s.cursorActivityCalled<s.cursorActivityHandlers.length;)s.cursorActivityHandlers[s.cursorActivityCalled++].call(null,s.cm)}}while(r<t.length)}(r)}finally{ge=null,t(r)}}(t,(function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;!function endOperations(e){for(var t=e.ops,r=0;r<t.length;r++)endOperation_R1(t[r]);for(var a=0;a<t.length;a++)endOperation_W1(t[a]);for(var s=0;s<t.length;s++)endOperation_R2(t[s]);for(var l=0;l<t.length;l++)endOperation_W2(t[l]);for(var y=0;y<t.length;y++)endOperation_finish(t[y])}(e)}))}function endOperation_R1(e){var t=e.cm,r=t.display;!function maybeClipScrollbars(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=scrollGap(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=scrollGap(e)+"px",t.scrollbarsClipped=!0)}(t),e.updateMaxLine&&findMaxLine(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<r.viewFrom||e.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new DisplayUpdate(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function endOperation_W1(e){e.updatedDisplay=e.mustUpdate&&updateDisplayIfNeeded(e.cm,e.update)}function endOperation_R2(e){var t=e.cm,r=t.display;e.updatedDisplay&&updateHeightsInViewport(t),e.barMeasure=measureForScrollbars(t),r.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=measureChar(t,r.maxLine,r.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(r.scroller.clientWidth,r.sizer.offsetLeft+e.adjustWidthTo+scrollGap(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,r.sizer.offsetLeft+e.adjustWidthTo-displayWidth(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=r.input.prepareSelection())}function endOperation_W2(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&setScrollLeft(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var r=e.focus&&e.focus==activeElt();e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,r),(e.updatedDisplay||e.startHeight!=t.doc.height)&&updateScrollbars(t,e.barMeasure),e.updatedDisplay&&setDocumentHeight(t,e.barMeasure),e.selectionChanged&&restartBlink(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),r&&ensureFocus(e.cm)}function endOperation_finish(e){var t=e.cm,r=t.display,a=t.doc;e.updatedDisplay&&postUpdateDisplay(t,e.update),null==r.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(r.wheelStartX=r.wheelStartY=null),null!=e.scrollTop&&setScrollTop(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&setScrollLeft(t,e.scrollLeft,!0,!0),e.scrollToPos&&function maybeScrollWindow(e,t){if(!signalDOMEvent(e,"scrollCursorIntoView")){var r=e.display,a=r.sizer.getBoundingClientRect(),s=null;if(t.top+a.top<0?s=!0:t.bottom+a.top>(window.innerHeight||document.documentElement.clientHeight)&&(s=!1),null!=s&&!L){var l=elt("div","​",null,"position: absolute;\n                         top: "+(t.top-r.viewOffset-paddingTop(e.display))+"px;\n                         height: "+(t.bottom-t.top+scrollGap(e)+r.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(l),l.scrollIntoView(s),e.display.lineSpace.removeChild(l)}}}(t,function scrollPosIntoView(e,t,r,a){var s;null==a&&(a=0),e.options.lineWrapping||t!=r||(r="before"==(t=t.ch?Pos(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t).sticky?Pos(t.line,t.ch+1,"before"):t);for(var l=0;l<5;l++){var y=!1,w=cursorCoords(e,t),E=r&&r!=t?cursorCoords(e,r):w,S=calculateScrollPos(e,s={left:Math.min(w.left,E.left),top:Math.min(w.top,E.top)-a,right:Math.max(w.left,E.left),bottom:Math.max(w.bottom,E.bottom)+a}),T=e.doc.scrollTop,O=e.doc.scrollLeft;if(null!=S.scrollTop&&(updateScrollTop(e,S.scrollTop),Math.abs(e.doc.scrollTop-T)>1&&(y=!0)),null!=S.scrollLeft&&(setScrollLeft(e,S.scrollLeft),Math.abs(e.doc.scrollLeft-O)>1&&(y=!0)),!y)break}return s}(t,clipPos(a,e.scrollToPos.from),clipPos(a,e.scrollToPos.to),e.scrollToPos.margin));var s=e.maybeHiddenMarkers,l=e.maybeUnhiddenMarkers;if(s)for(var y=0;y<s.length;++y)s[y].lines.length||signal(s[y],"hide");if(l)for(var w=0;w<l.length;++w)l[w].lines.length&&signal(l[w],"unhide");r.wrapper.offsetHeight&&(a.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&signal(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function runInOp(e,t){if(e.curOp)return t();startOperation(e);try{return t()}finally{endOperation(e)}}function operation(e,t){return function(){if(e.curOp)return t.apply(e,arguments);startOperation(e);try{return t.apply(e,arguments)}finally{endOperation(e)}}}function methodOp(e){return function(){if(this.curOp)return e.apply(this,arguments);startOperation(this);try{return e.apply(this,arguments)}finally{endOperation(this)}}}function docMethodOp(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);startOperation(t);try{return e.apply(this,arguments)}finally{endOperation(t)}}}function startWorker(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,bind(highlightWorker,e))}function highlightWorker(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var r=+new Date+e.options.workTime,a=getContextBefore(e,t.highlightFrontier),s=[];t.iter(a.line,Math.min(t.first+t.size,e.display.viewTo+500),(function(l){if(a.line>=e.display.viewFrom){var y=l.styles,w=l.text.length>e.options.maxHighlightLength?copyState(t.mode,a.state):null,E=highlightLine(e,l,a,!0);w&&(a.state=w),l.styles=E.styles;var S=l.styleClasses,T=E.classes;T?l.styleClasses=T:S&&(l.styleClasses=null);for(var O=!y||y.length!=l.styles.length||S!=T&&(!S||!T||S.bgClass!=T.bgClass||S.textClass!=T.textClass),N=0;!O&&N<y.length;++N)O=y[N]!=l.styles[N];O&&s.push(a.line),l.stateAfter=a.save(),a.nextLine()}else l.text.length<=e.options.maxHighlightLength&&processLine(e,l.text,a),l.stateAfter=a.line%5==0?a.save():null,a.nextLine();if(+new Date>r)return startWorker(e,e.options.workDelay),!0})),t.highlightFrontier=a.line,t.modeFrontier=Math.max(t.modeFrontier,a.line),s.length&&runInOp(e,(function(){for(var t=0;t<s.length;t++)regLineChange(e,s[t],"text")}))}}var DisplayUpdate=function(e,t,r){var a=e.display;this.viewport=t,this.visible=visibleLines(a,e.doc,t),this.editorIsHidden=!a.wrapper.offsetWidth,this.wrapperHeight=a.wrapper.clientHeight,this.wrapperWidth=a.wrapper.clientWidth,this.oldDisplayWidth=displayWidth(e),this.force=r,this.dims=getDimensions(e),this.events=[]};function updateDisplayIfNeeded(e,t){var r=e.display,a=e.doc;if(t.editorIsHidden)return resetView(e),!1;if(!t.force&&t.visible.from>=r.viewFrom&&t.visible.to<=r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>=r.viewTo)&&r.renderedView==r.view&&0==countDirtyView(e))return!1;maybeUpdateLineNumberWidth(e)&&(resetView(e),t.dims=getDimensions(e));var s=a.first+a.size,l=Math.max(t.visible.from-e.options.viewportMargin,a.first),y=Math.min(s,t.visible.to+e.options.viewportMargin);r.viewFrom<l&&l-r.viewFrom<20&&(l=Math.max(a.first,r.viewFrom)),r.viewTo>y&&r.viewTo-y<20&&(y=Math.min(s,r.viewTo)),pe&&(l=visualLineNo(e.doc,l),y=visualLineEndNo(e.doc,y));var w=l!=r.viewFrom||y!=r.viewTo||r.lastWrapHeight!=t.wrapperHeight||r.lastWrapWidth!=t.wrapperWidth;!function adjustView(e,t,r){var a=e.display;0==a.view.length||t>=a.viewTo||r<=a.viewFrom?(a.view=buildViewArray(e,t,r),a.viewFrom=t):(a.viewFrom>t?a.view=buildViewArray(e,t,a.viewFrom).concat(a.view):a.viewFrom<t&&(a.view=a.view.slice(findViewIndex(e,t))),a.viewFrom=t,a.viewTo<r?a.view=a.view.concat(buildViewArray(e,a.viewTo,r)):a.viewTo>r&&(a.view=a.view.slice(0,findViewIndex(e,r)))),a.viewTo=r}(e,l,y),r.viewOffset=heightAtLine(getLine(e.doc,r.viewFrom)),e.display.mover.style.top=r.viewOffset+"px";var S=countDirtyView(e);if(!w&&0==S&&!t.force&&r.renderedView==r.view&&(null==r.updateLineNumbers||r.updateLineNumbers>=r.viewTo))return!1;var T=function selectionSnapshot(e){if(e.hasFocus())return null;var t=activeElt();if(!t||!contains(e.display.lineDiv,t))return null;var r={activeElt:t};if(window.getSelection){var a=window.getSelection();a.anchorNode&&a.extend&&contains(e.display.lineDiv,a.anchorNode)&&(r.anchorNode=a.anchorNode,r.anchorOffset=a.anchorOffset,r.focusNode=a.focusNode,r.focusOffset=a.focusOffset)}return r}(e);return S>4&&(r.lineDiv.style.display="none"),function patchDisplay(e,t,r){var a=e.display,s=e.options.lineNumbers,l=a.lineDiv,y=l.firstChild;function rm(t){var r=t.nextSibling;return E&&B&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),r}for(var w=a.view,S=a.viewFrom,T=0;T<w.length;T++){var O=w[T];if(O.hidden);else if(O.node&&O.node.parentNode==l){for(;y!=O.node;)y=rm(y);var N=s&&null!=t&&t<=S&&O.lineNumber;O.changes&&(indexOf(O.changes,"gutter")>-1&&(N=!1),updateLineForChanges(e,O,S,r)),N&&(removeChildren(O.lineNumber),O.lineNumber.appendChild(document.createTextNode(lineNumberFor(e.options,S)))),y=O.node.nextSibling}else{var A=buildLineElement(e,O,S,r);l.insertBefore(A,y)}S+=O.size}for(;y;)y=rm(y)}(e,r.updateLineNumbers,t.dims),S>4&&(r.lineDiv.style.display=""),r.renderedView=r.view,function restoreSelection(e){if(e&&e.activeElt&&e.activeElt!=activeElt()&&(e.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(e.activeElt.nodeName)&&e.anchorNode&&contains(document.body,e.anchorNode)&&contains(document.body,e.focusNode))){var t=window.getSelection(),r=document.createRange();r.setEnd(e.anchorNode,e.anchorOffset),r.collapse(!1),t.removeAllRanges(),t.addRange(r),t.extend(e.focusNode,e.focusOffset)}}(T),removeChildren(r.cursorDiv),removeChildren(r.selectionDiv),r.gutters.style.height=r.sizer.style.minHeight=0,w&&(r.lastWrapHeight=t.wrapperHeight,r.lastWrapWidth=t.wrapperWidth,startWorker(e,400)),r.updateLineNumbers=null,!0}function postUpdateDisplay(e,t){for(var r=t.viewport,a=!0;;a=!1){if(a&&e.options.lineWrapping&&t.oldDisplayWidth!=displayWidth(e))a&&(t.visible=visibleLines(e.display,e.doc,r));else if(r&&null!=r.top&&(r={top:Math.min(e.doc.height+paddingVert(e.display)-displayHeight(e),r.top)}),t.visible=visibleLines(e.display,e.doc,r),t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)break;if(!updateDisplayIfNeeded(e,t))break;updateHeightsInViewport(e);var s=measureForScrollbars(e);updateSelection(e),updateScrollbars(e,s),setDocumentHeight(e,s),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function updateDisplaySimple(e,t){var r=new DisplayUpdate(e,t);if(updateDisplayIfNeeded(e,r)){updateHeightsInViewport(e),postUpdateDisplay(e,r);var a=measureForScrollbars(e);updateSelection(e),updateScrollbars(e,a),setDocumentHeight(e,a),r.finish()}}function updateGutterSpace(e){var t=e.gutters.offsetWidth;e.sizer.style.marginLeft=t+"px",signalLater(e,"gutterChanged",e)}function setDocumentHeight(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+scrollGap(e)+"px"}function alignHorizontally(e){var t=e.display,r=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var a=compensateForHScroll(t)-t.scroller.scrollLeft+e.doc.scrollLeft,s=t.gutters.offsetWidth,l=a+"px",y=0;y<r.length;y++)if(!r[y].hidden){e.options.fixedGutter&&(r[y].gutter&&(r[y].gutter.style.left=l),r[y].gutterBackground&&(r[y].gutterBackground.style.left=l));var w=r[y].alignable;if(w)for(var E=0;E<w.length;E++)w[E].style.left=l}e.options.fixedGutter&&(t.gutters.style.left=a+s+"px")}}function maybeUpdateLineNumberWidth(e){if(!e.options.lineNumbers)return!1;var t=e.doc,r=lineNumberFor(e.options,t.first+t.size-1),a=e.display;if(r.length!=a.lineNumChars){var s=a.measure.appendChild(elt("div",[elt("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt")),l=s.firstChild.offsetWidth,y=s.offsetWidth-l;return a.lineGutter.style.width="",a.lineNumInnerWidth=Math.max(l,a.lineGutter.offsetWidth-y)+1,a.lineNumWidth=a.lineNumInnerWidth+y,a.lineNumChars=a.lineNumInnerWidth?r.length:-1,a.lineGutter.style.width=a.lineNumWidth+"px",updateGutterSpace(e.display),!0}return!1}function getGutters(e,t){for(var r=[],a=!1,s=0;s<e.length;s++){var l=e[s],y=null;if("string"!=typeof l&&(y=l.style,l=l.className),"CodeMirror-linenumbers"==l){if(!t)continue;a=!0}r.push({className:l,style:y})}return t&&!a&&r.push({className:"CodeMirror-linenumbers",style:null}),r}function renderGutters(e){var t=e.gutters,r=e.gutterSpecs;removeChildren(t),e.lineGutter=null;for(var a=0;a<r.length;++a){var s=r[a],l=s.className,y=s.style,w=t.appendChild(elt("div",null,"CodeMirror-gutter "+l));y&&(w.style.cssText=y),"CodeMirror-linenumbers"==l&&(e.lineGutter=w,w.style.width=(e.lineNumWidth||1)+"px")}t.style.display=r.length?"":"none",updateGutterSpace(e)}function updateGutters(e){renderGutters(e.display),regChange(e),alignHorizontally(e)}function Display(e,t,a,s){var l=this;this.input=a,l.scrollbarFiller=elt("div",null,"CodeMirror-scrollbar-filler"),l.scrollbarFiller.setAttribute("cm-not-content","true"),l.gutterFiller=elt("div",null,"CodeMirror-gutter-filler"),l.gutterFiller.setAttribute("cm-not-content","true"),l.lineDiv=eltP("div",null,"CodeMirror-code"),l.selectionDiv=elt("div",null,null,"position: relative; z-index: 1"),l.cursorDiv=elt("div",null,"CodeMirror-cursors"),l.measure=elt("div",null,"CodeMirror-measure"),l.lineMeasure=elt("div",null,"CodeMirror-measure"),l.lineSpace=eltP("div",[l.measure,l.lineMeasure,l.selectionDiv,l.cursorDiv,l.lineDiv],null,"position: relative; outline: none");var S=eltP("div",[l.lineSpace],"CodeMirror-lines");l.mover=elt("div",[S],null,"position: relative"),l.sizer=elt("div",[l.mover],"CodeMirror-sizer"),l.sizerWidth=null,l.heightForcer=elt("div",null,null,"position: absolute; height: 50px; width: 1px;"),l.gutters=elt("div",null,"CodeMirror-gutters"),l.lineGutter=null,l.scroller=elt("div",[l.sizer,l.heightForcer,l.gutters],"CodeMirror-scroll"),l.scroller.setAttribute("tabIndex","-1"),l.wrapper=elt("div",[l.scrollbarFiller,l.gutterFiller,l.scroller],"CodeMirror"),y&&w<8&&(l.gutters.style.zIndex=-1,l.scroller.style.paddingRight=0),E||r&&M||(l.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(l.wrapper):e(l.wrapper)),l.viewFrom=l.viewTo=t.first,l.reportedViewFrom=l.reportedViewTo=t.first,l.view=[],l.renderedView=null,l.externalMeasured=null,l.viewOffset=0,l.lastWrapHeight=l.lastWrapWidth=0,l.updateLineNumbers=null,l.nativeBarWidth=l.barHeight=l.barWidth=0,l.scrollbarsClipped=!1,l.lineNumWidth=l.lineNumInnerWidth=l.lineNumChars=null,l.alignWidgets=!1,l.cachedCharWidth=l.cachedTextHeight=l.cachedPaddingH=null,l.maxLine=null,l.maxLineLength=0,l.maxLineChanged=!1,l.wheelDX=l.wheelDY=l.wheelStartX=l.wheelStartY=null,l.shift=!1,l.selForContextMenu=null,l.activeTouch=null,l.gutterSpecs=getGutters(s.gutters,s.lineNumbers),renderGutters(l),a.init(l)}DisplayUpdate.prototype.signal=function(e,t){hasHandler(e,t)&&this.events.push(arguments)},DisplayUpdate.prototype.finish=function(){for(var e=0;e<this.events.length;e++)signal.apply(null,this.events[e])};var Ce=0,xe=null;function wheelEventDelta(e){var t=e.wheelDeltaX,r=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==r&&e.detail&&e.axis==e.VERTICAL_AXIS?r=e.detail:null==r&&(r=e.wheelDelta),{x:t,y:r}}function wheelEventPixels(e){var t=wheelEventDelta(e);return t.x*=xe,t.y*=xe,t}function onScrollWheel(e,t){var a=wheelEventDelta(t),s=a.x,l=a.y,y=e.display,w=y.scroller,S=w.scrollWidth>w.clientWidth,T=w.scrollHeight>w.clientHeight;if(s&&S||l&&T){if(l&&B&&E)e:for(var N=t.target,A=y.view;N!=w;N=N.parentNode)for(var L=0;L<A.length;L++)if(A[L].node==N){e.display.currentWheelTarget=N;break e}if(s&&!r&&!O&&null!=xe)return l&&T&&updateScrollTop(e,Math.max(0,w.scrollTop+l*xe)),setScrollLeft(e,Math.max(0,w.scrollLeft+s*xe)),(!l||l&&T)&&e_preventDefault(t),void(y.wheelStartX=null);if(l&&null!=xe){var R=l*xe,D=e.doc.scrollTop,M=D+y.wrapper.clientHeight;R<0?D=Math.max(0,D+R-50):M=Math.min(e.doc.height,M+R+50),updateDisplaySimple(e,{top:D,bottom:M})}Ce<20&&(null==y.wheelStartX?(y.wheelStartX=w.scrollLeft,y.wheelStartY=w.scrollTop,y.wheelDX=s,y.wheelDY=l,setTimeout((function(){if(null!=y.wheelStartX){var e=w.scrollLeft-y.wheelStartX,t=w.scrollTop-y.wheelStartY,r=t&&y.wheelDY&&t/y.wheelDY||e&&y.wheelDX&&e/y.wheelDX;y.wheelStartX=y.wheelStartY=null,r&&(xe=(xe*Ce+r)/(Ce+1),++Ce)}}),200)):(y.wheelDX+=s,y.wheelDY+=l))}}y?xe=-.53:r?xe=15:T?xe=-.7:N&&(xe=-1/3);var Selection=function(e,t){this.ranges=e,this.primIndex=t};Selection.prototype.primary=function(){return this.ranges[this.primIndex]},Selection.prototype.equals=function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var r=this.ranges[t],a=e.ranges[t];if(!equalCursorPos(r.anchor,a.anchor)||!equalCursorPos(r.head,a.head))return!1}return!0},Selection.prototype.deepCopy=function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new Range(copyPos(this.ranges[t].anchor),copyPos(this.ranges[t].head));return new Selection(e,this.primIndex)},Selection.prototype.somethingSelected=function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},Selection.prototype.contains=function(e,t){t||(t=e);for(var r=0;r<this.ranges.length;r++){var a=this.ranges[r];if(cmp(t,a.from())>=0&&cmp(e,a.to())<=0)return r}return-1};var Range=function(e,t){this.anchor=e,this.head=t};function normalizeSelection(e,t,r){var a=e&&e.options.selectionsMayTouch,s=t[r];t.sort((function(e,t){return cmp(e.from(),t.from())})),r=indexOf(t,s);for(var l=1;l<t.length;l++){var y=t[l],w=t[l-1],E=cmp(w.to(),y.from());if(a&&!y.empty()?E>0:E>=0){var S=minPos(w.from(),y.from()),T=maxPos(w.to(),y.to()),O=w.empty()?y.from()==y.head:w.from()==w.head;l<=r&&--r,t.splice(--l,2,new Range(O?T:S,O?S:T))}}return new Selection(t,r)}function simpleSelection(e,t){return new Selection([new Range(e,t||e)],0)}function changeEnd(e){return e.text?Pos(e.from.line+e.text.length-1,lst(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function adjustForChange(e,t){if(cmp(e,t.from)<0)return e;if(cmp(e,t.to)<=0)return changeEnd(t);var r=e.line+t.text.length-(t.to.line-t.from.line)-1,a=e.ch;return e.line==t.to.line&&(a+=changeEnd(t).ch-t.to.ch),Pos(r,a)}function computeSelAfterChange(e,t){for(var r=[],a=0;a<e.sel.ranges.length;a++){var s=e.sel.ranges[a];r.push(new Range(adjustForChange(s.anchor,t),adjustForChange(s.head,t)))}return normalizeSelection(e.cm,r,e.sel.primIndex)}function offsetPos(e,t,r){return e.line==t.line?Pos(r.line,e.ch-t.ch+r.ch):Pos(r.line+(e.line-t.line),e.ch)}function loadMode(e){e.doc.mode=getMode(e.options,e.doc.modeOption),resetModeState(e)}function resetModeState(e){e.doc.iter((function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)})),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,startWorker(e,100),e.state.modeGen++,e.curOp&&regChange(e)}function isWholeLineUpdate(e,t){return 0==t.from.ch&&0==t.to.ch&&""==lst(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function updateDoc(e,t,r,a){function spansFor(e){return r?r[e]:null}function update(e,r,s){!function updateLine(e,t,r,a){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),detachMarkedSpans(e),attachMarkedSpans(e,r);var s=a?a(e):1;s!=e.height&&updateLineHeight(e,s)}(e,r,s,a),signalLater(e,"change",e,t)}function linesFor(e,t){for(var r=[],s=e;s<t;++s)r.push(new Line(y[s],spansFor(s),a));return r}var s=t.from,l=t.to,y=t.text,w=getLine(e,s.line),E=getLine(e,l.line),S=lst(y),T=spansFor(y.length-1),O=l.line-s.line;if(t.full)e.insert(0,linesFor(0,y.length)),e.remove(y.length,e.size-y.length);else if(isWholeLineUpdate(e,t)){var N=linesFor(0,y.length-1);update(E,E.text,T),O&&e.remove(s.line,O),N.length&&e.insert(s.line,N)}else if(w==E)if(1==y.length)update(w,w.text.slice(0,s.ch)+S+w.text.slice(l.ch),T);else{var A=linesFor(1,y.length-1);A.push(new Line(S+w.text.slice(l.ch),T,a)),update(w,w.text.slice(0,s.ch)+y[0],spansFor(0)),e.insert(s.line+1,A)}else if(1==y.length)update(w,w.text.slice(0,s.ch)+y[0]+E.text.slice(l.ch),spansFor(0)),e.remove(s.line+1,O);else{update(w,w.text.slice(0,s.ch)+y[0],spansFor(0)),update(E,S+E.text.slice(l.ch),T);var L=linesFor(1,y.length-1);O>1&&e.remove(s.line+1,O-1),e.insert(s.line+1,L)}signalLater(e,"change",e,t)}function linkedDocs(e,t,r){!function propagate(e,a,s){if(e.linked)for(var l=0;l<e.linked.length;++l){var y=e.linked[l];if(y.doc!=a){var w=s&&y.sharedHist;r&&!w||(t(y.doc,w),propagate(y.doc,e,w))}}}(e,null,!0)}function attachDoc(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,estimateLineHeights(e),loadMode(e),setDirectionClass(e),e.options.lineWrapping||findMaxLine(e),e.options.mode=t.modeOption,regChange(e)}function setDirectionClass(e){("rtl"==e.doc.direction?addClass:rmClass)(e.display.lineDiv,"CodeMirror-rtl")}function History(e){this.done=[],this.undone=[],this.undoDepth=e?e.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e?e.maxGeneration:1}function historyChangeFromChange(e,t){var r={from:copyPos(t.from),to:changeEnd(t),text:getBetween(e,t.from,t.to)};return attachLocalSpans(e,r,t.from.line,t.to.line+1),linkedDocs(e,(function(e){return attachLocalSpans(e,r,t.from.line,t.to.line+1)}),!0),r}function clearSelectionEvents(e){for(;e.length&&lst(e).ranges;)e.pop()}function addChangeToHistory(e,t,r,a){var s=e.history;s.undone.length=0;var l,y,w=+new Date;if((s.lastOp==a||s.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&s.lastModTime>w-(e.cm?e.cm.options.historyEventDelay:500)||"*"==t.origin.charAt(0)))&&(l=function lastChangeEvent(e,t){return t?(clearSelectionEvents(e.done),lst(e.done)):e.done.length&&!lst(e.done).ranges?lst(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),lst(e.done)):void 0}(s,s.lastOp==a)))y=lst(l.changes),0==cmp(t.from,t.to)&&0==cmp(t.from,y.to)?y.to=changeEnd(t):l.changes.push(historyChangeFromChange(e,t));else{var E=lst(s.done);for(E&&E.ranges||pushSelectionToHistory(e.sel,s.done),l={changes:[historyChangeFromChange(e,t)],generation:s.generation},s.done.push(l);s.done.length>s.undoDepth;)s.done.shift(),s.done[0].ranges||s.done.shift()}s.done.push(r),s.generation=++s.maxGeneration,s.lastModTime=s.lastSelTime=w,s.lastOp=s.lastSelOp=a,s.lastOrigin=s.lastSelOrigin=t.origin,y||signal(e,"historyAdded")}function addSelectionToHistory(e,t,r,a){var s=e.history,l=a&&a.origin;r==s.lastSelOp||l&&s.lastSelOrigin==l&&(s.lastModTime==s.lastSelTime&&s.lastOrigin==l||function selectionEventCanBeMerged(e,t,r,a){var s=t.charAt(0);return"*"==s||"+"==s&&r.ranges.length==a.ranges.length&&r.somethingSelected()==a.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}(e,l,lst(s.done),t))?s.done[s.done.length-1]=t:pushSelectionToHistory(t,s.done),s.lastSelTime=+new Date,s.lastSelOrigin=l,s.lastSelOp=r,a&&!1!==a.clearRedo&&clearSelectionEvents(s.undone)}function pushSelectionToHistory(e,t){var r=lst(t);r&&r.ranges&&r.equals(e)||t.push(e)}function attachLocalSpans(e,t,r,a){var s=t["spans_"+e.id],l=0;e.iter(Math.max(e.first,r),Math.min(e.first+e.size,a),(function(r){r.markedSpans&&((s||(s=t["spans_"+e.id]={}))[l]=r.markedSpans),++l}))}function removeClearedSpans(e){if(!e)return null;for(var t,r=0;r<e.length;++r)e[r].marker.explicitlyCleared?t||(t=e.slice(0,r)):t&&t.push(e[r]);return t?t.length?t:null:e}function mergeOldSpans(e,t){var r=function getOldSpans(e,t){var r=t["spans_"+e.id];if(!r)return null;for(var a=[],s=0;s<t.text.length;++s)a.push(removeClearedSpans(r[s]));return a}(e,t),a=stretchSpansOverChange(e,t);if(!r)return a;if(!a)return r;for(var s=0;s<r.length;++s){var l=r[s],y=a[s];if(l&&y)e:for(var w=0;w<y.length;++w){for(var E=y[w],S=0;S<l.length;++S)if(l[S].marker==E.marker)continue e;l.push(E)}else y&&(r[s]=y)}return r}function copyHistoryArray(e,t,r){for(var a=[],s=0;s<e.length;++s){var l=e[s];if(l.ranges)a.push(r?Selection.prototype.deepCopy.call(l):l);else{var y=l.changes,w=[];a.push({changes:w});for(var E=0;E<y.length;++E){var S=y[E],T=void 0;if(w.push({from:S.from,to:S.to,text:S.text}),t)for(var O in S)(T=O.match(/^spans_(\d+)$/))&&indexOf(t,Number(T[1]))>-1&&(lst(w)[O]=S[O],delete S[O])}}}return a}function extendRange(e,t,r,a){if(a){var s=e.anchor;if(r){var l=cmp(t,s)<0;l!=cmp(r,s)<0?(s=t,t=r):l!=cmp(t,r)<0&&(t=r)}return new Range(s,t)}return new Range(r||t,t)}function extendSelection(e,t,r,a,s){null==s&&(s=e.cm&&(e.cm.display.shift||e.extend)),setSelection(e,new Selection([extendRange(e.sel.primary(),t,r,s)],0),a)}function extendSelections(e,t,r){for(var a=[],s=e.cm&&(e.cm.display.shift||e.extend),l=0;l<e.sel.ranges.length;l++)a[l]=extendRange(e.sel.ranges[l],t[l],null,s);setSelection(e,normalizeSelection(e.cm,a,e.sel.primIndex),r)}function replaceOneSelection(e,t,r,a){var s=e.sel.ranges.slice(0);s[t]=r,setSelection(e,normalizeSelection(e.cm,s,e.sel.primIndex),a)}function setSimpleSelection(e,t,r,a){setSelection(e,simpleSelection(t,r),a)}function setSelectionReplaceHistory(e,t,r){var a=e.history.done,s=lst(a);s&&s.ranges?(a[a.length-1]=t,setSelectionNoUndo(e,t,r)):setSelection(e,t,r)}function setSelection(e,t,r){setSelectionNoUndo(e,t,r),addSelectionToHistory(e,e.sel,e.cm?e.cm.curOp.id:NaN,r)}function setSelectionNoUndo(e,t,r){(hasHandler(e,"beforeSelectionChange")||e.cm&&hasHandler(e.cm,"beforeSelectionChange"))&&(t=function filterSelectionChange(e,t,r){var a={ranges:t.ranges,update:function(t){this.ranges=[];for(var r=0;r<t.length;r++)this.ranges[r]=new Range(clipPos(e,t[r].anchor),clipPos(e,t[r].head))},origin:r&&r.origin};return signal(e,"beforeSelectionChange",e,a),e.cm&&signal(e.cm,"beforeSelectionChange",e.cm,a),a.ranges!=t.ranges?normalizeSelection(e.cm,a.ranges,a.ranges.length-1):t}(e,t,r));var a=r&&r.bias||(cmp(t.primary().head,e.sel.primary().head)<0?-1:1);setSelectionInner(e,skipAtomicInSelection(e,t,a,!0)),r&&!1===r.scroll||!e.cm||"nocursor"==e.cm.getOption("readOnly")||ensureCursorVisible(e.cm)}function setSelectionInner(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=1,e.cm.curOp.selectionChanged=!0,signalCursorActivity(e.cm)),signalLater(e,"cursorActivity",e))}function reCheckSelection(e){setSelectionInner(e,skipAtomicInSelection(e,e.sel,null,!1))}function skipAtomicInSelection(e,t,r,a){for(var s,l=0;l<t.ranges.length;l++){var y=t.ranges[l],w=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[l],E=skipAtomic(e,y.anchor,w&&w.anchor,r,a),S=skipAtomic(e,y.head,w&&w.head,r,a);(s||E!=y.anchor||S!=y.head)&&(s||(s=t.ranges.slice(0,l)),s[l]=new Range(E,S))}return s?normalizeSelection(e.cm,s,t.primIndex):t}function skipAtomicInner(e,t,r,a,s){var l=getLine(e,t.line);if(l.markedSpans)for(var y=0;y<l.markedSpans.length;++y){var w=l.markedSpans[y],E=w.marker,S="selectLeft"in E?!E.selectLeft:E.inclusiveLeft,T="selectRight"in E?!E.selectRight:E.inclusiveRight;if((null==w.from||(S?w.from<=t.ch:w.from<t.ch))&&(null==w.to||(T?w.to>=t.ch:w.to>t.ch))){if(s&&(signal(E,"beforeCursorEnter"),E.explicitlyCleared)){if(l.markedSpans){--y;continue}break}if(!E.atomic)continue;if(r){var O=E.find(a<0?1:-1),N=void 0;if((a<0?T:S)&&(O=movePos(e,O,-a,O&&O.line==t.line?l:null)),O&&O.line==t.line&&(N=cmp(O,r))&&(a<0?N<0:N>0))return skipAtomicInner(e,O,t,a,s)}var A=E.find(a<0?-1:1);return(a<0?S:T)&&(A=movePos(e,A,a,A.line==t.line?l:null)),A?skipAtomicInner(e,A,t,a,s):null}}return t}function skipAtomic(e,t,r,a,s){var l=a||1,y=skipAtomicInner(e,t,r,l,s)||!s&&skipAtomicInner(e,t,r,l,!0)||skipAtomicInner(e,t,r,-l,s)||!s&&skipAtomicInner(e,t,r,-l,!0);return y||(e.cantEdit=!0,Pos(e.first,0))}function movePos(e,t,r,a){return r<0&&0==t.ch?t.line>e.first?clipPos(e,Pos(t.line-1)):null:r>0&&t.ch==(a||getLine(e,t.line)).text.length?t.line<e.first+e.size-1?Pos(t.line+1,0):null:new Pos(t.line,t.ch+r)}function selectAll(e){e.setSelection(Pos(e.firstLine(),0),Pos(e.lastLine()),G)}function filterChange(e,t,r){var a={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return a.canceled=!0}};return r&&(a.update=function(t,r,s,l){t&&(a.from=clipPos(e,t)),r&&(a.to=clipPos(e,r)),s&&(a.text=s),void 0!==l&&(a.origin=l)}),signal(e,"beforeChange",e,a),e.cm&&signal(e.cm,"beforeChange",e.cm,a),a.canceled?(e.cm&&(e.cm.curOp.updateInput=2),null):{from:a.from,to:a.to,text:a.text,origin:a.origin}}function makeChange(e,t,r){if(e.cm){if(!e.cm.curOp)return operation(e.cm,makeChange)(e,t,r);if(e.cm.state.suppressEdits)return}if(!(hasHandler(e,"beforeChange")||e.cm&&hasHandler(e.cm,"beforeChange"))||(t=filterChange(e,t,!0))){var a=he&&!r&&function removeReadOnlyRanges(e,t,r){var a=null;if(e.iter(t.line,r.line+1,(function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var r=e.markedSpans[t].marker;!r.readOnly||a&&-1!=indexOf(a,r)||(a||(a=[])).push(r)}})),!a)return null;for(var s=[{from:t,to:r}],l=0;l<a.length;++l)for(var y=a[l],w=y.find(0),E=0;E<s.length;++E){var S=s[E];if(!(cmp(S.to,w.from)<0||cmp(S.from,w.to)>0)){var T=[E,1],O=cmp(S.from,w.from),N=cmp(S.to,w.to);(O<0||!y.inclusiveLeft&&!O)&&T.push({from:S.from,to:w.from}),(N>0||!y.inclusiveRight&&!N)&&T.push({from:w.to,to:S.to}),s.splice.apply(s,T),E+=T.length-3}}return s}(e,t.from,t.to);if(a)for(var s=a.length-1;s>=0;--s)makeChangeInner(e,{from:a[s].from,to:a[s].to,text:s?[""]:t.text,origin:t.origin});else makeChangeInner(e,t)}}function makeChangeInner(e,t){if(1!=t.text.length||""!=t.text[0]||0!=cmp(t.from,t.to)){var r=computeSelAfterChange(e,t);addChangeToHistory(e,t,r,e.cm?e.cm.curOp.id:NaN),makeChangeSingleDoc(e,t,r,stretchSpansOverChange(e,t));var a=[];linkedDocs(e,(function(e,r){r||-1!=indexOf(a,e.history)||(rebaseHist(e.history,t),a.push(e.history)),makeChangeSingleDoc(e,t,null,stretchSpansOverChange(e,t))}))}}function makeChangeFromHistory(e,t,r){var a=e.cm&&e.cm.state.suppressEdits;if(!a||r){for(var s,l=e.history,y=e.sel,w="undo"==t?l.done:l.undone,E="undo"==t?l.undone:l.done,S=0;S<w.length&&(s=w[S],r?!s.ranges||s.equals(e.sel):s.ranges);S++);if(S!=w.length){for(l.lastOrigin=l.lastSelOrigin=null;;){if(!(s=w.pop()).ranges){if(a)return void w.push(s);break}if(pushSelectionToHistory(s,E),r&&!s.equals(e.sel))return void setSelection(e,s,{clearRedo:!1});y=s}var T=[];pushSelectionToHistory(y,E),E.push({changes:T,generation:l.generation}),l.generation=s.generation||++l.maxGeneration;for(var O=hasHandler(e,"beforeChange")||e.cm&&hasHandler(e.cm,"beforeChange"),loop=function(r){var a=s.changes[r];if(a.origin=t,O&&!filterChange(e,a,!1))return w.length=0,{};T.push(historyChangeFromChange(e,a));var l=r?computeSelAfterChange(e,a):lst(w);makeChangeSingleDoc(e,a,l,mergeOldSpans(e,a)),!r&&e.cm&&e.cm.scrollIntoView({from:a.from,to:changeEnd(a)});var y=[];linkedDocs(e,(function(e,t){t||-1!=indexOf(y,e.history)||(rebaseHist(e.history,a),y.push(e.history)),makeChangeSingleDoc(e,a,null,mergeOldSpans(e,a))}))},N=s.changes.length-1;N>=0;--N){var A=loop(N);if(A)return A.v}}}}function shiftDoc(e,t){if(0!=t&&(e.first+=t,e.sel=new Selection(map(e.sel.ranges,(function(e){return new Range(Pos(e.anchor.line+t,e.anchor.ch),Pos(e.head.line+t,e.head.ch))})),e.sel.primIndex),e.cm)){regChange(e.cm,e.first,e.first-t,t);for(var r=e.cm.display,a=r.viewFrom;a<r.viewTo;a++)regLineChange(e.cm,a,"gutter")}}function makeChangeSingleDoc(e,t,r,a){if(e.cm&&!e.cm.curOp)return operation(e.cm,makeChangeSingleDoc)(e,t,r,a);if(t.to.line<e.first)shiftDoc(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var s=t.text.length-1-(e.first-t.from.line);shiftDoc(e,s),t={from:Pos(e.first,0),to:Pos(t.to.line+s,t.to.ch),text:[lst(t.text)],origin:t.origin}}var l=e.lastLine();t.to.line>l&&(t={from:t.from,to:Pos(l,getLine(e,l).text.length),text:[t.text[0]],origin:t.origin}),t.removed=getBetween(e,t.from,t.to),r||(r=computeSelAfterChange(e,t)),e.cm?function makeChangeSingleDocInEditor(e,t,r){var a=e.doc,s=e.display,l=t.from,y=t.to,w=!1,E=l.line;e.options.lineWrapping||(E=lineNo(visualLine(getLine(a,l.line))),a.iter(E,y.line+1,(function(e){if(e==s.maxLine)return w=!0,!0}))),a.sel.contains(t.from,t.to)>-1&&signalCursorActivity(e),updateDoc(a,t,r,estimateHeight(e)),e.options.lineWrapping||(a.iter(E,l.line+t.text.length,(function(e){var t=lineLength(e);t>s.maxLineLength&&(s.maxLine=e,s.maxLineLength=t,s.maxLineChanged=!0,w=!1)})),w&&(e.curOp.updateMaxLine=!0)),function retreatFrontier(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var r=e.first,a=t-1;a>r;a--){var s=getLine(e,a).stateAfter;if(s&&(!(s instanceof SavedContext)||a+s.lookAhead<t)){r=a+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,r)}}(a,l.line),startWorker(e,400);var S=t.text.length-(y.line-l.line)-1;t.full?regChange(e):l.line!=y.line||1!=t.text.length||isWholeLineUpdate(e.doc,t)?regChange(e,l.line,y.line+1,S):regLineChange(e,l.line,"text");var T=hasHandler(e,"changes"),O=hasHandler(e,"change");if(O||T){var N={from:l,to:y,text:t.text,removed:t.removed,origin:t.origin};O&&signalLater(e,"change",e,N),T&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(N)}e.display.selForContextMenu=null}(e.cm,t,a):updateDoc(e,t,a),setSelectionNoUndo(e,r,G),e.cantEdit&&skipAtomic(e,Pos(e.firstLine(),0))&&(e.cantEdit=!1)}}function replaceRange(e,t,r,a,s){var l;a||(a=r),cmp(a,r)<0&&(r=(l=[a,r])[0],a=l[1]),"string"==typeof t&&(t=e.splitLines(t)),makeChange(e,{from:r,to:a,text:t,origin:s})}function rebaseHistSelSingle(e,t,r,a){r<e.line?e.line+=a:t<e.line&&(e.line=t,e.ch=0)}function rebaseHistArray(e,t,r,a){for(var s=0;s<e.length;++s){var l=e[s],y=!0;if(l.ranges){l.copied||((l=e[s]=l.deepCopy()).copied=!0);for(var w=0;w<l.ranges.length;w++)rebaseHistSelSingle(l.ranges[w].anchor,t,r,a),rebaseHistSelSingle(l.ranges[w].head,t,r,a)}else{for(var E=0;E<l.changes.length;++E){var S=l.changes[E];if(r<S.from.line)S.from=Pos(S.from.line+a,S.from.ch),S.to=Pos(S.to.line+a,S.to.ch);else if(t<=S.to.line){y=!1;break}}y||(e.splice(0,s+1),s=0)}}}function rebaseHist(e,t){var r=t.from.line,a=t.to.line,s=t.text.length-(a-r)-1;rebaseHistArray(e.done,r,a,s),rebaseHistArray(e.undone,r,a,s)}function changeLine(e,t,r,a){var s=t,l=t;return"number"==typeof t?l=getLine(e,clipLine(e,t)):s=lineNo(t),null==s?null:(a(l,s)&&e.cm&&regLineChange(e.cm,s,r),l)}function LeafChunk(e){this.lines=e,this.parent=null;for(var t=0,r=0;r<e.length;++r)e[r].parent=this,t+=e[r].height;this.height=t}function BranchChunk(e){this.children=e;for(var t=0,r=0,a=0;a<e.length;++a){var s=e[a];t+=s.chunkSize(),r+=s.height,s.parent=this}this.size=t,this.height=r,this.parent=null}Range.prototype.from=function(){return minPos(this.anchor,this.head)},Range.prototype.to=function(){return maxPos(this.anchor,this.head)},Range.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},LeafChunk.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var r=e,a=e+t;r<a;++r){var s=this.lines[r];this.height-=s.height,cleanUpLine(s),signalLater(s,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,r){this.height+=r,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var a=0;a<t.length;++a)t[a].parent=this},iterN:function(e,t,r){for(var a=e+t;e<a;++e)if(r(this.lines[e]))return!0}},BranchChunk.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var r=0;r<this.children.length;++r){var a=this.children[r],s=a.chunkSize();if(e<s){var l=Math.min(t,s-e),y=a.height;if(a.removeInner(e,l),this.height-=y-a.height,s==l&&(this.children.splice(r--,1),a.parent=null),0==(t-=l))break;e=0}else e-=s}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof LeafChunk))){var w=[];this.collapse(w),this.children=[new LeafChunk(w)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,r){this.size+=t.length,this.height+=r;for(var a=0;a<this.children.length;++a){var s=this.children[a],l=s.chunkSize();if(e<=l){if(s.insertInner(e,t,r),s.lines&&s.lines.length>50){for(var y=s.lines.length%25+25,w=y;w<s.lines.length;){var E=new LeafChunk(s.lines.slice(w,w+=25));s.height-=E.height,this.children.splice(++a,0,E),E.parent=this}s.lines=s.lines.slice(0,y),this.maybeSpill()}break}e-=l}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new BranchChunk(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var r=indexOf(e.parent.children,e);e.parent.children.splice(r+1,0,t)}else{var a=new BranchChunk(e.children);a.parent=e,e.children=[a,t],e=a}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,r){for(var a=0;a<this.children.length;++a){var s=this.children[a],l=s.chunkSize();if(e<l){var y=Math.min(t,l-e);if(s.iterN(e,y,r))return!0;if(0==(t-=y))break;e=0}else e-=l}}};var LineWidget=function(e,t,r){if(r)for(var a in r)r.hasOwnProperty(a)&&(this[a]=r[a]);this.doc=e,this.node=t};function adjustScrollWhenAboveVisible(e,t,r){heightAtLine(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&addToScrollTop(e,r)}LineWidget.prototype.clear=function(){var e=this.doc.cm,t=this.line.widgets,r=this.line,a=lineNo(r);if(null!=a&&t){for(var s=0;s<t.length;++s)t[s]==this&&t.splice(s--,1);t.length||(r.widgets=null);var l=widgetHeight(this);updateLineHeight(r,Math.max(0,r.height-l)),e&&(runInOp(e,(function(){adjustScrollWhenAboveVisible(e,r,-l),regLineChange(e,a,"widget")})),signalLater(e,"lineWidgetCleared",e,this,a))}},LineWidget.prototype.changed=function(){var e=this,t=this.height,r=this.doc.cm,a=this.line;this.height=null;var s=widgetHeight(this)-t;s&&(lineIsHidden(this.doc,a)||updateLineHeight(a,a.height+s),r&&runInOp(r,(function(){r.curOp.forceUpdate=!0,adjustScrollWhenAboveVisible(r,a,s),signalLater(r,"lineWidgetChanged",r,e,lineNo(a))})))},eventMixin(LineWidget);var Ee=0,TextMarker=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++Ee};function markText(e,t,r,a,s){if(a&&a.shared)return function markTextShared(e,t,r,a,s){(a=copyObj(a)).shared=!1;var l=[markText(e,t,r,a,s)],y=l[0],w=a.widgetNode;return linkedDocs(e,(function(e){w&&(a.widgetNode=w.cloneNode(!0)),l.push(markText(e,clipPos(e,t),clipPos(e,r),a,s));for(var E=0;E<e.linked.length;++E)if(e.linked[E].isParent)return;y=lst(l)})),new SharedTextMarker(l,y)}(e,t,r,a,s);if(e.cm&&!e.cm.curOp)return operation(e.cm,markText)(e,t,r,a,s);var l=new TextMarker(e,s),y=cmp(t,r);if(a&&copyObj(a,l,!1),y>0||0==y&&!1!==l.clearWhenEmpty)return l;if(l.replacedWith&&(l.collapsed=!0,l.widgetNode=eltP("span",[l.replacedWith],"CodeMirror-widget"),a.handleMouseEvents||l.widgetNode.setAttribute("cm-ignore-events","true"),a.insertLeft&&(l.widgetNode.insertLeft=!0)),l.collapsed){if(conflictingCollapsedRange(e,t.line,t,r,l)||t.line!=r.line&&conflictingCollapsedRange(e,r.line,t,r,l))throw new Error("Inserting collapsed marker partially overlapping an existing one");!function seeCollapsedSpans(){pe=!0}()}l.addToHistory&&addChangeToHistory(e,{from:t,to:r,origin:"markText"},e.sel,NaN);var w,E=t.line,S=e.cm;if(e.iter(E,r.line+1,(function(e){S&&l.collapsed&&!S.options.lineWrapping&&visualLine(e)==S.display.maxLine&&(w=!0),l.collapsed&&E!=t.line&&updateLineHeight(e,0),function addMarkedSpan(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}(e,new MarkedSpan(l,E==t.line?t.ch:null,E==r.line?r.ch:null)),++E})),l.collapsed&&e.iter(t.line,r.line+1,(function(t){lineIsHidden(e,t)&&updateLineHeight(t,0)})),l.clearOnEnter&&on(l,"beforeCursorEnter",(function(){return l.clear()})),l.readOnly&&(function seeReadOnlySpans(){he=!0}(),(e.history.done.length||e.history.undone.length)&&e.clearHistory()),l.collapsed&&(l.id=++Ee,l.atomic=!0),S){if(w&&(S.curOp.updateMaxLine=!0),l.collapsed)regChange(S,t.line,r.line+1);else if(l.className||l.startStyle||l.endStyle||l.css||l.attributes||l.title)for(var T=t.line;T<=r.line;T++)regLineChange(S,T,"text");l.atomic&&reCheckSelection(S.doc),signalLater(S,"markerAdded",S,l)}return l}TextMarker.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&startOperation(e),hasHandler(this,"clear")){var r=this.find();r&&signalLater(this,"clear",r.from,r.to)}for(var a=null,s=null,l=0;l<this.lines.length;++l){var y=this.lines[l],w=getMarkedSpanFor(y.markedSpans,this);e&&!this.collapsed?regLineChange(e,lineNo(y),"text"):e&&(null!=w.to&&(s=lineNo(y)),null!=w.from&&(a=lineNo(y))),y.markedSpans=removeMarkedSpan(y.markedSpans,w),null==w.from&&this.collapsed&&!lineIsHidden(this.doc,y)&&e&&updateLineHeight(y,textHeight(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var E=0;E<this.lines.length;++E){var S=visualLine(this.lines[E]),T=lineLength(S);T>e.display.maxLineLength&&(e.display.maxLine=S,e.display.maxLineLength=T,e.display.maxLineChanged=!0)}null!=a&&e&&this.collapsed&&regChange(e,a,s+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&reCheckSelection(e.doc)),e&&signalLater(e,"markerCleared",e,this,a,s),t&&endOperation(e),this.parent&&this.parent.clear()}},TextMarker.prototype.find=function(e,t){var r,a;null==e&&"bookmark"==this.type&&(e=1);for(var s=0;s<this.lines.length;++s){var l=this.lines[s],y=getMarkedSpanFor(l.markedSpans,this);if(null!=y.from&&(r=Pos(t?l:lineNo(l),y.from),-1==e))return r;if(null!=y.to&&(a=Pos(t?l:lineNo(l),y.to),1==e))return a}return r&&{from:r,to:a}},TextMarker.prototype.changed=function(){var e=this,t=this.find(-1,!0),r=this,a=this.doc.cm;t&&a&&runInOp(a,(function(){var s=t.line,l=lineNo(t.line),y=findViewForLine(a,l);if(y&&(clearLineMeasurementCacheFor(y),a.curOp.selectionChanged=a.curOp.forceUpdate=!0),a.curOp.updateMaxLine=!0,!lineIsHidden(r.doc,s)&&null!=r.height){var w=r.height;r.height=null;var E=widgetHeight(r)-w;E&&updateLineHeight(s,s.height+E)}signalLater(a,"markerChanged",a,e)}))},TextMarker.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=indexOf(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},TextMarker.prototype.detachLine=function(e){if(this.lines.splice(indexOf(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},eventMixin(TextMarker);var SharedTextMarker=function(e,t){this.markers=e,this.primary=t;for(var r=0;r<e.length;++r)e[r].parent=this};function findSharedMarkers(e){return e.findMarks(Pos(e.first,0),e.clipPos(Pos(e.lastLine())),(function(e){return e.parent}))}function detachSharedMarkers(e){for(var loop=function(t){var r=e[t],a=[r.primary.doc];linkedDocs(r.primary.doc,(function(e){return a.push(e)}));for(var s=0;s<r.markers.length;s++){var l=r.markers[s];-1==indexOf(a,l.doc)&&(l.parent=null,r.markers.splice(s--,1))}},t=0;t<e.length;t++)loop(t)}SharedTextMarker.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();signalLater(this,"clear")}},SharedTextMarker.prototype.find=function(e,t){return this.primary.find(e,t)},eventMixin(SharedTextMarker);var Se=0,Doc=function(e,t,r,a,s){if(!(this instanceof Doc))return new Doc(e,t,r,a,s);null==r&&(r=0),BranchChunk.call(this,[new LeafChunk([new Line("",null)])]),this.first=r,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=r;var l=Pos(r,0);this.sel=simpleSelection(l),this.history=new History(null),this.id=++Se,this.modeOption=t,this.lineSep=a,this.direction="rtl"==s?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),updateDoc(this,{from:l,to:l,text:e}),setSelection(this,simpleSelection(l),G)};Doc.prototype=createObj(BranchChunk.prototype,{constructor:Doc,iter:function(e,t,r){r?this.iterN(e-this.first,t-e,r):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var r=0,a=0;a<t.length;++a)r+=t[a].height;this.insertInner(e-this.first,t,r)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=getLines(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:docMethodOp((function(e){var t=Pos(this.first,0),r=this.first+this.size-1;makeChange(this,{from:t,to:Pos(r,getLine(this,r).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&scrollToCoords(this.cm,0,0),setSelection(this,simpleSelection(t),G)})),replaceRange:function(e,t,r,a){replaceRange(this,e,t=clipPos(this,t),r=r?clipPos(this,r):t,a)},getRange:function(e,t,r){var a=getBetween(this,clipPos(this,e),clipPos(this,t));return!1===r?a:a.join(r||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(isLine(this,e))return getLine(this,e)},getLineNumber:function(e){return lineNo(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=getLine(this,e)),visualLine(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return clipPos(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:docMethodOp((function(e,t,r){setSimpleSelection(this,clipPos(this,"number"==typeof e?Pos(e,t||0):e),null,r)})),setSelection:docMethodOp((function(e,t,r){setSimpleSelection(this,clipPos(this,e),clipPos(this,t||e),r)})),extendSelection:docMethodOp((function(e,t,r){extendSelection(this,clipPos(this,e),t&&clipPos(this,t),r)})),extendSelections:docMethodOp((function(e,t){extendSelections(this,clipPosArray(this,e),t)})),extendSelectionsBy:docMethodOp((function(e,t){extendSelections(this,clipPosArray(this,map(this.sel.ranges,e)),t)})),setSelections:docMethodOp((function(e,t,r){if(e.length){for(var a=[],s=0;s<e.length;s++)a[s]=new Range(clipPos(this,e[s].anchor),clipPos(this,e[s].head||e[s].anchor));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),setSelection(this,normalizeSelection(this.cm,a,t),r)}})),addSelection:docMethodOp((function(e,t,r){var a=this.sel.ranges.slice(0);a.push(new Range(clipPos(this,e),clipPos(this,t||e))),setSelection(this,normalizeSelection(this.cm,a,a.length-1),r)})),getSelection:function(e){for(var t,r=this.sel.ranges,a=0;a<r.length;a++){var s=getBetween(this,r[a].from(),r[a].to());t=t?t.concat(s):s}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=[],r=this.sel.ranges,a=0;a<r.length;a++){var s=getBetween(this,r[a].from(),r[a].to());!1!==e&&(s=s.join(e||this.lineSeparator())),t[a]=s}return t},replaceSelection:function(e,t,r){for(var a=[],s=0;s<this.sel.ranges.length;s++)a[s]=e;this.replaceSelections(a,t,r||"+input")},replaceSelections:docMethodOp((function(e,t,r){for(var a=[],s=this.sel,l=0;l<s.ranges.length;l++){var y=s.ranges[l];a[l]={from:y.from(),to:y.to(),text:this.splitLines(e[l]),origin:r}}for(var w=t&&"end"!=t&&function computeReplacedSel(e,t,r){for(var a=[],s=Pos(e.first,0),l=s,y=0;y<t.length;y++){var w=t[y],E=offsetPos(w.from,s,l),S=offsetPos(changeEnd(w),s,l);if(s=w.to,l=S,"around"==r){var T=e.sel.ranges[y],O=cmp(T.head,T.anchor)<0;a[y]=new Range(O?S:E,O?E:S)}else a[y]=new Range(E,E)}return new Selection(a,e.sel.primIndex)}(this,a,t),E=a.length-1;E>=0;E--)makeChange(this,a[E]);w?setSelectionReplaceHistory(this,w):this.cm&&ensureCursorVisible(this.cm)})),undo:docMethodOp((function(){makeChangeFromHistory(this,"undo")})),redo:docMethodOp((function(){makeChangeFromHistory(this,"redo")})),undoSelection:docMethodOp((function(){makeChangeFromHistory(this,"undo",!0)})),redoSelection:docMethodOp((function(){makeChangeFromHistory(this,"redo",!0)})),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,r=0,a=0;a<e.done.length;a++)e.done[a].ranges||++t;for(var s=0;s<e.undone.length;s++)e.undone[s].ranges||++r;return{undo:t,redo:r}},clearHistory:function(){var e=this;this.history=new History(this.history),linkedDocs(this,(function(t){return t.history=e.history}),!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:copyHistoryArray(this.history.done),undone:copyHistoryArray(this.history.undone)}},setHistory:function(e){var t=this.history=new History(this.history);t.done=copyHistoryArray(e.done.slice(0),null,!0),t.undone=copyHistoryArray(e.undone.slice(0),null,!0)},setGutterMarker:docMethodOp((function(e,t,r){return changeLine(this,e,"gutter",(function(e){var a=e.gutterMarkers||(e.gutterMarkers={});return a[t]=r,!r&&isEmpty(a)&&(e.gutterMarkers=null),!0}))})),clearGutter:docMethodOp((function(e){var t=this;this.iter((function(r){r.gutterMarkers&&r.gutterMarkers[e]&&changeLine(t,r,"gutter",(function(){return r.gutterMarkers[e]=null,isEmpty(r.gutterMarkers)&&(r.gutterMarkers=null),!0}))}))})),lineInfo:function(e){var t;if("number"==typeof e){if(!isLine(this,e))return null;if(t=e,!(e=getLine(this,e)))return null}else if(null==(t=lineNo(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:docMethodOp((function(e,t,r){return changeLine(this,e,"gutter"==t?"gutter":"class",(function(e){var a="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass";if(e[a]){if(classTest(r).test(e[a]))return!1;e[a]+=" "+r}else e[a]=r;return!0}))})),removeLineClass:docMethodOp((function(e,t,r){return changeLine(this,e,"gutter"==t?"gutter":"class",(function(e){var a="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass",s=e[a];if(!s)return!1;if(null==r)e[a]=null;else{var l=s.match(classTest(r));if(!l)return!1;var y=l.index+l[0].length;e[a]=s.slice(0,l.index)+(l.index&&y!=s.length?" ":"")+s.slice(y)||null}return!0}))})),addLineWidget:docMethodOp((function(e,t,r){return function addLineWidget(e,t,r,a){var s=new LineWidget(e,r,a),l=e.cm;return l&&s.noHScroll&&(l.display.alignWidgets=!0),changeLine(e,t,"widget",(function(t){var r=t.widgets||(t.widgets=[]);if(null==s.insertAt?r.push(s):r.splice(Math.min(r.length,Math.max(0,s.insertAt)),0,s),s.line=t,l&&!lineIsHidden(e,t)){var a=heightAtLine(t)<e.scrollTop;updateLineHeight(t,t.height+widgetHeight(s)),a&&addToScrollTop(l,s.height),l.curOp.forceUpdate=!0}return!0})),l&&signalLater(l,"lineWidgetAdded",l,s,"number"==typeof t?t:lineNo(t)),s}(this,e,t,r)})),removeLineWidget:function(e){e.clear()},markText:function(e,t,r){return markText(this,clipPos(this,e),clipPos(this,t),r,r&&r.type||"range")},setBookmark:function(e,t){var r={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return markText(this,e=clipPos(this,e),e,r,"bookmark")},findMarksAt:function(e){var t=[],r=getLine(this,(e=clipPos(this,e)).line).markedSpans;if(r)for(var a=0;a<r.length;++a){var s=r[a];(null==s.from||s.from<=e.ch)&&(null==s.to||s.to>=e.ch)&&t.push(s.marker.parent||s.marker)}return t},findMarks:function(e,t,r){e=clipPos(this,e),t=clipPos(this,t);var a=[],s=e.line;return this.iter(e.line,t.line+1,(function(l){var y=l.markedSpans;if(y)for(var w=0;w<y.length;w++){var E=y[w];null!=E.to&&s==e.line&&e.ch>=E.to||null==E.from&&s!=e.line||null!=E.from&&s==t.line&&E.from>=t.ch||r&&!r(E.marker)||a.push(E.marker.parent||E.marker)}++s})),a},getAllMarks:function(){var e=[];return this.iter((function(t){var r=t.markedSpans;if(r)for(var a=0;a<r.length;++a)null!=r[a].from&&e.push(r[a].marker)})),e},posFromIndex:function(e){var t,r=this.first,a=this.lineSeparator().length;return this.iter((function(s){var l=s.text.length+a;if(l>e)return t=e,!0;e-=l,++r})),clipPos(this,Pos(r,t))},indexFromPos:function(e){var t=(e=clipPos(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var r=this.lineSeparator().length;return this.iter(this.first,e.line,(function(e){t+=e.text.length+r})),t},copy:function(e){var t=new Doc(getLines(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,r=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<r&&(r=e.to);var a=new Doc(getLines(this,t,r),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(a.history=this.history),(this.linked||(this.linked=[])).push({doc:a,sharedHist:e.sharedHist}),a.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],function copySharedMarkers(e,t){for(var r=0;r<t.length;r++){var a=t[r],s=a.find(),l=e.clipPos(s.from),y=e.clipPos(s.to);if(cmp(l,y)){var w=markText(e,l,y,a.primary,a.primary.type);a.markers.push(w),w.parent=a}}}(a,findSharedMarkers(this)),a},unlinkDoc:function(e){if(e instanceof CodeMirror&&(e=e.doc),this.linked)for(var t=0;t<this.linked.length;++t)if(this.linked[t].doc==e){this.linked.splice(t,1),e.unlinkDoc(this),detachSharedMarkers(findSharedMarkers(this));break}if(e.history==this.history){var r=[e.id];linkedDocs(e,(function(e){return r.push(e.id)}),!0),e.history=new History(null),e.history.done=copyHistoryArray(this.history.done,r),e.history.undone=copyHistoryArray(this.history.undone,r)}},iterLinkedDocs:function(e){linkedDocs(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):oe(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:docMethodOp((function(e){"rtl"!=e&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter((function(e){return e.order=null})),this.cm&&function directionChanged(e){runInOp(e,(function(){setDirectionClass(e),regChange(e)}))}(this.cm))}))}),Doc.prototype.eachLine=Doc.prototype.iter;var Te=0;function onDrop(e){var t=this;if(clearDragCursor(t),!signalDOMEvent(t,e)&&!eventInWidget(t.display,e)){e_preventDefault(e),y&&(Te=+new Date);var r=posFromMouse(t,e,!0),a=e.dataTransfer.files;if(r&&!t.isReadOnly())if(a&&a.length&&window.FileReader&&window.File)for(var s=a.length,l=Array(s),w=0,markAsReadAndPasteIfAllFilesAreRead=function(){++w==s&&operation(t,(function(){var e={from:r=clipPos(t.doc,r),to:r,text:t.doc.splitLines(l.filter((function(e){return null!=e})).join(t.doc.lineSeparator())),origin:"paste"};makeChange(t.doc,e),setSelectionReplaceHistory(t.doc,simpleSelection(clipPos(t.doc,r),clipPos(t.doc,changeEnd(e))))}))()},readTextFromFile=function(e,r){if(t.options.allowDropFileTypes&&-1==indexOf(t.options.allowDropFileTypes,e.type))markAsReadAndPasteIfAllFilesAreRead();else{var a=new FileReader;a.onerror=function(){return markAsReadAndPasteIfAllFilesAreRead()},a.onload=function(){var e=a.result;/[\x00-\x08\x0e-\x1f]{2}/.test(e)||(l[r]=e),markAsReadAndPasteIfAllFilesAreRead()},a.readAsText(e)}},E=0;E<a.length;E++)readTextFromFile(a[E],E);else{if(t.state.draggingText&&t.doc.sel.contains(r)>-1)return t.state.draggingText(e),void setTimeout((function(){return t.display.input.focus()}),20);try{var S=e.dataTransfer.getData("Text");if(S){var T;if(t.state.draggingText&&!t.state.draggingText.copy&&(T=t.listSelections()),setSelectionNoUndo(t.doc,simpleSelection(r,r)),T)for(var O=0;O<T.length;++O)replaceRange(t.doc,"",T[O].anchor,T[O].head,"drag");t.replaceSelection(S,"around","paste"),t.display.input.focus()}}catch(e){}}}}function clearDragCursor(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function forEachCodeMirror(e){if(document.getElementsByClassName){for(var t=document.getElementsByClassName("CodeMirror"),r=[],a=0;a<t.length;a++){var s=t[a].CodeMirror;s&&r.push(s)}r.length&&r[0].operation((function(){for(var t=0;t<r.length;t++)e(r[t])}))}}var ke=!1;function ensureGlobalHandlers(){ke||(function registerGlobalHandlers(){var e;on(window,"resize",(function(){null==e&&(e=setTimeout((function(){e=null,forEachCodeMirror(onResize)}),100))})),on(window,"blur",(function(){return forEachCodeMirror(onBlur)}))}(),ke=!0)}function onResize(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize()}for(var Oe={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Ne=0;Ne<10;Ne++)Oe[Ne+48]=Oe[Ne+96]=String(Ne);for(var Pe=65;Pe<=90;Pe++)Oe[Pe]=String.fromCharCode(Pe);for(var Ae=1;Ae<=12;Ae++)Oe[Ae+111]=Oe[Ae+63235]="F"+Ae;var Le={};function normalizeKeyName(e){var t,r,a,s,l=e.split(/-(?!$)/);e=l[l.length-1];for(var y=0;y<l.length-1;y++){var w=l[y];if(/^(cmd|meta|m)$/i.test(w))s=!0;else if(/^a(lt)?$/i.test(w))t=!0;else if(/^(c|ctrl|control)$/i.test(w))r=!0;else{if(!/^s(hift)?$/i.test(w))throw new Error("Unrecognized modifier name: "+w);a=!0}}return t&&(e="Alt-"+e),r&&(e="Ctrl-"+e),s&&(e="Cmd-"+e),a&&(e="Shift-"+e),e}function normalizeKeyMap(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];if(/^(name|fallthrough|(de|at)tach)$/.test(r))continue;if("..."==a){delete e[r];continue}for(var s=map(r.split(" "),normalizeKeyName),l=0;l<s.length;l++){var y=void 0,w=void 0;l==s.length-1?(w=s.join(" "),y=a):(w=s.slice(0,l+1).join(" "),y="...");var E=t[w];if(E){if(E!=y)throw new Error("Inconsistent bindings for "+w)}else t[w]=y}delete e[r]}for(var S in t)e[S]=t[S];return e}function lookupKey(e,t,r,a){var s=(t=getKeyMap(t)).call?t.call(e,a):t[e];if(!1===s)return"nothing";if("..."===s)return"multi";if(null!=s&&r(s))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return lookupKey(e,t.fallthrough,r,a);for(var l=0;l<t.fallthrough.length;l++){var y=lookupKey(e,t.fallthrough[l],r,a);if(y)return y}}}function isModifierKey(e){var t="string"==typeof e?e:Oe[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function addModifierNames(e,t,r){var a=e;return t.altKey&&"Alt"!=a&&(e="Alt-"+e),(H?t.metaKey:t.ctrlKey)&&"Ctrl"!=a&&(e="Ctrl-"+e),(H?t.ctrlKey:t.metaKey)&&"Mod"!=a&&(e="Cmd-"+e),!r&&t.shiftKey&&"Shift"!=a&&(e="Shift-"+e),e}function keyName(e,t){if(O&&34==e.keyCode&&e.char)return!1;var r=Oe[e.keyCode];return null!=r&&!e.altGraphKey&&(3==e.keyCode&&e.code&&(r=e.code),addModifierNames(r,e,t))}function getKeyMap(e){return"string"==typeof e?Le[e]:e}function deleteNearSelection(e,t){for(var r=e.doc.sel.ranges,a=[],s=0;s<r.length;s++){for(var l=t(r[s]);a.length&&cmp(l.from,lst(a).to)<=0;){var y=a.pop();if(cmp(y.from,l.from)<0){l.from=y.from;break}}a.push(l)}runInOp(e,(function(){for(var t=a.length-1;t>=0;t--)replaceRange(e.doc,"",a[t].from,a[t].to,"+delete");ensureCursorVisible(e)}))}function moveCharLogically(e,t,r){var a=skipExtendingChars(e.text,t+r,r);return a<0||a>e.text.length?null:a}function moveLogically(e,t,r){var a=moveCharLogically(e,t.ch,r);return null==a?null:new Pos(t.line,a,r<0?"after":"before")}function endOfLine(e,t,r,a,s){if(e){"rtl"==t.doc.direction&&(s=-s);var l=getOrder(r,t.doc.direction);if(l){var y,w=s<0?lst(l):l[0],E=s<0==(1==w.level)?"after":"before";if(w.level>0||"rtl"==t.doc.direction){var S=prepareMeasureForLine(t,r);y=s<0?r.text.length-1:0;var T=measureCharPrepared(t,S,y).top;y=findFirst((function(e){return measureCharPrepared(t,S,e).top==T}),s<0==(1==w.level)?w.from:w.to-1,y),"before"==E&&(y=moveCharLogically(r,y,1))}else y=s<0?w.to:w.from;return new Pos(a,y,E)}}return new Pos(a,s<0?r.text.length:0,s<0?"before":"after")}Le.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Le.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Le.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Le.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Le.default=B?Le.macDefault:Le.pcDefault;var Re={selectAll:selectAll,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),G)},killLine:function(e){return deleteNearSelection(e,(function(t){if(t.empty()){var r=getLine(e.doc,t.head.line).text.length;return t.head.ch==r&&t.head.line<e.lastLine()?{from:t.head,to:Pos(t.head.line+1,0)}:{from:t.head,to:Pos(t.head.line,r)}}return{from:t.from(),to:t.to()}}))},deleteLine:function(e){return deleteNearSelection(e,(function(t){return{from:Pos(t.from().line,0),to:clipPos(e.doc,Pos(t.to().line+1,0))}}))},delLineLeft:function(e){return deleteNearSelection(e,(function(e){return{from:Pos(e.from().line,0),to:e.from()}}))},delWrappedLineLeft:function(e){return deleteNearSelection(e,(function(t){var r=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:r},"div"),to:t.from()}}))},delWrappedLineRight:function(e){return deleteNearSelection(e,(function(t){var r=e.charCoords(t.head,"div").top+5,a=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div");return{from:t.from(),to:a}}))},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(Pos(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(Pos(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy((function(t){return lineStart(e,t.head.line)}),{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy((function(t){return lineStartSmart(e,t.head)}),{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy((function(t){return function lineEnd(e,t){var r=getLine(e.doc,t),a=function visualLineEnd(e){for(var t;t=collapsedSpanAtEnd(e);)e=t.find(1,!0).line;return e}(r);return a!=r&&(t=lineNo(a)),endOfLine(!0,e,r,t,-1)}(e,t.head.line)}),{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy((function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div")}),$)},goLineLeft:function(e){return e.extendSelectionsBy((function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:r},"div")}),$)},goLineLeftSmart:function(e){return e.extendSelectionsBy((function(t){var r=e.cursorCoords(t.head,"div").top+5,a=e.coordsChar({left:0,top:r},"div");return a.ch<e.getLine(a.line).search(/\S/)?lineStartSmart(e,t.head):a}),$)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"codepoint")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],r=e.listSelections(),a=e.options.tabSize,s=0;s<r.length;s++){var l=r[s].from(),y=countColumn(e.getLine(l.line),l.ch,a);t.push(spaceStr(a-y%a))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return runInOp(e,(function(){for(var t=e.listSelections(),r=[],a=0;a<t.length;a++)if(t[a].empty()){var s=t[a].head,l=getLine(e.doc,s.line).text;if(l)if(s.ch==l.length&&(s=new Pos(s.line,s.ch-1)),s.ch>0)s=new Pos(s.line,s.ch+1),e.replaceRange(l.charAt(s.ch-1)+l.charAt(s.ch-2),Pos(s.line,s.ch-2),s,"+transpose");else if(s.line>e.doc.first){var y=getLine(e.doc,s.line-1).text;y&&(s=new Pos(s.line,1),e.replaceRange(l.charAt(0)+e.doc.lineSeparator()+y.charAt(y.length-1),Pos(s.line-1,y.length-1),s,"+transpose"))}r.push(new Range(s,s))}e.setSelections(r)}))},newlineAndIndent:function(e){return runInOp(e,(function(){for(var t=e.listSelections(),r=t.length-1;r>=0;r--)e.replaceRange(e.doc.lineSeparator(),t[r].anchor,t[r].head,"+input");t=e.listSelections();for(var a=0;a<t.length;a++)e.indentLine(t[a].from().line,null,!0);ensureCursorVisible(e)}))},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}};function lineStart(e,t){var r=getLine(e.doc,t),a=visualLine(r);return a!=r&&(t=lineNo(a)),endOfLine(!0,e,a,t,1)}function lineStartSmart(e,t){var r=lineStart(e,t.line),a=getLine(e.doc,r.line),s=getOrder(a,e.doc.direction);if(!s||0==s[0].level){var l=Math.max(r.ch,a.text.search(/\S/)),y=t.line==r.line&&t.ch<=l&&t.ch;return Pos(r.line,y?0:l,r.sticky)}return r}function doHandleBinding(e,t,r){if("string"==typeof t&&!(t=Re[t]))return!1;e.display.input.ensurePolled();var a=e.display.shift,s=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),r&&(e.display.shift=!1),s=t(e)!=U}finally{e.display.shift=a,e.state.suppressEdits=!1}return s}var Ie=new Delayed;function dispatchKey(e,t,r,a){var s=e.state.keySeq;if(s){if(isModifierKey(t))return"handled";if(/\'$/.test(t)?e.state.keySeq=null:Ie.set(50,(function(){e.state.keySeq==s&&(e.state.keySeq=null,e.display.input.reset())})),dispatchKeyInner(e,s+" "+t,r,a))return!0}return dispatchKeyInner(e,t,r,a)}function dispatchKeyInner(e,t,r,a){var s=function lookupKeyForEditor(e,t,r){for(var a=0;a<e.state.keyMaps.length;a++){var s=lookupKey(t,e.state.keyMaps[a],r,e);if(s)return s}return e.options.extraKeys&&lookupKey(t,e.options.extraKeys,r,e)||lookupKey(t,e.options.keyMap,r,e)}(e,t,a);return"multi"==s&&(e.state.keySeq=t),"handled"==s&&signalLater(e,"keyHandled",e,t,r),"handled"!=s&&"multi"!=s||(e_preventDefault(r),restartBlink(e)),!!s}function handleKeyBinding(e,t){var r=keyName(t,!0);return!!r&&(t.shiftKey&&!e.state.keySeq?dispatchKey(e,"Shift-"+r,t,(function(t){return doHandleBinding(e,t,!0)}))||dispatchKey(e,r,t,(function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return doHandleBinding(e,t)})):dispatchKey(e,r,t,(function(t){return doHandleBinding(e,t)})))}var De=null;function onKeyDown(e){var t=this;if(!(e.target&&e.target!=t.display.input.getField()||(t.curOp.focus=activeElt(),signalDOMEvent(t,e)))){y&&w<11&&27==e.keyCode&&(e.returnValue=!1);var a=e.keyCode;t.display.shift=16==a||e.shiftKey;var s=handleKeyBinding(t,e);O&&(De=s?a:null,!s&&88==a&&!se&&(B?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),r&&!B&&!s&&46==a&&e.shiftKey&&!e.ctrlKey&&document.execCommand&&document.execCommand("cut"),18!=a||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||function showCrossHair(e){var t=e.display.lineDiv;function up(e){18!=e.keyCode&&e.altKey||(rmClass(t,"CodeMirror-crosshair"),off(document,"keyup",up),off(document,"mouseover",up))}addClass(t,"CodeMirror-crosshair"),on(document,"keyup",up),on(document,"mouseover",up)}(t)}}function onKeyUp(e){16==e.keyCode&&(this.doc.sel.shift=!1),signalDOMEvent(this,e)}function onKeyPress(e){var t=this;if(!(e.target&&e.target!=t.display.input.getField()||eventInWidget(t.display,e)||signalDOMEvent(t,e)||e.ctrlKey&&!e.altKey||B&&e.metaKey)){var r=e.keyCode,a=e.charCode;if(O&&r==De)return De=null,void e_preventDefault(e);if(!O||e.which&&!(e.which<10)||!handleKeyBinding(t,e)){var s=String.fromCharCode(null==a?r:a);"\b"!=s&&(function handleCharBinding(e,t,r){return dispatchKey(e,"'"+r+"'",t,(function(t){return doHandleBinding(e,t,!0)}))}(t,e,s)||t.display.input.onKeyPress(e))}}}var Me,Be,PastClick=function(e,t,r){this.time=e,this.pos=t,this.button=r};function onMouseDown(e){var t=this,r=t.display;if(!(signalDOMEvent(t,e)||r.activeTouch&&r.input.supportsTouch()))if(r.input.ensurePolled(),r.shift=e.shiftKey,eventInWidget(r,e))E||(r.scroller.draggable=!1,setTimeout((function(){return r.scroller.draggable=!0}),100));else if(!clickInGutter(t,e)){var a=posFromMouse(t,e),s=e_button(e),l=a?function clickRepeat(e,t){var r=+new Date;return Be&&Be.compare(r,e,t)?(Me=Be=null,"triple"):Me&&Me.compare(r,e,t)?(Be=new PastClick(r,e,t),Me=null,"double"):(Me=new PastClick(r,e,t),Be=null,"single")}(a,s):"single";window.focus(),1==s&&t.state.selectingText&&t.state.selectingText(e),a&&function handleMappedButton(e,t,r,a,s){var l="Click";return"double"==a?l="Double"+l:"triple"==a&&(l="Triple"+l),dispatchKey(e,addModifierNames(l=(1==t?"Left":2==t?"Middle":"Right")+l,s),s,(function(t){if("string"==typeof t&&(t=Re[t]),!t)return!1;var a=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),a=t(e,r)!=U}finally{e.state.suppressEdits=!1}return a}))}(t,s,a,l,e)||(1==s?a?function leftButtonDown(e,t,r,a){y?setTimeout(bind(ensureFocus,e),0):e.curOp.focus=activeElt();var s,l=function configureMouse(e,t,r){var a=e.getOption("configureMouse"),s=a?a(e,t,r):{};if(null==s.unit){var l=q?r.shiftKey&&r.metaKey:r.altKey;s.unit=l?"rectangle":"single"==t?"char":"double"==t?"word":"line"}return(null==s.extend||e.doc.extend)&&(s.extend=e.doc.extend||r.shiftKey),null==s.addNew&&(s.addNew=B?r.metaKey:r.ctrlKey),null==s.moveOnDrag&&(s.moveOnDrag=!(B?r.altKey:r.ctrlKey)),s}(e,r,a),S=e.doc.sel;e.options.dragDrop&&re&&!e.isReadOnly()&&"single"==r&&(s=S.contains(t))>-1&&(cmp((s=S.ranges[s]).from(),t)<0||t.xRel>0)&&(cmp(s.to(),t)>0||t.xRel<0)?function leftButtonStartDrag(e,t,r,a){var s=e.display,l=!1,S=operation(e,(function(t){E&&(s.scroller.draggable=!1),e.state.draggingText=!1,e.state.delayingBlurEvent&&(e.hasFocus()?e.state.delayingBlurEvent=!1:delayBlurEvent(e)),off(s.wrapper.ownerDocument,"mouseup",S),off(s.wrapper.ownerDocument,"mousemove",mouseMove),off(s.scroller,"dragstart",dragStart),off(s.scroller,"drop",S),l||(e_preventDefault(t),a.addNew||extendSelection(e.doc,r,null,null,a.extend),E&&!N||y&&9==w?setTimeout((function(){s.wrapper.ownerDocument.body.focus({preventScroll:!0}),s.input.focus()}),20):s.input.focus())})),mouseMove=function(e){l=l||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},dragStart=function(){return l=!0};E&&(s.scroller.draggable=!0),e.state.draggingText=S,S.copy=!a.moveOnDrag,on(s.wrapper.ownerDocument,"mouseup",S),on(s.wrapper.ownerDocument,"mousemove",mouseMove),on(s.scroller,"dragstart",dragStart),on(s.scroller,"drop",S),e.state.delayingBlurEvent=!0,setTimeout((function(){return s.input.focus()}),20),s.scroller.dragDrop&&s.scroller.dragDrop()}(e,a,t,l):function leftButtonSelect(e,t,r,a){y&&delayBlurEvent(e);var s=e.display,l=e.doc;e_preventDefault(t);var w,E,S=l.sel,T=S.ranges;if(a.addNew&&!a.extend?(E=l.sel.contains(r),w=E>-1?T[E]:new Range(r,r)):(w=l.sel.primary(),E=l.sel.primIndex),"rectangle"==a.unit)a.addNew||(w=new Range(r,r)),r=posFromMouse(e,t,!0,!0),E=-1;else{var O=rangeForUnit(e,r,a.unit);w=a.extend?extendRange(w,O.anchor,O.head,a.extend):O}a.addNew?-1==E?(E=T.length,setSelection(l,normalizeSelection(e,T.concat([w]),E),{scroll:!1,origin:"*mouse"})):T.length>1&&T[E].empty()&&"char"==a.unit&&!a.extend?(setSelection(l,normalizeSelection(e,T.slice(0,E).concat(T.slice(E+1)),0),{scroll:!1,origin:"*mouse"}),S=l.sel):replaceOneSelection(l,E,w,K):(E=0,setSelection(l,new Selection([w],0),K),S=l.sel);var N=r;function extendTo(t){if(0!=cmp(N,t))if(N=t,"rectangle"==a.unit){for(var s=[],y=e.options.tabSize,T=countColumn(getLine(l,r.line).text,r.ch,y),O=countColumn(getLine(l,t.line).text,t.ch,y),A=Math.min(T,O),L=Math.max(T,O),R=Math.min(r.line,t.line),D=Math.min(e.lastLine(),Math.max(r.line,t.line));R<=D;R++){var M=getLine(l,R).text,B=findColumn(M,A,y);A==L?s.push(new Range(Pos(R,B),Pos(R,B))):M.length>B&&s.push(new Range(Pos(R,B),Pos(R,findColumn(M,L,y))))}s.length||s.push(new Range(r,r)),setSelection(l,normalizeSelection(e,S.ranges.slice(0,E).concat(s),E),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var q,W=w,j=rangeForUnit(e,t,a.unit),H=W.anchor;cmp(j.anchor,H)>0?(q=j.head,H=minPos(W.from(),j.anchor)):(q=j.anchor,H=maxPos(W.to(),j.head));var V=S.ranges.slice(0);V[E]=function bidiSimplify(e,t){var r=t.anchor,a=t.head,s=getLine(e.doc,r.line);if(0==cmp(r,a)&&r.sticky==a.sticky)return t;var l=getOrder(s);if(!l)return t;var y=getBidiPartAt(l,r.ch,r.sticky),w=l[y];if(w.from!=r.ch&&w.to!=r.ch)return t;var E,S=y+(w.from==r.ch==(1!=w.level)?0:1);if(0==S||S==l.length)return t;if(a.line!=r.line)E=(a.line-r.line)*("ltr"==e.doc.direction?1:-1)>0;else{var T=getBidiPartAt(l,a.ch,a.sticky),O=T-y||(a.ch-r.ch)*(1==w.level?-1:1);E=T==S-1||T==S?O<0:O>0}var N=l[S+(E?-1:0)],A=E==(1==N.level),L=A?N.from:N.to,R=A?"after":"before";return r.ch==L&&r.sticky==R?t:new Range(new Pos(r.line,L,R),a)}(e,new Range(clipPos(l,H),q)),setSelection(l,normalizeSelection(e,V,E),K)}}var A=s.wrapper.getBoundingClientRect(),L=0;function done(t){e.state.selectingText=!1,L=1/0,t&&(e_preventDefault(t),s.input.focus()),off(s.wrapper.ownerDocument,"mousemove",R),off(s.wrapper.ownerDocument,"mouseup",D),l.history.lastSelOrigin=null}var R=operation(e,(function(t){0!==t.buttons&&e_button(t)?function extend(t){var r=++L,y=posFromMouse(e,t,!0,"rectangle"==a.unit);if(y)if(0!=cmp(y,N)){e.curOp.focus=activeElt(),extendTo(y);var w=visibleLines(s,l);(y.line>=w.to||y.line<w.from)&&setTimeout(operation(e,(function(){L==r&&extend(t)})),150)}else{var E=t.clientY<A.top?-20:t.clientY>A.bottom?20:0;E&&setTimeout(operation(e,(function(){L==r&&(s.scroller.scrollTop+=E,extend(t))})),50)}}(t):done(t)})),D=operation(e,done);e.state.selectingText=D,on(s.wrapper.ownerDocument,"mousemove",R),on(s.wrapper.ownerDocument,"mouseup",D)}(e,a,t,l)}(t,a,l,e):e_target(e)==r.scroller&&e_preventDefault(e):2==s?(a&&extendSelection(t.doc,a),setTimeout((function(){return r.input.focus()}),20)):3==s&&(V?t.display.input.onContextMenu(e):delayBlurEvent(t)))}}function rangeForUnit(e,t,r){if("char"==r)return new Range(t,t);if("word"==r)return e.findWordAt(t);if("line"==r)return new Range(Pos(t.line,0),clipPos(e.doc,Pos(t.line+1,0)));var a=r(e,t);return new Range(a.from,a.to)}function gutterEvent(e,t,r,a){var s,l;if(t.touches)s=t.touches[0].clientX,l=t.touches[0].clientY;else try{s=t.clientX,l=t.clientY}catch(e){return!1}if(s>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;a&&e_preventDefault(t);var y=e.display,w=y.lineDiv.getBoundingClientRect();if(l>w.bottom||!hasHandler(e,r))return e_defaultPrevented(t);l-=w.top-y.viewOffset;for(var E=0;E<e.display.gutterSpecs.length;++E){var S=y.gutters.childNodes[E];if(S&&S.getBoundingClientRect().right>=s)return signal(e,r,e,lineAtHeight(e.doc,l),e.display.gutterSpecs[E].className,t),e_defaultPrevented(t)}}function clickInGutter(e,t){return gutterEvent(e,t,"gutterClick",!0)}function onContextMenu(e,t){eventInWidget(e.display,t)||function contextMenuInGutter(e,t){return!!hasHandler(e,"gutterContextMenu")&&gutterEvent(e,t,"gutterContextMenu",!1)}(e,t)||signalDOMEvent(e,t,"contextmenu")||V||e.display.input.onContextMenu(t)}function themeChanged(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),clearCaches(e)}PastClick.prototype.compare=function(e,t,r){return this.time+400>e&&0==cmp(t,this.pos)&&r==this.button};var qe={toString:function(){return"CodeMirror.Init"}},Fe={},We={};function dragDropChanged(e,t,r){if(!t!=!(r&&r!=qe)){var a=e.display.dragFunctions,s=t?on:off;s(e.display.scroller,"dragstart",a.start),s(e.display.scroller,"dragenter",a.enter),s(e.display.scroller,"dragover",a.over),s(e.display.scroller,"dragleave",a.leave),s(e.display.scroller,"drop",a.drop)}}function wrappingChanged(e){e.options.lineWrapping?(addClass(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(rmClass(e.display.wrapper,"CodeMirror-wrap"),findMaxLine(e)),estimateLineHeights(e),regChange(e),clearCaches(e),setTimeout((function(){return updateScrollbars(e)}),100)}function CodeMirror(e,t){var r=this;if(!(this instanceof CodeMirror))return new CodeMirror(e,t);this.options=t=t?copyObj(t):{},copyObj(Fe,t,!1);var a=t.value;"string"==typeof a?a=new Doc(a,t.mode,null,t.lineSeparator,t.direction):t.mode&&(a.modeOption=t.mode),this.doc=a;var s=new CodeMirror.inputStyles[t.inputStyle](this),l=this.display=new Display(e,a,s,t);for(var S in l.wrapper.CodeMirror=this,themeChanged(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),initScrollbars(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new Delayed,keySeq:null,specialChars:null},t.autofocus&&!M&&l.input.focus(),y&&w<11&&setTimeout((function(){return r.display.input.reset(!0)}),20),function registerEventHandlers(e){var t=e.display;on(t.scroller,"mousedown",operation(e,onMouseDown)),on(t.scroller,"dblclick",y&&w<11?operation(e,(function(t){if(!signalDOMEvent(e,t)){var r=posFromMouse(e,t);if(r&&!clickInGutter(e,t)&&!eventInWidget(e.display,t)){e_preventDefault(t);var a=e.findWordAt(r);extendSelection(e.doc,a.anchor,a.head)}}})):function(t){return signalDOMEvent(e,t)||e_preventDefault(t)}),on(t.scroller,"contextmenu",(function(t){return onContextMenu(e,t)})),on(t.input.getField(),"contextmenu",(function(r){t.scroller.contains(r.target)||onContextMenu(e,r)}));var r,a={end:0};function finishTouch(){t.activeTouch&&(r=setTimeout((function(){return t.activeTouch=null}),1e3),(a=t.activeTouch).end=+new Date)}function farAway(e,t){if(null==t.left)return!0;var r=t.left-e.left,a=t.top-e.top;return r*r+a*a>400}on(t.scroller,"touchstart",(function(s){if(!signalDOMEvent(e,s)&&!function isMouseLikeTouchEvent(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}(s)&&!clickInGutter(e,s)){t.input.ensurePolled(),clearTimeout(r);var l=+new Date;t.activeTouch={start:l,moved:!1,prev:l-a.end<=300?a:null},1==s.touches.length&&(t.activeTouch.left=s.touches[0].pageX,t.activeTouch.top=s.touches[0].pageY)}})),on(t.scroller,"touchmove",(function(){t.activeTouch&&(t.activeTouch.moved=!0)})),on(t.scroller,"touchend",(function(r){var a=t.activeTouch;if(a&&!eventInWidget(t,r)&&null!=a.left&&!a.moved&&new Date-a.start<300){var s,l=e.coordsChar(t.activeTouch,"page");s=!a.prev||farAway(a,a.prev)?new Range(l,l):!a.prev.prev||farAway(a,a.prev.prev)?e.findWordAt(l):new Range(Pos(l.line,0),clipPos(e.doc,Pos(l.line+1,0))),e.setSelection(s.anchor,s.head),e.focus(),e_preventDefault(r)}finishTouch()})),on(t.scroller,"touchcancel",finishTouch),on(t.scroller,"scroll",(function(){t.scroller.clientHeight&&(updateScrollTop(e,t.scroller.scrollTop),setScrollLeft(e,t.scroller.scrollLeft,!0),signal(e,"scroll",e))})),on(t.scroller,"mousewheel",(function(t){return onScrollWheel(e,t)})),on(t.scroller,"DOMMouseScroll",(function(t){return onScrollWheel(e,t)})),on(t.wrapper,"scroll",(function(){return t.wrapper.scrollTop=t.wrapper.scrollLeft=0})),t.dragFunctions={enter:function(t){signalDOMEvent(e,t)||e_stop(t)},over:function(t){signalDOMEvent(e,t)||(function onDragOver(e,t){var r=posFromMouse(e,t);if(r){var a=document.createDocumentFragment();drawSelectionCursor(e,r,a),e.display.dragCursor||(e.display.dragCursor=elt("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),removeChildrenAndAdd(e.display.dragCursor,a)}}(e,t),e_stop(t))},start:function(t){return function onDragStart(e,t){if(y&&(!e.state.draggingText||+new Date-Te<100))e_stop(t);else if(!signalDOMEvent(e,t)&&!eventInWidget(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!N)){var r=elt("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",O&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),O&&r.parentNode.removeChild(r)}}(e,t)},drop:operation(e,onDrop),leave:function(t){signalDOMEvent(e,t)||clearDragCursor(e)}};var s=t.input.getField();on(s,"keyup",(function(t){return onKeyUp.call(e,t)})),on(s,"keydown",operation(e,onKeyDown)),on(s,"keypress",operation(e,onKeyPress)),on(s,"focus",(function(t){return onFocus(e,t)})),on(s,"blur",(function(t){return onBlur(e,t)}))}(this),ensureGlobalHandlers(),startOperation(this),this.curOp.forceUpdate=!0,attachDoc(this,a),t.autofocus&&!M||this.hasFocus()?setTimeout((function(){r.hasFocus()&&!r.state.focused&&onFocus(r)}),20):onBlur(this),We)We.hasOwnProperty(S)&&We[S](this,t[S],qe);maybeUpdateLineNumberWidth(this),t.finishInit&&t.finishInit(this);for(var T=0;T<je.length;++T)je[T](this);endOperation(this),E&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(l.lineDiv).textRendering&&(l.lineDiv.style.textRendering="auto")}CodeMirror.defaults=Fe,CodeMirror.optionHandlers=We;var je=[];function indentLine(e,t,r,a){var s,l=e.doc;null==r&&(r="add"),"smart"==r&&(l.mode.indent?s=getContextBefore(e,t).state:r="prev");var y=e.options.tabSize,w=getLine(l,t),E=countColumn(w.text,null,y);w.stateAfter&&(w.stateAfter=null);var S,T=w.text.match(/^\s*/)[0];if(a||/\S/.test(w.text)){if("smart"==r&&((S=l.mode.indent(s,w.text.slice(T.length),w.text))==U||S>150)){if(!a)return;r="prev"}}else S=0,r="not";"prev"==r?S=t>l.first?countColumn(getLine(l,t-1).text,null,y):0:"add"==r?S=E+e.options.indentUnit:"subtract"==r?S=E-e.options.indentUnit:"number"==typeof r&&(S=E+r),S=Math.max(0,S);var O="",N=0;if(e.options.indentWithTabs)for(var A=Math.floor(S/y);A;--A)N+=y,O+="\t";if(N<S&&(O+=spaceStr(S-N)),O!=T)return replaceRange(l,O,Pos(t,0),Pos(t,T.length),"+input"),w.stateAfter=null,!0;for(var L=0;L<l.sel.ranges.length;L++){var R=l.sel.ranges[L];if(R.head.line==t&&R.head.ch<T.length){var D=Pos(t,T.length);replaceOneSelection(l,L,new Range(D,D));break}}}CodeMirror.defineInitHook=function(e){return je.push(e)};var He=null;function setLastCopied(e){He=e}function applyTextInput(e,t,r,a,s){var l=e.doc;e.display.shift=!1,a||(a=l.sel);var y=+new Date-200,w="paste"==s||e.state.pasteIncoming>y,E=oe(t),S=null;if(w&&a.ranges.length>1)if(He&&He.text.join("\n")==t){if(a.ranges.length%He.text.length==0){S=[];for(var T=0;T<He.text.length;T++)S.push(l.splitLines(He.text[T]))}}else E.length==a.ranges.length&&e.options.pasteLinesPerSelection&&(S=map(E,(function(e){return[e]})));for(var O=e.curOp.updateInput,N=a.ranges.length-1;N>=0;N--){var A=a.ranges[N],L=A.from(),R=A.to();A.empty()&&(r&&r>0?L=Pos(L.line,L.ch-r):e.state.overwrite&&!w?R=Pos(R.line,Math.min(getLine(l,R.line).text.length,R.ch+lst(E).length)):w&&He&&He.lineWise&&He.text.join("\n")==E.join("\n")&&(L=R=Pos(L.line,0)));var D={from:L,to:R,text:S?S[N%S.length]:E,origin:s||(w?"paste":e.state.cutIncoming>y?"cut":"+input")};makeChange(e.doc,D),signalLater(e,"inputRead",e,D)}t&&!w&&triggerElectric(e,t),ensureCursorVisible(e),e.curOp.updateInput<2&&(e.curOp.updateInput=O),e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=-1}function handlePaste(e,t){var r=e.clipboardData&&e.clipboardData.getData("Text");if(r)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||runInOp(t,(function(){return applyTextInput(t,r,0,null,"paste")})),!0}function triggerElectric(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var r=e.doc.sel,a=r.ranges.length-1;a>=0;a--){var s=r.ranges[a];if(!(s.head.ch>100||a&&r.ranges[a-1].head.line==s.head.line)){var l=e.getModeAt(s.head),y=!1;if(l.electricChars){for(var w=0;w<l.electricChars.length;w++)if(t.indexOf(l.electricChars.charAt(w))>-1){y=indentLine(e,s.head.line,"smart");break}}else l.electricInput&&l.electricInput.test(getLine(e.doc,s.head.line).text.slice(0,s.head.ch))&&(y=indentLine(e,s.head.line,"smart"));y&&signalLater(e,"electricInput",e,s.head.line)}}}function copyableRanges(e){for(var t=[],r=[],a=0;a<e.doc.sel.ranges.length;a++){var s=e.doc.sel.ranges[a].head.line,l={anchor:Pos(s,0),head:Pos(s+1,0)};r.push(l),t.push(e.getRange(l.anchor,l.head))}return{text:t,ranges:r}}function disableBrowserMagic(e,t,r,a){e.setAttribute("autocorrect",r?"":"off"),e.setAttribute("autocapitalize",a?"":"off"),e.setAttribute("spellcheck",!!t)}function hiddenTextarea(){var e=elt("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=elt("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return E?e.style.width="1000px":e.setAttribute("wrap","off"),R&&(e.style.border="1px solid black"),disableBrowserMagic(e),t}function findPosH(e,t,r,a,s){var l=t,y=r,w=getLine(e,t.line),E=s&&"rtl"==e.direction?-r:r;function moveOnce(l){var y;if("codepoint"==a){var S=w.text.charCodeAt(t.ch+(r>0?0:-1));if(isNaN(S))y=null;else{var T=r>0?S>=55296&&S<56320:S>=56320&&S<57343;y=new Pos(t.line,Math.max(0,Math.min(w.text.length,t.ch+r*(T?2:1))),-r)}}else y=s?function moveVisually(e,t,r,a){var s=getOrder(t,e.doc.direction);if(!s)return moveLogically(t,r,a);r.ch>=t.text.length?(r.ch=t.text.length,r.sticky="before"):r.ch<=0&&(r.ch=0,r.sticky="after");var l=getBidiPartAt(s,r.ch,r.sticky),y=s[l];if("ltr"==e.doc.direction&&y.level%2==0&&(a>0?y.to>r.ch:y.from<r.ch))return moveLogically(t,r,a);var w,mv=function(e,r){return moveCharLogically(t,e instanceof Pos?e.ch:e,r)},getWrappedLineExtent=function(r){return e.options.lineWrapping?(w=w||prepareMeasureForLine(e,t),wrappedLineExtentChar(e,t,w,r)):{begin:0,end:t.text.length}},E=getWrappedLineExtent("before"==r.sticky?mv(r,-1):r.ch);if("rtl"==e.doc.direction||1==y.level){var S=1==y.level==a<0,T=mv(r,S?1:-1);if(null!=T&&(S?T<=y.to&&T<=E.end:T>=y.from&&T>=E.begin)){var O=S?"before":"after";return new Pos(r.line,T,O)}}var searchInVisualLine=function(e,t,a){for(var getRes=function(e,t){return t?new Pos(r.line,mv(e,1),"before"):new Pos(r.line,e,"after")};e>=0&&e<s.length;e+=t){var l=s[e],y=t>0==(1!=l.level),w=y?a.begin:mv(a.end,-1);if(l.from<=w&&w<l.to)return getRes(w,y);if(w=y?l.from:mv(l.to,-1),a.begin<=w&&w<a.end)return getRes(w,y)}},N=searchInVisualLine(l+a,a,E);if(N)return N;var A=a>0?E.end:mv(E.begin,-1);return null==A||a>0&&A==t.text.length||!(N=searchInVisualLine(a>0?0:s.length-1,a,getWrappedLineExtent(A)))?null:N}(e.cm,w,t,r):moveLogically(w,t,r);if(null==y){if(l||!function findNextLine(){var r=t.line+E;return!(r<e.first||r>=e.first+e.size)&&(t=new Pos(r,t.ch,t.sticky),w=getLine(e,r))}())return!1;t=endOfLine(s,e.cm,w,t.line,E)}else t=y;return!0}if("char"==a||"codepoint"==a)moveOnce();else if("column"==a)moveOnce(!0);else if("word"==a||"group"==a)for(var S=null,T="group"==a,O=e.cm&&e.cm.getHelper(t,"wordChars"),N=!0;!(r<0)||moveOnce(!N);N=!1){var A=w.text.charAt(t.ch)||"\n",L=isWordChar(A,O)?"w":T&&"\n"==A?"n":!T||/\s/.test(A)?null:"p";if(!T||N||L||(L="s"),S&&S!=L){r<0&&(r=1,moveOnce(),t.sticky="after");break}if(L&&(S=L),r>0&&!moveOnce(!N))break}var R=skipAtomic(e,t,l,y,!0);return equalCursorPos(l,R)&&(R.hitSide=!0),R}function findPosV(e,t,r,a){var s,l,y=e.doc,w=t.left;if("page"==a){var E=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),S=Math.max(E-.5*textHeight(e.display),3);s=(r>0?t.bottom:t.top)+r*S}else"line"==a&&(s=r>0?t.bottom+3:t.top-3);for(;(l=coordsChar(e,w,s)).outside;){if(r<0?s<=0:s>=y.height){l.hitSide=!0;break}s+=5*r}return l}var ContentEditableInput=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Delayed,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};function posToDOM(e,t){var r=findViewForLine(e,t.line);if(!r||r.hidden)return null;var a=getLine(e.doc,t.line),s=mapFromLineView(r,a,t.line),l=getOrder(a,e.doc.direction),y="left";l&&(y=getBidiPartAt(l,t.ch)%2?"right":"left");var w=nodeAndOffsetInLineMap(s.map,t.ch,y);return w.offset="right"==w.collapse?w.end:w.start,w}function badPos(e,t){return t&&(e.bad=!0),e}function domToPos(e,t,r){var a;if(t==e.display.lineDiv){if(!(a=e.display.lineDiv.childNodes[r]))return badPos(e.clipPos(Pos(e.display.viewTo-1)),!0);t=null,r=0}else for(a=t;;a=a.parentNode){if(!a||a==e.display.lineDiv)return null;if(a.parentNode&&a.parentNode==e.display.lineDiv)break}for(var s=0;s<e.display.view.length;s++){var l=e.display.view[s];if(l.node==a)return locateNodeInLineView(l,t,r)}}function locateNodeInLineView(e,t,r){var a=e.text.firstChild,s=!1;if(!t||!contains(a,t))return badPos(Pos(lineNo(e.line),0),!0);if(t==a&&(s=!0,t=a.childNodes[r],r=0,!t)){var l=e.rest?lst(e.rest):e.line;return badPos(Pos(lineNo(l),l.text.length),s)}var y=3==t.nodeType?t:null,w=t;for(y||1!=t.childNodes.length||3!=t.firstChild.nodeType||(y=t.firstChild,r&&(r=y.nodeValue.length));w.parentNode!=a;)w=w.parentNode;var E=e.measure,S=E.maps;function find(t,r,a){for(var s=-1;s<(S?S.length:0);s++)for(var l=s<0?E.map:S[s],y=0;y<l.length;y+=3){var w=l[y+2];if(w==t||w==r){var T=lineNo(s<0?e.line:e.rest[s]),O=l[y]+a;return(a<0||w!=t)&&(O=l[y+(a?1:0)]),Pos(T,O)}}}var T=find(y,w,r);if(T)return badPos(T,s);for(var O=w.nextSibling,N=y?y.nodeValue.length-r:0;O;O=O.nextSibling){if(T=find(O,O.firstChild,0))return badPos(Pos(T.line,T.ch-N),s);N+=O.textContent.length}for(var A=w.previousSibling,L=r;A;A=A.previousSibling){if(T=find(A,A.firstChild,-1))return badPos(Pos(T.line,T.ch+L),s);L+=A.textContent.length}}ContentEditableInput.prototype.init=function(e){var t=this,r=this,a=r.cm,s=r.div=e.lineDiv;function belongsToInput(e){for(var t=e.target;t;t=t.parentNode){if(t==s)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(t.className))break}return!1}function onCopyCut(e){if(belongsToInput(e)&&!signalDOMEvent(a,e)){if(a.somethingSelected())setLastCopied({lineWise:!1,text:a.getSelections()}),"cut"==e.type&&a.replaceSelection("",null,"cut");else{if(!a.options.lineWiseCopyCut)return;var t=copyableRanges(a);setLastCopied({lineWise:!0,text:t.text}),"cut"==e.type&&a.operation((function(){a.setSelections(t.ranges,0,G),a.replaceSelection("",null,"cut")}))}if(e.clipboardData){e.clipboardData.clearData();var l=He.text.join("\n");if(e.clipboardData.setData("Text",l),e.clipboardData.getData("Text")==l)return void e.preventDefault()}var y=hiddenTextarea(),w=y.firstChild;a.display.lineSpace.insertBefore(y,a.display.lineSpace.firstChild),w.value=He.text.join("\n");var E=activeElt();selectInput(w),setTimeout((function(){a.display.lineSpace.removeChild(y),E.focus(),E==s&&r.showPrimarySelection()}),50)}}s.contentEditable=!0,disableBrowserMagic(s,a.options.spellcheck,a.options.autocorrect,a.options.autocapitalize),on(s,"paste",(function(e){!belongsToInput(e)||signalDOMEvent(a,e)||handlePaste(e,a)||w<=11&&setTimeout(operation(a,(function(){return t.updateFromDOM()})),20)})),on(s,"compositionstart",(function(e){t.composing={data:e.data,done:!1}})),on(s,"compositionupdate",(function(e){t.composing||(t.composing={data:e.data,done:!1})})),on(s,"compositionend",(function(e){t.composing&&(e.data!=t.composing.data&&t.readFromDOMSoon(),t.composing.done=!0)})),on(s,"touchstart",(function(){return r.forceCompositionEnd()})),on(s,"input",(function(){t.composing||t.readFromDOMSoon()})),on(s,"copy",onCopyCut),on(s,"cut",onCopyCut)},ContentEditableInput.prototype.screenReaderLabelChanged=function(e){e?this.div.setAttribute("aria-label",e):this.div.removeAttribute("aria-label")},ContentEditableInput.prototype.prepareSelection=function(){var e=prepareSelection(this.cm,!1);return e.focus=activeElt()==this.div,e},ContentEditableInput.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},ContentEditableInput.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},ContentEditableInput.prototype.showPrimarySelection=function(){var e=this.getSelection(),t=this.cm,a=t.doc.sel.primary(),s=a.from(),l=a.to();if(t.display.viewTo==t.display.viewFrom||s.line>=t.display.viewTo||l.line<t.display.viewFrom)e.removeAllRanges();else{var y=domToPos(t,e.anchorNode,e.anchorOffset),w=domToPos(t,e.focusNode,e.focusOffset);if(!y||y.bad||!w||w.bad||0!=cmp(minPos(y,w),s)||0!=cmp(maxPos(y,w),l)){var E=t.display.view,S=s.line>=t.display.viewFrom&&posToDOM(t,s)||{node:E[0].measure.map[2],offset:0},T=l.line<t.display.viewTo&&posToDOM(t,l);if(!T){var O=E[E.length-1].measure,N=O.maps?O.maps[O.maps.length-1]:O.map;T={node:N[N.length-1],offset:N[N.length-2]-N[N.length-3]}}if(S&&T){var A,L=e.rangeCount&&e.getRangeAt(0);try{A=z(S.node,S.offset,T.offset,T.node)}catch(e){}A&&(!r&&t.state.focused?(e.collapse(S.node,S.offset),A.collapsed||(e.removeAllRanges(),e.addRange(A))):(e.removeAllRanges(),e.addRange(A)),L&&null==e.anchorNode?e.addRange(L):r&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},ContentEditableInput.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout((function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation((function(){return e.cm.curOp.selectionChanged=!0}))}),20)},ContentEditableInput.prototype.showMultipleSelections=function(e){removeChildrenAndAdd(this.cm.display.cursorDiv,e.cursors),removeChildrenAndAdd(this.cm.display.selectionDiv,e.selection)},ContentEditableInput.prototype.rememberSelection=function(){var e=this.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},ContentEditableInput.prototype.selectionInEditor=function(){var e=this.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return contains(this.div,t)},ContentEditableInput.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()&&activeElt()==this.div||this.showSelection(this.prepareSelection(),!0),this.div.focus())},ContentEditableInput.prototype.blur=function(){this.div.blur()},ContentEditableInput.prototype.getField=function(){return this.div},ContentEditableInput.prototype.supportsTouch=function(){return!0},ContentEditableInput.prototype.receivedFocus=function(){var e=this;this.selectionInEditor()?this.pollSelection():runInOp(this.cm,(function(){return e.cm.curOp.selectionChanged=!0})),this.polling.set(this.cm.options.pollInterval,(function poll(){e.cm.state.focused&&(e.pollSelection(),e.polling.set(e.cm.options.pollInterval,poll))}))},ContentEditableInput.prototype.selectionChanged=function(){var e=this.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},ContentEditableInput.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=this.getSelection(),t=this.cm;if(D&&T&&this.cm.display.gutterSpecs.length&&function isInGutter(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var r=domToPos(t,e.anchorNode,e.anchorOffset),a=domToPos(t,e.focusNode,e.focusOffset);r&&a&&runInOp(t,(function(){setSelection(t.doc,simpleSelection(r,a),G),(r.bad||a.bad)&&(t.curOp.selectionChanged=!0)}))}}},ContentEditableInput.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e,t,r,a=this.cm,s=a.display,l=a.doc.sel.primary(),y=l.from(),w=l.to();if(0==y.ch&&y.line>a.firstLine()&&(y=Pos(y.line-1,getLine(a.doc,y.line-1).length)),w.ch==getLine(a.doc,w.line).text.length&&w.line<a.lastLine()&&(w=Pos(w.line+1,0)),y.line<s.viewFrom||w.line>s.viewTo-1)return!1;y.line==s.viewFrom||0==(e=findViewIndex(a,y.line))?(t=lineNo(s.view[0].line),r=s.view[0].node):(t=lineNo(s.view[e].line),r=s.view[e-1].node.nextSibling);var E,S,T=findViewIndex(a,w.line);if(T==s.view.length-1?(E=s.viewTo-1,S=s.lineDiv.lastChild):(E=lineNo(s.view[T+1].line)-1,S=s.view[T+1].node.previousSibling),!r)return!1;for(var O=a.doc.splitLines(function domTextBetween(e,t,r,a,s){var l="",y=!1,w=e.doc.lineSeparator(),E=!1;function close(){y&&(l+=w,E&&(l+=w),y=E=!1)}function addText(e){e&&(close(),l+=e)}function walk(t){if(1==t.nodeType){var r=t.getAttribute("cm-text");if(r)return void addText(r);var l,S=t.getAttribute("cm-marker");if(S){var T=e.findMarks(Pos(a,0),Pos(s+1,0),function recognizeMarker(e){return function(t){return t.id==e}}(+S));return void(T.length&&(l=T[0].find(0))&&addText(getBetween(e.doc,l.from,l.to).join(w)))}if("false"==t.getAttribute("contenteditable"))return;var O=/^(pre|div|p|li|table|br)$/i.test(t.nodeName);if(!/^br$/i.test(t.nodeName)&&0==t.textContent.length)return;O&&close();for(var N=0;N<t.childNodes.length;N++)walk(t.childNodes[N]);/^(pre|p)$/i.test(t.nodeName)&&(E=!0),O&&(y=!0)}else 3==t.nodeType&&addText(t.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;walk(t),t!=r;)t=t.nextSibling,E=!1;return l}(a,r,S,t,E)),N=getBetween(a.doc,Pos(t,0),Pos(E,getLine(a.doc,E).text.length));O.length>1&&N.length>1;)if(lst(O)==lst(N))O.pop(),N.pop(),E--;else{if(O[0]!=N[0])break;O.shift(),N.shift(),t++}for(var A=0,L=0,R=O[0],D=N[0],M=Math.min(R.length,D.length);A<M&&R.charCodeAt(A)==D.charCodeAt(A);)++A;for(var B=lst(O),q=lst(N),W=Math.min(B.length-(1==O.length?A:0),q.length-(1==N.length?A:0));L<W&&B.charCodeAt(B.length-L-1)==q.charCodeAt(q.length-L-1);)++L;if(1==O.length&&1==N.length&&t==y.line)for(;A&&A>y.ch&&B.charCodeAt(B.length-L-1)==q.charCodeAt(q.length-L-1);)A--,L++;O[O.length-1]=B.slice(0,B.length-L).replace(/^\u200b+/,""),O[0]=O[0].slice(A).replace(/\u200b+$/,"");var j=Pos(t,A),H=Pos(E,N.length?lst(N).length-L:0);return O.length>1||O[0]||cmp(j,H)?(replaceRange(a.doc,O,j,H,"+input"),!0):void 0},ContentEditableInput.prototype.ensurePolled=function(){this.forceCompositionEnd()},ContentEditableInput.prototype.reset=function(){this.forceCompositionEnd()},ContentEditableInput.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},ContentEditableInput.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout((function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()}),80))},ContentEditableInput.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||runInOp(this.cm,(function(){return regChange(e.cm)}))},ContentEditableInput.prototype.setUneditable=function(e){e.contentEditable="false"},ContentEditableInput.prototype.onKeyPress=function(e){0==e.charCode||this.composing||(e.preventDefault(),this.cm.isReadOnly()||operation(this.cm,applyTextInput)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},ContentEditableInput.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},ContentEditableInput.prototype.onContextMenu=function(){},ContentEditableInput.prototype.resetPosition=function(){},ContentEditableInput.prototype.needsContentAttribute=!0;var TextareaInput=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new Delayed,this.hasSelection=!1,this.composing=null};TextareaInput.prototype.init=function(e){var t=this,r=this,a=this.cm;this.createField(e);var s=this.textarea;function prepareCopyCut(e){if(!signalDOMEvent(a,e)){if(a.somethingSelected())setLastCopied({lineWise:!1,text:a.getSelections()});else{if(!a.options.lineWiseCopyCut)return;var t=copyableRanges(a);setLastCopied({lineWise:!0,text:t.text}),"cut"==e.type?a.setSelections(t.ranges,null,G):(r.prevInput="",s.value=t.text.join("\n"),selectInput(s))}"cut"==e.type&&(a.state.cutIncoming=+new Date)}}e.wrapper.insertBefore(this.wrapper,e.wrapper.firstChild),R&&(s.style.width="0px"),on(s,"input",(function(){y&&w>=9&&t.hasSelection&&(t.hasSelection=null),r.poll()})),on(s,"paste",(function(e){signalDOMEvent(a,e)||handlePaste(e,a)||(a.state.pasteIncoming=+new Date,r.fastPoll())})),on(s,"cut",prepareCopyCut),on(s,"copy",prepareCopyCut),on(e.scroller,"paste",(function(t){if(!eventInWidget(e,t)&&!signalDOMEvent(a,t)){if(!s.dispatchEvent)return a.state.pasteIncoming=+new Date,void r.focus();var l=new Event("paste");l.clipboardData=t.clipboardData,s.dispatchEvent(l)}})),on(e.lineSpace,"selectstart",(function(t){eventInWidget(e,t)||e_preventDefault(t)})),on(s,"compositionstart",(function(){var e=a.getCursor("from");r.composing&&r.composing.range.clear(),r.composing={start:e,range:a.markText(e,a.getCursor("to"),{className:"CodeMirror-composing"})}})),on(s,"compositionend",(function(){r.composing&&(r.poll(),r.composing.range.clear(),r.composing=null)}))},TextareaInput.prototype.createField=function(e){this.wrapper=hiddenTextarea(),this.textarea=this.wrapper.firstChild},TextareaInput.prototype.screenReaderLabelChanged=function(e){e?this.textarea.setAttribute("aria-label",e):this.textarea.removeAttribute("aria-label")},TextareaInput.prototype.prepareSelection=function(){var e=this.cm,t=e.display,r=e.doc,a=prepareSelection(e);if(e.options.moveInputWithCursor){var s=cursorCoords(e,r.sel.primary().head,"div"),l=t.wrapper.getBoundingClientRect(),y=t.lineDiv.getBoundingClientRect();a.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,s.top+y.top-l.top)),a.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,s.left+y.left-l.left))}return a},TextareaInput.prototype.showSelection=function(e){var t=this.cm.display;removeChildrenAndAdd(t.cursorDiv,e.cursors),removeChildrenAndAdd(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},TextareaInput.prototype.reset=function(e){if(!this.contextMenuPending&&!this.composing){var t=this.cm;if(t.somethingSelected()){this.prevInput="";var r=t.getSelection();this.textarea.value=r,t.state.focused&&selectInput(this.textarea),y&&w>=9&&(this.hasSelection=r)}else e||(this.prevInput=this.textarea.value="",y&&w>=9&&(this.hasSelection=null))}},TextareaInput.prototype.getField=function(){return this.textarea},TextareaInput.prototype.supportsTouch=function(){return!1},TextareaInput.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!M||activeElt()!=this.textarea))try{this.textarea.focus()}catch(e){}},TextareaInput.prototype.blur=function(){this.textarea.blur()},TextareaInput.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},TextareaInput.prototype.receivedFocus=function(){this.slowPoll()},TextareaInput.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,(function(){e.poll(),e.cm.state.focused&&e.slowPoll()}))},TextareaInput.prototype.fastPoll=function(){var e=!1,t=this;t.pollingFast=!0,t.polling.set(20,(function p(){t.poll()||e?(t.pollingFast=!1,t.slowPoll()):(e=!0,t.polling.set(60,p))}))},TextareaInput.prototype.poll=function(){var e=this,t=this.cm,r=this.textarea,a=this.prevInput;if(this.contextMenuPending||!t.state.focused||ae(r)&&!a&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var s=r.value;if(s==a&&!t.somethingSelected())return!1;if(y&&w>=9&&this.hasSelection===s||B&&/[\uf700-\uf7ff]/.test(s))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var l=s.charCodeAt(0);if(8203!=l||a||(a="​"),8666==l)return this.reset(),this.cm.execCommand("undo")}for(var E=0,S=Math.min(a.length,s.length);E<S&&a.charCodeAt(E)==s.charCodeAt(E);)++E;return runInOp(t,(function(){applyTextInput(t,s.slice(E),a.length-E,null,e.composing?"*compose":null),s.length>1e3||s.indexOf("\n")>-1?r.value=e.prevInput="":e.prevInput=s,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))})),!0},TextareaInput.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},TextareaInput.prototype.onKeyPress=function(){y&&w>=9&&(this.hasSelection=null),this.fastPoll()},TextareaInput.prototype.onContextMenu=function(e){var t=this,r=t.cm,a=r.display,s=t.textarea;t.contextMenuPending&&t.contextMenuPending();var l=posFromMouse(r,e),S=a.scroller.scrollTop;if(l&&!O){r.options.resetSelectionOnContextMenu&&-1==r.doc.sel.contains(l)&&operation(r,setSelection)(r.doc,simpleSelection(l),G);var T,N=s.style.cssText,A=t.wrapper.style.cssText,L=t.wrapper.offsetParent.getBoundingClientRect();if(t.wrapper.style.cssText="position: static",s.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-L.top-5)+"px; left: "+(e.clientX-L.left-5)+"px;\n      z-index: 1000; background: "+(y?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",E&&(T=window.scrollY),a.input.focus(),E&&window.scrollTo(null,T),a.input.reset(),r.somethingSelected()||(s.value=t.prevInput=" "),t.contextMenuPending=rehide,a.selForContextMenu=r.doc.sel,clearTimeout(a.detectingSelectAll),y&&w>=9&&prepareSelectAllHack(),V){e_stop(e);var mouseup=function(){off(window,"mouseup",mouseup),setTimeout(rehide,20)};on(window,"mouseup",mouseup)}else setTimeout(rehide,50)}function prepareSelectAllHack(){if(null!=s.selectionStart){var e=r.somethingSelected(),l="​"+(e?s.value:"");s.value="⇚",s.value=l,t.prevInput=e?"":"​",s.selectionStart=1,s.selectionEnd=l.length,a.selForContextMenu=r.doc.sel}}function rehide(){if(t.contextMenuPending==rehide&&(t.contextMenuPending=!1,t.wrapper.style.cssText=A,s.style.cssText=N,y&&w<9&&a.scrollbars.setScrollTop(a.scroller.scrollTop=S),null!=s.selectionStart)){(!y||y&&w<9)&&prepareSelectAllHack();var e=0,poll=function(){a.selForContextMenu==r.doc.sel&&0==s.selectionStart&&s.selectionEnd>0&&"​"==t.prevInput?operation(r,selectAll)(r):e++<10?a.detectingSelectAll=setTimeout(poll,500):(a.selForContextMenu=null,a.input.reset())};a.detectingSelectAll=setTimeout(poll,200)}}},TextareaInput.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e,this.textarea.readOnly=!!e},TextareaInput.prototype.setUneditable=function(){},TextareaInput.prototype.needsContentAttribute=!1,function defineOptions(e){var t=e.optionHandlers;function option(r,a,s,l){e.defaults[r]=a,s&&(t[r]=l?function(e,t,r){r!=qe&&s(e,t,r)}:s)}e.defineOption=option,e.Init=qe,option("value","",(function(e,t){return e.setValue(t)}),!0),option("mode",null,(function(e,t){e.doc.modeOption=t,loadMode(e)}),!0),option("indentUnit",2,loadMode,!0),option("indentWithTabs",!1),option("smartIndent",!0),option("tabSize",4,(function(e){resetModeState(e),clearCaches(e),regChange(e)}),!0),option("lineSeparator",null,(function(e,t){if(e.doc.lineSep=t,t){var r=[],a=e.doc.first;e.doc.iter((function(e){for(var s=0;;){var l=e.text.indexOf(t,s);if(-1==l)break;s=l+t.length,r.push(Pos(a,l))}a++}));for(var s=r.length-1;s>=0;s--)replaceRange(e.doc,t,r[s],Pos(r[s].line,r[s].ch+t.length))}})),option("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,(function(e,t,r){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),r!=qe&&e.refresh()})),option("specialCharPlaceholder",defaultSpecialCharPlaceholder,(function(e){return e.refresh()}),!0),option("electricChars",!0),option("inputStyle",M?"contenteditable":"textarea",(function(){throw new Error("inputStyle can not (yet) be changed in a running editor")}),!0),option("spellcheck",!1,(function(e,t){return e.getInputField().spellcheck=t}),!0),option("autocorrect",!1,(function(e,t){return e.getInputField().autocorrect=t}),!0),option("autocapitalize",!1,(function(e,t){return e.getInputField().autocapitalize=t}),!0),option("rtlMoveVisually",!W),option("wholeLineUpdateBefore",!0),option("theme","default",(function(e){themeChanged(e),updateGutters(e)}),!0),option("keyMap","default",(function(e,t,r){var a=getKeyMap(t),s=r!=qe&&getKeyMap(r);s&&s.detach&&s.detach(e,a),a.attach&&a.attach(e,s||null)})),option("extraKeys",null),option("configureMouse",null),option("lineWrapping",!1,wrappingChanged,!0),option("gutters",[],(function(e,t){e.display.gutterSpecs=getGutters(t,e.options.lineNumbers),updateGutters(e)}),!0),option("fixedGutter",!0,(function(e,t){e.display.gutters.style.left=t?compensateForHScroll(e.display)+"px":"0",e.refresh()}),!0),option("coverGutterNextToScrollbar",!1,(function(e){return updateScrollbars(e)}),!0),option("scrollbarStyle","native",(function(e){initScrollbars(e),updateScrollbars(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)}),!0),option("lineNumbers",!1,(function(e,t){e.display.gutterSpecs=getGutters(e.options.gutters,t),updateGutters(e)}),!0),option("firstLineNumber",1,updateGutters,!0),option("lineNumberFormatter",(function(e){return e}),updateGutters,!0),option("showCursorWhenSelecting",!1,updateSelection,!0),option("resetSelectionOnContextMenu",!0),option("lineWiseCopyCut",!0),option("pasteLinesPerSelection",!0),option("selectionsMayTouch",!1),option("readOnly",!1,(function(e,t){"nocursor"==t&&(onBlur(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)})),option("screenReaderLabel",null,(function(e,t){t=""===t?null:t,e.display.input.screenReaderLabelChanged(t)})),option("disableInput",!1,(function(e,t){t||e.display.input.reset()}),!0),option("dragDrop",!0,dragDropChanged),option("allowDropFileTypes",null),option("cursorBlinkRate",530),option("cursorScrollMargin",0),option("cursorHeight",1,updateSelection,!0),option("singleCursorHeightPerLine",!0,updateSelection,!0),option("workTime",100),option("workDelay",100),option("flattenSpans",!0,resetModeState,!0),option("addModeClass",!1,resetModeState,!0),option("pollInterval",100),option("undoDepth",200,(function(e,t){return e.doc.history.undoDepth=t})),option("historyEventDelay",1250),option("viewportMargin",10,(function(e){return e.refresh()}),!0),option("maxHighlightLength",1e4,resetModeState,!0),option("moveInputWithCursor",!0,(function(e,t){t||e.display.input.resetPosition()})),option("tabindex",null,(function(e,t){return e.display.input.getField().tabIndex=t||""})),option("autofocus",null),option("direction","ltr",(function(e,t){return e.doc.setDirection(t)}),!0),option("phrases",null)}(CodeMirror),function addEditorMethods(e){var t=e.optionHandlers,r=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,r){var a=this.options,s=a[e];a[e]==r&&"mode"!=e||(a[e]=r,t.hasOwnProperty(e)&&operation(this,t[e])(this,r,s),signal(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](getKeyMap(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,r=0;r<t.length;++r)if(t[r]==e||t[r].name==e)return t.splice(r,1),!0},addOverlay:methodOp((function(t,r){var a=t.token?t:e.getMode(this.options,t);if(a.startState)throw new Error("Overlays may not be stateful.");!function insertSorted(e,t,r){for(var a=0,s=r(t);a<e.length&&r(e[a])<=s;)a++;e.splice(a,0,t)}(this.state.overlays,{mode:a,modeSpec:t,opaque:r&&r.opaque,priority:r&&r.priority||0},(function(e){return e.priority})),this.state.modeGen++,regChange(this)})),removeOverlay:methodOp((function(e){for(var t=this.state.overlays,r=0;r<t.length;++r){var a=t[r].modeSpec;if(a==e||"string"==typeof e&&a.name==e)return t.splice(r,1),this.state.modeGen++,void regChange(this)}})),indentLine:methodOp((function(e,t,r){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),isLine(this.doc,e)&&indentLine(this,e,t,r)})),indentSelection:methodOp((function(e){for(var t=this.doc.sel.ranges,r=-1,a=0;a<t.length;a++){var s=t[a];if(s.empty())s.head.line>r&&(indentLine(this,s.head.line,e,!0),r=s.head.line,a==this.doc.sel.primIndex&&ensureCursorVisible(this));else{var l=s.from(),y=s.to(),w=Math.max(r,l.line);r=Math.min(this.lastLine(),y.line-(y.ch?0:1))+1;for(var E=w;E<r;++E)indentLine(this,E,e);var S=this.doc.sel.ranges;0==l.ch&&t.length==S.length&&S[a].from().ch>0&&replaceOneSelection(this.doc,a,new Range(l,S[a].to()),G)}}})),getTokenAt:function(e,t){return takeToken(this,e,t)},getLineTokens:function(e,t){return takeToken(this,Pos(e),t,!0)},getTokenTypeAt:function(e){e=clipPos(this.doc,e);var t,r=getLineStyles(this,getLine(this.doc,e.line)),a=0,s=(r.length-1)/2,l=e.ch;if(0==l)t=r[2];else for(;;){var y=a+s>>1;if((y?r[2*y-1]:0)>=l)s=y;else{if(!(r[2*y+1]<l)){t=r[2*y+2];break}a=y+1}}var w=t?t.indexOf("overlay "):-1;return w<0?t:0==w?null:t.slice(0,w-1)},getModeAt:function(t){var r=this.doc.mode;return r.innerMode?e.innerMode(r,this.getTokenAt(t).state).mode:r},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var a=[];if(!r.hasOwnProperty(t))return a;var s=r[t],l=this.getModeAt(e);if("string"==typeof l[t])s[l[t]]&&a.push(s[l[t]]);else if(l[t])for(var y=0;y<l[t].length;y++){var w=s[l[t][y]];w&&a.push(w)}else l.helperType&&s[l.helperType]?a.push(s[l.helperType]):s[l.name]&&a.push(s[l.name]);for(var E=0;E<s._global.length;E++){var S=s._global[E];S.pred(l,this)&&-1==indexOf(a,S.val)&&a.push(S.val)}return a},getStateAfter:function(e,t){var r=this.doc;return getContextBefore(this,(e=clipLine(r,null==e?r.first+r.size-1:e))+1,t).state},cursorCoords:function(e,t){var r=this.doc.sel.primary();return cursorCoords(this,null==e?r.head:"object"==typeof e?clipPos(this.doc,e):e?r.from():r.to(),t||"page")},charCoords:function(e,t){return charCoords(this,clipPos(this.doc,e),t||"page")},coordsChar:function(e,t){return coordsChar(this,(e=fromCoordSystem(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=fromCoordSystem(this,{top:e,left:0},t||"page").top,lineAtHeight(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,r){var a,s=!1;if("number"==typeof e){var l=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>l&&(e=l,s=!0),a=getLine(this.doc,e)}else a=e;return intoCoordSystem(this,a,{top:0,left:0},t||"page",r||s).top+(s?this.doc.height-heightAtLine(a):0)},defaultTextHeight:function(){return textHeight(this.display)},defaultCharWidth:function(){return charWidth(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,r,a,s){var l=this.display,y=(e=cursorCoords(this,clipPos(this.doc,e))).bottom,w=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),l.sizer.appendChild(t),"over"==a)y=e.top;else if("above"==a||"near"==a){var E=Math.max(l.wrapper.clientHeight,this.doc.height),S=Math.max(l.sizer.clientWidth,l.lineSpace.clientWidth);("above"==a||e.bottom+t.offsetHeight>E)&&e.top>t.offsetHeight?y=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=E&&(y=e.bottom),w+t.offsetWidth>S&&(w=S-t.offsetWidth)}t.style.top=y+"px",t.style.left=t.style.right="","right"==s?(w=l.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==s?w=0:"middle"==s&&(w=(l.sizer.clientWidth-t.offsetWidth)/2),t.style.left=w+"px"),r&&function scrollIntoView(e,t){var r=calculateScrollPos(e,t);null!=r.scrollTop&&updateScrollTop(e,r.scrollTop),null!=r.scrollLeft&&setScrollLeft(e,r.scrollLeft)}(this,{left:w,top:y,right:w+t.offsetWidth,bottom:y+t.offsetHeight})},triggerOnKeyDown:methodOp(onKeyDown),triggerOnKeyPress:methodOp(onKeyPress),triggerOnKeyUp:onKeyUp,triggerOnMouseDown:methodOp(onMouseDown),execCommand:function(e){if(Re.hasOwnProperty(e))return Re[e].call(null,this)},triggerElectric:methodOp((function(e){triggerElectric(this,e)})),findPosH:function(e,t,r,a){var s=1;t<0&&(s=-1,t=-t);for(var l=clipPos(this.doc,e),y=0;y<t&&!(l=findPosH(this.doc,l,s,r,a)).hitSide;++y);return l},moveH:methodOp((function(e,t){var r=this;this.extendSelectionsBy((function(a){return r.display.shift||r.doc.extend||a.empty()?findPosH(r.doc,a.head,e,t,r.options.rtlMoveVisually):e<0?a.from():a.to()}),$)})),deleteH:methodOp((function(e,t){var r=this.doc.sel,a=this.doc;r.somethingSelected()?a.replaceSelection("",null,"+delete"):deleteNearSelection(this,(function(r){var s=findPosH(a,r.head,e,t,!1);return e<0?{from:s,to:r.head}:{from:r.head,to:s}}))})),findPosV:function(e,t,r,a){var s=1,l=a;t<0&&(s=-1,t=-t);for(var y=clipPos(this.doc,e),w=0;w<t;++w){var E=cursorCoords(this,y,"div");if(null==l?l=E.left:E.left=l,(y=findPosV(this,E,s,r)).hitSide)break}return y},moveV:methodOp((function(e,t){var r=this,a=this.doc,s=[],l=!this.display.shift&&!a.extend&&a.sel.somethingSelected();if(a.extendSelectionsBy((function(y){if(l)return e<0?y.from():y.to();var w=cursorCoords(r,y.head,"div");null!=y.goalColumn&&(w.left=y.goalColumn),s.push(w.left);var E=findPosV(r,w,e,t);return"page"==t&&y==a.sel.primary()&&addToScrollTop(r,charCoords(r,E,"div").top-w.top),E}),$),s.length)for(var y=0;y<a.sel.ranges.length;y++)a.sel.ranges[y].goalColumn=s[y]})),findWordAt:function(e){var t=getLine(this.doc,e.line).text,r=e.ch,a=e.ch;if(t){var s=this.getHelper(e,"wordChars");"before"!=e.sticky&&a!=t.length||!r?++a:--r;for(var l=t.charAt(r),y=isWordChar(l,s)?function(e){return isWordChar(e,s)}:/\s/.test(l)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!isWordChar(e)};r>0&&y(t.charAt(r-1));)--r;for(;a<t.length&&y(t.charAt(a));)++a}return new Range(Pos(e.line,r),Pos(e.line,a))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?addClass(this.display.cursorDiv,"CodeMirror-overwrite"):rmClass(this.display.cursorDiv,"CodeMirror-overwrite"),signal(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==activeElt()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:methodOp((function(e,t){scrollToCoords(this,e,t)})),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-scrollGap(this)-this.display.barHeight,width:e.scrollWidth-scrollGap(this)-this.display.barWidth,clientHeight:displayHeight(this),clientWidth:displayWidth(this)}},scrollIntoView:methodOp((function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:Pos(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?function scrollToRange(e,t){resolveScrollToPos(e),e.curOp.scrollToPos=t}(this,e):scrollToCoordsRange(this,e.from,e.to,e.margin)})),setSize:methodOp((function(e,t){var r=this,interpret=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=interpret(e)),null!=t&&(this.display.wrapper.style.height=interpret(t)),this.options.lineWrapping&&clearLineMeasurementCache(this);var a=this.display.viewFrom;this.doc.iter(a,this.display.viewTo,(function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){regLineChange(r,a,"widget");break}++a})),this.curOp.forceUpdate=!0,signal(this,"refresh",this)})),operation:function(e){return runInOp(this,e)},startOperation:function(){return startOperation(this)},endOperation:function(){return endOperation(this)},refresh:methodOp((function(){var e=this.display.cachedTextHeight;regChange(this),this.curOp.forceUpdate=!0,clearCaches(this),scrollToCoords(this,this.doc.scrollLeft,this.doc.scrollTop),updateGutterSpace(this.display),(null==e||Math.abs(e-textHeight(this.display))>.5||this.options.lineWrapping)&&estimateLineHeights(this),signal(this,"refresh",this)})),swapDoc:methodOp((function(e){var t=this.doc;return t.cm=null,this.state.selectingText&&this.state.selectingText(),attachDoc(this,e),clearCaches(this),this.display.input.reset(),scrollToCoords(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,signalLater(this,"swapDoc",this,t),t})),phrase:function(e){var t=this.options.phrases;return t&&Object.prototype.hasOwnProperty.call(t,e)?t[e]:e},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},eventMixin(e),e.registerHelper=function(t,a,s){r.hasOwnProperty(t)||(r[t]=e[t]={_global:[]}),r[t][a]=s},e.registerGlobalHelper=function(t,a,s,l){e.registerHelper(t,a,l),r[t]._global.push({pred:s,val:l})}}(CodeMirror);var Ve="iter insert remove copy getEditor constructor".split(" ");for(var ze in Doc.prototype)Doc.prototype.hasOwnProperty(ze)&&indexOf(Ve,ze)<0&&(CodeMirror.prototype[ze]=function(e){return function(){return e.apply(this.doc,arguments)}}(Doc.prototype[ze]));return eventMixin(Doc),CodeMirror.inputStyles={textarea:TextareaInput,contenteditable:ContentEditableInput},CodeMirror.defineMode=function(e){CodeMirror.defaults.mode||"null"==e||(CodeMirror.defaults.mode=e),defineMode.apply(this,arguments)},CodeMirror.defineMIME=function defineMIME(e,t){ue[e]=t},CodeMirror.defineMode("null",(function(){return{token:function(e){return e.skipToEnd()}}})),CodeMirror.defineMIME("text/plain","null"),CodeMirror.defineExtension=function(e,t){CodeMirror.prototype[e]=t},CodeMirror.defineDocExtension=function(e,t){Doc.prototype[e]=t},CodeMirror.fromTextArea=function fromTextArea(e,t){if((t=t?copyObj(t):{}).value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var r=activeElt();t.autofocus=r==e||null!=e.getAttribute("autofocus")&&r==document.body}function save(){e.value=y.getValue()}var a;if(e.form&&(on(e.form,"submit",save),!t.leaveSubmitMethodAlone)){var s=e.form;a=s.submit;try{var l=s.submit=function(){save(),s.submit=a,s.submit(),s.submit=l}}catch(e){}}t.finishInit=function(r){r.save=save,r.getTextArea=function(){return e},r.toTextArea=function(){r.toTextArea=isNaN,save(),e.parentNode.removeChild(r.getWrapperElement()),e.style.display="",e.form&&(off(e.form,"submit",save),t.leaveSubmitMethodAlone||"function"!=typeof e.form.submit||(e.form.submit=a))}},e.style.display="none";var y=CodeMirror((function(t){return e.parentNode.insertBefore(t,e.nextSibling)}),t);return y},function addLegacyProps(e){e.off=off,e.on=on,e.wheelEventPixels=wheelEventPixels,e.Doc=Doc,e.splitLines=oe,e.countColumn=countColumn,e.findColumn=findColumn,e.isWordChar=isWordCharBasic,e.Pass=U,e.signal=signal,e.Line=Line,e.changeEnd=changeEnd,e.scrollbarModel=we,e.Pos=Pos,e.cmpPos=cmp,e.modes=ce,e.mimeModes=ue,e.resolveMode=resolveMode,e.getMode=getMode,e.modeExtensions=de,e.extendMode=extendMode,e.copyState=copyState,e.startState=startState,e.innerMode=innerMode,e.commands=Re,e.keyMap=Le,e.keyName=keyName,e.isModifierKey=isModifierKey,e.lookupKey=lookupKey,e.normalizeKeyMap=normalizeKeyMap,e.StringStream=StringStream,e.SharedTextMarker=SharedTextMarker,e.TextMarker=TextMarker,e.LineWidget=LineWidget,e.e_preventDefault=e_preventDefault,e.e_stopPropagation=e_stopPropagation,e.e_stop=e_stop,e.addClass=addClass,e.contains=contains,e.rmClass=rmClass,e.keyNames=Oe}(CodeMirror),CodeMirror.version="5.61.0",CodeMirror}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return enhanceWithImageUpload}));var a=r(0),s=r.n(a),l=r(5),y=r.n(l),w=(r(2),r(158)),E=r(228);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function enhanceWithImageUpload(e,t){var r=e.model,a=e.activity,l=e.data;Object(w.a)(e,{maxFileSize:function maxFileSize(){return l.maxFileSize||(l.maxFileSize=1e6),l.maxFileSize},maxFileSizeInMB:function maxFileSizeInMB(){return e.maxFileSize/1e3/1e3},warningFileSize:function warningFileSize(){return l.warningFileSize||(l.warningFileSize=4e6),l.warningFileSize},responseValue:function responseValue(){var e=this.getResponse(),t=s.a.getNested(e,"value");if(!t||t.indexOf("<img ")<0)return t;var r=document.createElement("DIV");return r.innerHTML=t,s.a.each(r.querySelectorAll("img"),(function(e){var t=e.getAttribute("data-asset-path");if(t){var r=T.resume(t);e.src=r.getViewUrl()}})),r.innerHTML}});a.get("consumer");var S=s.a.extend({},y.a.Events),T=new E.a({activity:a,eventBus:S,modelId:r.get("id"),responseId:r.get("response_id"),compression:s.a.extend({size:e.maxFileSize},t)}),O=function upload(e){return new Promise((function(t,r){var a=T.upload(e),s=function cleanUp(){S.off("fileUploaded",l),S.off("fileUploadFailed",y)},l=function onSuccess(){var e=a.getViewUrl();s(),t({url:e,assetPath:a.get("assetPath")})},y=function onError(e){s(),r(e)};S.once("fileUploaded",l),S.once("fileUploadFailed",y)}))};e.uploadImage=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.a.isNumber(r.rotation)&&r.rotation<0?e.compressImage(t,_objectSpread(_objectSpread({},r),{},{quality:1})).then(O):O(t)},e.compressImage=function(e,t){return T.compressImage(e,t)},e.formatValue=s.a.wrap(e.formatValue,(function(t,r){return r=((r=t?t.call(e,r)||"":r)||"").replace(/<img([^>]*)(src=".*?")([^>]*)>/gi,"<img$1$3>").replace(/<img\s+([^>]*)>/g,"<img $1>").replace(/<img\s+([^>]*)\s+>/g,"<img $1>").replace(/<img >/,"<img>")})),e.EXPOSED_METHODS.indexOf("uploadImage")<0&&e.EXPOSED_METHODS.push("uploadImage","compressImage","formatValue")}},function(e,t,r){const a=r(0);e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,r){"use strict";var s;function o(e){return["image/png","image/jpeg","image/gif"].some((function(t){return t===e}))}function u(e,t,r){return void 0===t&&(t=.92),void 0===r&&(r=s.JPEG),function(e,t,r,a){return new(r||(r=Promise))((function(s,l){function i(e){try{c(a.next(e))}catch(e){l(e)}}function u(e){try{c(a.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}c((a=a.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){return function(e,t){var r,a,s,l,y={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return l={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function u(l){return function(w){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;y;)try{if(r=1,a&&(s=2&l[0]?a.return:l[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,l[1])).done)return s;switch(a=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return y.label++,{value:l[1],done:!1};case 5:y.label++,a=l[1],l=[0];continue;case 7:l=y.ops.pop(),y.trys.pop();continue;default:if(!((s=(s=y.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){y=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){y.label=l[1];break}if(6===l[0]&&y.label<s[1]){y.label=s[1],s=l;break}if(s&&y.label<s[2]){y.label=s[2],y.ops.push(l);break}s[2]&&y.ops.pop(),y.trys.pop();continue}l=t.call(e,y)}catch(e){l=[6,e],a=0}finally{r=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,w])}}}(this,(function(a){return o(r)||(r=s.JPEG),[2,e.toDataURL(r,t)]}))}))}function c(e,t,r){return void 0===t&&(t=.92),void 0===r&&(r=s.JPEG),new Promise((function(a){return e.toBlob((function(e){return a(e)}),r,t)}))}function f(e,t){return function(e,t,r,a){return new(r||(r=Promise))((function(s,l){function i(e){try{c(a.next(e))}catch(e){l(e)}}function u(e){try{c(a.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}c((a=a.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){var r,a,s,l,y;return function(e,t){var r,a,s,l,y={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return l={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function u(l){return function(w){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;y;)try{if(r=1,a&&(s=2&l[0]?a.return:l[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,l[1])).done)return s;switch(a=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return y.label++,{value:l[1],done:!1};case 5:y.label++,a=l[1],l=[0];continue;case 7:l=y.ops.pop(),y.trys.pop();continue;default:if(!((s=(s=y.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){y=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){y.label=l[1];break}if(6===l[0]&&y.label<s[1]){y.label=s[1],s=l;break}if(s&&y.label<s[2]){y.label=s[2],y.ops.push(l);break}s[2]&&y.ops.pop(),y.trys.pop();continue}l=t.call(e,y)}catch(e){l=[6,e],a=0}finally{r=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,w])}}}(this,(function(w){for(r=e.split(","),a=r[0].match(/:(.*?);/)[1],s=atob(r[1]),l=s.length,y=new Uint8Array(l);l--;)y[l]=s.charCodeAt(l);return o(t)&&(a=t),[2,new Blob([y],{type:a})]}))}))}function h(e){return new Promise((function(t,r){var a=new Image;a.onload=function(){return t(a)},a.onerror=function(){return r(new Error("dataURLtoImage(): dataURL is illegal"))},a.src=e}))}function d(e,t){var r=document.createElement("a");r.href=window.URL.createObjectURL(e),r.download=t||Date.now().toString(36),document.body.appendChild(r);var a=document.createEvent("MouseEvents");a.initEvent("click",!1,!1),r.dispatchEvent(a),document.body.removeChild(r)}function p(e){return new Promise((function(t){var r=new FileReader;r.onloadend=function(e){return t(e.target.result)},r.readAsDataURL(e)}))}r.r(t),r.d(t,"canvastoDataURL",(function(){return u})),r.d(t,"canvastoFile",(function(){return c})),r.d(t,"dataURLtoFile",(function(){return f})),r.d(t,"dataURLtoImage",(function(){return h})),r.d(t,"downloadFile",(function(){return d})),r.d(t,"filetoDataURL",(function(){return p})),r.d(t,"imagetoCanvas",(function(){return g})),r.d(t,"urltoBlob",(function(){return v})),r.d(t,"urltoImage",(function(){return m})),r.d(t,"compress",(function(){return k})),r.d(t,"compressAccurately",(function(){return I})),r.d(t,"EImageType",(function(){return s})),function(e){e.PNG="image/png",e.JPEG="image/jpeg",e.GIF="image/gif"}(s||(s={}));var b=function(){return(b=a.extend||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function g(e,t){return void 0===t&&(t={}),function(e,t,r,a){return new(r||(r=Promise))((function(s,l){function i(e){try{c(a.next(e))}catch(e){l(e)}}function u(e){try{c(a.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}c((a=a.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){var r,a,s,l,y,w,E;return function(e,t){var r,a,s,l,y={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return l={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function u(l){return function(w){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;y;)try{if(r=1,a&&(s=2&l[0]?a.return:l[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,l[1])).done)return s;switch(a=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return y.label++,{value:l[1],done:!1};case 5:y.label++,a=l[1],l=[0];continue;case 7:l=y.ops.pop(),y.trys.pop();continue;default:if(!((s=(s=y.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){y=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){y.label=l[1];break}if(6===l[0]&&y.label<s[1]){y.label=s[1],s=l;break}if(s&&y.label<s[2]){y.label=s[2],y.ops.push(l);break}s[2]&&y.ops.pop(),y.trys.pop();continue}l=t.call(e,y)}catch(e){l=[6,e],a=0}finally{r=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,w])}}}(this,(function(S){for(w in r=b({},t),a=document.createElement("canvas"),s=a.getContext("2d"),r)Object.prototype.hasOwnProperty.call(r,w)&&(r[w]=Number(r[w]));switch(r.scale?(E=r.scale>0&&r.scale<10?r.scale:1,y=e.width*E,l=e.height*E):(y=r.width||r.height*e.width/e.height||e.width,l=r.height||r.width*e.height/e.width||e.height),[5,6,7,8].some((function(e){return e===r.orientation}))?(a.height=y,a.width=l):(a.height=l,a.width=y),r.orientation){case 3:s.rotate(180*Math.PI/180),s.drawImage(e,-a.width,-a.height,a.width,a.height);break;case 6:s.rotate(90*Math.PI/180),s.drawImage(e,0,-a.width,a.height,a.width);break;case 8:s.rotate(270*Math.PI/180),s.drawImage(e,-a.height,0,a.height,a.width);break;case 2:s.translate(a.width,0),s.scale(-1,1),s.drawImage(e,0,0,a.width,a.height);break;case 4:s.translate(a.width,0),s.scale(-1,1),s.rotate(180*Math.PI/180),s.drawImage(e,-a.width,-a.height,a.width,a.height);break;case 5:s.translate(a.width,0),s.scale(-1,1),s.rotate(90*Math.PI/180),s.drawImage(e,0,-a.width,a.height,a.width);break;case 7:s.translate(a.width,0),s.scale(-1,1),s.rotate(270*Math.PI/180),s.drawImage(e,-a.height,0,a.height,a.width);break;default:s.drawImage(e,0,0,a.width,a.height)}return[2,a]}))}))}function v(e){return fetch(e).then((function(e){return e.blob()}))}function m(e){return new Promise((function(t,r){var a=new Image;a.onload=function(){return t(a)},a.onerror=function(){return r(new Error("urltoImage(): Image failed to load, please check the image URL"))},a.src=e}))}var x=function(e,t,r,a){return new(r||(r=Promise))((function(s,l){function i(e){try{c(a.next(e))}catch(e){l(e)}}function u(e){try{c(a.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}c((a=a.apply(e,t||[])).next())}))},P=function(e,t){var r,a,s,l,y={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return l={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function u(l){return function(w){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;y;)try{if(r=1,a&&(s=2&l[0]?a.return:l[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,l[1])).done)return s;switch(a=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return y.label++,{value:l[1],done:!1};case 5:y.label++,a=l[1],l=[0];continue;case 7:l=y.ops.pop(),y.trys.pop();continue;default:if(!((s=(s=y.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){y=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){y.label=l[1];break}if(6===l[0]&&y.label<s[1]){y.label=s[1],s=l;break}if(s&&y.label<s[2]){y.label=s[2],y.ops.push(l);break}s[2]&&y.ops.pop(),y.trys.pop();continue}l=t.call(e,y)}catch(e){l=[6,e],a=0}finally{r=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,w])}}};function k(e,t){return void 0===t&&(t={}),x(this,void 0,void 0,(function(){var r,l,y,w;return P(this,(function(E){switch(E.label){case 0:if(!(e instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");return"object"!=typeof t&&(t=a.extend({quality:t})),t.quality=Number(t.quality),a.isNaN(t.quality)?[2,e]:[4,p(e)];case 1:return r=E.sent(),l=r.split(",")[0].match(/:(.*?);/)[1],y=s.JPEG,o(t.type)&&(y=t.type,l=t.type),[4,h(r)];case 2:return[4,g(E.sent(),a.extend({},t))];case 3:return[4,u(E.sent(),t.quality,y)];case 4:return[4,f(E.sent(),l)];case 5:return(w=E.sent()).size>e.size?[2,e]:[2,w]}}))}))}function I(e,t){return void 0===t&&(t={}),x(this,void 0,void 0,(function(){var r,l,y,w,E,S,T,O,N,A,L,R;return P(this,(function(D){switch(D.label){case 0:if(!(e instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");return"object"!=typeof t&&(t=a.extend({size:t})),t.size=Number(t.size),a.isNaN(t.size)||1024*t.size>e.size?[2,e]:(t.accuracy=Number(t.accuracy),(!t.accuracy||t.accuracy<.8||t.accuracy>.99)&&(t.accuracy=.95),r={max:t.size*(2-t.accuracy)*1024,accurate:1024*t.size,min:t.size*t.accuracy*1024},[4,p(e)]);case 1:return l=D.sent(),y=l.split(",")[0].match(/:(.*?);/)[1],w=s.JPEG,o(t.type)&&(w=t.type,y=t.type),[4,h(l)];case 2:return[4,g(D.sent(),a.extend({},t))];case 3:E=D.sent(),S=.75,T=.5,N=[null,null],A=1,D.label=4;case 4:return A<=7?[4,u(E,T,w)]:[3,7];case 5:if(O=D.sent(),L=O.length*S,7===A)return(r.max<L||r.min>L)&&(O=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var a=Array(e),s=0;for(t=0;t<r;t++)for(var l=arguments[t],y=0,w=l.length;y<w;y++,s++)a[s]=l[y];return a}([O],N).filter((function(e){return e})).sort((function(e,t){return Math.abs(e.length*S-r.accurate)-Math.abs(t.length*S-r.accurate)}))[0]),[3,7];if(r.max<L)N[1]=O,T-=Math.pow(.5,A+1);else{if(!(r.min>L))return[3,7];N[0]=O,T+=Math.pow(.5,A+1)}D.label=6;case 6:return A++,[3,4];case 7:return[4,f(O,y)];case 8:return(R=D.sent()).size>e.size?[2,e]:[2,R]}}))}))}}])},,,,,,,,,,function(e,t,r){"use strict";var a=r(127),s=r.n(a),l=r(0),y=r.n(l),w=r(258),E=r.n(w),S={blockLevelEl:{keep_styles:{textAlign:/^((left)|(right)|(center)|(justify))$/i,float:1},add_style:{align:"align_text"},check_attributes:{id:"any"}},makeDiv:{rename_tag:"div",one_of_type:{alignment_object:1},remove_action:"unwrap",keep_styles:{textAlign:1,float:1},add_style:{align:"align_text"},check_attributes:{id:"any"}}},T={defaultRules:S,advancedRules:{classes:"any",classes_blacklist:{"Apple-interchange-newline":1,MsoNormal:1,MsoPlainText:1},type_definitions:{alignment_object:{classes:{"wysiwyg-text-align-center":1,"wysiwyg-text-align-justify":1,"wysiwyg-text-align-left":1,"wysiwyg-text-align-right":1,"wysiwyg-float-left":1,"wysiwyg-float-right":1},styles:{float:["left","right"],"text-align":["left","right","center"]}},valid_image_src:{attrs:{src:/^[^data\:]/i}},text_color_object:{styles:{color:!0,"background-color":!0}},text_fontsize_object:{styles:{"font-size":!0}},text_formatting_object:{classes:{"wysiwyg-color-aqua":1,"wysiwyg-color-black":1,"wysiwyg-color-blue":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-gray":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-maroon":1,"wysiwyg-color-navy":1,"wysiwyg-color-olive":1,"wysiwyg-color-purple":1,"wysiwyg-color-red":1,"wysiwyg-color-silver":1,"wysiwyg-color-teal":1,"wysiwyg-color-white":1,"wysiwyg-color-yellow":1,"wysiwyg-font-size-large":1,"wysiwyg-font-size-larger":1,"wysiwyg-font-size-medium":1,"wysiwyg-font-size-small":1,"wysiwyg-font-size-smaller":1,"wysiwyg-font-size-x-large":1,"wysiwyg-font-size-x-small":1,"wysiwyg-font-size-xx-large":1,"wysiwyg-font-size-xx-small":1}}},comments:1,tags:{tr:{add_style:{align:"align_text"},check_attributes:{id:"any"}},strike:{unwrap:1},form:{unwrap:1},rt:{rename_tag:"span"},code:{},acronym:{rename_tag:"span"},br:{add_class:{clear:"clear_br"}},details:{unwrap:1},h4:S.blockLevelEl,em:{},title:{remove:1},multicol:{unwrap:1},figure:{unwrap:1},xmp:{unwrap:1},small:{rename_tag:"span",set_class:"wysiwyg-font-size-smaller"},area:{remove:1},time:{unwrap:1},dir:{rename_tag:"ul"},bdi:{unwrap:1},command:{unwrap:1},ul:{check_attributes:{id:"any"}},progress:{rename_tag:"span"},dfn:{unwrap:1},iframe:{check_attributes:{src:"any",width:"any",height:"any",frameborder:"any",style:"any",id:"any"}},figcaption:{unwrap:1},a:{check_attributes:{href:"href",rel:"any",target:"any",id:"any"}},img:{one_of_type:{valid_image_src:1},check_attributes:{width:"dimension",alt:"alt",src:"src",height:"dimension",id:"any"},add_class:{align:"align_img"}},rb:{unwrap:1},footer:S.makeDiv,noframes:{remove:1},abbr:{unwrap:1},u:{},bgsound:{remove:1},sup:{},address:{unwrap:1},basefont:{remove:1},nav:{unwrap:1},h1:S.blockLevelEl,head:{unwrap:1},tbody:S.blockLevelEl,dd:{unwrap:1},s:{unwrap:1},li:{},td:{check_attributes:{rowspan:"numbers",colspan:"numbers",valign:"any",align:"any",id:"any",class:"any"},keep_styles:{backgroundColor:1,width:1,height:1},add_style:{align:"align_text"}},object:{remove:1},div:{keep_styles:{textAlign:1,float:1},check_attributes:{id:"any",contenteditable:"any","data-lrn-wysihtml-widget":"any","data-lrn-code-editor-id":"any"}},option:{remove:1},select:{remove:1},i:{},track:{remove:1},wbr:{remove:1},fieldset:{unwrap:1},big:{rename_tag:"span",set_class:"wysiwyg-font-size-larger"},button:{remove:1},noscript:{remove:1},svg:{remove:1},input:{remove:1},table:{keep_styles:{width:1,textAlign:1,float:1},check_attributes:{id:"any"}},keygen:{remove:1},h5:S.blockLevelEl,meta:{remove:1},map:{remove:1},isindex:{remove:1},mark:{unwrap:1},caption:S.blockLevelEl,tfoot:S.blockLevelEl,base:{remove:1},video:{remove:1},strong:{},canvas:{remove:1},output:{unwrap:1},marquee:{unwrap:1},b:{},q:{check_attributes:{cite:"url",id:"any"}},applet:{remove:1},span:{one_of_type:{text_formatting_object:1,text_color_object:1,text_fontsize_object:1},keep_styles:{color:1,backgroundColor:1,fontSize:1},remove_action:"unwrap",check_attributes:{id:"any"}},rp:{unwrap:1},spacer:{remove:1},source:{remove:1},aside:S.makeDiv,frame:{remove:1},section:S.makeDiv,body:{unwrap:1},ol:{},nobr:{unwrap:1},html:{unwrap:1},summary:{unwrap:1},var:{unwrap:1},del:{unwrap:1},blockquote:{keep_styles:{textAlign:1,float:1},add_style:{align:"align_text"},check_attributes:{cite:"url",id:"any"}},style:{check_attributes:{type:"any",src:"any",charset:"any"}},device:{remove:1},meter:{unwrap:1},h3:S.blockLevelEl,textarea:{unwrap:1},embed:{remove:1},hgroup:{unwrap:1},font:{rename_tag:"span",add_class:{size:"size_font"}},tt:{unwrap:1},noembed:{remove:1},thead:{add_style:{align:"align_text"},check_attributes:{id:"any"}},blink:{unwrap:1},plaintext:{unwrap:1},xml:{remove:1},h6:S.blockLevelEl,param:{remove:1},th:{check_attributes:{rowspan:"numbers",colspan:"numbers",valign:"any",align:"any",id:"any"},keep_styles:{backgroundColor:1,width:1,height:1},add_style:{align:"align_text"}},legend:{unwrap:1},hr:{},label:{unwrap:1},dl:{unwrap:1},kbd:{unwrap:1},listing:{unwrap:1},dt:{unwrap:1},nextid:{remove:1},pre:{},center:S.makeDiv,audio:{remove:1},datalist:{unwrap:1},samp:{unwrap:1},col:{remove:1},article:S.makeDiv,cite:{},link:{remove:1},script:{check_attributes:{type:"any",src:"any",charset:"any"}},bdo:{unwrap:1},menu:{rename_tag:"ul"},colgroup:{remove:1},ruby:{unwrap:1},h2:S.blockLevelEl,ins:{unwrap:1},p:S.blockLevelEl,sub:{},comment:{remove:1},frameset:{remove:1},optgroup:{unwrap:1},header:S.makeDiv}}},O=r(207);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var N={bold:"bold",italic:"italic",underline:"underline",orderedList:"insertOrderedList",unorderedList:"insertUnorderedList",removeFormat:"removeFormat",alignLeft:"alignLeftStyle",alignCenter:"alignCenterStyle",alignRight:"alignRightStyle",alignJustify:"alignJustifyStyle",superscript:"superscript",subscript:"subscript",insertHorizontalRule:"insertHorizontalRule",indentIncrease:"increaseIndent",indentDecrease:"decreaseIndent",textDirectionLtr:"textDirectionLtr",textDirectionRtl:"textDirectionRtl",blockquote:"insertBlockQuote",createTable:"createTable",deleteTable:"deleteTable",addTableCells:"addTableCells",deleteTableCells:"deleteTableCells",insertImage:"insertImage",characterMap:"insertHTML",createFormula:"createFormula",editFormula:"editFormula",codeInline:"codeInline",codeEditor:"codeEditor",undo:"undo",redo:"redo"},A="F10",L=function(e){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(WYSIHTMLEditor,e);var t=_createSuper(WYSIHTMLEditor);function WYSIHTMLEditor(){var e;_classCallCheck(this,WYSIHTMLEditor);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return _defineProperty(_assertThisInitialized(e=t.call.apply(t,[this].concat(a))),"state",{tableCellSelected:!1}),_defineProperty(_assertThisInitialized(e),"handleKeyDown",(function(t){var r=e.props.focusButtonInsideToolbar;t.altKey&&t.key===A&&r()})),_defineProperty(_assertThisInitialized(e),"createEditor",(function(){var t=e.props,r=t.stripExternalPastedImages,a=t.stripExternalPastedMath,s=t.invalidExternalImageWarning,l=t.invalidExternalMathWarning,y=new E.a.Editor(e.el,{stripExternalPastedImages:r,stripExternalPastedMath:a,invalidExternalImageWarning:s,invalidExternalMathWarning:l,isReviewState:e.props.isReviewState,autoLink:!e.props.disableAutoLink,toolbar:null,useLineBreaks:!1,handleTabKey:!1,parserRules:T.advancedRules}),w=e.props.value;y.on("load",(function(){w&&y.setValue(w,!1)})),y.on("interaction",e.onInteraction),y.on("tableselectstart",e.onTableSelectStart),y.on("tableunselect",e.onTableUnselect),y.on("codeEditor:focus",e.onCodeEditorFocus),y.on("codeEditor:blur",e.onCodeEditorBlur),y.on("blur",e.onBlur),y.installPlugin("widget"),y.installPlugin("mathWidget"),y.installPlugin("codeEditorWidget"),y.on("mathWidget:select",e.onMathWidgetSelect),y.on("mathWidget:paste",e.onMathWidgetPaste),e.editor=y,e.oldValue=e.value})),_defineProperty(_assertThisInitialized(e),"doAction",(function(t){var r=_assertThisInitialized(e),a=r.props,s=r.editor,l=a.onActionDone,w=N[t.type],E=function notifyActionDone(){l(e.getActiveActions(),t),e.onInteraction()},S=function executeDelayedAction(){var t=e.actionInProgress;if(t){var r=N[t.type];e.actionInProgress=!1,e.tryToExecuteCommand(r,t.params)}},T=y.a.contains(["createTable","deleteTable","addTableCells","deleteTableCells","characterMap","insertImage","createFormula","insertHTML"],t.type);t&&("undo"!==t.type&&"redo"!==t.type||!e._hasCodeEditorFocus?T?(e.actionInProgress=t,"insertImage"===t.type?y.a.defer((function(){s.restoreBookmark(),S(),E()})):(s.restoreBookmark(),"deleteTable"===t.type&&s.fire("tableunselect"),S(),E())):(s.focus(!1),"deleteImage"===t.type?e.tryToExecuteCommand("insertImage",{src:null}):e.tryToExecuteCommand(w,t.params),E()):e.tryToExecuteCommand(w,t.params))})),_defineProperty(_assertThisInitialized(e),"onInteraction",y.a.debounce((function(){var t=_assertThisInitialized(e),r=t.props,a=t.oldValue,s=t.value,l=r.onInteraction,y=r.onValueChange;e.editor&&(a!==s&&y(s),l(e.getActiveActions()),e.oldValue=s)}),100)),_defineProperty(_assertThisInitialized(e),"onCodeEditorFocus",(function(){e._hasCodeEditorFocus=!0,e.props.onCodeEditorFocusChange(e._hasCodeEditorFocus)})),_defineProperty(_assertThisInitialized(e),"onCodeEditorBlur",(function(){e._hasCodeEditorFocus=!1,e.props.onCodeEditorFocusChange(e._hasCodeEditorFocus)})),_defineProperty(_assertThisInitialized(e),"onBlur",(function(){(0,_assertThisInitialized(e).props.onInteraction)([])})),_defineProperty(_assertThisInitialized(e),"onMathWidgetSelect",(function(t){(0,_assertThisInitialized(e).props.onMathWidgetSelect)(O.default.getDataFromEvent(t))})),_defineProperty(_assertThisInitialized(e),"onMathWidgetPaste",(function(){var t=e.props.onMathWidgetPaste;y.a.isFunction(t)&&t()})),_defineProperty(_assertThisInitialized(e),"onTableSelectStart",(function(){e.setState({tableCellSelected:!0})})),_defineProperty(_assertThisInitialized(e),"onTableUnselect",(function(){e.setState({tableCellSelected:!1})})),_defineProperty(_assertThisInitialized(e),"tryToExecuteCommand",(function(t,r){try{e.editor.composer.commands.exec(t,r)}catch(e){console.warn(e)}})),_defineProperty(_assertThisInitialized(e),"destroyEditor",(function(){var t=_assertThisInitialized(e).editor;t&&(t.destroy(),delete e.editor)})),_defineProperty(_assertThisInitialized(e),"disable",(function(t){var r=_assertThisInitialized(e).editor;if(r){if(t)return r.plugins.codeEditorWidget.setDisabled(r.composer,!0),r.disable();r.plugins.codeEditorWidget.setDisabled(r.composer,!1),r.enable()}})),e}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(WYSIHTMLEditor,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(e){var t=this;return!!y.a.find(["className","actionToDo","disabled","inactive"],(function(r){return e[r]!==t.props[r]}))}},{key:"render",value:function render(){var e=this,t=this.props,r=t.spellCheck,a=t.autocomplete,l=t.autocapitalize,y=t.autocorrect,w=t.placeholder,E=t.className,S=t.ariaLabel,T=t.uiStyle,O=t.focusButtonInsideToolbar;return s.a.createElement("div",{className:E,style:T,spellCheck:r,autoComplete:a,autoCapitalize:l,autoCorrect:y,"aria-label":S,role:"textbox","aria-multiline":"true",tabIndex:"0",onKeyDown:O&&this.handleKeyDown,"data-placeholder":w,ref:function ref(t){return e.el=t},contentEditable:!0})}},{key:"componentDidMount",value:function componentDidMount(){this.createEditor()}},{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(e){var t=this.props,r=t.actionToDo,a=t.disabled,s=t.inactive;!this.actionInProgress&&e.actionToDo&&(!r||r.type!==e.actionToDo.type)&&this.doAction(e.actionToDo),a!==e.disabled&&this.disable(e.disabled),s!==e.inactive&&e.inactive&&this.editor.saveBookmark()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.destroyEditor()}},{key:"getActiveActions",value:function getActiveActions(){var e=this.state,t=this.editor,r=e.tableCellSelected,a=[];return r&&a.push({action:"editTable"}),t&&y.a.each(N,(function(e,r){var s=t.composer.commands.state(N[r]);s&&a.push({target:s,action:r})})),a}},{key:"value",get:function get(){var e=this.editor;if(e)return e.getValue(!1)}}]),WYSIHTMLEditor}(s.a.Component),R=r(195);function lrnEditor_typeof(e){return(lrnEditor_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function lrnEditor_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function lrnEditor_defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function lrnEditor_setPrototypeOf(e,t){return(lrnEditor_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function lrnEditor_createSuper(e){var t=function lrnEditor_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=lrnEditor_getPrototypeOf(e);if(t){var s=lrnEditor_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return lrnEditor_possibleConstructorReturn(this,r)}}function lrnEditor_possibleConstructorReturn(e,t){if(t&&("object"===lrnEditor_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function lrnEditor_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function lrnEditor_getPrototypeOf(e){return(lrnEditor_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}t.a={WYSIHTML:function wrapEditor(e){return function(t){!function lrnEditor_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lrnEditor_setPrototypeOf(e,t)}(LRNEditor,t);var r=lrnEditor_createSuper(LRNEditor);function LRNEditor(){return lrnEditor_classCallCheck(this,LRNEditor),r.apply(this,arguments)}return function lrnEditor_createClass(e,t,r){return t&&lrnEditor_defineProperties(e.prototype,t),r&&lrnEditor_defineProperties(e,r),e}(LRNEditor,[{key:"componentDidMount",value:function componentDidMount(){this.props.readOnly&&R.a.render({readOnly:!0})}},{key:"render",value:function render(){var t=this.props,r=this.props,a=r.readOnly,l=r.uiStyle,y=this.className,w=this.ariaLabel,E=this.props.responseValue;return a?s.a.createElement("div",{className:y,"aria-label":w,role:"textbox","aria-multiline":"true",dangerouslySetInnerHTML:{__html:E},style:l}):s.a.createElement(e,_extends({},t,{className:y,ariaLabel:w,uiStyle:l,value:E}))}},{key:"className",get:function get(){var e=this.props,t=e.isReviewState,r=e.wordCountExceeded,a=e.className,s=r?"lrn_wordcount_warning":"",l=t?"lrn_response_input_wrapper":"";return"lrn_texteditor_editable  lrn_editor_area  ".concat(a,"  ").concat(s,"  ").concat(l)}},{key:"ariaLabel",get:function get(){return this.props.i18n.labels.editor.inputAriaLabel}}]),LRNEditor}(s.a.Component)}(L)}},,,,function(e,t,r){"use strict";r(1);var a=r(0),s=r.n(a),l=r(8).a.extend({DEFAULT_FORMATTING_OPTIONS:["bold","italic","underline","|","unorderedList","orderedList"],SHOW_WORD_LIMITS:{ALWAYS:"always",ON:"on-limit",OFF:"off"},MAX_WORD_LENGTH:1e4,processResponseValue:function processResponseValue(e){this.hasResponse()||this.set({response:{value:"",wordCount:0,type:this.RESPONSE_TYPE.STRING}},{silent:!0}),this.get("response").value=e.value,this.get("response").wordCount=e.wordCount},getFormattingOptions:function getFormattingOptions(){if(!this._formattingOptions){var e=this.get("question").formatting_options;s.a.isArray(e)||(e=this.DEFAULT_FORMATTING_OPTIONS);var t=this.getCharacterMap(),r=e.indexOf("charactermap");s.a.isArray(t)||!1!==t?r<0&&e.push("charactermap"):!1===t&&r>=0&&Array.prototype.splice.call(e,r,1),this._formattingOptions=e}return this._formattingOptions},getMaxLength:function getMaxLength(){if(!this._maxLength){var e=this.get("question").max_length;(!s.a.isNumber(e)||e<0||e>this.MAX_WORD_LENGTH)&&(e=this.MAX_WORD_LENGTH),this._maxLength=e}return this._maxLength},getWordCount:function getWordCount(){return this.hasResponse()?this.get("response").wordCount:0},getShowWordCount:function getShowWordCount(){if(s.a.isUndefined(this._showWordCount)){var e=this.get("question").show_word_count;this._showWordCount=!s.a.isBoolean(e)||e}return this._showWordCount},getPlaceholder:function getPlaceholder(){return this.get("question").placeholder},getBrowserSpellCheck:function getBrowserSpellCheck(){if(s.a.isUndefined(this._spellCheck)){var e=this.get("question").spellcheck;this._spellCheck=s.a.isBoolean(e)?e:"false"!==e}return this._spellCheck},disableAutoLink:function disableAutoLink(){return this.activity.get("disable_auto_link")||s.a.getNested(this.get("question"),"disable_auto_link")},getCharacterMap:function getCharacterMap(){if(s.a.isUndefined(this._characterMap)){var e=this.get("question"),t=e.character_map,r=s.a.isArray(e.formatting_options)?e.formatting_options:[],a=(s.a.isUndefined(t)||s.a.isArray(t)&&!t.length)&&r.indexOf("charactermap")>=0;this._characterMap=!!a||!(!s.a.isArray(t)&&!s.a.isBoolean(t))&&t}return this._characterMap},getShowWordLimit:function getShowWordLimit(){if(s.a.isUndefined(this._showWordLimit)){var e=this.get("question").show_word_limit,t=this.SHOW_WORD_LIMITS;this._showWordLimit=s.a.contains(t,e)?e:t.ALWAYS}return this._showWordLimit},getUIStyle:function getUIStyle(){return s.a.isUndefined(this._uiStyle)&&(this._uiStyle=s.a.getNested(this.get("question"),"ui_style")||{}),this._uiStyle},isMaxLengthDefined:function isMaxLengthDefined(){return s.a.isUndefined(this._isMaxLengthDefined)&&(this._isMaxLengthDefined=!!this.get("question").max_length),this._isMaxLengthDefined},wordCountExceeded:function wordCountExceeded(){return this.getWordCount()>this.getMaxLength()},hasAllowedResponse:function hasAllowedResponse(){return!(this.hasResponse()&&!this.get("question").submit_over_limit&&this.wordCountExceeded())}});t.a=l},function(e,t,r){var a,s;a=[r(186),r(294),r(278),r(279),r(280),r(281)],void 0===(s=function(e,t){"use strict";return t.addTo(e),e}.apply(t,a))||(e.exports=s)},,,,,,,,,,function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(148),y=r(127),w=r.n(y),E=r(131),S=r(129),T=r(128),O=r.n(T),N=r(145),A=r(142),L=r(151),R=r(184);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function modalWithToggle(e){return function(t){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(_class2,t);var r=_createSuper(_class2);function _class2(){var e;_classCallCheck(this,_class2);for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return _defineProperty(_assertThisInitialized(e=r.call.apply(r,[this].concat(a))),"state",{modalIsOpen:!1}),_defineProperty(_assertThisInitialized(e),"closeModal",(function(){(0,e.props.onModal)(null),e.setState({modalIsOpen:!1})})),_defineProperty(_assertThisInitialized(e),"toggleModal",(function(){var t=e.props.onModal,r=!e.state.modalIsOpen;t(r),e.setState({modalIsOpen:r})})),e}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(_class2,[{key:"render",value:function render(){var t=this.props,r=this.state,a=t.isActive,s=t.visible,l=t.onApply,y=t.getContainer,E=r.modalIsOpen,S=O()({hide:!s});return w.a.createElement(w.a.Fragment,null,w.a.createElement(L.a.Button,_extends({},t,{isActive:a,className:S,onClick:this.toggleModal})),w.a.createElement(e,_extends({},t,{relativeNode:y,modalIsOpen:E,onRequestClose:this.closeModal,onApply:l})))}}]),_class2}(w.a.Component)}var D=r(152);function create_typeof(e){return(create_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function create_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function create_defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function create_setPrototypeOf(e,t){return(create_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function create_createSuper(e){var t=function create_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=create_getPrototypeOf(e);if(t){var s=create_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return create_possibleConstructorReturn(this,r)}}function create_possibleConstructorReturn(e,t){if(t&&("object"===create_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return create_assertThisInitialized(e)}function create_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function create_getPrototypeOf(e){return(create_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function create_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var M=function(e){!function create_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&create_setPrototypeOf(e,t)}(CreateTableModal,e);var t=create_createSuper(CreateTableModal);function CreateTableModal(){var e;create_classCallCheck(this,CreateTableModal);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return create_defineProperty(create_assertThisInitialized(e=t.call.apply(t,[this].concat(a))),"state",{cols:3,rows:2}),create_defineProperty(create_assertThisInitialized(e),"onChange",(function(t,r){e.setState(create_defineProperty({},t,r))})),create_defineProperty(create_assertThisInitialized(e),"onApply",(function(t){var r=e.props,a=r.onApply,s=r.onRequestClose,l=e.state;a({cols:l.cols,rows:l.rows}),s(),t.preventDefault()})),create_defineProperty(create_assertThisInitialized(e),"onCloseWithoutApply",(function(){var t=e.props,r=t.onApply,a=t.onRequestClose;r(null),a()})),e}return function create_createClass(e,t,r){return t&&create_defineProperties(e.prototype,t),r&&create_defineProperties(e,r),e}(CreateTableModal,[{key:"render",value:function render(){var e=this,t=this.props,r=t.i18n,a=t.relativeNode,s=t.modalIsOpen,l=t.responseId,y=r.labels.editor.modals,E=this.state,S=E.cols,T=E.rows,O=S>0&&T>0&&S<100&&T<100;return w.a.createElement(D.a,{getRef:function getRef(t){return e.el=t},title:y.tableTitle,parentNode:a,modalIsOpen:s,onRequestClose:this.onCloseWithoutApply},w.a.createElement("div",{className:"lrn_clearfix"},w.a.createElement("div",{className:"lrn-wysihtml-modal-section"},w.a.createElement("label",{htmlFor:"".concat(l,"-table-columns")},w.a.createElement("span",{className:"lrn-label-title"},y.columns),w.a.createElement("input",{type:"number",id:"".concat(l,"-table-columns"),className:"lrn-editor-input",defaultValue:S,min:"1",max:"99",onChange:function onChange(t){return e.onChange("cols",t.target.value)}}))),w.a.createElement("div",{className:"lrn-wysihtml-modal-section"},w.a.createElement("label",{htmlFor:"".concat(l,"-table-rows")},w.a.createElement("span",{className:"lrn-label-title"},y.rows),w.a.createElement("input",{type:"number",id:"".concat(l,"-table-rows"),className:"lrn-editor-input",defaultValue:T,min:"1",max:"99",onChange:function onChange(t){return e.onChange("rows",t.target.value)}})))),w.a.createElement("hr",null),w.a.createElement("div",{className:"lrn-wysihtml-modal-controls"},w.a.createElement("button",{className:"lrn_btn lrn_btn_blue","data-lrn-action":"apply",onClick:this.onApply,disabled:!O,type:"button"},y.apply)))}}]),CreateTableModal}(w.a.Component);function edit_typeof(e){return(edit_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function edit_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function edit_defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function edit_setPrototypeOf(e,t){return(edit_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function edit_createSuper(e){var t=function edit_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=edit_getPrototypeOf(e);if(t){var s=edit_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return edit_possibleConstructorReturn(this,r)}}function edit_possibleConstructorReturn(e,t){if(t&&("object"===edit_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return edit_assertThisInitialized(e)}function edit_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function edit_getPrototypeOf(e){return(edit_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function edit_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var B=function(e){!function edit_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&edit_setPrototypeOf(e,t)}(EditTableModal,e);var t=edit_createSuper(EditTableModal);function EditTableModal(){var e;edit_classCallCheck(this,EditTableModal);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return edit_defineProperty(edit_assertThisInitialized(e=t.call.apply(t,[this].concat(a))),"onApply",(function(t,r){var a=e.props,s=a.onApply,l=a.onRequestClose;s(r),l(),t.preventDefault()})),e}return function edit_createClass(e,t,r){return t&&edit_defineProperties(e.prototype,t),r&&edit_defineProperties(e,r),e}(EditTableModal,[{key:"render",value:function render(){var e=this,t=this.props,r=t.i18n,a=t.relativeNode,s=t.modalIsOpen,l=t.onRequestClose,y=r.labels.editor.modals;return w.a.createElement(D.a,{getRef:function getRef(t){return e.el=t},title:y.tableTitle,parentNode:a,className:"lrn-wysihtml-modal-table-edit",modalIsOpen:s,onRequestClose:l},w.a.createElement("div",{className:"lrn_clearfix"},w.a.createElement("div",{className:"lrn-wysihtml-modal-section"},w.a.createElement("div",null,w.a.createElement("span",{className:"lrn-label-title"},y.columns)),w.a.createElement("ul",null,w.a.createElement("li",null,w.a.createElement("button",{type:"button",className:"lrn_btn",onMouseDown:function onMouseDown(t){return e.onApply(t,{type:"addTableCells",params:"before"})}},y.insertColumnBefore)),w.a.createElement("li",null,w.a.createElement("button",{type:"button",className:"lrn_btn",onMouseDown:function onMouseDown(t){return e.onApply(t,{type:"addTableCells",params:"after"})}},y.insertColumnAfter)),w.a.createElement("li",null,w.a.createElement("button",{type:"button",className:"lrn_btn",onMouseDown:function onMouseDown(t){return e.onApply(t,{type:"deleteTableCells",params:"column"})}},y.deleteColumn)))),w.a.createElement("div",{className:"lrn-wysihtml-modal-section"},w.a.createElement("div",null,w.a.createElement("span",{className:"lrn-label-title"},y.rows)),w.a.createElement("ul",null,w.a.createElement("li",null,w.a.createElement("button",{type:"button",className:"lrn_btn",onMouseDown:function onMouseDown(t){return e.onApply(t,{type:"addTableCells",params:"above"})}},y.insertRowAbove)),w.a.createElement("li",null,w.a.createElement("button",{type:"button",className:"lrn_btn",onMouseDown:function onMouseDown(t){return e.onApply(t,{type:"addTableCells",params:"below"})}},y.insertRowBelow)),w.a.createElement("li",null,w.a.createElement("button",{type:"button",className:"lrn_btn",onMouseDown:function onMouseDown(t){return e.onApply(t,{type:"deleteTableCells",params:"row"})}},y.deleteRow))))),w.a.createElement("hr",null),w.a.createElement("div",{className:"lrn-wysihtml-modal-controls"},w.a.createElement("button",{type:"button",className:"lrn_btn  lrn_btn_danger",onMouseDown:function onMouseDown(t){return e.onApply(t,{type:"deleteTable"})}},y.deleteTable)))}}]),EditTableModal}(w.a.Component),q={CreateTableButton:modalWithToggle(M),EditTableButton:modalWithToggle(B)},W=r(277),j=r.n(W),H=r(201),V=r(133);function imagePropsUtil_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function generateImageAttributes(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{className:"class"},r=e.url,a=e.size,s=e.naturalWidth,l=e.naturalHeight,y=imagePropsUtil_defineProperty({src:r,width:getImageWidthFromSize(a,s,l)},t.className,O()(imagePropsUtil_defineProperty({},"lrn-size-".concat(a),!!a)));return e.assetPath&&(y["data-asset-path"]=e.assetPath),y}function getImageWidthFromSize(e,t,r){var a,s=t<r,l=s?r:t;((a=e===A.e.SMALL?Math.min(l,A.d.SMALL):e===A.e.MEDIUM?Math.min(l,A.d.MEDIUM):e===A.e.LARGE?Math.min(l,A.d.LARGE):Math.min(l,A.d.FULL_SIZE))||(a=0),s)&&(a=parseInt(a*(t/r),10));return a}var z=r(239);function editor_extends(){return(editor_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function _slicedToArray(e,t){return function _arrayWithHoles(e){if(Array.isArray(e))return e}(e)||function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var a,s,l=[],y=!0,w=!1;try{for(r=r.call(e);!(y=(a=r.next()).done)&&(l.push(a.value),!t||l.length!==t);y=!0);}catch(e){w=!0,s=e}finally{try{y||null==r.return||r.return()}finally{if(w)throw s}}return l}(e,t)||function _unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}(e,t)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function ImageSizeSelection(e){var t=e.naturalWidth,r=e.naturalHeight,a=e.labels,l=e.size,y=e.responseId,E=function getAvailableSizes(e,t){var r=e<t?t:e;if(r<=A.d.SMALL)return null;var a=[A.e.SMALL];return r>A.d.MEDIUM&&a.push(A.e.MEDIUM),r>A.d.LARGE&&a.push(A.e.LARGE),a.push(A.e.FULL_SIZE),a}(t,r);if(!E)return null;var S=s.a.mapObject(a.imageSize,(function(e,a){return function getImageSizeLabel(e){var t=e.label,r=e.size,a=e.naturalWidth,s=e.naturalHeight,l=a/s,y=getImageWidthFromSize(r,a,s)||a,w=parseInt(y/l,10);return Object(V.a)(t,{width:y,height:w})}({label:e,size:a,naturalWidth:t,naturalHeight:r})}));return w.a.createElement("div",{className:"lrn-image-properties"},w.a.createElement("div",{className:"lrn-image-properties-inner"},w.a.createElement("label",{htmlFor:"".concat(y,"-image-size")},w.a.createElement("span",{className:"lrn-label-title lrn-display-block"},a.imageSize.title),w.a.createElement("select",{id:"".concat(y,"-image-size"),value:l,className:"lrn-editor-input",onChange:function onChange(a){return function onSizeChange(a){e.onChange({size:a,width:getImageWidthFromSize(a,t,r)})}(a.target.value)},onBlur:s.a.noop},s.a.map(E,(function(e){return w.a.createElement("option",{key:e,value:e},S[e])}))))))}function ZoomableImage(e){var t=e.naturalWidth,r=e.naturalHeight,a=e.containerDimensions.height,s=t>a&&r>a,l=_slicedToArray(Object(y.useState)(!1),2),E=l[0],S=l[1],T={onClick:function onClick(){return S(s&&!E)}},N=generateImageAttributes(e,{className:"className"});return N.className=O()({"lrn-img-zoom-in":s&&E,"lrn-img-zoom-out":s&&!E},N.className),w.a.createElement("img",editor_extends({alt:""},T,N))}function ImageEditor(e){var t=e.children,r=Object(y.useRef)(null),a=_slicedToArray(Object(y.useState)(0),2),s=a[0],l=a[1];return Object(y.useLayoutEffect)((function(){r.current&&r.current.clientHeight!==s&&l(r.current.clientHeight)})),w.a.createElement("div",null,w.a.createElement("div",{className:"lrn-image-uploader-preview",ref:r},w.a.createElement(ZoomableImage,editor_extends({containerDimensions:{height:s}},e))),t,w.a.createElement(ImageSizeSelection,e))}var U=r(240),G={fileDialog:r.n(U).a},K=r(21),$={LONGTEXTV2_UPDATE_WORD_COUNT:"longtextv2:update:wordcount",LONGTEXTV2_UPDATE_WORD_COUNT_EXCEEDED:"longtextv2:update:wordcountexceeded",LONGTEXTV2_UPDATE_WORD_LIMIT_VISIBILITY:"longtextv2:update:wordlimitvisibility",LONGTEXTV2_DISABLE_EDITOR:"longtextv2:disable:editor"};var Q={actionTypes:$,compressImage:function compressImage(e,t){return function(r,a,s){return s.dataService.compressImage(e,t)}},uploadImage:function actions_uploadImage(e,t){return function(r,a,s){return s.dataService.uploadImage(e,t)}},updateValue:function updateValue(e){return function(t,r,a){var s=a.dataService.getResponse();if((s&&s.value)!==(e=a.dataService.formatValue(e))){t({type:$.LONGTEXTV2_UPDATE_WORD_COUNT,payload:{value:e}});var l=r().longTextV2.footer.wordCount;t(K.a.updateResponseValue({value:e,wordCount:l}));var y=a.dataService.getWordCountExceeded();t({type:$.LONGTEXTV2_UPDATE_WORD_COUNT_EXCEEDED,payload:{value:y}});var w=a.dataService.getWordLimitVisibility();t({type:$.LONGTEXTV2_UPDATE_WORD_LIMIT_VISIBILITY,payload:{value:w}})}}},disableEditor:function disableEditor(e){return{type:$.LONGTEXTV2_DISABLE_EDITOR,payload:{value:e}}}};function uploadModal_typeof(e){return(uploadModal_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){uploadModal_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function uploadModal_extends(){return(uploadModal_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function uploadModal_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function uploadModal_defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function uploadModal_setPrototypeOf(e,t){return(uploadModal_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function uploadModal_createSuper(e){var t=function uploadModal_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=uploadModal_getPrototypeOf(e);if(t){var s=uploadModal_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return uploadModal_possibleConstructorReturn(this,r)}}function uploadModal_possibleConstructorReturn(e,t){if(t&&("object"===uploadModal_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return uploadModal_assertThisInitialized(e)}function uploadModal_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function uploadModal_getPrototypeOf(e){return(uploadModal_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function uploadModal_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Y={url:null,width:0,naturalWidth:0,naturalHeight:0,size:A.e.FULL_SIZE,rotation:0,loading:!1,error:null,warning:null},X=function(e){!function uploadModal_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&uploadModal_setPrototypeOf(e,t)}(UploadImageModal,e);var t=uploadModal_createSuper(UploadImageModal);function UploadImageModal(){var e;uploadModal_classCallCheck(this,UploadImageModal);for(var r=arguments.length,a=new Array(r),l=0;l<r;l++)a[l]=arguments[l];return uploadModal_defineProperty(uploadModal_assertThisInitialized(e=t.call.apply(t,[this].concat(a))),"file",null),uploadModal_defineProperty(uploadModal_assertThisInitialized(e),"state",s.a.extend({},Y)),uploadModal_defineProperty(uploadModal_assertThisInitialized(e),"reset",(function(){e.setState(Y)})),uploadModal_defineProperty(uploadModal_assertThisInitialized(e),"cleanUpAndClose",(function(){e.file=null,e.props.onRequestClose(),e.reset()})),uploadModal_defineProperty(uploadModal_assertThisInitialized(e),"onImageRotationClick",(function(){var t=uploadModal_assertThisInitialized(e),r=t.file,a=t.state,s=t.props,l=a.rotation;return l>-270?l-=90:l=0,e.setState({loading:!0}),s.compressImage(r,{rotation:l}).then(H.c).then((function(t){e.setState({loading:!1,url:t.src,width:t.width,naturalWidth:t.width,naturalHeight:t.height,rotation:l})}))})),uploadModal_defineProperty(uploadModal_assertThisInitialized(e),"startImageSelection",(function(){e.uploadAborted=!1,G.fileDialog({multiple:!1,accept:A.b}).then((function(t){e.processSelectedImage(t[0])}))})),uploadModal_defineProperty(uploadModal_assertThisInitialized(e),"onImageEditorChanged",(function(t){var r=t.width,a=t.size;e.setState({width:r,size:a})})),uploadModal_defineProperty(uploadModal_assertThisInitialized(e),"onCancelButtonClicked",(function(){e.uploadAborted=!0,e.cleanUpAndClose()})),uploadModal_defineProperty(uploadModal_assertThisInitialized(e),"onUploadButtonClicked",(function(t){var r=e.state,a=r.rotation,s=r.naturalWidth,l=e.props.uploadImage,y={rotation:a};return s>A.d.FULL_SIZE&&(y.width=A.d.FULL_SIZE),t.preventDefault(),t.stopPropagation(),e.setState({loading:!0}),l(e.file,y).then((function(t){e.uploadAborted||e.insertImage(t)})).catch((function(){e.showProcessingImageError()}))})),e}return function uploadModal_createClass(e,t,r){return t&&uploadModal_defineProperties(e.prototype,t),r&&uploadModal_defineProperties(e,r),e}(UploadImageModal,[{key:"componentDidUpdate",value:function componentDidUpdate(e){var t=this.props,r=t.modalIsOpen,a=t.selectedFile;e.selectedFile!==a&&(this.file=null,this.uploadAborted=!1,a&&r&&this.processSelectedImage(a))}},{key:"render",value:function render(){var e=this,t=this.props,r=t.i18n,a=t.relativeNode,l=t.responseId,y=t.modalIsOpen,E=this.state,S=E.url,T=E.loading,O=E.warning,N=E.error,A=!(!y||!(this.file||T||N||O)),L=r.labels.editor.modals;return w.a.createElement(D.a,{className:"lrn-full-width",getRef:function getRef(t){return e.el=t},title:L.imageTitle,parentNode:a,modalIsOpen:A,onRequestClose:this.onCancelButtonClicked},w.a.createElement("div",{className:"lrn-image-editor-wrapper"},this.getMessage(),N&&w.a.createElement("div",{className:"lrn-config-btn-upload-wrapper"},w.a.createElement("button",{className:"btn lrn_btn_blue lrn-imageupload-config-btn-upload",type:"button",onClick:this.startImageSelection},L.uploadText)),S&&w.a.createElement(ImageEditor,uploadModal_extends({},this.state,{labels:L,responseId:l,onChange:this.onImageEditorChanged}),w.a.createElement("button",{className:"lrn_btn lrn-btn-outline image-editor-replace-btn",onClick:this.startImageSelection,disabled:T},w.a.createElement("span",{className:"lrn-icon-image image-editor-replace-span"}),L.imageReplace),w.a.createElement("button",{className:"lrn_btn lrn-btn-outline image-editor-rotate-btn",onClick:this.onImageRotationClick,disabled:T},w.a.createElement("span",{className:"lrn-icon-image-rotation image-editor-rotate-span"}),L.imageRotate)),T&&w.a.createElement("div",{className:"lrn-loader-wrapper"},w.a.createElement(z.a,null))),w.a.createElement("hr",null),w.a.createElement("div",{className:"lrn-wysihtml-modal-controls"},w.a.createElement("button",{className:"lrn_btn lrn_btn_blue image-editor-upload-button","data-lrn-action":"upload",onClick:this.onUploadButtonClicked,disabled:s.a.isEmpty(S)||T,type:"button"},L.upload),w.a.createElement("button",{className:"lrn_btn",onClick:this.onCancelButtonClicked,type:"button"},L.cancel)))}},{key:"getMessage",value:function getMessage(){var e=this.state,t=e.error,r=e.warning;if(!t&&!r)return null;var a=this.props.i18n.labels.editor.messages,s=t?"error":"warning",l=t?a.failedLoadingImage:a.imageHasBeenOptimized;return w.a.createElement(j.a,{className:"upload-modal-message",type:s,iconClassMapping:{warning:"lrn-icon-warning",error:"lrn-icon-info"},ariaHidden:!0},l)}},{key:"showProcessingImageError",value:function showProcessingImageError(){this.file=null,this.uploadAborted=!1,this.setState({loading:!1,url:null,error:!0})}},{key:"processSelectedImage",value:function processSelectedImage(e){var t,r=this;return this.setState({loading:!0,error:!1}),Object(H.c)(e).then((function(r){return t=r.width,e})).then((function processImage(){return r.shouldCompress(e,t)?(r.setState({warning:r.shouldShowWarning(e,t)}),t>A.d.FULL_SIZE&&(a={width:A.d.FULL_SIZE}),r.props.compressImage(e,{rotation:0,compressOptions:a})):(r.setState({warning:null,error:null}),Promise.resolve(e));var a})).then((function(e){return r.file=e,Object(H.c)(e)})).then((function(e){return r.setState({loading:!1,url:e.src,width:e.width,naturalWidth:e.width,naturalHeight:e.height,rotation:0})})).catch((function(){r.showProcessingImageError()}))}},{key:"insertImage",value:function insertImage(e){var t=e.url,r=e.assetPath;(0,this.props.onApply)(generateImageAttributes(_objectSpread(_objectSpread({},this.state),{},{url:t,assetPath:r}))),this.cleanUpAndClose()}},{key:"shouldCompress",value:function shouldCompress(e,t){return e.size>this.props.maxFileSize||t>A.d.FULL_SIZE}},{key:"shouldShowWarning",value:function shouldShowWarning(e,t){return e.size>this.props.warningFileSize||t>A.d.FULL_SIZE}}]),UploadImageModal}(w.a.PureComponent),Z=S.b((function(e){return{maxFileSize:e.longTextV2.maxFileSize,warningFileSize:e.longTextV2.warningFileSize}}),(function(e){return{compressImage:E.b(Q.compressImage,e),uploadImage:E.b(Q.uploadImage,e)}}))(X);function insertImageButton_extends(){return(insertImageButton_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function insertImageButton_slicedToArray(e,t){return function insertImageButton_arrayWithHoles(e){if(Array.isArray(e))return e}(e)||function insertImageButton_iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var a,s,l=[],y=!0,w=!1;try{for(r=r.call(e);!(y=(a=r.next()).done)&&(l.push(a.value),!t||l.length!==t);y=!0);}catch(e){w=!0,s=e}finally{try{y||null==r.return||r.return()}finally{if(w)throw s}}return l}(e,t)||function insertImageButton_unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return insertImageButton_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return insertImageButton_arrayLikeToArray(e,t)}(e,t)||function insertImageButton_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function insertImageButton_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function editorModal_typeof(e){return(editorModal_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function editorModal_extends(){return(editorModal_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function editorModal_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function editorModal_defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function editorModal_setPrototypeOf(e,t){return(editorModal_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function editorModal_createSuper(e){var t=function editorModal_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=editorModal_getPrototypeOf(e);if(t){var s=editorModal_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return editorModal_possibleConstructorReturn(this,r)}}function editorModal_possibleConstructorReturn(e,t){if(t&&("object"===editorModal_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return editorModal_assertThisInitialized(e)}function editorModal_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function editorModal_getPrototypeOf(e){return(editorModal_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function editorModal_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var J={url:null,align:"",width:0,naturalWidth:0,size:A.e.FULL_SIZE},ee={InsertImageButton:function InsertImageButton(e){var t=insertImageButton_slicedToArray(Object(y.useState)(!1),2),r=t[0],a=t[1],l=insertImageButton_slicedToArray(Object(y.useState)(null),2),E=l[0],S=l[1],T=e.isActive,N=e.visible,R=e.onApply,D=e.getContainer,M=e.onModal,B=e.editableElementSelector,q=O()({hide:!N}),W=s.a.debounce((function(){S(null),G.fileDialog({multiple:!1,accept:A.b}).then((function(e){M(!0),a(!0),S(e[0])}))}),10,!0),j=function(){var e=D();if(e){var t=e.querySelector(B),r=t&&t.querySelectorAll("img");return!!(r&&r.length>=A.f)}return!1}();return w.a.createElement(w.a.Fragment,null,w.a.createElement(L.a.Button,insertImageButton_extends({},e,{isActive:T,disabled:e.disabled||j,className:q,onClick:W})),w.a.createElement(Z,insertImageButton_extends({},e,{selectedFile:E,relativeNode:D,modalIsOpen:r,onRequestClose:function closeModal(){M(null),S(null),a(!1)},onApply:R})))},EditImageButton:modalWithToggle(function(e){!function editorModal_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&editorModal_setPrototypeOf(e,t)}(ImageEditorModal,e);var t=editorModal_createSuper(ImageEditorModal);function ImageEditorModal(){var e;editorModal_classCallCheck(this,ImageEditorModal);for(var r=arguments.length,a=new Array(r),l=0;l<r;l++)a[l]=arguments[l];return editorModal_defineProperty(editorModal_assertThisInitialized(e=t.call.apply(t,[this].concat(a))),"state",s.a.extend({},J)),editorModal_defineProperty(editorModal_assertThisInitialized(e),"cleanUpAndClose",(function(){e.setState(J),e.props.onRequestClose()})),editorModal_defineProperty(editorModal_assertThisInitialized(e),"onImageEditorChanged",(function(t){var r=t.width,a=t.size;e.setState({width:r,size:a})})),editorModal_defineProperty(editorModal_assertThisInitialized(e),"onApply",(function(t){var r=e.props.onApply,a=generateImageAttributes(e.state);t.preventDefault(),t.stopPropagation(),r(a),e.cleanUpAndClose()})),e}return function editorModal_createClass(e,t,r){return t&&editorModal_defineProperties(e.prototype,t),r&&editorModal_defineProperties(e,r),e}(ImageEditorModal,[{key:"componentDidUpdate",value:function componentDidUpdate(){var e=this.props,t=e.image;e.modalIsOpen&&t&&this.state.url!==t.url&&this.setState(s.a.extend({},J,t))}},{key:"render",value:function render(){var e=this,t=this.state.url,r=this.props,a=r.i18n,s=r.relativeNode,l=r.responseId,y=r.modalIsOpen,E=a.labels.editor.modals;return w.a.createElement(w.a.Fragment,null,w.a.createElement(D.a,{className:"lrn-full-width",getRef:function getRef(t){return e.el=t},title:E.imageTitle,parentNode:s,modalIsOpen:y,onRequestClose:this.cleanUpAndClose},t&&w.a.createElement(w.a.Fragment,null,w.a.createElement(ImageEditor,editorModal_extends({},this.state,{labels:E,responseId:l,onChange:this.onImageEditorChanged})),w.a.createElement("hr",null),w.a.createElement("div",{className:"lrn-wysihtml-modal-controls"},w.a.createElement("button",{className:"lrn_btn lrn_btn_blue editor-modal-blue-button","data-lrn-action":"apply",onClick:this.onApply,type:"button"},E.apply),w.a.createElement("button",{className:"lrn_btn","data-lrn-action":"cancel",onClick:this.cleanUpAndClose,type:"button"},E.cancel)))))}}]),ImageEditorModal}(w.a.PureComponent))};function subToolbar_extends(){return(subToolbar_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var te=function getImageFromProps(e){var t=s.a.findWhere(e.activeActions,{action:"insertImage"}),r=t&&t.target;return r?function getImageProps(e){var t,r,a,s=e.naturalWidth,l=e.naturalHeight,y=e.width,w=e.src,E=e.className;return{naturalWidth:s,naturalHeight:l,url:w,width:y||0,size:(t=E,r="lrn-size-(\\S+)",a=new RegExp(r,"g").exec(t),(a&&a.length>=2?a[1]:"")||A.e.FULL_SIZE)}}(r):null};function ImageEditorSubControl(e){var t=e.image,r=e.i18n,a=e.onClick,s=e.onModal,l=r.labels.editor.toolbar,y=!!t;return w.a.createElement(w.a.Fragment,null,w.a.createElement(ee.EditImageButton,subToolbar_extends({},e,{name:"editImage",image:t,getImage:function getImage(){return t},icon:A.a.image.icons.edit,label:l.editImage,isActive:!1,visible:!0,disabled:!y,onApply:function onApply(e){return a({type:"insertImage",params:e})},onModal:function onModal(e){return s(e?"editImage":null)}})),w.a.createElement(L.a.Button,subToolbar_extends({},e,{name:"preview",icon:A.a.image.icons.preview,label:l.previewImage,disabled:!y,onClick:function onClick(){return a({type:"previewImage",url:t.url})}})),w.a.createElement(L.a.Button,subToolbar_extends({},e,{name:"delete",icon:A.a.image.icons.delete,label:l.deleteImage,disabled:!y,onClick:function onClick(){return a({type:"deleteImage"})}})))}function SubToolbar(e){var t=te(e),r=O()({in:!!t},"lrn-sub-toolbar lrn-wysihtml-toolbar lrn-animation-dropdown");return w.a.createElement("div",{className:r},s.a.contains(e.formattingOptions,"image")&&w.a.createElement(ImageEditorSubControl,subToolbar_extends({},e,{image:t})))}var ne=r(272);function toolbar_typeof(e){return(toolbar_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function toolbar_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function toolbar_defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function toolbar_setPrototypeOf(e,t){return(toolbar_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function toolbar_createSuper(e){var t=function toolbar_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=toolbar_getPrototypeOf(e);if(t){var s=toolbar_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return toolbar_possibleConstructorReturn(this,r)}}function toolbar_possibleConstructorReturn(e,t){if(t&&("object"===toolbar_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return toolbar_assertThisInitialized(e)}function toolbar_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function toolbar_getPrototypeOf(e){return(toolbar_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function toolbar_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e))return toolbar_arrayLikeToArray(e)}(e)||function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function toolbar_unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return toolbar_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return toolbar_arrayLikeToArray(e,t)}(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function toolbar_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function toolbar_extends(){return(toolbar_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var re="ArrowRight",ie="ArrowLeft";function getControls(e,t){return s.a.reduce(e.formattingOptions,(function(r,a){var s=A.a[a],l=r.length,y={control:s,key:a,index:l,props:e,selectedIndex:t};if(s&&(r.push(getControl(y)),"table"===a)){var w={control:A.a.editTable,key:"editTable",index:l+1,props:e,selectedIndex:t};r.push(getControl(w))}return r}),[])}function getControl(e){var t=e.control,r=e.key,a=e.index,l=e.props,y=e.selectedIndex,E=l.i18n,S=l.isChemistry,T=l.disabled,O=l.activeModal,N=l.formulaEditorHorizontalLayout,A=l.formulaEditorNumberPad,D=l.formulaEditorSymbols,M=l.formulaEditorTextBlocks,B=l.modalData,W=l.activeActions,j=l.onClick,H=l.onModal,V=l.onMouseEnter,z=l.onMouseLeave,U=l.characterMapModalClassName,G=l.focusButtonInsideToolbar,K=l.hasCodeEditorFocus,$=l.disableSpokenmathUserInputs,Q=E.labels.ariaLabel,Y=t.icon,X=t.type,Z=E.labels.editor.toolbar[r],J=!!s.a.findWhere(W,{action:r}),te="".concat(r).concat(a),re=a===y?0:-1;switch(X){case"divider":return w.a.createElement(L.a.Divider,{key:te,name:X});case"button":return w.a.createElement(L.a.Button,toolbar_extends({},l,{key:te,name:r,icon:Y,label:Z,tabIndex:re,isActive:J,disabled:"undo"!==r&&"redo"!==r?T||K:T,onClick:function onClick(){return j({type:r})}}));case"charactermap":var ie=l.characterMap,oe=!0===ie?_toConsumableArray(E.labels.characterMapCharacters):ie;return w.a.createElement(R.a.CharacterMapButton,{key:te,label:E.labels.characterMapIcon,title:E.labels.characterMapTitle,disabled:T||K,characters:oe,className:"lrn-wysihtml-toolbar",modalClassName:U,tabIndex:re,recoverFocus:G,onMouseEnter:function onMouseEnter(){return V(E.labels.characterMapTitle)},onMouseLeave:z,onSelect:function onSelect(e){return j({type:"characterMap",params:e})}});case"characterMathMap":var ae=_toConsumableArray(E.labels.characterMapMathCharacters);return(w.a.createElement(R.a.CharacterMapButton,{key:te,label:E.labels.characterMapMathIcon,title:E.labels.characterMathMapTitle,onMouseEnter:function onMouseEnter(){return V(E.labels.characterMathMapTitle)},onMouseLeave:z,disabled:T||K,characters:ae,tabIndex:re,recoverFocus:G,className:"lrn-wysihtml-toolbar",modalClassName:U,onSelect:function onSelect(e){return j({type:"characterMap",params:e})}}));case"createTable":var se=s.a.findWhere(W,{action:"editTable"});return(w.a.createElement(q.CreateTableButton,toolbar_extends({},l,{key:te,name:r,icon:Y,tabIndex:re,label:Z,disabled:T||K,visible:!se,onApply:function onApply(e){return j({type:"createTable",params:e})},onModal:function onModal(e){return H(e?"createTable":null)}})));case"editTable":return w.a.createElement(q.EditTableButton,toolbar_extends({},l,{key:te,name:r,icon:Y,tabIndex:re,label:E.labels.editor.editTable,isActive:J,visible:J,disabled:T||K,onApply:function onApply(e){return j({type:e.type,params:e.params})},onModal:function onModal(e){return H(e?"editTable":null)}}));case"insertImage":return w.a.createElement(ee.InsertImageButton,{i18n:E,getContainer:l.getContainer,editableElementSelector:l.editableElementSelector,responseId:l.responseId,key:te,name:"insertImage",icon:Y,tabIndex:re,label:Z,visible:!0,disabled:T||K,onMouseEnter:V,onMouseLeave:z,onApply:function onApply(e){return j({type:"insertImage",params:e})},onModal:function onModal(e){return H(e?"insertImage":null)}});case"formulaEditor":return w.a.createElement(ne.a.FormulaEditorButton,{activeModal:O,className:"lrn-wysihtml-toolbar",disabled:T||K,getContainer:l.getContainer,disableSpokenmathUserInputs:$,horizontalLayout:N,i18n:E,icon:Y,isActive:J,isChemistry:S,key:te,modalData:B,onApply:function onApply(e){return j(e)},onModal:H,onMouseEnter:function onMouseEnter(){return V(Q.mathKeyboard.title)},onMouseLeave:z,tabIndex:re,symbols:D,textBlocks:M,numberPad:A,title:Q.mathKeyboard.title});default:return null}}function lrnToolbar_extends(){return(lrnToolbar_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var oe={WYSIHTML:function withWYSIHTML(e){return function(t){return t.isReviewState?null:w.a.createElement(e,lrnToolbar_extends({},t,{className:"lrn-wysihtml-toolbar",activeClassName:"wysihtml-command-active",role:"group"}))}}(function(e){!function toolbar_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&toolbar_setPrototypeOf(e,t)}(Toolbar,e);var t=toolbar_createSuper(Toolbar);function Toolbar(){var e;toolbar_classCallCheck(this,Toolbar);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return toolbar_defineProperty(toolbar_assertThisInitialized(e=t.call.apply(t,[this].concat(a))),"state",{index:0}),toolbar_defineProperty(toolbar_assertThisInitialized(e),"handleKeyDown",(function(t){t.stopPropagation();var r=t.key;if(r===ie||r===re){var a=e.rovingTabIndex(r);e.setState({index:a})}})),toolbar_defineProperty(toolbar_assertThisInitialized(e),"rovingTabIndex",(function(t){for(var r=toolbar_assertThisInitialized(e),a=r.props,s=r.state,l=getControls(a,s.index),y=e.moveIndex(s.index,t,l.length);"divider"===l[y].props.name||"editTable"===l[y].props.name;)y=e.moveIndex(y,t,l.length);return y})),toolbar_defineProperty(toolbar_assertThisInitialized(e),"moveIndex",(function(e,t,r){var a=e;return t===ie?a--:t===re&&a++,Math.max(Math.min(a,r-1),0)})),e}return function toolbar_createClass(e,t,r){return t&&toolbar_defineProperties(e.prototype,t),r&&toolbar_defineProperties(e,r),e}(Toolbar,[{key:"componentDidUpdate",value:function componentDidUpdate(e,t){this.state.index!==t.index&&this.props.focusButtonInsideToolbar()}},{key:"render",value:function render(){var e=this.props,t=this.state,r=e.i18n.labels.ariaLabel,a=getControls(e,t.index),s=O()({"lrn-toolbar-rtl":e.toolbarRtlEditingMode},e.className,"lrn_clearfix");return w.a.createElement("div",{className:"lrn-toolbar"},w.a.createElement("div",{ref:e.toolbarRef,onKeyDown:this.handleKeyDown,className:s,role:"toolbar","aria-label":r.longTextV2.toolbar},a),w.a.createElement(SubToolbar,e))}}]),Toolbar}(w.a.Component))};function preview_typeof(e){return(preview_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function preview_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function preview_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?preview_ownKeys(Object(r),!0).forEach((function(t){preview_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):preview_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function preview_extends(){return(preview_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function preview_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function preview_defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function preview_createClass(e,t,r){return t&&preview_defineProperties(e.prototype,t),r&&preview_defineProperties(e,r),e}function preview_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&preview_setPrototypeOf(e,t)}function preview_setPrototypeOf(e,t){return(preview_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function preview_createSuper(e){var t=function preview_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=preview_getPrototypeOf(e);if(t){var s=preview_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return preview_possibleConstructorReturn(this,r)}}function preview_possibleConstructorReturn(e,t){if(t&&("object"===preview_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return preview_assertThisInitialized(e)}function preview_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function preview_getPrototypeOf(e){return(preview_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function preview_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ae={fullSize:!1,scrollPosition:null,zoomable:!1,imageSizeText:""},se=function(e){preview_inherits(ImagePreview,e);var t=preview_createSuper(ImagePreview);function ImagePreview(){var e;preview_classCallCheck(this,ImagePreview);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return preview_defineProperty(preview_assertThisInitialized(e=t.call.apply(t,[this].concat(a))),"state",preview_objectSpread({},ae)),preview_defineProperty(preview_assertThisInitialized(e),"onImageClick",(function(t){if(t.preventDefault(),t.stopPropagation(),e.state.fullSize)e.onToggleFullSize();else{var r=t.currentTarget.getBoundingClientRect(),a=(t.clientX-r.left)/r.width,s=(t.clientY-r.top)/r.height;e.setState({fullSize:!0},(function(){e.scrollToPosition(a,s)}))}})),preview_defineProperty(preview_assertThisInitialized(e),"validateImageSize",(function(){if(e.image&&e.imageWrapper){var t=e.props.labels,r=e.image,a=r.naturalWidth,s=r.naturalHeight,l=e.imageWrapper.getBoundingClientRect();e.setState({imageSizeText:Object(V.a)(t.imagePreviewText,{width:a,height:s}),zoomable:a>l.width||s>l.height})}})),preview_defineProperty(preview_assertThisInitialized(e),"close",(function(){e.setState(ae),e.props.onClose()})),preview_defineProperty(preview_assertThisInitialized(e),"onToggleFullSize",(function(){e.setState({fullSize:!e.state.fullSize})})),e}return preview_createClass(ImagePreview,[{key:"render",value:function render(){var e=this,t=this.props,r=this.state,a=t.url,s=t.labels,l=r.fullSize,y=r.zoomable,E=r.imageSizeText;if(!a)return null;var S=O()({"full-size":l,zoomable:y}),T=y?{onClick:this.onImageClick}:{};return w.a.createElement("div",{className:"lrn-image-preview"},w.a.createElement("div",{className:"lrn-image-preview-toolbar"},w.a.createElement("div",{className:"lrn-image-preview-size-label"},E),w.a.createElement("div",{className:"lrn-image-preview-control"},w.a.createElement("a",{className:"lrn_btn lrn-btn-outline snow-theme",href:a,target:"_blank"},s.openImageURL),y&&w.a.createElement("button",{className:"lrn_btn lrn-btn-outline snow-theme",onClick:this.onToggleFullSize,type:"button"},l?s.zoomOut:s.zoomIn)),w.a.createElement("div",{className:"close-button"},w.a.createElement("button",{className:"lrn_btn lrn-btn-outline snow-theme lrn-btn-close",type:"button",onClick:this.close},w.a.createElement("span",{className:"lrn-icon-clear"})))),w.a.createElement("div",{className:"lrn-image-wrapper-container"},w.a.createElement("div",{className:"lrn-image-wrapper",ref:function ref(t){return e.imageWrapper=t}},w.a.createElement("img",preview_extends({src:a,className:S,onLoad:this.validateImageSize,ref:function ref(t){return e.image=t},alt:s.imageTitle},T)))))}},{key:"scrollToPosition",value:function scrollToPosition(e,t){var r=this.image.getBoundingClientRect(),a=r.width,s=r.height,l=this.imageWrapper.getBoundingClientRect(),y=parseInt(e*a-l.width/2,10),w=parseInt(t*s-l.height/2,10);this.imageWrapper.scrollTop=w,this.imageWrapper.scrollLeft=y}}]),ImagePreview}(w.a.PureComponent),le=function withImageClickDetection(e){return function(t){preview_inherits(_class2,t);var r=preview_createSuper(_class2);function _class2(){var e;preview_classCallCheck(this,_class2);for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return preview_defineProperty(preview_assertThisInitialized(e=r.call.apply(r,[this].concat(a))),"state",{url:null}),preview_defineProperty(preview_assertThisInitialized(e),"onContainerClick",(function(t){t.preventDefault(),t.stopPropagation(),"IMG"===t.target.tagName&&(e.setState({url:t.target.src}),e.props.onOpen())})),preview_defineProperty(preview_assertThisInitialized(e),"onClose",(function(){e.setState({url:null}),e.props.onClose()})),e}return preview_createClass(_class2,[{key:"componentDidMount",value:function componentDidMount(){this.container=this.props.getContainer(),this.container.addEventListener("click",this.onContainerClick)}},{key:"componentDidUpdate",value:function componentDidUpdate(e,t){t.url!==this.state.url&&(this.state.url?this.container.removeEventListener("click",this.onContainerClick):this.container.addEventListener("click",this.onContainerClick))}},{key:"render",value:function render(){return w.a.createElement(e,preview_extends({},this.props,{url:this.state.url,onClose:this.onClose}))}}]),_class2}(w.a.PureComponent)}(se),ce=r(253);function Tooltip(e){var t=e.disabled,r=e.activeAction;return t?null:w.a.createElement("span",null,r)}function LengthIndicator(e){var t=e.wordCountExceeded,r="lrn_length_indicator  ".concat(t?"lrn_wordcount_warning_label":"");return w.a.createElement("span",{className:r}," ",w.a.createElement(WordCount,e),w.a.createElement(WordStatic,e),w.a.createElement(WordLimit,e),w.a.createElement(AccessibleCounter,e))}function WordCount(e){var t=e.wordCountVisible,r=e.wordCount;return t?w.a.createElement("span",{className:"lrn_word_count"},r):null}function AccessibleCounter(e){var t=e.textToAnnounce;return(w.a.createElement("span",{className:"sr-only","aria-live":"polite","aria-atomic":"true"},t))}function WordStatic(e){var t=e.wordStaticVisible,r=e.wordCountVisible,a=e.i18n.labels.word;return t&&r?w.a.createElement("span",{className:"lrn_static_words"},a):null}function WordLimit(e){var t=e.wordLimitVisible,r=e.wordCountVisible,a=e.wordMaxLength,s=r?" /":"",l=e.i18n.labels.wordLength,y="".concat(s," ").concat(a," ").concat(l);return t?w.a.createElement("span",{className:"lrn_word_limit"},y):null}var ue=function Footer(e){return w.a.createElement("footer",{className:"lrn-toolbar-footer  lrn_clearfix"},w.a.createElement("div",{className:"lrn_toolbar_footer_left"},w.a.createElement(Tooltip,e)),w.a.createElement("div",{className:"lrn_toolbar_footer_right"},w.a.createElement(LengthIndicator,e)))},de=r(32);function longTextV2_typeof(e){return(longTextV2_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function longTextV2_extends(){return(longTextV2_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function longTextV2_defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function longTextV2_setPrototypeOf(e,t){return(longTextV2_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function longTextV2_createSuper(e){var t=function longTextV2_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=longTextV2_getPrototypeOf(e);if(t){var s=longTextV2_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return longTextV2_possibleConstructorReturn(this,r)}}function longTextV2_possibleConstructorReturn(e,t){if(t&&("object"===longTextV2_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return longTextV2_assertThisInitialized(e)}function longTextV2_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function longTextV2_getPrototypeOf(e){return(longTextV2_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function longTextV2_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var he=function(e){!function longTextV2_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&longTextV2_setPrototypeOf(e,t)}(LongTextV2,e);var t=longTextV2_createSuper(LongTextV2);function LongTextV2(e){var r;return function longTextV2_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,LongTextV2),longTextV2_defineProperty(longTextV2_assertThisInitialized(r=t.call(this,e)),"state",{toolbarActiveActions:[],toolbarRtlEditingMode:de.a.isRtl(),footerActiveAction:null,isPreviewingImage:!1,previewingImageUrl:null,hasCodeEditorFocus:!1,actionToDo:null,activeModal:null,modalData:null,container:null,textToAnnounce:""}),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"toolbarRef",w.a.createRef()),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"setContainerElement",(function(e){return r.el=e})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"getContainerElement",(function(){return r.el})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"onImagePreviewOpened",(function(){return r.setState({isPreviewingImage:!0})})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"onImagePreviewClosed",(function(){return r.setState({isPreviewingImage:!1,previewingImageUrl:null})})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"focusButtonInsideToolbar",(function(){var e=r.toolbarRef.current.querySelector("[tabIndex='0']");e&&e.focus()})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"onToolbarControlHover",(function(e){r.setState({footerActiveAction:e})})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"onToolbarActionToDo",(function(e){e&&"previewImage"===e.type?(r.setState({previewingImageUrl:e.url}),r.onImagePreviewOpened()):r.setState({actionToDo:e})})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"onEditorActionDone",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.type,l=s()([A.c.EDIT_FORMULA,A.c.CREATE_FORMULA]).contains(a);l&&r.props.renderMath(),r.setState(s.a.extend(getToolbarState(e),{actionToDo:null}))})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"onEditorInteraction",(function(e){r.setState(getToolbarState(e))})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"onEditorValueChange",(function(e){r.props.longTextV2Actions.updateValue(e),r.updateAriaLiveText()})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"onMathWidgetPaste",(function(){r.props.renderMath()})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"onMathWidgetSelect",(function(e){r.onModal(A.g.FORMULA_EDITOR,e)})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"updateAriaLiveText",(function(){var e=r.getWordLimitText();setTimeout((function(){return!r._unmounted&&r.setState({textToAnnounce:e})}),500)})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"getWordLimitText",(function(){var e=r.props.longTextV2.footer,t=e.wordCount,a=e.wordMaxLength,s=e.wordCountVisible,l=e.wordLimitVisible,y="of ".concat(a," allowed");return s?"".concat(t," words written ").concat(l?y:""):""})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"onModal",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r.setState({modalData:t,activeModal:e})})),longTextV2_defineProperty(longTextV2_assertThisInitialized(r),"onCodeEditorFocusChange",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];r.state.hasCodeEditorFocus!==e&&r.setState({hasCodeEditorFocus:e})})),r.onEditorValueChange=s.a.debounce(r.onEditorValueChange,500).bind(longTextV2_assertThisInitialized(r)),r.updateAriaLiveText=s.a.debounce(r.updateAriaLiveText,500),r}return function longTextV2_createClass(e,t,r){return t&&longTextV2_defineProperties(e.prototype,t),r&&longTextV2_defineProperties(e,r),e}(LongTextV2,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(){return!this._unmounted}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._unmounted=!0}},{key:"render",value:function render(){var e=this,t=this.props,r=t.base,a=t.longTextV2,l=t.canInsertImage,y=r.isReviewState,E=r.isPreviewState,S=r.readOnly,T=r.disabled,A=r.i18n,L=r.fontSizeClass,R=r.responseId,D=a.wordCountExceeded,M=a.disableAutoLink,B=this.state,q=B.toolbarActiveActions,W=B.toolbarRtlEditingMode,j=B.isPreviewingImage,H=B.previewingImageUrl,V=B.footerActiveAction,z=B.hasCodeEditorFocus,U=B.actionToDo,G=B.activeModal,K=B.modalData,$=B.container,Q=B.textToAnnounce,Y=O()({lrn_texteditor_inactive:G,lrn_hide:j},"lrn_texteditor"),X=T||S,Z=O()({lrn_active:z},"lrn_longtextinput"),J="chemistryessayV2"===r.questionType,ee=r.disableSpokenmathUserInputs,te=a.toolbar.formattingOptions,ne=!s.a.contains(te,"image"),re=!s.a.contains(te,"formulaEditor"),ie=A.labels.longTextV2,ae=ie.invalidExternalImageWarning,de=ie.invalidExternalMathWarning;return w.a.createElement(N.a,{responsive:l},w.a.createElement("div",{className:"lrn_response_input_wrapper"},w.a.createElement("div",{className:Y,ref:this.setContainerElement},w.a.createElement(oe.WYSIHTML,longTextV2_extends({},a.toolbar,{toolbarRtlEditingMode:W,isReviewState:y,isPreviewState:E,disableSpokenmathUserInputs:ee,i18n:A,isChemistry:J,characterMapModalClassName:L,disabled:X||G,hasCodeEditorFocus:z,activeActions:q,activeModal:G,modalData:K,responseId:R,getContainer:function getContainer(){return $},editableElementSelector:".".concat(Z),onMouseEnter:this.onToolbarControlHover,onMouseLeave:function onMouseLeave(){return e.onToolbarControlHover(null)},onClick:this.onToolbarActionToDo,onModal:this.onModal,focusButtonInsideToolbar:this.focusButtonInsideToolbar,toolbarRef:this.toolbarRef})),w.a.createElement(ce.a.WYSIHTML,longTextV2_extends({},a.lrnEditor,{isReviewState:y,readOnly:S,className:Z,disabled:X,inactive:!!G,i18n:A,wordCountExceeded:D,actionToDo:U,focusButtonInsideToolbar:this.focusButtonInsideToolbar,onInteraction:this.onEditorInteraction,onValueChange:this.onEditorValueChange,onActionDone:this.onEditorActionDone,onMathWidgetSelect:this.onMathWidgetSelect,onMathWidgetPaste:this.onMathWidgetPaste,onCodeEditorFocusChange:this.onCodeEditorFocusChange,disableAutoLink:M,invalidExternalImageWarning:ae,invalidExternalMathWarning:de,stripExternalPastedImages:ne,stripExternalPastedMath:re})),w.a.createElement(ue,longTextV2_extends({},a.footer,{textToAnnounce:Q,i18n:A,disabled:X,wordCountExceeded:D,activeAction:V}))),S&&w.a.createElement(le,{labels:A.labels.editor.modals,getContainer:this.getContainerElement,onOpen:this.onImagePreviewOpened,onClose:this.onImagePreviewClosed}),!S&&l&&w.a.createElement(se,{url:H,labels:A.labels.editor.modals,visible:j,getContainer:this.getContainerElement,onOpen:this.onImagePreviewOpened,onClose:this.onImagePreviewClosed})))}},{key:"componentDidMount",value:function componentDidMount(){this.setState({container:this.el})}}]),LongTextV2}(w.a.Component);function getToolbarState(e){return{toolbarActiveActions:e,toolbarRtlEditingMode:s.a.isEmpty(e)?de.a.isRtl():s.a.some(e,{action:"textDirectionRtl"})}}var pe=S.b((function(e){return{base:e.base,longTextV2:e.longTextV2,canInsertImage:s.a.contains(e.longTextV2.toolbar.formattingOptions,"image")}}),(function(e){return{longTextV2Actions:E.b(Q,e),renderMath:E.b(K.a.renderMathIfRequired,e)}}))(he),fe=r(27),me=r(208),ge=r(202),ye=r(242),ve=r(195);function dataService_typeof(e){return(dataService_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dataService_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function dataService_defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(e,t,r){var a=function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=dataService_getPrototypeOf(e)););return e}(e,t);if(a){var s=Object.getOwnPropertyDescriptor(a,t);return s.get?s.get.call(r):s.value}})(e,t,r||e)}function dataService_setPrototypeOf(e,t){return(dataService_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function dataService_createSuper(e){var t=function dataService_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=dataService_getPrototypeOf(e);if(t){var s=dataService_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return dataService_possibleConstructorReturn(this,r)}}function dataService_possibleConstructorReturn(e,t){if(t&&("object"===dataService_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return dataService_assertThisInitialized(e)}function dataService_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dataService_getPrototypeOf(e){return(dataService_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var be=function(e){!function dataService_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dataService_setPrototypeOf(e,t)}(LongTextV2DataService,e);var t=dataService_createSuper(LongTextV2DataService);function LongTextV2DataService(e,r){var a;return function dataService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,LongTextV2DataService),a=t.call(this,e,r),Object(me.a)(dataService_assertThisInitialized(a)),Object(ye.a)(dataService_assertThisInitialized(a)),a}return function dataService_createClass(e,t,r){return t&&dataService_defineProperties(e.prototype,t),r&&dataService_defineProperties(e,r),e}(LongTextV2DataService,[{key:"getInitialState",value:function getInitialState(){var e=_get(dataService_getPrototypeOf(LongTextV2DataService.prototype),"getInitialState",this).call(this),t=this.placeholder,r=this.browserSpellCheck,a=Object(ge.a)(r),l=Object(ge.b)(r),y=Object(ge.c)(r),w=this.isReviewState?this.getReviewResponseValue():this.responseValue,E=this.uiStyle,S=this.wordCount,T=this.wordCountExceeded,O=this.wordCountVisible,N=this.wordLimitVisibility,A=N.wordStatic,L=N.wordLimit,R=this.wordMaxLength,D=this.formattingOptions,M=this.characterMap,B=this.disableAutoLink,q=this.formulaEditorHorizontalLayout,W=this.formulaEditorSymbols,j=this.formulaEditorTextBlocks,H=this.formulaEditorNumberPad;return s.a.extend(e,{longTextV2:{wordCountExceeded:T,disableAutoLink:B,maxFileSize:this.maxFileSize,warningFileSize:this.warningFileSize,toolbar:{formattingOptions:D,characterMap:M,formulaEditorHorizontalLayout:q,formulaEditorNumberPad:H,formulaEditorSymbols:W,formulaEditorTextBlocks:j},lrnEditor:{placeholder:t,spellCheck:r,autocapitalize:a,autocomplete:l,autocorrect:y,responseValue:w,uiStyle:E},footer:{wordCount:S,wordCountVisible:O,wordStaticVisible:A,wordLimitVisible:L,wordMaxLength:R}}})}},{key:"getWordLimitVisibility",value:function getWordLimitVisibility(){return this.wordLimitVisibility}},{key:"getWordCountExceeded",value:function getWordCountExceeded(){return this.wordCountExceeded}},{key:"formatValue",value:function formatValue(e){return e=(e||"").replace(/<p[^>]*>\s?<\/p>/gi,"")}},{key:"wordLimitVisibility",get:function get(){var e,t,r=this.model,a=r.SHOW_WORD_LIMITS,s=r.getShowWordLimit();return s===a.ALWAYS||s===a.ON&&this.wordCountExceeded?(t=!0,e=!1):(t=!1,e=!0),{wordLimit:t,wordStatic:e}}},{key:"placeholder",get:function get(){return this.model.getPlaceholder()}},{key:"browserSpellCheck",get:function get(){return this.model.getBrowserSpellCheck()}},{key:"disableAutoLink",get:function get(){return this.model.disableAutoLink()}},{key:"formulaEditorHorizontalLayout",get:function get(){return!!this.question.horizontal_layout}},{key:"formulaEditorNumberPad",get:function get(){return this.question.numberPad}},{key:"formulaEditorSymbols",get:function get(){return this.question.symbols}},{key:"formulaEditorTextBlocks",get:function get(){return this.question.text_blocks}},{key:"responseValue",get:function get(){var e=this.getResponse();return s.a.getNested(e,"value")}},{key:"uiStyle",get:function get(){var e=s.a.extend({},this.model.getUIStyle());return e.minHeight=e.min_height||"",e.maxHeight=e.max_height||"",delete e.min_height,delete e.max_height,e}},{key:"wordCount",get:function get(){return this.model.getWordCount()}},{key:"wordCountExceeded",get:function get(){return this.model.wordCountExceeded()}},{key:"wordCountVisible",get:function get(){return this.model.getShowWordCount()}},{key:"wordMaxLength",get:function get(){return this.model.getMaxLength()}},{key:"formattingOptions",get:function get(){return this.model.getFormattingOptions()}},{key:"getReviewResponseValue",value:function getReviewResponseValue(){var e=this.responseValue;return ve.a.parse(e)}}]),LongTextV2DataService}(fe.a);be.prototype.EXPOSED_METHODS=[].concat(function dataService_toConsumableArray(e){return function dataService_arrayWithoutHoles(e){if(Array.isArray(e))return dataService_arrayLikeToArray(e)}(e)||function dataService_iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function dataService_unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return dataService_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dataService_arrayLikeToArray(e,t)}(e)||function dataService_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(be.prototype.EXPOSED_METHODS),["getWordLimitVisibility","getWordCountExceeded","formatValue"]);var we,_e=be,Ce=r(25),xe=r(223);function reducer_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ee=Object(xe.a)("[\\p{L}\\p{N}]"),Se=Q.actionTypes,Te=(reducer_defineProperty(we={},Se.LONGTEXTV2_UPDATE_WORD_COUNT,(function(e,t){var r=e.footer,a=function getWordCount(e){if(!s.a.isString(e)||s.a.isEmpty(e))return 0;return e=e.replace(/( | )/," ").replace(/[\n\r]/g," ").replace(/&nbsp;/g," ").replace(/<\/p>/g," ").replace(/<\/blockquote>/g," ").replace(/<\/li>/g," ").replace(/<\/div>/g," ").replace(/<br>/g," ").replace(/<br \/>/g," ").replace(/<.*?>/g,""),s.a.reduce(e.split(/\s+/),(function(e,t){return t.length>0&&Ee.test(t)?e+1:e}),0)}(t.value);return{footer:s.a.extend({},r,{wordCount:a})}})),reducer_defineProperty(we,Se.LONGTEXTV2_UPDATE_WORD_COUNT_EXCEEDED,(function(e,t){return{wordCountExceeded:t.value}})),reducer_defineProperty(we,Se.LONGTEXTV2_UPDATE_WORD_LIMIT_VISIBILITY,(function(e,t){var r=e.footer,a=t.value;return{footer:s.a.extend({},r,{wordStaticVisible:a.wordStatic,wordLimitVisible:a.wordLimit})}})),reducer_defineProperty(we,Se.LONGTEXTV2_DISABLE_EDITOR,(function(e,t){return{disabled:t.value}})),we);var ke=Object(Ce.a)(Te,{imageUrl:null,error:null});t.a=l.a.extend({maskable:!1,ViewComponent:pe,DataService:_e,getReducers:function getReducers(){var e=l.a.prototype.getReducers.apply(this,arguments);return s.a.extend(e,{longTextV2:ke})}})},,,,function(e,t,r){"use strict";var a=r(0),s=r.n(a),l=r(127),y=r.n(l),w=(r(130),r(152)),E=r(161),S=r(162);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var T=function(e){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(FormulaEditor,e);var t=_createSuper(FormulaEditor);function FormulaEditor(e){var r;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,FormulaEditor),_defineProperty(_assertThisInitialized(r=t.call(this,e)),"cacheEditorOutlet",(function(e){return r.editorOutlet=e})),_defineProperty(_assertThisInitialized(r),"cacheKeyboardOutlet",(function(e){return r.keyboardOutlet=e})),r.state={isFocused:!1},r}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(FormulaEditor,[{key:"editorClassName",get:function get(){var e=this.state.isFocused;return s.a.conditionallyBuildString({"lrn-formula-editor":!0,lrn_bordered_mathinput:!0,lrn_focused:e}," ")}},{key:"bindHandlers",value:function bindHandlers(){var e=this,t=this.editorView,r=this.props.onUpdate,a=t.mathEvents,s=a.EVENT;a.on(s.UPDATED,(function(){var e=t.getValue();r(e)})),a.on(s.FOCUSED,(function(){return e.setState({isFocused:!0})})),a.on(s.BLURRED,(function(){return e.setState({isFocused:!1})}))}},{key:"componentDidMount",value:function componentDidMount(){var e=this,t=this.props.afterRender,r=void 0===t?s.a.noop:t;s.a.defer((function(){e.renderEditorView(),e.renderKeyboardView(),e.bindHandlers(),r()}))}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.editorView&&this.editorView.remove(),this.keyboardView&&this.keyboardView.remove()}},{key:"render",value:function render(){return y.a.createElement("div",null,y.a.createElement("div",{className:this.editorClassName,ref:this.cacheEditorOutlet}),y.a.createElement("div",{className:"lrn-formula-keyboard",ref:this.cacheKeyboardOutlet}))}},{key:"renderEditorView",value:function renderEditorView(){var e=this.editorOutlet,t=this.props,r=t.i18n,a=t.isChemistry,s=(t.showInputUi,t.textBlocks),l=t.value;this.editorView=new E.a({i18n:r,value:l,disableItalics:a,el:e,text_blocks:s})}},{key:"renderKeyboardView",value:function renderKeyboardView(){var e=this.editorView,t=this.keyboardOutlet,r=this.props,a=r.horizontalLayout,s=r.i18n,l=r.isChemistry,y=r.numberPad,w=(r.showHints,r.showInputUi,r.symbols),E=r.disableSpokenmathUserInputs,T=e.mathEvents;this.keyboardView=new S.a({disableSpokenmathUserInputs:E,horizontalLayout:a,i18n:s,mathEvents:T,numberPad:y,symbols:w,chemistry:l,el:t,uiStyleType:"block-keyboard"})}}]),FormulaEditor}(y.a.Component),O=r(151),N=r(142);function formulaEditor_typeof(e){return(formulaEditor_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function formulaEditor_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function formulaEditor_defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function formulaEditor_createClass(e,t,r){return t&&formulaEditor_defineProperties(e.prototype,t),r&&formulaEditor_defineProperties(e,r),e}function formulaEditor_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&formulaEditor_setPrototypeOf(e,t)}function formulaEditor_setPrototypeOf(e,t){return(formulaEditor_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function formulaEditor_createSuper(e){var t=function formulaEditor_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,a=formulaEditor_getPrototypeOf(e);if(t){var s=formulaEditor_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return formulaEditor_possibleConstructorReturn(this,r)}}function formulaEditor_possibleConstructorReturn(e,t){if(t&&("object"===formulaEditor_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return formulaEditor_assertThisInitialized(e)}function formulaEditor_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function formulaEditor_getPrototypeOf(e){return(formulaEditor_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function formulaEditor_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var A={SYMBOLS:["basic","qwerty"],NUMBER_PAD:["7","8","9","÷","4","5","6","multiply","1","2","3","minus","0","decimal","comma","plus","left","right","backspace","="]},L=".lrn-wysihtml-modal-dialog",R=".lrn_widget",D=".lrn_response_wrapper",M=function(e){formulaEditor_inherits(FormulaEditorModal,e);var t=formulaEditor_createSuper(FormulaEditorModal);function FormulaEditorModal(e){var r;formulaEditor_classCallCheck(this,FormulaEditorModal);var a=e.value;return formulaEditor_defineProperty(formulaEditor_assertThisInitialized(r=t.call(this,e)),"afterFormulaEditorRender",(function(){var e=formulaEditor_assertThisInitialized(r).modalEl,t=r.getQuestionWrapper(),a=e.querySelector(L).getBoundingClientRect().height;t&&(t.style.minHeight=a+"px")})),formulaEditor_defineProperty(formulaEditor_assertThisInitialized(r),"onRequestClose",(function(){r.restoreModalHeight(),r.props.onRequestClose()})),formulaEditor_defineProperty(formulaEditor_assertThisInitialized(r),"restoreModalHeight",(function(){var e=r.getQuestionWrapper();e&&(e.style.minHeight=null)})),formulaEditor_defineProperty(formulaEditor_assertThisInitialized(r),"getQuestionWrapper",(function(){return r.modalEl.closest("".concat(R," ").concat(D))})),formulaEditor_defineProperty(formulaEditor_assertThisInitialized(r),"afterModalRender",(function(e){r.modalEl=e,r.setState({isReadyToRenderFormulaEditor:!0})})),formulaEditor_defineProperty(formulaEditor_assertThisInitialized(r),"onApply",(function(){r.restoreModalHeight(),r.props.onApply(r.state.value)})),formulaEditor_defineProperty(formulaEditor_assertThisInitialized(r),"onEditorUpdate",(function(e){r.setState({value:e})})),r.state={value:a,isReadyToRenderFormulaEditor:!1},r}return formulaEditor_createClass(FormulaEditorModal,[{key:"numberPad",get:function get(){return this.props.numberPad||A.NUMBER_PAD}},{key:"symbols",get:function get(){return this.props.symbols||A.SYMBOLS}},{key:"render",value:function render(){var e=this.afterFormulaEditorRender,t=this.afterModalRender,r=this.onRequestClose,a=this.numberPad,l=this.onApply,E=this.onEditorUpdate,S=this.props,O=this.state,N=this.symbols,A=S.horizontalLayout,L=S.i18n,R=S.isChemistry,D=S.modalIsOpen,M=S.parentNode,B=S.textBlocks,q=S.title,W=S.disableSpokenmathUserInputs,j=O.isReadyToRenderFormulaEditor,H=O.value,V=L.labels.editor.modals;return y.a.createElement(w.a,{className:"lrn-full-width",afterRender:t,modalIsOpen:D,parentNode:M,title:q,onRequestClose:r},y.a.createElement("div",{className:"lrn-wysihtml-modal-content"},j&&y.a.createElement(T,{afterRender:e,disableSpokenmathUserInputs:W,horizontalLayout:A,i18n:L,isChemistry:R,numberPad:a,onUpdate:E,showInputUi:!0,symbols:N,textBlocks:B,value:H})),y.a.createElement("div",{className:"lrn-wysihtml-modal-controls"},y.a.createElement("button",{className:"lrn_btn lrn_btn_blue",disabled:s.a.isEmpty(H),"data-lrn-action":"apply",onClick:l,type:"button"},V.apply)))}},{key:"componentDidUpdate",value:function componentDidUpdate(e,t){this.updateValueOnComponentDidUpdate(e)}},{key:"updateValueOnComponentDidUpdate",value:function updateValueOnComponentDidUpdate(e){var t=this.props,r=t.modalIsOpen,a=s.a.getNested(t,"modalData.latex"),l=r&&!e.modalIsOpen,y=!r&&e.modalIsOpen,w=a!==e.value;s.a.exists(a)&&l&&w?this.setState({value:a}):y&&this.setState({value:null})}}]),FormulaEditorModal}(y.a.Component),B=function(e){formulaEditor_inherits(FormulaEditorButton,e);var t=formulaEditor_createSuper(FormulaEditorButton);function FormulaEditorButton(){var e;formulaEditor_classCallCheck(this,FormulaEditorButton);for(var r=arguments.length,a=new Array(r),l=0;l<r;l++)a[l]=arguments[l];return formulaEditor_defineProperty(formulaEditor_assertThisInitialized(e=t.call.apply(t,[this].concat(a))),"closeModal",(function(){e.props.onModal(null)})),formulaEditor_defineProperty(formulaEditor_assertThisInitialized(e),"onApply",(function(t){var r=formulaEditor_assertThisInitialized(e),a=r.closeModal,l=r.props,y=l.onApply,w=l.modalData;if(!s.a.isEmpty(w)){var E=w.element;y({type:N.c.EDIT_FORMULA,params:{formula:t,widgetElement:E}})}else y({type:N.c.CREATE_FORMULA,params:{formula:t}});a()})),formulaEditor_defineProperty(formulaEditor_assertThisInitialized(e),"toggleModal",(function(t){var r=formulaEditor_assertThisInitialized(e),a=r.modalIsOpen;(0,r.props.onModal)(a?null:N.g.FORMULA_EDITOR)})),e}return formulaEditor_createClass(FormulaEditorButton,[{key:"modalIsOpen",get:function get(){return this.props.activeModal===N.g.FORMULA_EDITOR}},{key:"render",value:function render(){var e=this.modalIsOpen,t=this.onApply,r=this.props,a=(this.state,this.toggleModal),s=this.closeModal,l=(r.activeModal,r.className,r.disabled),w=r.getContainer,E=r.horizontalLayout,S=r.i18n,T=r.icon,A=r.isActive,L=r.isChemistry,R=r.modalData,D=r.numberPad,B=r.onMouseEnter,q=r.onMouseLeave,W=r.symbols,j=r.tabIndex,H=r.textBlocks,V=r.title,z=r.disableSpokenmathUserInputs;return y.a.createElement(y.a.Fragment,null,y.a.createElement(O.a.Button,{isActive:A,disabled:l,icon:T,label:V,name:N.g.FORMULA_EDITOR,onClick:a,onMouseEnter:B,onMouseLeave:q,tabIndex:j}),y.a.createElement(M,{horizontalLayout:E,disableSpokenmathUserInputs:z,i18n:S,isChemistry:L,modalData:R,modalIsOpen:e,onRequestClose:s,onApply:t,parentNode:w,numberPad:D,symbols:W,textBlocks:H,title:V}))}}]),FormulaEditorButton}(y.a.Component);t.a={FormulaEditorButton:B,FormulaEditorModal:M}},,,,,,function(e,t,r){var a,s;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}a=[r(186)],void 0===(s=function(e){"use strict";var t,r;return e.commands.alignCenterStyle=(t={styleProperty:"textAlign",styleValue:"center",toggle:!0},{exec:function exec(r,a){return e.commands.formatBlock.exec(r,"formatBlock",t)},state:function state(r,a){return e.commands.formatBlock.state(r,"formatBlock",t)}}),e.commands.alignJustifyStyle=function(){var t={styleProperty:"textAlign",styleValue:"justify",toggle:!0};return{exec:function exec(r,a){return e.commands.formatBlock.exec(r,"formatBlock",t)},state:function state(r,a){return e.commands.formatBlock.state(r,"formatBlock",t)}}}(),e.commands.alignLeftStyle=function(){var t={styleProperty:"textAlign",styleValue:"left",toggle:!0};return{exec:function exec(r,a){return e.commands.formatBlock.exec(r,"formatBlock",t)},state:function state(r,a){return e.commands.formatBlock.state(r,"formatBlock",t)}}}(),e.commands.alignRightStyle=function(){var t={styleProperty:"textAlign",styleValue:"right",toggle:!0};return{exec:function exec(r,a){return e.commands.formatBlock.exec(r,"formatBlock",t)},state:function state(r,a){return e.commands.formatBlock.state(r,"formatBlock",t)}}}(),e.commands.bgColorStyle={exec:function exec(t,r,a){var s,l=e.quirks.styleParser.parseColor("background-color:"+(a.color||a),"background-color");l&&(s=(1===l[3]?"rgb("+[l[0],l[1],l[2]].join(", "):"rgba("+l.join(", "))+")",e.commands.formatInline.exec(t,r,{styleProperty:"backgroundColor",styleValue:s}))},state:function state(t,r,a){var s,l=a?e.quirks.styleParser.parseColor("background-color:"+(a.color||a),"background-color"):null;return l&&(s=(1===l[3]?"rgb("+[l[0],l[1],l[2]].join(", "):"rgba("+l.join(", "))+")"),e.commands.formatInline.state(t,r,{styleProperty:"backgroundColor",styleValue:s})},remove:function remove(t,r){return e.commands.formatInline.remove(t,r,{styleProperty:"backgroundColor"})},stateValue:function stateValue(t,r,a){var s,l=this.state(t,r),y=!1;return l&&e.lang.object(l).isArray()&&(l=l[0]),!(!l||!(s=l.getAttribute("style")))&&(y=e.quirks.styleParser.parseColor(s,"background-color"),e.quirks.styleParser.unparseColor(y,a))}},e.commands.bold=function(){var t={nodeName:"B",toggle:!0};return{exec:function exec(r,a){e.commands.formatInline.exec(r,a,t)},state:function state(r,a){return e.commands.formatInline.state(r,a,t)}}}(),e.commands.formatCode={exec:function exec(t,r,a){var s,l,y,w=this.state(t)[0];w?t.selection.executeAndRestore((function(){s=w.querySelector("code"),e.dom.replaceWithChildNodes(w),s&&e.dom.replaceWithChildNodes(s)})):(y=(l=t.selection.getRange()).extractContents(),w=t.doc.createElement("pre"),s=t.doc.createElement("code"),a&&(s.className=a),w.appendChild(s),s.appendChild(y),l.insertNode(w),t.selection.selectNode(w))},state:function state(t){var r,a=t.selection.getSelectedNode();return a&&a.nodeName&&"PRE"==a.nodeName&&a.firstChild&&a.firstChild.nodeName&&"CODE"==a.firstChild.nodeName?[a]:!!(r=e.dom.getParentElement(a,{query:"pre code"}))&&[r.parentNode]}},e.commands.insertImage={exec:function exec(t,r,a){a="object"===_typeof(a)?a:{src:a};var s,l,y=t.doc,w=this.state(t);if(w&&!a.src)return t.selection.setBefore(w),(l=w.parentNode).removeChild(w),e.dom.removeEmptyTextNodes(l),"A"!==l.nodeName||l.firstChild||(t.selection.setAfter(l),l.parentNode.removeChild(l)),void e.quirks.redraw(t.element);if(w)for(var E in a)a.hasOwnProperty(E)&&w.setAttribute("className"===E?"class":E,a[E]);else{for(var S in w=y.createElement("IMG"),a)w.setAttribute("className"===S?"class":S,a[S]);t.selection.insertNode(w),e.browser.hasProblemsSettingCaretAfterImg()?(s=y.createTextNode(e.INVISIBLE_SPACE),t.selection.insertNode(s),t.selection.setAfter(s)):t.selection.setAfter(w)}},state:function state(t){var r,a,s,l=t.doc;return!!e.dom.hasElementWithTagName(l,"IMG")&&!!(r=t.selection.getSelectedNode())&&("IMG"===r.nodeName?r:r.nodeType===e.ELEMENT_NODE&&(a=t.selection.getText(),!(a=e.lang.string(a).trim())&&1===(s=t.selection.getNodes(e.ELEMENT_NODE,(function(e){return"IMG"===e.nodeName}))).length&&s[0]))}},e.commands.fontSize=(r=/wysiwyg-font-size-[0-9a-z\-]+/g,{exec:function exec(t,a,s){e.commands.formatInline.exec(t,a,{className:"wysiwyg-font-size-"+s,classRegExp:r,toggle:!0})},state:function state(t,r,a){return e.commands.formatInline.state(t,r,{className:"wysiwyg-font-size-"+a})}}),e.commands.fontSizeStyle={exec:function exec(t,r,a){a=a.size||a,/^\s*$/.test(a)||e.commands.formatInline.exec(t,r,{styleProperty:"fontSize",styleValue:a,toggle:!1})},state:function state(t,r,a){return e.commands.formatInline.state(t,r,{styleProperty:"fontSize",styleValue:a||void 0})},remove:function remove(t,r){return e.commands.formatInline.remove(t,r,{styleProperty:"fontSize"})},stateValue:function stateValue(t,r){var a,s=this.state(t,r);return s&&e.lang.object(s).isArray()&&(s=s[0]),!(!s||!(a=s.getAttribute("style")))&&e.quirks.styleParser.parseFontSize(a)}},e.commands.foreColor=function(){var t=/wysiwyg-color-[0-9a-z]+/g;return{exec:function exec(r,a,s){e.commands.formatInline.exec(r,a,{className:"wysiwyg-color-"+s,classRegExp:t,toggle:!0})},state:function state(t,r,a){return e.commands.formatInline.state(t,r,{className:"wysiwyg-color-"+a})}}}(),e.commands.foreColorStyle={exec:function exec(t,r,a){var s,l;a&&(s=e.quirks.styleParser.parseColor("color:"+(a.color||a),"color"))&&(l=(1===s[3]?"rgb("+[s[0],s[1],s[2]].join(", "):"rgba("+s.join(", "))+")",e.commands.formatInline.exec(t,r,{styleProperty:"color",styleValue:l}))},state:function state(t,r,a){var s,l=a?e.quirks.styleParser.parseColor("color:"+(a.color||a),"color"):null;return l&&(s=(1===l[3]?"rgb("+[l[0],l[1],l[2]].join(", "):"rgba("+l.join(", "))+")"),e.commands.formatInline.state(t,r,{styleProperty:"color",styleValue:s})},remove:function remove(t,r){return e.commands.formatInline.remove(t,r,{styleProperty:"color"})},stateValue:function stateValue(t,r,a){var s,l=this.state(t,r),y=!1;return l&&e.lang.object(l).isArray()&&(l=l[0]),!(!l||!(s=l.getAttribute("style")))&&(y=e.quirks.styleParser.parseColor(s,"color"),e.quirks.styleParser.unparseColor(y,a))}},e.commands.insertBlockQuote=function(){var t={nodeName:"BLOCKQUOTE",toggle:!0};return{exec:function exec(r,a){return e.commands.formatBlock.exec(r,"formatBlock",t)},state:function state(r,a){return e.commands.formatBlock.state(r,"formatBlock",t)}}}(),e.commands.insertHorizontalRule={exec:function exec(t){var r=t.selection.getSelectedNode(),a=e.dom.getParentElement(r,{query:e.PERMITTED_PHRASING_CONTENT_ONLY},null,t.editableArea),s=document.createElement("hr");a?t.selection.splitElementAtCaret(a,s):t.selection.insertNode(s),s.nextSibling?t.selection.setBefore(s.nextSibling):t.selection.setAfter(s)},state:function state(){return!1}},e.commands.insertOrderedList={exec:function exec(t,r){e.commands.insertList.exec(t,r,"OL")},state:function state(t,r){return e.commands.insertList.state(t,r,"OL")}},e.commands.insertUnorderedList={exec:function exec(t,r){e.commands.insertList.exec(t,r,"UL")},state:function state(t,r){return e.commands.insertList.state(t,r,"UL")}},e.commands.italic=function(){var t={nodeName:"I",toggle:!0};return{exec:function exec(r,a){e.commands.formatInline.exec(r,a,t)},state:function state(r,a){return e.commands.formatInline.state(r,a,t)}}}(),e.commands.justifyCenter=function(){var t={className:"wysiwyg-text-align-center",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};return{exec:function exec(r,a){return e.commands.formatBlock.exec(r,"formatBlock",t)},state:function state(r,a){return e.commands.formatBlock.state(r,"formatBlock",t)}}}(),e.commands.justifyFull=function(){var t={className:"wysiwyg-text-align-justify",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};return{exec:function exec(r,a){return e.commands.formatBlock.exec(r,"formatBlock",t)},state:function state(r,a){return e.commands.formatBlock.state(r,"formatBlock",t)}}}(),e.commands.justifyLeft=function(){var t={className:"wysiwyg-text-align-left",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};return{exec:function exec(r,a){return e.commands.formatBlock.exec(r,"formatBlock",t)},state:function state(r,a){return e.commands.formatBlock.state(r,"formatBlock",t)}}}(),e.commands.justifyRight=function(){var t={className:"wysiwyg-text-align-right",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};return{exec:function exec(r,a){return e.commands.formatBlock.exec(r,"formatBlock",t)},state:function state(r,a){return e.commands.formatBlock.state(r,"formatBlock",t)}}}(),e.commands.subscript=function(){var t={nodeName:"SUB",toggle:!0};return{exec:function exec(r,a){e.commands.formatInline.exec(r,a,t)},state:function state(r,a){return e.commands.formatInline.state(r,a,t)}}}(),e.commands.superscript=function(){var t={nodeName:"SUP",toggle:!0};return{exec:function exec(r,a){e.commands.formatInline.exec(r,a,t)},state:function state(r,a){return e.commands.formatInline.state(r,a,t)}}}(),e.commands.underline=function(){var t={nodeName:"U",toggle:!0};return{exec:function exec(r,a){e.commands.formatInline.exec(r,a,t)},state:function state(r,a){return e.commands.formatInline.state(r,a,t)}}}(),e}.apply(t,a))||(e.exports=s)},function(e,t,r){var a,s;a=[r(186),r(207)],void 0===(s=function(e,t){"use strict";var r=t.default.createHtml;return e.commands.createFormula={exec:function exec(e,t,a){var s=a.formula;!e.getValue()&&function workaroundEmptyEditorLinebreak(e){var t=/<br>$/,r=function getValue(e){return e.getValue()}(e);r.match(t)&&(!function setValue(e,t){e.setValue(t)}(e,r.replace(t,"")),e.selection.moveCaretToEnd())}(e),e.commands.exec("insertHTML",r(s))},state:function state(){return!1}},e.commands.editFormula={exec:function exec(e,t,a){var s=a.formula,l=a.widgetElement;!function selectElement(e){var t=document.createRange(),r=window.getSelection();t.selectNodeContents(e),r.removeAllRanges(),r.addRange(t)}(l),l.remove(),e.commands.exec("insertHTML",r(s))},state:function state(){return!1}},e}.apply(t,a))||(e.exports=s)},function(e,t,r){var a,s;a=[r(186)],void 0===(s=function(e){var t,r;return e.commands.addTableCells={exec:function exec(t,r,a){if(t.tableSelection&&t.tableSelection.start&&t.tableSelection.end){var s=e.dom.table.orderSelectionEnds(t.tableSelection.start,t.tableSelection.end);"before"==a||"above"==a?e.dom.table.addCells(s.start,a):"after"!=a&&"below"!=a||e.dom.table.addCells(s.end,a),setTimeout((function(){t.tableSelection.select(s.start,s.end)}),0)}},state:function state(e,t){return!1}},e.commands.createTable={exec:function exec(e,t,r){var a,s,l,y=e.config.useLineBreaks;if(r&&r.cols&&r.rows&&parseInt(r.cols,10)>0&&parseInt(r.rows,10)>0){if(l=r.tableStyle?'<table style="'+r.tableStyle+'">':"<table",r.tableClass&&(l+=' class="'+r.tableClass+'"'),l+=">",r.tableHead){for(l+="<thead><tr>",a=0;a<r.cols;a++)l+="<th>",l+=y?"<br></th>":"<p><br></p></th>";l+="</tr></thead>"}for(l+="<tbody>",s=0;s<r.rows;s++){for(l+="<tr>",a=0;a<r.cols;a++)l+="<td>",l+=y?"<br></td>":"<p><br></p></td>";l+="</tr>"}l+="</tbody></table>",e.commands.exec("insertHTML",l)}},state:function state(e,t){return!1}},e.commands.deleteTableCells={exec:function exec(t,r,a){if(t.tableSelection&&t.tableSelection.start&&t.tableSelection.end){var s,l=e.dom.table.orderSelectionEnds(t.tableSelection.start,t.tableSelection.end),y=e.dom.table.indexOf(l.start),w=t.tableSelection.table;e.dom.table.removeCells(l.start,a),setTimeout((function(){(s=e.dom.table.findCell(w,y))||("row"==a&&(s=e.dom.table.findCell(w,{row:y.row-1,col:y.col})),"column"==a&&(s=e.dom.table.findCell(w,{row:y.row,col:y.col-1}))),s&&t.tableSelection.select(s,s)}),0)}},state:function state(e,t){return!1}},e.commands.mergeTableCells={exec:function exec(t,r){t.tableSelection&&t.tableSelection.start&&t.tableSelection.end&&(this.state(t,r)?e.dom.table.unmergeCell(t.tableSelection.start):e.dom.table.mergeCellsBetween(t.tableSelection.start,t.tableSelection.end))},state:function state(t,r){if(t.tableSelection){var a=t.tableSelection.start,s=t.tableSelection.end;if(a&&s&&a==s&&(e.dom.getAttribute(a,"colspan")&&parseInt(e.dom.getAttribute(a,"colspan"),10)>1||e.dom.getAttribute(a,"rowspan")&&parseInt(e.dom.getAttribute(a,"rowspan"),10)>1))return[a]}return!1}},function(){var t=e.dom,r=function MapCell(e){this.el=e,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},a=function TableModifyerByCell(e,r){e?(this.cell=e,this.table=t.getParentElement(e,{query:"table"})):r&&(this.table=r,this.cell=this.table.querySelectorAll("th, td")[0])};function queryInList(e,t){for(var r,a=[],s=0,l=e.length;s<l;s++)if(r=e[s].querySelectorAll(t))for(var y=r.length;y--;a.unshift(r[y]));return a}function removeElement(e){e.parentNode.removeChild(e)}function insertAfter(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function nextNode(e,t){for(var r=e.nextSibling;1!=r.nodeType;)if(r=r.nextSibling,!t||t==r.tagName.toLowerCase())return r;return null}a.prototype={addSpannedCellToMap:function addSpannedCellToMap(e,t,a,s,l,y){for(var w=[],E=a+(y?parseInt(y,10)-1:0),S=s+(l?parseInt(l,10)-1:0),T=a;T<=E;T++){void 0===t[T]&&(t[T]=[]);for(var O=s;O<=S;O++)t[T][O]=new r(e),t[T][O].isColspan=l&&parseInt(l,10)>1,t[T][O].isRowspan=y&&parseInt(y,10)>1,t[T][O].firstCol=O==s,t[T][O].lastCol=O==S,t[T][O].firstRow=T==a,t[T][O].lastRow=T==E,t[T][O].isReal=O==s&&T==a,t[T][O].spanCollection=w,w.push(t[T][O])}},setCellAsModified:function setCellAsModified(e){if(e.modified=!0,e.spanCollection.length>0)for(var t=0,r=e.spanCollection.length;t<r;t++)e.spanCollection[t].modified=!0},setTableMap:function setTableMap(){var e,a,s,l,y,w,E,S,T=[],O=this.getTableRows();for(e=0;e<O.length;e++)for(a=O[e],s=this.getRowCells(a),w=0,void 0===T[e]&&(T[e]=[]),l=0;l<s.length;l++){for(y=s[l];void 0!==T[e][w];)w++;E=t.getAttribute(y,"colspan"),S=t.getAttribute(y,"rowspan"),E||S?(this.addSpannedCellToMap(y,T,e,w,E,S),w+=E?parseInt(E,10):1):(T[e][w]=new r(y),w++)}return this.map=T,T},getRowCells:function getRowCells(t){var r=this.table.querySelectorAll("table"),a=r?queryInList(r,"th, td"):[],s=t.querySelectorAll("th, td");return a.length>0?e.lang.array(s).without(a):s},getTableRows:function getTableRows(){var t=this.table.querySelectorAll("table"),r=t?queryInList(t,"tr"):[],a=this.table.querySelectorAll("tr");return r.length>0?e.lang.array(a).without(r):a},getMapIndex:function getMapIndex(e){for(var t=this.map.length,r=this.map&&this.map[0]?this.map[0].length:0,a=0;a<t;a++)for(var s=0;s<r;s++)if(this.map[a][s].el===e)return{row:a,col:s};return!1},getElementAtIndex:function getElementAtIndex(e){return this.setTableMap(),this.map[e.row]&&this.map[e.row][e.col]&&this.map[e.row][e.col].el?this.map[e.row][e.col].el:null},getMapElsTo:function getMapElsTo(e){var t=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var r=this.idx_start;this.idx_start=this.idx_end,this.idx_end=r}if(this.idx_start.col>this.idx_end.col){var a=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=a}if(null!=this.idx_start&&null!=this.idx_end)for(var s=this.idx_start.row,l=this.idx_end.row;s<=l;s++)for(var y=this.idx_start.col,w=this.idx_end.col;y<=w;y++)t.push(this.map[s][y].el);return t},orderSelectionEnds:function orderSelectionEnds(e){if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var r=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=r}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function createCells(e,t,r){for(var a,s=this.table.ownerDocument,l=s.createDocumentFragment(),y=0;y<t;y++){if(a=s.createElement(e),r)for(var w in r)r.hasOwnProperty(w)&&a.setAttribute(w,r[w]);a.appendChild(document.createTextNode(" ")),l.appendChild(a)}return l},correctColIndexForUnreals:function correctColIndexForUnreals(e,t){for(var r=this.map[t],a=-1,s=0;s<e;s++)r[s].isReal&&a++;return a},getLastNewCellOnRow:function getLastNewCellOnRow(e,t){for(var r,a,s=this.getRowCells(e),l=0,y=s.length;l<y;l++)if(r=s[l],!1===(a=this.getMapIndex(r))||void 0!==t&&a.row!=t)return r;return null},removeEmptyTable:function removeEmptyTable(){var e=this.table.querySelectorAll("td, th");return(!e||0==e.length)&&(removeElement(this.table),!0)},splitRowToCells:function splitRowToCells(e){if(e.isColspan){var r=parseInt(t.getAttribute(e.el,"colspan")||1,10),a=e.el.tagName.toLowerCase();if(r>1){var s=this.createCells(a,r-1);insertAfter(e.el,s)}e.el.removeAttribute("colspan")}},getRealRowEl:function getRealRowEl(e,r){var a=null,s=null;r=r||this.idx;for(var l=0,y=this.map[r.row].length;l<y;l++)if((s=this.map[r.row][l]).isReal&&(a=t.getParentElement(s.el,{query:"tr"})))return a;return null===a&&e&&(a=t.getParentElement(this.map[r.row][r.col].el,{query:"tr"})||null),a},injectRowAt:function injectRowAt(e,r,a,s,l){var y=this.getRealRowEl(!1,{row:e,col:r}),w=this.createCells(s,a);if(y){var E=this.correctColIndexForUnreals(r,e);E>=0?insertAfter(this.getRowCells(y)[E],w):y.insertBefore(w,y.firstChild)}else{var S=this.table.ownerDocument.createElement("tr");S.appendChild(w),insertAfter(t.getParentElement(l.el,{query:"tr"}),S)}},canMerge:function canMerge(e){if(this.to=e,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var r=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=r}for(var a=this.idx_start.row,s=this.idx_end.row;a<=s;a++)for(var l=this.idx_start.col,y=this.idx_end.col;l<=y;l++)if(this.map[a][l].isColspan||this.map[a][l].isRowspan)return!1;return!0},decreaseCellSpan:function decreaseCellSpan(e,r){var a=parseInt(t.getAttribute(e.el,r),10)-1;a>=1?e.el.setAttribute(r,a):(e.el.removeAttribute(r),"colspan"==r&&(e.isColspan=!1),"rowspan"==r&&(e.isRowspan=!1),e.firstCol=!0,e.lastCol=!0,e.firstRow=!0,e.lastRow=!0,e.isReal=!0)},removeSurplusLines:function removeSurplusLines(){var e,r,a,s,l,y,w;if(this.setTableMap(),this.map){for(a=0,s=this.map.length;a<s;a++){for(w=!0,l=0,y=(e=this.map[a]).length;l<y;l++)if(r=e[l],!(t.getAttribute(r.el,"rowspan")&&parseInt(t.getAttribute(r.el,"rowspan"),10)>1&&!0!==r.firstRow)){w=!1;break}if(w)for(l=0;l<y;l++)this.decreaseCellSpan(e[l],"rowspan")}var E=this.getTableRows();for(a=0,s=E.length;a<s;a++)0==(e=E[a]).childNodes.length&&/^\s*$/.test(e.textContent||e.innerText)&&removeElement(e)}},fillMissingCells:function fillMissingCells(){var e=0,t=0,a=null;if(this.setTableMap(),this.map){e=this.map.length;for(var s=0;s<e;s++)this.map[s].length>t&&(t=this.map[s].length);for(var l=0;l<e;l++)for(var y=0;y<t;y++)this.map[l]&&!this.map[l][y]&&y>0&&(this.map[l][y]=new r(this.createCells("td",1)),(a=this.map[l][y-1])&&a.el&&a.el.parent&&insertAfter(this.map[l][y-1].el,this.map[l][y].el))}},rectify:function rectify(){return!this.removeEmptyTable()&&(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function unmerge(){if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var e=this.map[this.idx.row][this.idx.col],r=t.getAttribute(e.el,"colspan")?parseInt(t.getAttribute(e.el,"colspan"),10):1,a=e.el.tagName.toLowerCase();if(e.isRowspan){var s=parseInt(t.getAttribute(e.el,"rowspan"),10);if(s>1)for(var l=1,y=s-1;l<=y;l++)this.injectRowAt(this.idx.row+l,this.idx.col,r,a,e);e.el.removeAttribute("rowspan")}this.splitRowToCells(e)}},merge:function merge(e){if(this.rectify())if(this.canMerge(e)){for(var t=this.idx_end.row-this.idx_start.row+1,r=this.idx_end.col-this.idx_start.col+1,a=this.idx_start.row,s=this.idx_end.row;a<=s;a++)for(var l=this.idx_start.col,y=this.idx_end.col;l<=y;l++)a==this.idx_start.row&&l==this.idx_start.col?(t>1&&this.map[a][l].el.setAttribute("rowspan",t),r>1&&this.map[a][l].el.setAttribute("colspan",r)):(/^\s*<br\/?>\s*$/.test(this.map[a][l].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[a][l].el.innerHTML),removeElement(this.map[a][l].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function collapseCellToNextRow(e){var r=this.getMapIndex(e.el),a=r.row+1,s={row:a,col:r.col};if(a<this.map.length){var l=this.getRealRowEl(!1,s);if(null!==l){var y=this.correctColIndexForUnreals(s.col,s.row);if(y>=0)insertAfter(this.getRowCells(l)[y],e.el);else{var w=this.getLastNewCellOnRow(l,a);null!==w?insertAfter(w,e.el):l.insertBefore(e.el,l.firstChild)}parseInt(t.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(t.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")}}},removeRowCell:function removeRowCell(e){e.isReal?e.isRowspan?this.collapseCellToNextRow(e):removeElement(e.el):parseInt(t.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(t.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")},getRowElementsByCell:function getRowElementsByCell(){var e=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var t=this.map[this.idx.row],r=0,a=t.length;r<a;r++)t[r].isReal&&e.push(t[r].el);return e},getColumnElementsByCell:function getColumnElementsByCell(){var e=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var t=0,r=this.map.length;t<r;t++)this.map[t][this.idx.col]&&this.map[t][this.idx.col].isReal&&e.push(this.map[t][this.idx.col].el);return e},removeRow:function removeRow(){var e=t.getParentElement(this.cell,{query:"tr"});if(e){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var r=this.map[this.idx.row],a=0,s=r.length;a<s;a++)r[a].modified||(this.setCellAsModified(r[a]),this.removeRowCell(r[a]));removeElement(e)}},removeColCell:function removeColCell(e){e.isColspan?parseInt(t.getAttribute(e.el,"colspan"),10)>2?e.el.setAttribute("colspan",parseInt(t.getAttribute(e.el,"colspan"),10)-1):e.el.removeAttribute("colspan"):e.isReal&&removeElement(e.el)},removeColumn:function removeColumn(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var e=0,t=this.map.length;e<t;e++)this.map[e][this.idx.col].modified||(this.setCellAsModified(this.map[e][this.idx.col]),this.removeColCell(this.map[e][this.idx.col]))},remove:function remove(e){if(this.rectify()){switch(e){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function addRow(e){var r=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==e&&t.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(t.getAttribute(this.cell,"rowspan"),10)-1),!1!==this.idx){for(var a=this.map[this.idx.row],s=r.createElement("tr"),l=0,y=a.length;l<y;l++)a[l].modified||(this.setCellAsModified(a[l]),this.addRowCell(a[l],s,e));switch(e){case"below":insertAfter(this.getRealRowEl(!0),s);break;case"above":var w=t.getParentElement(this.map[this.idx.row][this.idx.col].el,{query:"tr"});w&&w.parentNode.insertBefore(s,w)}}},addRowCell:function addRowCell(e,r,a){var s=e.isColspan?{colspan:t.getAttribute(e.el,"colspan")}:null;e.isReal?"above"!=a&&e.isRowspan?e.el.setAttribute("rowspan",parseInt(t.getAttribute(e.el,"rowspan"),10)+1):r.appendChild(this.createCells("td",1,s)):"above"!=a&&e.isRowspan&&e.lastRow?r.appendChild(this.createCells("td",1,s)):c.isRowspan&&e.el.attr("rowspan",parseInt(t.getAttribute(e.el,"rowspan"),10)+1)},add:function add(e){this.rectify()&&("below"!=e&&"above"!=e||this.addRow(e),"before"!=e&&"after"!=e||this.addColumn(e))},addColCell:function addColCell(e,r,a){var s,l=e.el.tagName.toLowerCase();switch(a){case"before":s=!e.isColspan||e.firstCol;break;case"after":s=!e.isColspan||e.lastCol||e.isColspan&&e.el==this.cell}if(s){switch(a){case"before":e.el.parentNode.insertBefore(this.createCells(l,1),e.el);break;case"after":insertAfter(e.el,this.createCells(l,1))}e.isRowspan&&this.handleCellAddWithRowspan(e,r+1,a)}else e.el.setAttribute("colspan",parseInt(t.getAttribute(e.el,"colspan"),10)+1)},addColumn:function addColumn(e){var r,a;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==e&&t.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(t.getAttribute(this.cell,"colspan"),10)-1),!1!==this.idx)for(var s=0,l=this.map.length;s<l;s++)(r=this.map[s])[this.idx.col]&&((a=r[this.idx.col]).modified||(this.setCellAsModified(a),this.addColCell(a,s,e)))},handleCellAddWithRowspan:function handleCellAddWithRowspan(e,r,a){for(var s,l,y,w=parseInt(t.getAttribute(this.cell,"rowspan"),10)-1,E=t.getParentElement(e.el,{query:"tr"}),S=e.el.tagName.toLowerCase(),T=this.table.ownerDocument,O=0;O<w;O++)if(s=this.correctColIndexForUnreals(this.idx.col,r+O),E=nextNode(E,"tr"))if(s>0)switch(a){case"before":l=this.getRowCells(E),s>0&&this.map[r+O][this.idx.col].el!=l[s]&&s==l.length-1?insertAfter(l[s],this.createCells(S,1)):l[s].parentNode.insertBefore(this.createCells(S,1),l[s]);break;case"after":insertAfter(this.getRowCells(E)[s],this.createCells(S,1))}else E.insertBefore(this.createCells(S,1),E.firstChild);else(y=T.createElement("tr")).appendChild(this.createCells(S,1)),this.table.appendChild(y)}},t.table={getCellsBetween:function getCellsBetween(e,t){return new a(e).getMapElsTo(t)},addCells:function addCells(e,t){new a(e).add(t)},removeCells:function removeCells(e,t){new a(e).remove(t)},mergeCellsBetween:function mergeCellsBetween(e,t){new a(e).merge(t)},unmergeCell:function unmergeCell(e){new a(e).unmerge()},orderSelectionEnds:function orderSelectionEnds(e,t){return new a(e).orderSelectionEnds(t)},indexOf:function indexOf(e){var t=new a(e);return t.setTableMap(),t.getMapIndex(e)},findCell:function findCell(e,t){return new a(null,e).getElementAtIndex(t)},findRowByCell:function findRowByCell(e){return new a(e).getRowElementsByCell()},findColumnByCell:function findColumnByCell(e){return new a(e).getColumnElementsByCell()},canMerge:function canMerge(e,t){return new a(e).canMerge(t)}}}(),t=e.views.Composer.prototype.observe,r=function initTableHandling(){var t=function(){this.win.removeEventListener("load",t),this.doc.execCommand("enableObjectResizing",!1,"false"),this.doc.execCommand("enableInlineTableEditing",!1,"false")}.bind(this),r=function(){t.call(this),this.actions.removeListeners(this.sandbox.getIframe(),["focus","mouseup","mouseover"],r)}.bind(this);this.doc.execCommand&&e.browser.supportsCommand(this.doc,"enableObjectResizing")&&e.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?this.actions.addListeners(this.sandbox.getIframe(),["focus","mouseup","mouseover"],r):this.win.addEventListener("load",t)),this.tableSelection=e.quirks.tableCellsSelection(this.element,this.parent)},e.Editor.prototype.defaults.handleTables=!0,e.quirks.tableCellsSelection=function tableCellsSelection(t,r){var a=!1,s=function handleMouseDown(r){var a=e.dom.getParentElement(r.target,{query:"td, th"},!1,t);a&&y(a,!0)},l=function handleKeyDown(s){var l,w=s.keyCode;[37,38,39,40].indexOf(w)>=0&&((l=e.dom.getParentElement(r.composer.selection.getCaretNode(),{query:"td, th"},!1,t))?y(l):a&&O(s))},y=function handleSelectionMousedown(e,s){L.start=e,L.end=e,L.cells=[e],L.table=A.getParentElement(L.start,{query:"table"},!1,t),L.table&&(w(),A.addClass(e,R),s&&(t.addEventListener("mousemove",S),t.addEventListener("mouseup",T)),a=!0,r.fire("tableselectstart").fire("tableselectstart:composer"))},w=function removeCellSelections(){if(t){var e=t.querySelectorAll("."+R);if(e.length>0)for(var r=0;r<e.length;r++)A.removeClass(e[r],R)}},E=function addSelections(e){for(var t=0;t<e.length;t++)A.addClass(e[t],R)},S=function handleMouseMove(e){var a,s=null,l=A.getParentElement(e.target,{query:"td, th"},!1,t);l&&L.table&&L.start&&(s=A.getParentElement(l,{query:"table"},!1,t))&&s===L.table&&(w(),a=L.end,L.end=l,L.cells=A.table.getCellsBetween(L.start,l),L.cells.length>1&&r.composer.selection.deselect(),E(L.cells),L.end!==a&&r.fire("tableselectchange").fire("tableselectchange:composer"))},T=function handleMouseUp(e){t.removeEventListener("mousemove",S),t.removeEventListener("mouseup",handleMouseUp),r.fire("tableselect").fire("tableselect:composer"),setTimeout((function(){N()}),0)},O=function sideClickHandler(e){t.ownerDocument.removeEventListener("click",sideClickHandler),A.getParentElement(e.target,{query:"table"},!1,t)!=L.table&&(w(),a=!1,t.removeEventListener("mousemove",S),t.removeEventListener("mouseup",T),r.fire("tableunselect").fire("tableunselect:composer"))},N=function bindSideclick(){t.ownerDocument.addEventListener("click",O)},A=e.dom,L={table:null,start:null,end:null,cells:null,select:function selectCells(e,a){L.start=e,L.end=a,L.table=A.getParentElement(L.start,{query:"table"},!1,t);var s=A.table.getCellsBetween(L.start,L.end);E(s),N(),r.fire("tableselect").fire("tableselect:composer")}},R="wysiwyg-tmp-selected-cell";return function init(){return t.addEventListener("mousedown",s),t.addEventListener("keydown",function debounce(e,t,r){var a,s,l,y,w,E=function later(){var E=Date.now()-y;E<t&&E>=0?a=setTimeout(later,t-E):(a=null,r||(w=e.apply(l,s),a||(l=s=null)))};return function(){l=this,s=arguments,y=Date.now();var S=r&&!a;return a||(a=setTimeout(E,t)),S&&(w=e.apply(l,s),l=s=null),w}}(l,100)),L}()},e.views.Composer.prototype.observe=function extendedObserverFunction(){t.call(this),this.config.handleTables&&r.call(this)},e}.apply(t,a))||(e.exports=s)},function(e,t,r){var a,s;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}a=[r(186)],void 0===(s=function(e){"use strict";return function(e){var t=e.dom;e.toolbar.Dialog=e.lang.Dispatcher.extend({constructor:function constructor(e,t){this.link=e,this.container=t},_observe:function _observe(){if(!this._observed){var r=this,a=function callbackWrapper(e){var t=r._serialize();r.fire("save",t),r.hide(),e.preventDefault(),e.stopPropagation()};t.observe(r.link,"click",(function(){t.hasClass(r.link,"wysihtml-command-dialog-opened")&&setTimeout((function(){r.hide()}),0)})),t.observe(this.container,"keydown",(function(t){var s=t.keyCode;s===e.ENTER_KEY&&a(t),s===e.ESCAPE_KEY&&r.cancel()})),t.delegate(this.container,"[data-wysihtml-dialog-action=save]","click",a),t.delegate(this.container,"[data-wysihtml-dialog-action=cancel]","click",(function(e){r.cancel(),e.preventDefault(),e.stopPropagation()})),this._observed=!0}},_serialize:function _serialize(){for(var e={},t=this.container.querySelectorAll("[data-wysihtml-dialog-field]"),r=t.length,a=0;a<r;a++)e[t[a].getAttribute("data-wysihtml-dialog-field")]=t[a].value;return e},_interpolate:function _interpolate(e){for(var t,r,a,s=document.querySelector(":focus"),l=this.container.querySelectorAll("[data-wysihtml-dialog-field]"),y=l.length,w=0;w<y;w++)(t=l[w])!==s&&(e&&"hidden"===t.type||(r=t.getAttribute("data-wysihtml-dialog-field"),a=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(r)||"":t.defaultValue,t.value=a))},update:function update(e){this.elementToChange=e||this.elementToChange,this._interpolate()},show:function show(e){var r=this.container.querySelector("input, select, textarea");if(this._observe(),this.update(e),t.addClass(this.link,"wysihtml-command-dialog-opened"),this.container.style.display="",this.isOpen=!0,this.fire("show"),r&&!e)try{r.focus()}catch(e){}},_hide:function _hide(e){this.elementToChange=null,t.removeClass(this.link,"wysihtml-command-dialog-opened"),this.container.style.display="none",this.isOpen=!1},hide:function hide(){this._hide(),this.fire("hide")},cancel:function cancel(){this._hide(),this.fire("cancel")}})}(e),function(e){e.dom;e.toolbar.Dialog_bgColorStyle=e.toolbar.Dialog.extend({multiselect:!0,_serialize:function _serialize(){for(var e={},t=this.container.querySelectorAll("[data-wysihtml-dialog-field]"),r=t.length,a=0;a<r;a++)e[t[a].getAttribute("data-wysihtml-dialog-field")]=t[a].value;return e},_interpolate:function _interpolate(t){for(var r,a=document.querySelector(":focus"),s=this.container.querySelectorAll("[data-wysihtml-dialog-field]"),l=s.length,y=0,w=this.elementToChange?e.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,E=w?w.getAttribute("style"):null,S=E?e.quirks.styleParser.parseColor(E,"background-color"):null;y<l;y++)(r=s[y])!==a&&(t&&"hidden"===r.type||"color"===r.getAttribute("data-wysihtml-dialog-field")&&(S?S[3]&&1!=S[3]?r.value="rgba("+S[0]+","+S[1]+","+S[2]+","+S[3]+");":r.value="rgb("+S[0]+","+S[1]+","+S[2]+");":r.value="rgb(0,0,0);"))}})}(e),function(e){e.toolbar.Dialog_createTable=e.toolbar.Dialog.extend({show:function show(e){this.base(e)}})}(e),function(e){e.dom;e.toolbar.Dialog_fontSizeStyle=e.toolbar.Dialog.extend({multiselect:!0,_serialize:function _serialize(){return{size:this.container.querySelector('[data-wysihtml-dialog-field="size"]').value}},_interpolate:function _interpolate(t){var r=document.querySelector(":focus"),a=this.container.querySelector("[data-wysihtml-dialog-field='size']"),s=this.elementToChange?e.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,l=s?s.getAttribute("style"):null,y=l?e.quirks.styleParser.parseFontSize(l):null;a&&a!==r&&y&&!/^\s*$/.test(y)&&(a.value=y)}})}(e),function(e){e.toolbar.Dialog_foreColorStyle=e.toolbar.Dialog.extend({multiselect:!0,_serialize:function _serialize(){for(var e={},t=this.container.querySelectorAll("[data-wysihtml-dialog-field]"),r=t.length,a=0;a<r;a++)e[t[a].getAttribute("data-wysihtml-dialog-field")]=t[a].value;return e},_interpolate:function _interpolate(t){for(var r,a,s=e.quirks.styleParser,l=document.querySelector(":focus"),y=this.container.querySelectorAll("[data-wysihtml-dialog-field]"),w=y.length,E=0,S=this.elementToChange?e.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,T=S?S.getAttribute("style"):null,O=T?s.parseColor(T,"color"):null;E<w;E++)(r=y[E])!==l&&(t&&"hidden"===r.type||"color"===r.getAttribute("data-wysihtml-dialog-field")&&(a="hex"===(a=(r.dataset.colormode||"rgb").toLowerCase())?"hash":a,r.value=O?s.unparseColor(O,a):s.unparseColor([0,0,0],a)))}})}(e),function(e){var t=e.dom,r={position:"relative"},a={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},s={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},l={"x-webkit-speech":"",speech:""};e.toolbar.Speech=function(y,w){var E=document.createElement("input");if(e.browser.supportsSpeechApiOn(E)){var S=y.editor.textarea.element.getAttribute("lang");S&&(l.lang=S);var T=document.createElement("div");e.lang.object(a).merge({width:w.offsetWidth+"px",height:w.offsetHeight+"px"}),t.insert(E).into(T),t.insert(T).into(w),t.setStyles(s).on(E),t.setAttributes(l).on(E),t.setStyles(a).on(T),t.setStyles(r).on(w);var O="onwebkitspeechchange"in E?"webkitspeechchange":"speechchange";t.observe(E,O,(function(){y.execCommand("insertText",E.value),E.value=""})),t.observe(E,"click",(function(e){t.hasClass(w,"wysihtml-command-disabled")&&e.preventDefault(),e.stopPropagation()}))}else w.style.display="none"}}(e),function(e){var t="wysihtml-command-disabled",r="wysihtml-commands-disabled",a="wysihtml-command-active",s="wysihtml-action-active",l=e.dom;function getCommandState(t,r){var a=t.commands.state(r.name,r.value);return!r.dialog.multiselect&&e.lang.object(a).isArray()&&(a=1!==a.length||a[0]),a}e.toolbar.Toolbar=e.Base.extend({constructor:function constructor(l,y,w){this.editor=l,this.container="string"==typeof y?document.getElementById(y):y,this.composer=l.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),w&&this.show(),null!=l.config.classNameCommandDisabled&&(t=l.config.classNameCommandDisabled),null!=l.config.classNameCommandsDisabled&&(r=l.config.classNameCommandsDisabled),null!=l.config.classNameCommandActive&&(a=l.config.classNameCommandActive),null!=l.config.classNameActionActive&&(s=l.config.classNameActionActive);for(var E=this.container.querySelectorAll("[data-wysihtml-command=insertSpeech]"),S=E.length,T=0;T<S;T++)new e.toolbar.Speech(this,E[T])},_getLinks:function _getLinks(t){for(var r,a,s,l,y,w,E=this[t+"Links"]=e.lang.array(this.container.querySelectorAll("[data-wysihtml-"+t+"]")).get(),S=E.length,T=0,O=this[t+"Mapping"]={};T<S;T++)s=(r=E[T]).getAttribute("data-wysihtml-"+t),l=r.getAttribute("data-wysihtml-"+t+"-value"),w=r.getAttribute("data-wysihtml-"+t+"-blank-value"),a=this.container.querySelector("[data-wysihtml-"+t+"-group='"+s+"']"),y=this._getDialog(r,s),O[s+":"+l]={link:r,group:a,name:s,value:l,tracksBlankValue:w,dialog:y,state:!1}},_getDialog:function _getDialog(t,r){var a,s,l=this,y=this.container.querySelector("[data-wysihtml-dialog='"+r+"']");return y&&((a=e.toolbar["Dialog_"+r]?new e.toolbar["Dialog_"+r](t,y):new e.toolbar.Dialog(t,y)).on("show",(function(){s=l.composer.selection.getBookmark(),l.editor.fire("show:dialog",{command:r,dialogContainer:y,commandLink:t})})),a.on("save",(function(e){s&&l.composer.selection.setBookmark(s),l._execCommand(r,e),l.editor.fire("save:dialog",{command:r,dialogContainer:y,commandLink:t}),l._hideAllDialogs(),l._preventInstantFocus(),s=void 0})),a.on("cancel",(function(){s&&l.composer.selection.setBookmark(s),l.editor.fire("cancel:dialog",{command:r,dialogContainer:y,commandLink:t}),s=void 0,l._preventInstantFocus()})),a.on("hide",(function(){l.editor.fire("hide:dialog",{command:r,dialogContainer:y,commandLink:t}),s=void 0}))),a},execCommand:function execCommand(e,t){this.commandsDisabled||this._execCommand(e,t)},_execCommand:function _execCommand(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function execAction(e){var t=this.editor;"change_view"===e&&(t.currentView===t.textarea||"source"===t.currentView?t.fire("change_view","composer"):t.fire("change_view","textarea")),"showSource"==e&&t.fire("showSource")},_observe:function _observe(){for(var t=this,a=this.editor,s=this.container,y=this.commandLinks.concat(this.actionLinks),w=y.length,E=0;E<w;E++)"A"===y[E].nodeName?l.setAttributes({href:"javascript:;",unselectable:"on"}).on(y[E]):l.setAttributes({unselectable:"on"}).on(y[E]);if(l.delegate(s,"[data-wysihtml-command], [data-wysihtml-action]","mousedown",(function(e){e.preventDefault()})),l.delegate(s,"[data-wysihtml-command]","click",(function(e){var r,a=this.getAttribute("data-wysihtml-command"),s=this.getAttribute("data-wysihtml-command-value"),l=t.commandMapping[a+":"+s];s||!l.dialog?t.execCommand(a,s):(r=getCommandState(t.composer,l),l.dialog.show(r)),e.preventDefault()})),l.delegate(s,"[data-wysihtml-action]","click",(function(e){var r=this.getAttribute("data-wysihtml-action");t.execAction(r),e.preventDefault()})),a.on("interaction:composer",(function(e){t.preventFocus||t._updateLinkStates()})),this._ownerDocumentClick=function(r){e.dom.contains(t.container,r.target)||e.dom.contains(t.composer.element,r.target)||(t._updateLinkStates(),t._preventInstantFocus())},this.container.ownerDocument.addEventListener("click",this._ownerDocumentClick,!1),this.editor.on("destroy:composer",this.destroy.bind(this)),this.editor.config.handleTables){var S=t.container.querySelectorAll('[data-wysihtml-hiddentools="table"]');a.on("tableselect:composer",(function(){S.length&&(S[0].style.display="")})),a.on("tableunselect:composer",(function(){S.length&&(S[0].style.display="none")}))}a.on("change_view",(function(e){setTimeout((function(){t.commandsDisabled="composer"!==e,t._updateLinkStates(),t.commandsDisabled?l.addClass(s,r):l.removeClass(s,r)}),0)}))},destroy:function destroy(){this.container.ownerDocument.removeEventListener("click",this._ownerDocumentClick,!1)},_hideAllDialogs:function _hideAllDialogs(){var e=this.commandMapping;for(var t in e)e[t].dialog&&e[t].dialog.hide()},_preventInstantFocus:function _preventInstantFocus(){this.preventFocus=!0,setTimeout(function(){this.preventFocus=!1}.bind(this),0)},_updateLinkStates:function _updateLinkStates(){var e,r,y,w,E,S=this.commandMapping,T=this.composer,O=this.actionMapping;for(e in S)w=S[e],this.commandsDisabled?(r=!1,l.removeClass(w.link,a),w.group&&l.removeClass(w.group,a),w.dialog&&w.dialog.hide()):(r=this.composer.commands.state(w.name,w.value),l.removeClass(w.link,t),w.group&&l.removeClass(w.group,t)),(w.state!==r||w.tracksBlankValue)&&(w.state=r,r?w.tracksBlankValue?l.removeClass(w.link,a):(l.addClass(w.link,a),w.group&&l.addClass(w.group,a),!w.dialog||void 0!==w.value&&null!==w.value||(r&&"object"===_typeof(r)?(r=getCommandState(T,w),w.state=r,E=!!w.dialog.container.dataset&&w.dialog.container.dataset.showdialogonselection,T.config.showToolbarDialogsOnSelection||E?w.dialog.show(r):w.dialog.update(r)):w.dialog.hide())):w.tracksBlankValue?l.addClass(w.link,a):(l.removeClass(w.link,a),w.group&&l.removeClass(w.group,a),w.dialog&&!w.value&&w.dialog.hide()));for(e in O)"change_view"===(y=O[e]).name&&(y.state=this.editor.currentView===this.editor.textarea||"source"===this.editor.currentView,y.state?l.addClass(y.link,s):l.removeClass(y.link,s))},show:function show(){this.container.style.display=""},hide:function hide(){this.container.style.display="none"}}),e.Editor.prototype.defaults.toolbar=void 0,e.Editor.prototype.defaults.showToolbarAfterInit=!0,e.Editor.prototype.defaults.showToolbarDialogsOnSelection=!0,e.extendEditor((function(t){t.config.toolbar&&(t.toolbar=new e.toolbar.Toolbar(t,t.config.toolbar,t.config.showToolbarAfterInit),t.on("destroy:composer",(function(){t&&t.toolbar&&t.toolbar.destroy()})))}))}(e),e}.apply(t,a))||(e.exports=s)},,,,,,,,,,,,,function(e,t,r){"use strict";r.r(t),r.d(t,"addTo",(function(){return addTo}));var a=r(0),s=r.n(a),l=["DIV","P","PRE"];var y={getBlockElementsInSelection:function getBlockElementsInSelection(e){var t=e.selection.findNodesInSelection(l);if(t.length>0)return t;for(var r=e.selection.contain,a=e.selection.getRange(),s=a&&a.commonAncestorContainer;s&&s!==r;){var y=s,w=y.nodeName;if(y.nodeType===Node.ELEMENT_NODE&&l.indexOf(w)>=0){t.push(s);break}s=s.parentNode}return t},getRootElement:function getRootElement(e){return e.selection.contain},getTextDirection:function getTextDirection(e){return getComputedStyle(e).getPropertyValue("direction")}},w=r(32),E=r(1),S=r.n(E),T=r(195),O=["ArrowUp",37],N=["ArrowDown",38],A=["ArrowLeft",39],L=["ArrowRight",40],R=[].concat(O,N,A,L),D=["Backspace",8],M="lrn_active",B=function installTo(e){e.plugins.add("codeEditorWidget",e.plugins.get("widget").extend({init:function init(e){var t=this;this.setFocusToPotentialEditor=s.a.debounce(this.setFocusToPotentialEditor,1),e.on("htmlUpdated",(function(r){var a="insertHTML"===r.command;T.a.render({autofocus:a},e).forEach((function(r){t.listenToCodeMirrorEvents(r,e)}))})),this.processWrapperElementKeydown(e)},listenToCodeMirrorEvents:function listenToCodeMirrorEvents(e,t){var r=this,a=e.$el,s=e.instance;s.on("focus",(function(e,l){a.addClass(M),r._focusableCodeEditor=s,t.fire("codeEditor:focus")})),s.on("blur",(function(){a.removeClass(M),t.fire("codeEditor:blur"),r._focusableCodeEditor=null})),s.on("keydown",(function(e,r){var l=r.code||r.keyCode,y=s.getCursor().line;if(r.stopPropagation(),0===y&&O.includes(l)?(a.prev("*").length||a.before("<p><br/></p>"),t.composer.selection.setBefore(a.get(0))):y===s.lineCount()-1&&N.includes(l)&&(a.next("*").length||a.after("<p><br/></p>"),t.composer.selection.setAfter(a.get(0))),D.includes(l)){var w=e.getValue().trim(),E=(e.__previousValue||"").trim(),S=e.__previousCursorLine;w||E||e.getCursor().line||S||(t.composer.selection.setBefore(a.get(0)),T.a.remove(e))}})),s.display.input.textarea.setAttribute("tabindex","-1")},processWrapperElementKeydown:function processWrapperElementKeydown(e){var t=this;e.editableElement.addEventListener("keydown",(function(r){var a=e.composer;if(!t._focusableCodeEditor){var s=r.code||r.keyCode;R.includes(s)&&(t._currentCaretNode=t.getOuterNodeAtCaret(a),t.setFocusToPotentialEditor(s,a))}}))},setFocusToPotentialEditor:function setFocusToPotentialEditor(e,t){var r=this.getOuterNodeAtCaret(t),a=this._currentCaretNode;if(a&&r!==a){var s,l=t.selection,y=!0;if(N.includes(e)||L.includes(e)&&l.caretIsFirstInSelection()?s=a.nextSibling:(O.includes(e)||A.includes(e)&&l.caretIsInTheEndOfNode())&&(s=a.previousSibling,y=!1),s&&"codeEditorWidget"===s.getAttribute("data-lrn-wysihtml-widget")){var w=T.a.getInstanceFromNode(s);w&&(w.focus(),w.setCursor(y?0:w.lineCount(),0))}}else this._focusableCodeEditor=null},getOuterNodeAtCaret:function getOuterNodeAtCaret(t){var r=t.selection.getCaretNode();return!!r&&e.findOuterBlock(r,t.element)},parse:function parse(e){return T.a.parse(e)},getWidgetDataContent:function getWidgetDataContent(e,t,r){return T.a.getData(t)},setDisabled:function setDisabled(e,t){T.a.getAllInstances(e.element).forEach((function(e){e.setOption("readOnly",t)}))},hasCodeEditorFocus:function hasCodeEditorFocus(e){return!!T.a.getFocusEditorInstance(e.element)},handleUndo:function handleUndo(e,t){var r=T.a.getFocusEditorInstance(e.element);return r&&!t&&r.undo(),!!r},handleRedo:function handleRedo(e,t){var r=T.a.getFocusEditorInstance(e.element);return r&&!t&&r.redo(),!!r},handleCopy:function handleCopy(e){return this.hasCodeEditorFocus(e)},handlePaste:function handlePaste(e){return this.hasCodeEditorFocus(e)},handleDrop:function handleDrop(e){return this.hasCodeEditorFocus(e)},handleDeleteKeyPress:function handleDeleteKeyPress(e,t){var r=e.selection,a=this.getOuterNodeAtCaret(e);if(a&&r.caretIsInTheEndOfNode()&&a.nextElementSibling&&"codeEditorWidget"===a.nextElementSibling.getAttribute("data-lrn-wysihtml-widget")){var l=T.a.getInstanceFromNode(a.nextElementSibling);if(!s.a.isEmpty(l.getValue()))return t.preventDefault(),t.stopPropagation(),!0}return!!T.a.getFocusEditorInstance(e.element)},handleBackspaceKeyPress:function handleBackspaceKeyPress(e,t){var r=e.selection,a=this.getOuterNodeAtCaret(e);if(a&&r.caretIsFirstInSelection()&&a.previousElementSibling&&"codeEditorWidget"===a.previousElementSibling.getAttribute("data-lrn-wysihtml-widget")){var l=T.a.getInstanceFromNode(a.previousElementSibling);return t.preventDefault(),t.stopPropagation(),s.a.isEmpty(l.getValue())&&T.a.remove(l),!0}return!!T.a.getFocusEditorInstance(e.element)},handleSelectAllShortcut:function handleSelectAllShortcut(e){return this.hasCodeEditorFocus(e)},handleShortcut:function handleShortcut(e){return this.hasCodeEditorFocus(e)},additionalCleanBeforePaste:function additionalCleanBeforePaste(e,t){var r=t.composer.selection.getRange();if(r&&r.endContainer&&S()(r.endContainer).closest('[data-lrn-wysihtml-widget="codeEditorWidget"]').length)return"";var a=S()("<div />").html(e),s=a.find('[data-lrn-wysihtml-widget="codeEditorWidget"]');return s.length?(s.each((function(){var e=S()(this),t=T.a.getData(e.get(0));e.replaceWith(t)})),a.html()):e}}))},q=w.a.isRtl();var W={installTo:function attachCommands(e){e.commands.textDirectionLtr=function textDirectionLtr(e){return{exec:function exec(e){y.getBlockElementsInSelection(e).forEach((function(e){"ltr"!==e.direction&&e.removeAttribute("style"),q?e.dir="ltr":e.removeAttribute("dir")}))},state:function state(e){var t=y.getBlockElementsInSelection(e)[0]||y.getRootElement(e);return"ltr"===y.getTextDirection(t)}}}(),e.commands.textDirectionRtl=function textDirectionRtl(e){return{exec:function exec(e){y.getBlockElementsInSelection(e).forEach((function(e){"rtl"!==e.direction&&e.removeAttribute("style"),q?e.removeAttribute("dir"):e.dir="rtl"}))},state:function state(e){var t=y.getBlockElementsInSelection(e)[0]||y.getRootElement(e);return"rtl"===y.getTextDirection(t)}}}(),e.commands.increaseIndent=function increaseIndent(e){return{exec:function exec(e){y.getBlockElementsInSelection(e).forEach((function(e){var t="rtl"===y.getTextDirection(e),r=(t?e.style.marginRight:e.style.marginLeft)||"0px";r=parseInt(r,10),r+=40,t?e.style.marginRight="".concat(r,"px"):e.style.marginLeft="".concat(r,"px")}))},state:function state(){return!1}}}(),e.commands.decreaseIndent=function decreaseIndent(e){return{exec:function exec(e){y.getBlockElementsInSelection(e).forEach((function(e){var t="rtl"===y.getTextDirection(e),r=(t?e.style.marginRight:e.style.marginLeft)||"0px";r=parseInt(r,10),(r=Math.max(0,r-40))?t?e.style.marginRight="".concat(r,"px"):e.style.marginLeft="".concat(r,"px"):e.style.removeProperty(t?"margin-right":"margin-left")}))},state:function state(){return!1}}}(),e.commands.removeFormat=function removeFormat(e){return{exec:function exec(t){var r=e.commands.formatInline.remove;[{nodeName:"STRONG"},{nodeName:"B"},{nodeName:"I"},{nodeName:"U"},{nodeName:"SMALL"},{nodeName:"SUB"},{nodeName:"SUP"},{nodeName:"CODE"},{nodeName:"PRE"},{nodeName:"S"}].forEach((function(e){r(t,void 0,e)}))},state:function state(){return!1}}}(e),e.commands.deleteTable={exec:function exec(e,t,r){var a=r||e.tableSelection.table;a&&a.parentNode.removeChild(a)},state:function state(){return!1}},e.commands.codeEditor=function codeEditorCommand(e){return{exec:function exec(e){var t=S()('<div data-lrn-wysihtml-widget="codeEditorWidget" contenteditable="false" />');e.commands.exec("insertHTML",t.get(0).outerHTML)},state:function state(e){return!1}}}(),e.commands.codeInline=function codeInline(e){var t={nodeName:"CODE",toggle:!0};return{exec:function exec(r,a){e.commands.formatInline.exec(r,a,t)},state:function state(r,a){return e.commands.formatInline.state(r,a,t)}}}(e)}},j="[data-wysihtml-dropdown]",H='[data-wysihtml-dropdown-component="toggle"]',V='[data-wysihtml-dropdown-component="options"]',z='[data-wysihtml-dropdown-component="option"]',U='[data-wysihtml-dropdown-component="option"].wysihtml-dropdown-highlight',G="wysihtml-dropdown",K="wysihtml-dropdown-toggle",$="wysihtml-dropdown-options",Q="wysihtml-dropdown-title",Y="wysihtml-dropdown-active",X="wysihtml-non-default-selected",Z="wysihtml-dropdown-highlight",J="data-wysihtml-dropdown",ee='data-wysihtml-dropdown-component="toggle"',te='data-wysihtml-dropdown-component="options"',ne='data-wysihtml-dropdown-component="option"',re="data-wysihtml-dropdown-value",ie=27,oe=13,ae=32,se=38,le=40,ce=[];var ue={installTo:function addDropdownPlugin(e){e.plugins.add("dropdown",{preserveDefaultSelection:!1,selectableDefaultSelection:!0,createContentOnOpen:!1,dataUpdatedRequired:!1,init:function init(e,t){this.base(e),this.editor.on("load",s.a.bind((function(){this.render(),this.attachEvents()}),this)),t&&s.a.isBoolean(t.preserveDefaultSelection)&&(this.preserveDefaultSelection=t.preserveDefaultSelection)},render:function render(){var e=S()(this.editor.toolbar.container).find('[data-wysihtml-dropdown="'.concat(this.pluginName,'"]'));this.$el=e,this.setup(e.get(0))},attachEvents:function attachEvents(){var t=this,r=e.dom.delegate,a=this.editor.toolbar.container,l="["+J+'="'+this.pluginName+'"] ';this.$doc=S()(this.editor.composer.doc),this.$toolbarContainer=S()(a),this.onDocumentClick=this.onDocumentClick.bind(this),this.onKeydown=this.onKeydown.bind(this),r(a,l+H,"mousedown",s.a.bind(this.onMouseDown,this)),r(a,l+H,"click",s.a.bind(this.onToggleDropdowns,this)),r(a,z,"mousedown",s.a.bind(this.onMouseDown,this)),r(a,l+z,"click",s.a.bind(this.onSelectOption,this)),this.editor.__isAttachingBaseDropdownEvent||(this.editor.__isAttachingBaseDropdownEvent=!0,this.editor.on("interaction:composer",this.onEditorInteractionComposer.bind(this)),s.a.defer((function(){delete t.editor.__isAttachingBaseDropdownEvent})))},setup:function setup(e){var t,r,a=S()(e),s=!this.createContentOnOpen||this.createContentOnOpen&&this.isShowing;this.dataUpdatedRequired&&(this._hasRemovedDefaultOption=!1),t=!this.selectableDefaultSelection&&!this._hasRemovedDefaultOption,a.addClass(G),this._buildToggle(a),r=this._buildList(a,this.subTitle),s&&this._buildOptions(r),this.subTitle&&r.prepend('<div class="'.concat(Q,'">').concat(this.subTitle,"</div>")),t&&this._removeDefaultSelectionOption(r),this.dataUpdatedRequired=!1},_buildToggle:function _buildToggle(e){var t,r,a=this.options||{},s=a.title,l=e.find(H);return l.length||(t=a.toggleClass?K+" "+this.options.toggleClass:K,r='<button class="'.concat(t,'" ').concat(ee,"></button>"),l=S()(r),s&&l.attr("title",s),this.data&&this.data.defaultSelection&&l.text(this.data.defaultSelection.name),e.append(l)),l},_buildList:function _buildList(e,t){var r,a=e.find(V);return a.length||(r='<div class="'.concat($,'" ').concat(te,"></div>"),a=S()(r),e.append(a)),a},_buildOptions:function _buildOptions(e){var t,r,a=this;return this.dataUpdatedRequired&&e.empty(),(t=e.find(z)).length||(r="",s.a.each(this.data,(function(e,t){r+=a.buildOptionTemplate(e,t)})),e.prepend(r)),t},_removeDefaultSelectionOption:function _removeDefaultSelectionOption(e){var t=e.find(z);t.length&&(t.first().remove(),this._hasRemovedDefaultOption=!0)},buildOptionTemplate:function buildOptionTemplate(e,t){var r=e.textClassName?'class="'.concat(e.textClassName,'"'):"",a="<span ".concat(r,">").concat(e.name,"</span>"),s="".concat(ne," ").concat(re,'="').concat(t,'"'),l=e.optionClassName?'class="'.concat(e.optionClassName,'"'):"";return"<button ".concat(l," ").concat(s,">").concat(a,"</button>")},onMouseDown:function onMouseDown(e){e.preventDefault()},onDocumentClick:function onDocumentClick(e){this.reset(e)},onKeydown:function onKeydown(e){var t,r,a=e.keyCode,s=e.data.$dropdown;return a===ie?this.reset():a===oe||a===ae?(t=s.find(U)).length&&(this.onSelectOption({target:t[0],preventDefault:e.preventDefault.bind(e)}),this.reset()):a!==se&&a!==le||s&&((t=s.find(U)).removeClass(Z),a===se?(r=t.prev(z)).length||(r=s.find(z+":last-child")):(r=t.next(z)).length||(r=s.find(z+":first-child")),r.addClass(Z)),e.preventDefault(),!1},onToggleDropdowns:function onToggleDropdowns(e){var t=S()(e.target),r=t.closest(j);e.preventDefault(),this.$toogleButton=t,r.hasClass(Y)?this.reset():(e.stopPropagation(),this.onDropdownOpen(r))},onDropdownOpen:function onDropdownOpen(e){S()(this.editor.editableElement);var t,r=this.$doc;this.areAllDropdownClosed()||this.reset(),this.isShowing=!0,this.createContentOnOpen&&this.setup(e[0]),r.off("click",this.onDocumentClick),r.on("click",this.onDocumentClick),e.addClass(Y),this.positionDropdownList(e),ce.push(e),t=e.find(H).text(),e.find(z).each((function(){var e=S()(this),r=e.text()===t;e.toggleClass(Z,r)})),r.off("keydown",this.onKeydown).on("keydown",{$dropdown:e},this.onKeydown)},positionDropdownList:function positionDropdownList(e){},reset:function reset(){delete this.isShowing,this.$doc.off("click",this.onDocumentClick).off("keydown",this.onKeydown),S()(this.editor.editableElement).off("keydown",this.onKeydown),ce.forEach((function(e){e.removeClass(Y)})),ce=[]},areAllDropdownClosed:function areAllDropdownClosed(){return!ce.length},onSelectOption:function onSelectOption(e){var t=S()(e.target);e.preventDefault(),t.is(z)||(t=t.closest(z)),t.text()!==S()(this.$toggleButton).text()?S()(this.$toggleButton).closest(j).addClass(X):S()(this.$toggleButton).closest(j).removeClass(X),this.preserveDefaultSelection||this.$toogleButton.text(t.text()),delete this.$toogleButton,this.editor.fire(this.pluginName+":select",{value:t.attr(re)})},onEditorInteractionComposer:function onEditorInteractionComposer(){var e=this.$toolbarContainer.find(j),t=this;e.each((function(){var e,r=S()(this).attr(J);r&&(e=t.editor.plugins[r])&&s.a.isFunction(e.updateDropdownSelection)&&e.updateDropdownSelection(this)}))},setValue:function setValue(e){var t,r,a=this.getProcessedData(),s=this.$toolbarContainer.find("["+J+'="'+this.pluginName+'"]'),l=s.find(H);a&&e?(t=a[e])&&(r=t.name,l.closest(j).addClass(X)):(r=s.find(V).find(z).first().text(),l.closest(j).removeClass(X)),this.preserveDefaultSelection||l.text(r)},getProcessedData:function getProcessedData(){var e=this.editor.i18n;return this._processedData||(this._processedData=s.a.extend({},this.defaultData),e&&e[this.pluginName]&&(this._processedData=s.a.merge(this._processedData,e[this.pluginName].selection))),this._processedData},updateDropdownSelection:function updateDropdownSelection(e){}})}},de=".wysihtml-dropdown-highlight",he='[data-wysihtml-dropdown-component="option"]',pe='[data-wysihtml-dropdown-component="options"]',fe="wysihtml-dropdown-highlight",me=9,ge=27,ye=13,ve=32,be=37,we=39;var _e,Ce={installTo:function addCharacterMapDropdown(e){e.plugins.add("charactermap",e.plugins.get("dropdown").extend({preserveDefaultSelection:!0,selectableDefaultSelection:!1,init:function init(e,t){var r=t.data,a=t.defaultSelection,s=t.subTitle;this.data=this._buildDropdownData(r,a),this.subTitle=s,this.base(e,t)},attachEvents:function attachEvents(){this.base(),this.editor.on(this.pluginName+":select",this.processValue.bind(this))},_buildDropdownData:function _buildDropdownData(e,t){var r={defaultSelection:{name:t}};return s.a.each(e,(function(e){return r[e]={name:e}})),r},processValue:function processValue(e){if(e.value){var t=this.editor,r=function performInsertion(){t.composer.commands.exec("insertHTML",e.value),t.off("focus",performInsertion)};document.activeElement!==t.editableElement?(t.on("focus",r),t.focus(!1)):r()}},positionDropdownList:function positionDropdownList(e){var t,r,a,s=S()(this.editor.editableElement),l=s.outerWidth(),y=e.find(pe);y.width()>l?y.width(l):y.css("width","");var w=y.outerWidth(),E=w/2;y.css("left","-".concat(E,"px")),y.offset().left<0&&y.css("left",0),(a=y.offset().left+w-s.offset().left-l)>0&&y.css("left","-".concat(E+a,"px")),(t=y.offset().left)<0&&(r=parseInt(y.css("left"),10),y.css("left","".concat(r-t,"px")))},onDropdownOpen:function onDropdownOpen(e){var t=fe;this.base(e),e.find(he).removeClass(t).first().focus().addClass(t)},onKeydown:function onKeydown(e){var t=e.keyCode,r=e.data.$dropdown;return t===ye||t===ge||t===ve?this.base(e):(e.preventDefault(),t===be?this._highlightPreviousKey(r):t===we?this._highlightNexKey(r):t===me&&(e.shiftKey?this._highlightPreviousKey(r):this._highlightNexKey(r)),!1)},_highlightPreviousKey:function _highlightPreviousKey(e){var t=e.find(de);if(e.find(he).index(t)>0){var r=fe;t.removeClass(r).prev().focus().addClass(r)}},_highlightNexKey:function _highlightNexKey(e){var t=e.find(de);if(e.find(he).index(t)<e.find(he).length-1){var r=fe;t.removeClass(r).next().focus().addClass(r)}}}))}},xe=r(212),Ee="data-lrn-wysihtml-widget",Se="data-lrn-wysihtml-widget-display-type",Te="data-lrn-wysihtml-widget-id",ke="data-lrn-wysihtml-widget-data",Oe={WIDGET:"["+Ee+"]",ALL_WIDGETS:"["+Ee+"]:not(["+Ee+'="widget"])',WIDGET_ID:"["+Te+"]",WIDGET_MOCK_DISPLAY_CONTENT:"[data-lrn-wysihtml-widget-mock-content]"},Ne="lrn-wysihtml-widget",Pe="lrn-wysihtml-widget-active",Ae="lrn-wysihtml-no-selection",Le=["DIV","LI","UL","P"],Re=xe.a.hasFormatting,Ie=0;var De={installTo:function addWidgetPlugin(e){e.plugins.add("widget",{draggable:!0,className:void 0,init:function init(t){var r,a,l,y=function doParse(e,r){return s.a.each(r,(function(r){"function"==typeof r.parse&&(e=r.parse(e,t))})),e};this.base(t),this.attachEvents(),_e||(r=e.Selection.prototype.insertHTML,e.Selection.prototype.insertHTML=function(e){e=y(e,this.editor.plugins),r.call(this,e),this.editor.fire("htmlUpdated",{html:e,command:"insertHTML"})},l=e.Editor.prototype.setValue,e.Editor.prototype.setValue=function(e,t){e=y(e,this.plugins),l.call(this,e,t),this.fire("htmlUpdated",{html:e,command:"setValue"})},a=e.Editor.prototype.getValue,e.Editor.prototype.getValue=function(e,t,r){var l=this,y=l.plugins,w=S()("<div>"+a.call(this,e,t)+"</div>"),E=[];w.find(Oe.ALL_WIDGETS).each((function(){var e=this.getAttribute(Ee),t=l.plugins[e].getWidgetDataContent(l,this);E.push({oldValue:this.outerHTML,newValue:t})}));var T=w.html();return s.a.each(E,(function(e){T=T.replace(e.oldValue,e.newValue)})),s.a.each(y,(function(a){s.a.isFunction(a.sanitizeGetValue)&&(T=a.sanitizeGetValue(T,s.a.extend({parse:e,clearInternals:t},r)))})),T},_e=!0)},parse:function parse(t){var r,a,l=this,y=this.editor.composer.doc,w=this.editor.plugins,E=S()("<div></div>").html(t),T=this.className;return e.dom.removeEmptyTextNodes(E[0]),s.a.each(w,(function(t,w){a=Oe.WIDGET+" "+(r="["+ke+'="'+w+'"]'),E.find(r).not(a).each((function(){var r,a=S()(this),E=a.css("display"),O=t.uniqueId(),N="block"===E||""===E&&s.a.contains(Le,this.tagName);t.contents||(t.contents={}),t.contents[O]=t.getWidgetDataContent(l.editor,this,N),N?a.wrap("<div></div>"):a.wrap("<span></span>"),(r=a.parent()).addClass(Ne).addClass(T).attr(Ee,w).attr(Te,O).attr(Se,N?"block":"inline").attr("contenteditable",!1),N?(r.is(":last-child")&&r.before("<p><br></p>").after("<p><br></p>"),r.wrap('<div class="'+Ae+'"></div>')):r.before(y.createTextNode(e.INVISIBLE_SPACE)).after(y.createTextNode(e.INVISIBLE_SPACE))}))})),E.html()},getWidgetDataContent:function getWidgetDataContent(e,t){var r,a,s,l=y.closest(Oe.WIDGET),y=S()(t);return l.length&&(r=l.attr(Ee),a=l.attr(Te),(s=e.plugins[r]).contents)?s.contents[a]:((y=y.clone()).find(Oe.WIDGET_MOCK_DISPLAY_CONTENT).remove(),y.html())},refresh:function refresh(){var e=this.editor.getValue(!1);this.editor.setValue(e,!1),this.editor.focus(),this.editor.fire(this.pluginName+":refresh")},uniqueId:function uniqueId(e){var t=++Ie+"";return e?e+t:t},attachEvents:function attachEvents(){var t=e.dom.delegate,r=this.editor.editableElement,a="["+Ee+'="'+this.pluginName+'"]';this.$editableElement=S()(r),this.editor._isAttachingBaseWidgetEvents||(this.editor._isAttachingBaseWidgetEvents=!0,this.editor.on(this.pluginName+":setData",s.a.bind(this.onWidgetSetData,this)),this.editor.on("blur",s.a.bind(this.onEditorBlur,this)),this.editor.on("paste",s.a.bind(this.onEditorPaste,this)),this.$editableElement.on("keydown",s.a.bind(this.onKeyDown,this)),this.$editableElement.on("click",s.a.bind(this.onEditableElementClick,this)),t(r,a,"click",s.a.bind(this.onWidgetMouseClick,this)),t(r,a,"dblclick",s.a.bind(this.onWidgetDoubleClick,this)),t(r,a+Oe.WIDGET,"dragstart",s.a.bind(this.onWidgetDragStart,this)),this.$editableElement.on("drop",s.a.bind(this.onDrop,this)),this.$editableElement.on("dragend",s.a.bind(this.onDragEnd,this)),this.observeFormattingMutations(),delete this.editor._isAttachingBaseWidgetEvents)},onKeyDown:function onKeyDown(e){this.resetActiveElement()},onEditableElementClick:function onEditableElementClick(e){this.resetActiveElement()},onWidgetMouseClick:function onWidgetMouseClick(e){var t,r,a=this.editor.composer.selection;if(this.$editableElement.is(":focus")||this.editor.focus(),this.$activeElement=S()(e.target),this.$activeElement.is(Oe.WIDGET)||(this.$activeElement=this.$activeElement.closest(Oe.WIDGET)),this.$activeElement.addClass(Pe),this.$activeElement.length){var s=this.$activeElement[0];"inline"===this.$activeElement.attr(Se)?(a.selectNode(s),(r=a.getRange()).setStartBefore&&r.setEndAfter&&(r.setStartBefore(s),r.setEndAfter(s),r.select())):a.selectNode(s.parentNode),t=this.pluginName+":select",this.editor.fire(t,{event:e,eventName:t,pluginName:this.pluginName,data:this.getWidgetDataContent(this.editor,this.$activeElement[0])})}},onWidgetDragStart:function onWidgetDragStart(t){if(!this.draggable)return t.preventDefault(),!1;if(this.$activeElement){var r=this.getWidgetDataContent(this.editor,this.$activeElement[0]);e.browser.isIE()?(t.dataTransfer.clearData("HTML"),t.dataTransfer.setData("Text",r)):(t.dataTransfer.clearData("text/html"),t.dataTransfer.setData("text/plain",r))}},onDrop:function onDrop(e){var t,r,a=e.originalEvent,s=this.editor.composer.doc,l=a.clientX,y=a.clientY,w=s.elementFromPoint(l,y);s.caretPositionFromPoint?((t=document.caretPositionFromPoint(a.clientX,a.clientY)).offsetNode,r=t.offset):s.caretRangeFromPoint&&((t=document.caretRangeFromPoint(a.clientX,a.clientY)).startContainer,r=t.startOffset),this.__dropData={element:w,offset:r}},onDragEnd:function onDragEnd(e){this.$activeElement&&this.refresh(),this.editor.fire(this.pluginName+":dragend",e),this.resetActiveElement(),delete this.__dropData},onWidgetDoubleClick:function onWidgetDoubleClick(e){this.$activeElement&&this.editor.fire(this.pluginName+":dbclick",{event:e,data:this.getWidgetDataContent(this.editor,this.$activeElement[0])})},onWidgetSetData:function onWidgetSetData(e){e.data&&this.$activeElement&&e.data&&(this.$activeElement.replaceWith(e.data),this.refresh())},onEditorBlur:function onEditorBlur(e){this.$editableElement.find(Oe.WIDGET).removeClass(Pe)},onEditorPaste:function onEditorPaste(e){var t=this;s.a.defer((function(){return s()(t.editor.plugins).forEach((function(t){s.a.isFunction(t.afterPaste)&&t.afterPaste(e)}))}))},observeFormattingMutations:function observeFormattingMutations(){var e=this.editor,t=e.plugins,r=e.editableElement;this.mutationObserver=new MutationObserver((function(){var e=r.querySelectorAll(Oe.WIDGET);s()(e).forEach((function(e){var r=e.innerHTML,a=e.getAttribute(Ee),l=t[a];s.a.isFunction(l.handleFormatting)&&Re(r)&&l.handleFormatting(e)}))})),this.mutationObserver.observe(r,{attributes:!1,childList:!0,subtree:!0})},resetActiveElement:function resetActiveElement(){var e=this.pluginName+":unselect";this.$activeElement&&(this.$activeElement.removeClass(Pe),delete this.$activeElement),this.editor.fire(e,{eventName:e,pluginName:this.pluginName})},restoreCaretPosition:function restoreCaretPosition(){var e,t,r,a=this.editor.composer.selection;this.__dropData&&(this.editor.focus(),t=this.__dropData.element,r=this.__dropData.offset,(e=a.createRange()).setStart(t,r),e.setEnd(t,r),e.select())}})}},Me=r(207),Be=Me.default.ATTR,qe=(Me.default.CLASSES,Me.default.PATTERNS,Me.default.SELECTOR),Fe=Me.default.addLatexWrappers,We=Me.default.formatMathJaxRemnants,je=Me.default.stripMathWidgetTags,He=xe.a.stripFormattingTags;var Ve,ze,Ue,Ge={installTo:function addMathWidgetPlugin(e){e.plugins.add("mathWidget",e.plugins.get("widget").extend({afterPaste:function afterPaste(){var e=this.editor,t=this.pluginName,r=e.getValue(!1),a=We(r);a!==r&&(e.setValue(a,!1),e.fire("".concat(t,":paste")))},handleFormatting:function handleFormatting(e){var t=e.innerHTML;e.innerHTML=He(t)},sanitizeGetValue:function sanitizeGetValue(e,t){return s.a.extend({stripMathWidgetTags:!0},t).stripMathWidgetTags?je(e):e},parse:function parse(e,t){var r,a,s=0;return e?(a=S()("<div></div>").html(e),t.plugins[this.pluginName].contents&&(s=t.plugins[this.pluginName].contents.length),(r=a.find(qe.LATEX).length)&&r===s||(e=Fe(e),a=S()("<div></div>").html(e)),a.find(qe.LATEX).attr(Be.WIDGET_DATA,this.pluginName),e=a.html(),e=this.base(e)):e},getWidgetDataContent:function getWidgetDataContent(e,t,r){var a,s,l,y,w,E=S()(t),T=E.closest(qe.WIDGET);return T.length&&(a=T.attr(Be.WIDGET),s=T.attr(Be.WIDGET_ID),(l=e.plugins[a]).contents)?l.contents[s]:((E=E.clone()).find(qe.WIDGET_MOCK_DISPLAY_CONTENT).remove(),w=(w=E.html()).replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<"),(y=E.attr("aria-label"))?r?'<div aria-label="'+y+'">'+w+"</div>":'<span aria-label="'+y+'">'+w+"</span>":w)}}))}},Ke=r(17),$e=r.n(Ke);function addTo(e){(function extendEditor(e){e.extendEditor((function(e){e.saveBookmark=function(){this.__caretBookmark=this.composer.selection.getBookmark()},e.restoreBookmark=function(){this.__caretBookmark&&(this.composer.selection.setBookmark(this.__caretBookmark),delete this.__caretBookmark),this.focus(!1)},e.additionalCleanBeforePaste=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.isCopiedFromWysihtml,l=void 0!==a&&a,y=this.config,w=y.stripExternalPastedImages,E=void 0!==w&&w,S=y.stripExternalPastedMath,T=void 0!==S&&S,O=y.invalidExternalImageWarning,N=void 0===O?"":O,A=y.invalidExternalMathWarning,L=void 0===A?"":A;return l?(s.a.each(this.plugins,(function(r){s.a.isFunction(r.additionalCleanBeforePaste)&&(e=r.additionalCleanBeforePaste(e,t))})),e):$e.a.sanitizePastedContent(e,{attributesBlackList:["align","bgcolor","border","cellpadding","cellspacing","id","class","frame","height","on","rules","style","summary","width"],elementsWhiteList:["b","blockquote","caption","colgroup","br","hr","i","img","li","ol","p","sub","sup","table","tbody","td","tfoot","thead","tr","u","ul"],externalImages:{shouldStrip:E,warning:N},externalMath:{shouldStrip:T,warning:L}})}})),e.Selection.prototype.moveCaretToElementAfter=function(){for(var e=this.getRange(),t=this.getSelectedNode();t&&3===t.nodeType;)t=t.parentNode;t.nextSibling?e.setStartAfter(t.nextSibling):e.setEndAfter(this.contain),e.select()}})(Ue=e),function setupPluginTo(e){e.plugins||(ze=function buildBasePlugin(e){return e.lang.Dispatcher.extend({constructor:function constructor(e,t){this.editor=e,this.options=t,this.init(this.editor,this.options)},init:function init(e,t){}})}(e),e.plugins={add:function add(e,t){(Ve=Ve||{})[e]="function"==typeof t?t:ze.extend(t),Ve[e].prototype.pluginName=e},get:function get(e){return Ve[e]}},e.Editor.prototype.installPlugin=function(e,t){Ve&&!this.plugins&&(this.plugins={}),Ve[e]&&(this.plugins[e]=new Ve[e](this,t))})}(Ue),W.installTo(Ue),ue.installTo(Ue),Ce.installTo(Ue),De.installTo(Ue),Ge.installTo(Ue),B(Ue)}}])]);